# Vulnerability Information: CVE-2021-46848

## Vulnerability Description
GNU Libtasn1 before 4.19.0 has an ETYPE_OK **off-by-one array size check** that affects asn1_encode_simple_der.

### Vulnerability Description Key Phrases
- **rootcause:** **off-by-one array size check**
- **product:** GNU Libtasn1
- **version:** before 4.19.0
- **component:** asn1_encode_simple_der

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-46848:

**1. Verification:**
   - The content explicitly mentions "CVE-2021-46848" and describes an out-of-bounds read issue in `libtasn1`, aligning with the CVE description.

**2. Root Cause of Vulnerability:**
   - The vulnerability stems from an incorrect bound check within the `ETYPE_OK` macro used in the `asn1_encode_simple_der` function of libtasn1. The check was using `<=` instead of `<` when comparing the `etype` value with the size of the `_asn1_tags` array.

**3. Weaknesses/Vulnerabilities Present:**
   - **Out-of-bounds Read:** The flawed bound check allows an attacker to supply an `etype` value that is equal to `_asn1_tags_size`, causing an out-of-bounds read when accessing the `_asn1_tags` array.

**4. Impact of Exploitation:**
    - **Information Disclosure:** Reading out of bounds could lead to the disclosure of sensitive information from memory.
    - **Denial of Service (DoS):** While less likely, a carefully crafted out-of-bounds read could potentially cause a crash or other unexpected behavior, resulting in a denial of service.

**5. Attack Vectors:**
   - The vulnerability is triggered during the encoding of ASN.1 data through the `asn1_encode_simple_der` function. Specifically, the `etype` parameter provided to the function is used in the flawed bounds check.

**6. Required Attacker Capabilities/Position:**
   - **Ability to Control `etype`:** An attacker must be able to control or influence the `etype` value passed to the `asn1_encode_simple_der` function. This implies a position where the attacker is able to provide input to an application using `libtasn1`.
    - No specific privilege level is explicitly mentioned, suggesting the attacker may be an unauthenticated user in some cases.

**Additional details from the content:**
  - The vulnerable code is located in `lib/coding.c` of `libtasn1`, specifically around line 218 of the `asn1_encode_simple_der` function in version 4.16.0.
  - The fix involves changing the check from `(etype) <= _asn1_tags_size` to `(etype) < _asn1_tags_size`.
  - Various distributions like Ubuntu, Fedora, and Debian were affected.
  - Patches or updates for `libtasn1` version 4.19.0 and later contain the fix.
  - NetApp products were analyzed for this vulnerability, and none were found to be affected.
  - A test case to reproduce the crash was provided in one of the documents.

In summary, CVE-2021-46848 is an out-of-bounds read vulnerability in the libtasn1 library due to an off-by-one error in the `ETYPE_OK` macro. This can be exploited by providing a crafted `etype` parameter to `asn1_encode_simple_der`, leading to potential information disclosure or a denial of service.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6393 | dense, sparse, graph | dense: 0.419, sparse: 0.183, graph: 0.909 |
| 2 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6054 | dense, sparse, graph | dense: 0.390, sparse: 0.092, graph: 1.000 |
| 3 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3907 | sparse, graph | sparse: 0.091, graph: 1.000 |
| 4 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.3827 | sparse, graph | sparse: 0.100, graph: 1.000 |
| 5 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3448 | sparse, graph | sparse: 0.081, graph: 0.836 |
| 6 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.3380 | sparse, graph | sparse: 0.087, graph: 0.807 |
| 7 | CWE-839 | Numeric Range Comparison Without Minimum Check | Base | Allowed | 0.3285 | sparse, graph | sparse: 0.081, graph: 0.789 |
| 8 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.2824 | sparse, graph | sparse: 0.075, graph: 0.670 |
| 9 | CWE-129 | Improper Validation of Array Index | Variant | Allowed | 0.2809 | sparse, graph | sparse: 0.077, graph: 0.729 |
| 10 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.2451 | dense, sparse | dense: 0.401, sparse: 0.077 |

