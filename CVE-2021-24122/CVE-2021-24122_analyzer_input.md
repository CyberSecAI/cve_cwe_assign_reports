# Vulnerability Information: CVE-2021-24122

## Vulnerability Description
When serving resources from a network location using the NTFS file system, Apache Tomcat versions 10.0.0-M1 to 10.0.0-M9, 9.0.0.M1 to 9.0.39, 8.5.0 to 8.5.59 and 7.0.0 to 7.0.106 were susceptible to JSP source code disclosure in some configurations. The root cause was the unexpected behaviour of the JRE API File.getCanonicalPath() which in turn was caused by the inconsistent behaviour of the Windows API (FindFirstFileW) in some circumstances.

### Vulnerability Description Key Phrases
- **rootcause:** **unexpected behaviour of the JRE API File.getCanonicalPath() and inconsistent behaviour of the Windows API (FindFirstFileW)**
- **impact:** JSP source code disclosure
- **product:** Apache Tomcat
- **version:** 10.0.0-M1 to 10.0.0-M9 and 9.0.0.M1 to 9.0.39 and 8.5.0 to 8.5.59 and 7.0.0 to 7.0.106

## CVE Reference Links Content Summary
```
Message-ID: <0b682bd8-5aa1-1c74-abf8-5b3cd81c0c85@apache.org>
Date: Thu, 14 Jan 2021 14:22:50 +0000
From: Mark Thomas <markt@...che.org>
To: oss-security@...ts.openwall.com
Subject: [SECURITY] CVE-2021-24122 Apache Tomcat Information Disclosure

CVE-2021-24122 Apache Tomcat Information Disclosure

Severity: Important

Vendor: The Apache Software Foundation

Versions Affected:
Apache Tomcat 10.0.0-M1 to 10.0.0-M9
Apache Tomcat 9.0.0.M1 to 9.0.39
Apache Tomcat 8.5.0 to 8.5.59
Apache Tomcat 7.0.0 to 7.0.106

Description:
When serving resources from a network location using the NTFS file
system it was possible to bypass security constraints and/or view the
source code for JSPs in some configurations. The root cause was the
unexpected behaviour of the JRE API File.getCanonicalPath() which in
turn was caused by the inconsistent behaviour of the Windows API
(FindFirstFileW) in some circumstances.

Mitigation:
Users of the affected versions should apply one of the following
mitigations:
- Upgrade to Apache Tomcat 10.0.0-M10 or later
- Upgrade to Apache Tomcat 9.0.40 or later
- Upgrade to Apache Tomcat 8.5.60 or later
- Upgrade to Apache Tomcat 7.0.107 or later

Credit:
This issue was identified by Ilja Brander.

History:
2021-01-14 Original advisory

References:
[1] <https://tomcat.apache.org/security-10.html>
[2] <https://tomcat.apache.org/security-9.html>
[3] <https://tomcat.apache.org/security-8.html>
[4] <https://tomcat.apache.org/security-7.html>
```
- **Root cause of vulnerability**: The vulnerability is caused by the unexpected behavior of the JRE API `File.getCanonicalPath()`, which is due to the inconsistent behavior of the Windows API `FindFirstFileW` when serving resources from a network location using the NTFS file system.
- **Weaknesses/vulnerabilities present**:
  - Security constraints bypass
  - JSP source code disclosure
- **Impact of exploitation**: An attacker could bypass security constraints and/or view the source code of JSPs
- **Attack vectors**: Serving resources from a network location using the NTFS file system.
- **Required attacker capabilities/position**: The attacker needs to be able to access the Tomcat server which is serving resources from a network location using the NTFS file system.

```
## CVE-2021-24122 Apache Tomcat Vulnerability in NetApp Products
...
#### Summary

Multiple NetApp products incorporate Apache Tomcat. Apache Tomcat versions 7.0.0 through 7.0.106, 8.5.0 through 8.5.59, 9.0.0.M1 through 9.0.39, and 10.0.0-M1 through 10.0.0-M9 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information.

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2021-24122](https://nvd.nist.gov/vuln/detail/CVE-2021-24122) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |
```
- **Root cause of vulnerability**: The vulnerability lies within the Apache Tomcat component incorporated in the NetApp products. (The root cause is the same as the original report, but this is not stated)
- **Weaknesses/vulnerabilities present**: Information disclosure vulnerability.
- **Impact of exploitation**: Disclosure of sensitive information.
- **Attack vectors**: Unspecified, but it's likely the same as the original report, serving resources from a network location.
- **Required attacker capabilities/position**: Unspecified, but it's likely the same as the original report, network access.

```
Debian LTS Advisory DLA-2594-1                debian-lts@lists.debian.org
...
Package        : tomcat8
Version        : 8.5.54-0+deb9u6
CVE ID         : CVE-2021-24122 CVE-2021-25122 CVE-2021-25329

Three security issues have been detected in tomcat8.

CVE-2021-24122

    When serving resources from a network location using the NTFS file system,
    Apache Tomcat versions 8.5.0 to 8.5.59 is susceptible to JSP source code
    disclosure in some configurations. The root cause was the unexpected
    behaviour of the JRE API File.getCanonicalPath() which in turn was caused
    by the inconsistent behaviour of the Windows API (FindFirstFileW) in some
    circumstances.
```
- **Root cause of vulnerability**: The vulnerability is caused by the unexpected behavior of the JRE API `File.getCanonicalPath()`, which is due to the inconsistent behavior of the Windows API `FindFirstFileW` when serving resources from a network location using the NTFS file system.
- **Weaknesses/vulnerabilities present**: JSP source code disclosure
- **Impact of exploitation**: An attacker could view the source code of JSPs
- **Attack vectors**: Serving resources from a network location using the NTFS file system.
- **Required attacker capabilities/position**: The attacker needs to be able to access the Tomcat server which is serving resources from a network location using the NTFS file system.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-41 | Improper Resolution of Path Equivalence | Base | Allowed | 0.9928 | dense, sparse, graph | dense: 0.547, sparse: 0.682, graph: 0.921 |
| 2 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.7769 | dense, sparse, graph | dense: 0.560, sparse: 0.382, graph: 0.779 |
| 3 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.5436 | sparse, graph | sparse: 0.399, graph: 0.882 |
| 4 | CWE-73 | External Control of File Name or Path | Base | Allowed | 0.4163 | sparse, graph | sparse: 0.380, graph: 0.556 |
| 5 | CWE-923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | 0.2917 | dense, sparse | dense: 0.529, sparse: 0.405 |
| 6 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.2798 | dense, sparse | dense: 0.531, sparse: 0.368 |
| 7 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.2179 | sparse | sparse: 0.381 |
| 8 | CWE-204 | Observable Response Discrepancy | Base | Allowed | 0.2173 | sparse | sparse: 0.380 |
| 9 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.2141 | sparse | sparse: 0.374 |
| 10 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.2104 | dense, sparse | dense: 0.518, sparse: 0.368 |

