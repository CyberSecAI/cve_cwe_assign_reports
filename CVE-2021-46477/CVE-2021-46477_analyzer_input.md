# Vulnerability Information: CVE-2021-46477

## Vulnerability Description
Jsish v3.5.0 was discovered to contain a **heap buffer overflow** via RegExp_constructor in src/jsiRegexp.c. This vulnerability can lead to a Denial of Service (DoS).

### Vulnerability Description Key Phrases
- **rootcause:** **off-by-null-byte on heap**
- **weakness:** **heap buffer overflow**
- **impact:** denial of service
- **product:** componentJsish
- **version:** v3.5.0
- **component:** RegExp_constructor in src/jsiRegexp.c

## CVE Reference Links Content Summary
The provided content describes a heap-buffer-overflow vulnerability in the `jsish` project, specifically in the `src/jsiRegexp.c` file at line 176 within the `RegExp_constructor`.

**Root cause of vulnerability:**
The vulnerability is triggered by a crafted sequence of JavaScript calls involving `RegExp.bind` and the `new` operator.  Specifically, when a bound RegExp constructor is invoked with `new`, a heap-buffer-overflow occurs during the constructor execution.

**Weaknesses/vulnerabilities present:**
- Heap-buffer-overflow: A write operation attempts to write data beyond the allocated buffer on the heap.

**Impact of exploitation:**
- The heap-buffer-overflow can lead to memory corruption, potentially allowing an attacker to control the program's execution, which can result in denial of service, arbitrary code execution, or information disclosure.

**Attack vectors:**
- The attack vector involves executing malicious JavaScript code using the vulnerable `jsish` interpreter.
- Specifically, the provided test case demonstrates that the vulnerability is triggered through a specific pattern of calls including `RegExp.bind` and then calling `new` on the bound function.

**Required attacker capabilities/position:**
- The attacker needs to be able to execute arbitrary JavaScript code on a system running a vulnerable version of `jsish`.
- The attacker does not require any special privileges to exploit the vulnerability, only the ability to have the `jsish` interpreter process their malicious code.

**Additional Details:**
- The provided code snippet includes an AddressSanitizer output which pinpoints the exact location of the overflow, the size of the write, and the allocation site, giving valuable insight into the technical nature of the bug.
- The issue was found by the OWL337 team and subsequently fixed.
- The issue is triggered in the `RegExp_constructor` of `jsish`, not a general regular expression vulnerability but specific to how the constructor is used.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.7841 | dense, sparse, graph | dense: 0.526, sparse: 0.339, graph: 0.914 |
| 2 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.6385 | dense, sparse, graph | dense: 0.543, sparse: 0.290, graph: 0.711 |
| 3 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.5255 | sparse, graph | sparse: 0.294, graph: 1.000 |
| 4 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4437 | dense, sparse | dense: 0.543, sparse: 0.365 |
| 5 | CWE-170 | Improper Null Termination | Base | Allowed | 0.4433 | sparse, graph | sparse: 0.282, graph: 0.789 |
| 6 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.4312 | sparse, graph | sparse: 0.245, graph: 0.813 |
| 7 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4264 | dense, sparse | dense: 0.520, sparse: 0.290 |
| 8 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4115 | dense, sparse | dense: 0.503, sparse: 0.279 |
| 9 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4097 | dense, sparse | dense: 0.547, sparse: 0.297 |
| 10 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4052 | dense, sparse | dense: 0.523, sparse: 0.250 |

