# Critic Input for CVE-2022-31122



# Original Analyzer Input
## Vulnerability Description
Wire is an encrypted communication and collaboration platform. Versions prior to 2022-07-12/Chart 4.19.0 are subject to **Token Recipient Confusion**. If an attacker has certain details of SAML IdP metadata, and configures their own SAML on the same backend, the attacker can delete all SAML authenticated accounts of a targeted team, Authenticate as a user of the attacked team and create arbitrary accounts in the context of the team if it is not managed by SCIM. This issue is fixed in wire-server 2022-07-12 and is already deployed on all Wire managed services. On-premise instances of wire-server need to be updated to 2022-07-12/Chart 4.19.0, so that their backends are no longer affected. As a workaround, the risk of an attack can be reduced by disabling SAML configuration for teams (galley.config.settings.featureFlags.sso). Helm overrides are located in `values/wire-server/values.yaml` Note that the ability to configure SAML SSO as a team is disabled by default for on-premise installations.

### Vulnerability Description Key Phrases
- **rootcause:** **Token Recipient Confusion**
- **impact:** delete all SAML authenticated accounts and Authenticate as a user and create arbitrary accounts
- **vector:** certain details of SAML IdP metadata and configure own SAML on same backend
- **attacker:** attacker
- **product:** Wire
- **version:** prior to 2022-07-12/Chart 4.19.0

## CVE Reference Links Content Summary
```
{
  "Root cause of vulnerability": "The vulnerability arises from insufficient validation of SAML IdP metadata, allowing an attacker to manipulate the SAML SSO configuration of a targeted team.",
  "Weaknesses/vulnerabilities present": [
    "SAML IdP metadata confusion leading to unauthorized access and manipulation of accounts."
  ],
  "Impact of exploitation": "An attacker, by exploiting knowledge of SAML IdP metadata, can:\n  1. Delete all SAML authenticated accounts of the targeted team.\n  2. Authenticate as a user from existing accounts of the attacked team (if SAML is used for authentication).\n  3. Create arbitrary accounts within the context of the targeted team (unless managed by SCIM).",
  "Attack vectors": "Network-based attack, where an attacker needs to have knowledge of certain details of the SAML IdP metadata of a target team and also be able to configure SAML SSO for their own team on the same backend.",
   "Required attacker capabilities/position": "The attacker needs to have knowledge of specific details of a target team's SAML IdP metadata and must be able to configure SAML SSO for their own team on the same backend."
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1270 | Generation of Incorrect Security Tokens | Base | Allowed | 1.0831 | dense, sparse, graph | dense: 0.593, sparse: 1.000, graph: 0.600 |
| 2 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.8633 | dense, sparse, graph | dense: 0.439, sparse: 0.800, graph: 0.521 |
| 3 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.6423 | dense, sparse | dense: 0.418, sparse: 0.758 |
| 4 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.6317 | dense, sparse | dense: 0.432, sparse: 0.726 |
| 5 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.6264 | dense, sparse | dense: 0.431, sparse: 0.718 |
| 6 | CWE-303 | Incorrect Implementation of Authentication Algorithm | Base | Allowed | 0.6222 | dense, sparse | dense: 0.424, sparse: 0.717 |
| 7 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4115 | sparse | sparse: 0.719 |
| 8 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.4023 | sparse | sparse: 0.703 |
| 9 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.3853 | dense, sparse | dense: 0.428, sparse: 0.772 |
| 10 | CWE-1390 | Weak Authentication | Class | Allowed-with-Review | 0.3785 | sparse, graph | sparse: 0.812, graph: 0.503 |



# Analysis to Review
# Summary
| CWE ID    | CWE Name                                     | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
| :--------- | :------------------------------------------- | :--------- | :-------------------- | :------------------------------ | :------------------------------ |
| CWE-1270 | Generation of Incorrect Security Tokens | 0.85      | Base                   | Allowed                         | Acceptable-Use            |
| CWE-290 | Authentication Bypass by Spoofing | 0.65      | Base                   | Allowed                         | Acceptable-Use            |

## Evidence and Confidence

*   **Confidence Score:** 0.75
*   **Evidence Strength:** MEDIUM

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability description outlines a **Token Recipient Confusion** issue in Wire's SAML implementation. An attacker with knowledge of SAML IdP metadata can manipulate the SAML SSO configuration of a targeted team, leading to unauthorized access, deletion of SAML authenticated accounts, and creation of arbitrary accounts. This aligns strongly with CWE-1270 (Generation of Incorrect Security Tokens), as the root cause lies in the incorrect generation or handling of security tokens within the SAML authentication process. The **attacker** is able to **authenticate** as a user, which is the impact of **token recipient confusion**.
  The retriever results also strongly support CWE-1270, with the highest combined score, and the description matches the vulnerability well. MITRE's mapping guidance designates the usage as "Allowed" for the Base abstraction level.

  - *Relationship Analysis:* While CWE-1270 does not have direct relationships to other CWEs in the provided data, the authentication bypass aspect of the vulnerability suggests a possible relationship with authentication-related CWEs.

- **Confidence Score:**  
  - Confidence: 0.85 (High confidence based on the vulnerability description and retriever results. The direct mention of security tokens and the impact on SAML authentication strongly support this mapping.)

---
- **Analysis and Justification:**  
  - *Explanation:* The vulnerability allows an attacker to **authenticate as a user** of the targeted team and create arbitrary accounts. The "CVE Reference Links Content Summary" also mentions unauthorized access. This suggests that an authentication bypass is occurring, specifically by spoofing or impersonating a legitimate user. CWE-290 (Authentication Bypass by Spoofing) captures this aspect of the vulnerability, where the attacker can effectively bypass the intended authentication mechanism.

  - *Relationship Analysis:* CWE-290 is a child of CWE-287 (Improper Authentication). However, CWE-290 is more specific, as it focuses on spoofing attacks.
  Although the similarity score is lower, this is still relevant because the attacker ultimately gains unauthorized access, which aligns with the Authentication Bypass by Spoofing.

- **Confidence Score:**  
  - Confidence: 0.65 (Moderate confidence, as this is a secondary aspect of the vulnerability. The primary weakness is the token confusion, but the authentication bypass is a direct consequence.)

# CWE Examples from Database


## Known Examples for CWE-290: Authentication Bypass by Spoofing
### Observed Examples
- **CVE-2022-30319** [https://www.cve.org/CVERecord?id=CVE-2022-30319](https://www.cve.org/CVERecord?id=CVE-2022-30319): S-bus functionality in a home automation product performs access control using an IP allowlist, which can be bypassed by a forged IP address.
- **CVE-2009-1048** [https://www.cve.org/CVERecord?id=CVE-2009-1048](https://www.cve.org/CVERecord?id=CVE-2009-1048): VOIP product allows authentication bypass using 127.0.0.1 in the Host header.
### Top 25 Examples
- **CVE-2021-29280**: In TP-Link Wireless N Router WR840N an ARP poisoning attack can cause buffer overflow
- **CVE-2021-0232**: An authentication bypass vulnerability in the Juniper Networks Paragon Active Assurance Control Center may allow an attacker with specific information about the deployment to mimic an already registered Test Agent and access its configuration including associated inventory details. If the issue occurs, the affected Test Agent will not be able to connect to the Control Center. This issue affects Juniper Networks Paragon Active Assurance Control Center All versions prior to 2.35.6; 2.36 versions prior to 2.36.2.
- **CVE-2021-22779**: Authentication Bypass by Spoofing vulnerability exists in EcoStruxure Control Expert (all versions prior to V15.0 SP1, including all versions of Unity Pro), EcoStruxure Control Expert V15.0 SP1, EcoStruxure Process Expert (all versions, including all versions of EcoStruxure Hybrid DCS), SCADAPack RemoteConnect for x70 (all versions), Modicon M580 CPU (all versions - part numbers BMEP* and BMEH*), Modicon M340 CPU (all versions - part numbers BMXP34*), that could cause unauthorized access in read and write mode to the controller by spoofing the Modbus communication between the engineering software and the controller.
- **CVE-2020-19003**: An issue in Gate One 1.2.0 allows attackers to bypass to the verification check done by the origins list and connect to Gate One instances used by hosts not on the origins list.
- **CVE-2020-22001**: HomeAutomation 3.3.2 suffers from an authentication bypass vulnerability when spoofing client IP address using the X-Forwarded-For header with the local (loopback) IP address value allowing remote control of the smart home solution.
- **CVE-2021-22002**: VMware Workspace ONE Access and Identity Manager, allow the /cfg web app and diagnostic endpoints, on port 8443, to be accessed via port 443 using a custom host header. A malicious actor with network access to port 443 could tamper with host headers to facilitate access to the /cfg web app, in addition a malicious actor could access /cfg diagnostic endpoints without authentication.
- **CVE-2021-23008**: On version 15.1.x before 15.1.3, 14.1.x before 14.1.4, 13.1.x before 13.1.4, 12.1.x before 12.1.6, and all versions of 16.0.x and 11.6.x., BIG-IP APM AD (Active Directory) authentication can be bypassed via a spoofed AS-REP (Kerberos Authentication Service Response) response sent over a hijacked KDC (Kerberos Key Distribution Center) connection or from an AD server compromised by an attacker. Note: Software versions which have reached End of Technical Support (EoTS) are not evaluated.
- **CVE-2021-41753**: A denial-of-service attack in WPA2, and WPA3-SAE authentication methods in D-Link DIR-X1560, v1.04B04, and DIR-X6060, v1.11B04 allows a remote unauthenticated attacker to disconnect a wireless client via sending specific spoofed SAE authentication frames.


# Relevant CWE Specifications

## CWE-290: Authentication Bypass by Spoofing
**Abstraction:** Base
**Status:** Incomplete

### Description
This attack-focused weakness is caused by incorrectly implemented authentication schemes that are subject to spoofing attacks.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-1390
ChildOf -> CWE-287
ParentOf -> CWE-291
ParentOf -> CWE-293
ParentOf -> CWE-350

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use



### Additional Notes
**[Relationship]** This can be resultant from insufficient verification.



### Observed Examples
- **CVE-2022-30319:** S-bus functionality in a home automation product performs access control using an IP allowlist, which can be bypassed by a forged IP address.
- **CVE-2009-1048:** VOIP product allows authentication bypass using 127.0.0.1 in the Host header.



## CWE-1270: Generation of Incorrect Security Tokens
**Abstraction:** Base
**Status:** Incomplete

### Description
The product implements a Security Token mechanism to differentiate what actions are allowed or disallowed when a transaction originates from an entity. However, the Security Tokens generated in the system are incorrect.

### Extended Description


Systems-On-a-Chip (SoC) (Integrated circuits and hardware engines) implement Security Tokens to differentiate and identify actions originated from various agents. These actions could be "read", "write", "program", "reset", "fetch", "compute", etc. Security Tokens are generated and assigned to every agent on the SoC that is either capable of generating an action or receiving an action from another agent. Every agent could be assigned a unique, Security Token based on its trust level or privileges. Incorrectly generated Security Tokens could result in the same token used for multiple agents or multiple tokens being used for the same agent. This condition could result in a Denial-of-Service (DoS) or the execution of an action that in turn could result in privilege escalation or unintended access.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-1294

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Implementation
- **Description:** 

  - Generation of Security Tokens should be reviewed for design inconsistency and common weaknesses.

  - Security-Token definition and programming flow should be tested in pre-silicon and post-silicon testing.








## CWE-287: Improper Authentication
**Abstraction:** Class
**Status:** Draft

### Description
When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.

### Extended Description
Not provided

### Alternative Terms
authentification: An alternate term is "authentification", which appears to be most commonly used by people from non-English-speaking countries.
AuthN: "AuthN" is typically used as an abbreviation of "authentication" within the web application security community. It is also distinct from "AuthZ," which is an abbreviation of "authorization." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.
AuthC: "AuthC" is used as an abbreviation of "authentication," but it appears to used less frequently than "AuthN."

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1390
ParentOf -> CWE-290
ParentOf -> CWE-294
ParentOf -> CWE-295
ParentOf -> CWE-306
ParentOf -> CWE-307
ParentOf -> CWE-521
ParentOf -> CWE-522
CanFollow -> CWE-613
ParentOf -> CWE-640
ParentOf -> CWE-645
ParentOf -> CWE-798

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry might be misused when lower-level CWE entries are likely to be applicable. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children or descendants, beginning with CWE-1390: Weak Authentication or CWE-306: Missing Authentication for Critical Function.
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1390: Weak Authentication
- CWE-306: Missing Authentication for Critical Function


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an authentication framework or library such as the OWASP ESAPI Authentication feature.



### Additional Notes
**[Relationship]** This can be resultant from SQL injection vulnerabilities and other issues.

**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-35248:** Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436:** Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034:** Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).

