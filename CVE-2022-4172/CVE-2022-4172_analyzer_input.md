# Vulnerability Information: CVE-2022-4172

## Vulnerability Description
An **integer overflow** and **buffer overflow** issues were found in the ACPI Error Record Serialization Table (ERST) device of QEMU in the read_erst_record() and write_erst_record() functions. Both issues may allow the guest to overrun the host buffer allocated for the ERST memory device. A malicious guest could use these flaws to crash the QEMU process on the host.

### Vulnerability Description Key Phrases
- **weakness:** **integer overflow and buffer overflow**
- **impact:** crash the QEMU process on the host
- **vector:** overrun the host buffer allocated for the ERST memory device
- **attacker:** malicious guest
- **product:** QEMU
- **component:** ACPI Error Record Serialization Table (ERST) device

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-4172:

**Root Cause of Vulnerability:**

The vulnerability stems from two issues within the `hw/acpi/erst.c` file in QEMU's ACPI ERST (Error Record Serialization Table) implementation:
  1. Incorrect `memset` argument order: The `memset` function was used with the value and length arguments in the wrong order.
  2. Integer overflow: An integer overflow was possible when calculating the buffer size for the ERST memory device, leading to out-of-bounds memory access.

**Weaknesses/Vulnerabilities Present:**
*   **Memory Corruption**: Both the incorrect `memset` and integer overflow led to the guest being able to overrun the host buffer allocated for the ERST memory device.
*   **Out-of-bounds write**: Due to the incorrect argument order in `memset` and integer overflow, the guest can write outside the intended memory region.
*   **memcpy-param-overlap**: The reproducer code demonstrates an issue where `memcpy` writes to overlapping memory regions.

**Impact of Exploitation:**
*   **Denial of Service (DoS)**: As stated in the NetApp advisory, successful exploitation could result in a Denial of Service. The memory corruption and out-of-bounds write could lead to QEMU crashing.
*   **Potential Memory Corruption**: Overwriting memory could lead to unpredictable behavior and potentially further exploitation.

**Attack Vectors:**
*   **Guest-initiated**: A malicious guest operating system can trigger the vulnerability by writing to specific registers of the emulated ACPI ERST device. The provided reproducer code shows how this can be achieved.
*   **QEMU's ACPI ERST device**: The attack vector lies in the way QEMU processes guest interactions with the ACPI ERST device.

**Required Attacker Capabilities/Position:**
*   **Guest privileges**: The attacker must have control over a guest operating system running within the vulnerable QEMU environment.
*   **Knowledge of ERST interface**: The attacker needs to understand how to interact with the ACPI ERST interface through specific I/O ports and memory regions.
*   **Ability to execute I/O operations**: The attacker needs to be able to execute I/O operations from the guest operating system to interact with the ERST device.

**Additional Notes:**
*   The provided git commit message and patch clearly outlines the root cause.
*   The issue #1268 link in the git commit message provides more context about the `memcpy-param-overlap` issue.
*   The Fedora update notice indicates that this CVE has been addressed in a QEMU update.
*   The NetApp advisory states that their products are not affected by this vulnerability.

The provided content gives more information than the CVE description itself, particularly with the git commit message, patch, reproducer code, and stack trace which are helpful for understanding the root cause and how it can be triggered.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7907 | dense, sparse, graph | dense: 0.596, sparse: 0.376, graph: 0.776 |
| 2 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.7866 | dense, sparse, graph | dense: 0.503, sparse: 0.310, graph: 1.000 |
| 3 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.6564 | dense, sparse, graph | dense: 0.556, sparse: 0.287, graph: 0.598 |
| 4 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.4833 | sparse, graph | sparse: 0.331, graph: 0.822 |
| 5 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4324 | dense, sparse | dense: 0.528, sparse: 0.294 |
| 6 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.4226 | dense, sparse | dense: 0.540, sparse: 0.267 |
| 7 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.4145 | sparse, graph | sparse: 0.302, graph: 0.773 |
| 8 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.4064 | dense, sparse | dense: 0.505, sparse: 0.269 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4054 | dense, sparse | dense: 0.545, sparse: 0.291 |
| 10 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4029 | dense, sparse | dense: 0.539, sparse: 0.291 |

