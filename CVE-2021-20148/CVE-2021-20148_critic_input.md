# Critic Input for CVE-2021-20148



# Original Analyzer Input
## Vulnerability Description
ManageEngine ADSelfService Plus below build 6116 stores the password policy file for each domain under the html/ web root with a predictable filename based on the domain name. When ADSSP is configured with multiple Windows domains, a user from one domain can obtain the password policy for another domain by authenticating to the service and then sending a request specifying the password policy file of the other domain.

### Vulnerability Description Key Phrases
- **impact:** obtain the password policy for another domain
- **vector:** authenticating to the service and then sending a request specifying the password policy file of the other domain
- **attacker:** user from one domain
- **product:** ManageEngine ADSelfService Plus
- **version:** below build 6116

## CVE Reference Links Content Summary
```
{
  "vulnerability_details": [
    {
      "cve_id": "CVE-2021-20148",
      "root_cause": "The application fails to properly restrict access to password policy information across multiple configured Windows domains.",
      "weaknesses": [
        "Information Disclosure"
      ],
      "impact": "A user from one domain can obtain the password policy of another domain.",
       "attack_vectors": [
        "The attacker must be a logged in user of one of the domains"
      ],
      "attacker_capabilities": "A user from one domain can gain access to the password policy information of another domain by making requests to specific URLs.",
       "additional_information": "The attacker needs to be a logged-in user of the application and requires knowledge of the targeted domain name to exploit the vulnerability.  The domain name is used to access a specific HTML file."
    }
  ]
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-942 | Permissive Cross-domain Policy with Untrusted Domains | Variant | Allowed | 0.4095 | dense, sparse, graph | dense: 0.382, sparse: 0.110, graph: 0.531 |
| 2 | CWE-204 | Observable Response Discrepancy | Base | Allowed | 0.3325 | sparse, graph | sparse: 0.108, graph: 0.757 |
| 3 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.3308 | sparse, graph | sparse: 0.105, graph: 0.757 |
| 4 | CWE-219 | Storage of File with Sensitive Data Under Web Root | Variant | Allowed | 0.3124 | dense, sparse | dense: 0.452, sparse: 0.197 |
| 5 | CWE-522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | 0.1298 | dense, sparse | dense: 0.335, sparse: 0.094 |
| 6 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.0549 | sparse | sparse: 0.096 |
| 7 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.0548 | sparse | sparse: 0.096 |
| 8 | CWE-288 | Authentication Bypass Using an Alternate Path or Channel | Base | Allowed | 0.0540 | sparse | sparse: 0.094 |
| 9 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.0537 | sparse | sparse: 0.094 |
| 10 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.0537 | sparse | sparse: 0.094 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-219 | Storage of File with Sensitive Data Under Web Root | 0.85 | Variant | Allowed | Primary CWE |
| CWE-425 | Direct Request ('Forced Browsing') | 0.70 | Base | Allowed | Secondary Candidate |
| CWE-639 | Authorization Bypass Through User-Controlled Key | 0.60 | Base | Allowed | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.80
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* The primary **weakness** is that the application stores sensitive password policy files under the web root with insufficient access control. The vulnerability description explicitly states that "ManageEngine ADSelfService Plus below build 6116 stores the password policy file for each domain under the html/ web root with a predictable filename based on the domain name." This perfectly matches the description of CWE-219 (Storage of File with Sensitive Data Under Web Root), which is a Variant-level CWE and thus preferred. The CVE Reference Links Content Summary also reinforces this by stating that the application "fails to properly restrict access to password policy information across multiple configured Windows domains" leading to **Information Disclosure**. A secondary weakness exists because a user from one domain is able to directly request the password policy file of another domain, suggesting inadequate authorization checks which aligns with CWE-425 (Direct Request ('Forced Browsing')). Further, the fact that a user from one domain can access another domain's password policy file by modifying the request indicates a potential Authorization Bypass through a User-Controlled Key (CWE-639).

  - *Relationship Analysis:* CWE-219 is a variant-level weakness, making it more specific than its potential parents. It doesn't have any direct relationships listed in the provided data, but its nature relates to improper file access control. CWE-425 and CWE-639 also don't have direct relationships listed, but they are both related to authorization issues.

- **Confidence Score:**
  - Confidence: 0.85 (High confidence due to direct evidence from the vulnerability description and CVE details supporting CWE-219 as the primary weakness, with secondary weaknesses CWE-425 and CWE-639 possible).

# CWE Examples from Database


## Known Examples for CWE-639: Authorization Bypass Through User-Controlled Key
### Observed Examples
- **CVE-2021-36539** [https://www.cve.org/CVERecord?id=CVE-2021-36539](https://www.cve.org/CVERecord?id=CVE-2021-36539): An educational application does not appropriately restrict file IDs to a particular user. The attacker can brute-force guess IDs, indicating IDOR.
### Top 25 Examples
- **CVE-2020-26679**: vFairs 3.3 is affected by Insecure Permissions. Any user logged in to a vFairs virtual conference or event can modify any other users profile information or profile picture. After receiving any user's unique identification number and their own, an HTTP POST request can be made update their profile description or supply a new profile image. This can lead to potential cross-site scripting attacks on any user, or upload malicious PHP webshells as "profile pictures." The user IDs can be easily determined by other responses from the API for an event or chat room.
- **CVE-2021-41847**: An issue was discovered in 3xLogic Infinias Access Control through 6.7.10708.0, affecting physical security. Users with login credentials assigned to a specific zone can send modified HTTP GET and POST requests, allowing them to view user data such as personal information and Prox card credentials. Also, an authorized user of one zone can send API requests to unlock electronic locks associated with zones they are unauthorized to have access to. They can also create new user logins for zones they were not authorized to access, including the root zone of the software.
- **CVE-2021-22906**: Nextcloud End-to-End Encryption before 1.5.3, 1.6.3 and 1.7.1 suffers from a denial of service vulnerability due to permitting any authenticated users to lock files of other users.
- **CVE-2021-21012**: Magento versions 2.4.1 (and earlier), 2.4.0-p1 (and earlier) and 2.3.6 (and earlier) are vulnerable to an insecure direct object vulnerability (IDOR) in the checkout module. Successful exploitation could lead to sensitive information disclosure.
- **CVE-2021-21013**: Magento versions 2.4.1 (and earlier), 2.4.0-p1 (and earlier) and 2.3.6 (and earlier) are vulnerable to an insecure direct object vulnerability (IDOR) in the customer API module. Successful exploitation could lead to sensitive information disclosure and update arbitrary information on another user's account.
- **CVE-2021-21022**: Magento versions 2.4.1 (and earlier), 2.4.0-p1 (and earlier) and 2.3.6 (and earlier) are vulnerable to an insecure direct object reference (IDOR) in the product module. Successful exploitation could lead to unauthorized access to restricted resources.
- **CVE-2021-21255**: GLPI is an open-source asset and IT management software package that provides ITIL Service Desk features, licenses tracking and software auditing. In GLPI version 9.5.3, it was possible to switch entities with IDOR from a logged in user. This is fixed in version 9.5.4.
- **CVE-2021-24318**: The Listeo WordPress theme before 1.6.11 did not ensure that the Post/Page and Booking to delete belong to the user making the request, allowing any authenticated users to delete arbitrary page/post and booking via an IDOR vector.
- **CVE-2021-26024**: The Favorites component before 1.0.2 for Nagios XI 5.8.0 is vulnerable to Insecure Direct Object Reference: it is possible to create favorites for any other user account.


# Relevant CWE Specifications

## CWE-639: Authorization Bypass Through User-Controlled Key
**Abstraction:** Base
**Status:** Incomplete

### Description
The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.

### Extended Description


Retrieval of a user record occurs in the system based on some key value that is under user control. The key would typically identify a user-related record stored in the system and would be used to lookup that record for presentation to the user. It is likely that an attacker would have to be an authenticated user in the system. However, the authorization process would not properly check the data access operation to ensure that the authenticated user performing the operation has sufficient entitlements to perform the requested data access, hence bypassing any other authorization checks present in the system.


For example, attackers can look at places where user specific data is retrieved (e.g. search screens) and determine whether the key for the item being looked up is controllable externally. The key may be a hidden field in the HTML form field, might be passed as a URL parameter or as an unencrypted cookie variable, then in each of these cases it will be possible to tamper with the key value.


One manifestation of this weakness is when a system uses sequential or otherwise easily-guessable session IDs that would allow one user to easily switch to another user's session and read/modify their data.


### Alternative Terms
Insecure Direct Object Reference / IDOR: The "Insecure Direct Object Reference" term, as described in the OWASP Top Ten, is broader than this CWE because it also covers path traversal (CWE-22). Within the context of vulnerability theory, there is a similarity between the OWASP concept and CWE-706: Use of Incorrectly-Resolved Name or Reference.
Broken Object Level Authorization / BOLA: BOLA is used in the 2019 OWASP API Security Top 10 and is said to be the same as IDOR.
Horizontal Authorization: "Horizontal Authorization" is used to describe situations in which two users have the same privilege level, but must be prevented from accessing each other's resources. This is fairly common when using key-based access to resources in a multi-user context.

### Relationships
ChildOf -> CWE-863
ChildOf -> CWE-863
ChildOf -> CWE-284
ParentOf -> CWE-566

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** For each and every data access, ensure that the user has sufficient privilege to access the record that is being requested.

**Mitigation 2:**
- **Phase:** Architecture and Design, Implementation
- **Description:** Make sure that the key that is used in the lookup of a specific user's record is not controllable externally by the user or that any tampering can be detected.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** Use encryption in order to make it more difficult to guess other legitimate values of the key or associate a digital signature with the key so that the server can verify that there has been no tampering.




### Observed Examples
- **CVE-2021-36539:** An educational application does not appropriately restrict file IDs to a particular user. The attacker can brute-force guess IDs, indicating IDOR.



## CWE-219: Storage of File with Sensitive Data Under Web Root
**Abstraction:** Variant
**Status:** Draft

### Description
The product stores sensitive data under the web document root with insufficient access control, which might make it accessible to untrusted parties.

### Extended Description
Besides public-facing web pages and code, products may store sensitive data, code that is not directly invoked, or other files under the web document root of the web server. If the server is not configured or otherwise used to prevent direct access to those files, then attackers may obtain this sensitive data.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-552
ParentOf -> CWE-433

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation, System Configuration
- **Description:** Avoid storing information under the web root directory.

**Mitigation 2:**
- **Phase:** System Configuration
- **Description:** Access control permissions should be set to prevent reading/writing of sensitive files inside/outside of the web directory.




### Observed Examples
- **CVE-2005-1835:** Data file under web root.
- **CVE-2005-2217:** Data file under web root.
- **CVE-2002-1449:** Username/password in data file under web root.



## CWE-425: Direct Request ('Forced Browsing')
**Abstraction:** Base
**Status:** Incomplete

### Description
The web application does not adequately enforce appropriate authorization on all restricted URLs, scripts, or files.

### Extended Description
Web applications susceptible to direct request attacks often make the false assumption that such resources can only be reached through a given navigation path and so only apply authorization at certain points in the path.

### Alternative Terms
forced browsing: The "forced browsing" term could be misinterpreted to include weaknesses such as CSRF or XSS, so its use is discouraged.

### Relationships
ChildOf -> CWE-862
ChildOf -> CWE-862
ChildOf -> CWE-288
ChildOf -> CWE-424
CanPrecede -> CWE-471
CanPrecede -> CWE-98

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Apply appropriate access control authorizations for each access to all restricted URLs, scripts or files.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Consider using MVC based frameworks such as Struts.



### Additional Notes
**[Relationship]** Overlaps Modification of Assumed-Immutable Data (MAID), authorization errors, container errors; often primary to other weaknesses such as XSS and SQL injection.

**[Theoretical]** "Forced browsing" is a step-based manipulation involving the omission of one or more steps, whose order is assumed to be immutable. The application does not verify that the first step was performed successfully before the second step. The consequence is typically "authentication bypass" or "path disclosure," although it can be primary to all kinds of weaknesses, especially in languages such as PHP, which allow external modification of assumed-immutable variables.



### Observed Examples
- **CVE-2022-29238:** Access-control setting in web-based document collaboration tool is not properly implemented by the code, which prevents listing hidden directories but does not prevent direct requests to files in those directories.
- **CVE-2022-23607:** Python-based HTTP library did not scope cookies to a particular domain such that "supercookies" could be sent to any domain on redirect.
- **CVE-2004-2144:** Bypass authentication via direct request.

