# Vulnerability Information: CVE-2021-44548

## Vulnerability Description
An **Improper Input Validation** vulnerability in DataImportHandler of Apache Solr allows an attacker to provide a Windows UNC path resulting in an SMB network call being made from the Solr host to another host on the network. If the attacker has wider access to the network, this may lead to SMB attacks, which may result in * The exfiltration of sensitive data such as OS user hashes (NTLM/LM hashes), * In case of misconfigured systems, SMB Relay Attacks which can lead to user impersonation on SMB Shares or, in a worse-case scenario, Remote Code Execution This issue affects all Apache Solr versions prior to 8.11.1. This issue only affects Windows.

### Vulnerability Description Key Phrases
- **rootcause:** **Improper Input Validation**
- **impact:** SMB attacks and exfiltration of sensitive data and SMB Relay Attacks and user impersonation on SMB Shares and Remote Code Execution
- **vector:** providing a Windows UNC path
- **attacker:** attacker
- **product:** Apache Solr
- **version:** prior to 8.11.1
- **component:** DataImportHandler

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

*   The vulnerability lies in the DataImportHandler of Apache Solr. Specifically, it stems from improper input validation that allows an attacker to provide a Windows UNC path.

**Weaknesses/Vulnerabilities:**

*   **Improper Input Validation:** The DataImportHandler does not adequately validate user-supplied input, allowing a specially crafted UNC path to be passed.
*   **SMB Network Call:**  The vulnerability allows an attacker to force the Solr host to make an SMB network call to a remote host specified in the UNC path.

**Impact of Exploitation:**

Successful exploitation can lead to:

*   **Information Disclosure:** Exfiltration of sensitive data like OS user hashes (NTLM/LM hashes).
*   **SMB Relay Attacks:** User impersonation on SMB shares, and potentially remote code execution in misconfigured systems.
*   **Denial of Service (DoS):**  The vulnerability can potentially be used to create a denial of service.
*   **Data Modification:** Malicious actors could potentially add or modify data.

**Attack Vectors:**

*   **Network Attack:** A malicious actor on the network or someone who can access the Solr server with crafted input to the DataImportHandler.
*   **UNC Path Injection:** The attacker injects a malicious Windows UNC path as input to the DataImportHandler.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker must have network access to the Solr server.
*   **Access to Solr's DataImport Handler:**  The attacker must be able to send requests to the DataImportHandler with the crafted UNC path.
*   **Knowledge of Solr API:** The attacker needs to know how to make a request to trigger the DataImportHandler

**Additional Information**

*   The vulnerability is specific to **Windows** platforms.
*   The vulnerability exists in Apache Solr versions prior to **8.11.1**.
*   NetApp products were found to be affected, but later deemed **not affected**.
*   The CVSS score for the vulnerability is **9.8 (CRITICAL)**

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-40 | Path Traversal: '\\UNC\share\name\' (Windows UNC Share) | Variant | Allowed | 0.9691 | dense, sparse, graph | dense: 0.622, sparse: 0.978, graph: 0.502 |
| 2 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.9114 | dense, sparse, graph | dense: 0.530, sparse: 0.504, graph: 1.000 |
| 3 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.7205 | dense, sparse, graph | dense: 0.519, sparse: 0.444, graph: 0.578 |
| 4 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4261 | sparse, graph | sparse: 0.442, graph: 0.485 |
| 5 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.3386 | dense, sparse, graph | dense: 0.516, sparse: 0.482, graph: 0.622 |
| 6 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.2640 | sparse | sparse: 0.462 |
| 7 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.2623 | sparse | sparse: 0.459 |
| 8 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.2612 | sparse | sparse: 0.457 |
| 9 | CWE-923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | 0.2589 | sparse, graph | sparse: 0.475, graph: 0.472 |
| 10 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.2588 | sparse | sparse: 0.452 |

