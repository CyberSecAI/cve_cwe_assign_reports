# Vulnerability Information: CVE-2021-29591

## Vulnerability Description
TensorFlow is an end-to-end open source platform for machine learning. TFlite graphs must not have **loops between nodes**. However, this condition was not checked and an attacker could craft models that would result in infinite loop during evaluation. In certain cases, the infinite loop would be replaced by **stack overflow** due to too many recursive calls. For example, the `While` implementation(https//github.com/tensorflow/tensorflow/blob/106d8f4fb89335a2c52d7c895b7a7485465ca8d9/tensorflow/lite/kernels/while.cc) could be tricked into a scneario where both the body and the loop subgraphs are the same. Evaluating one of the subgraphs means calling the `Eval` function for the other and this quickly exhaust all stack space. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range. Please consult our security guide(https//github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

### Vulnerability Description Key Phrases
- **rootcause:** **loops between nodes**
- **weakness:** **stack overflow**
- **product:** TensorFlow
- **version:** before 2.5.0
- **component:** TFlite graphs

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2021-29591:

**Root Cause of Vulnerability:**
The vulnerability stems from the lack of proper validation in TensorFlow Lite (TFLite) graphs, specifically regarding loops between nodes. The `While` operator in TFLite could be exploited by creating a scenario where the condition and body subgraphs are the same. This would lead to an infinite loop or stack overflow during model evaluation due to recursive calls.

**Weaknesses/Vulnerabilities Present:**
- **Missing loop detection**: TFLite did not check for loops in the graph structure.
- **Recursive calls without limits**: The `While` operator could be tricked into recursively calling itself, exhausting the stack.

**Impact of Exploitation:**
- **Infinite loop:** A specially crafted model could cause an infinite loop during evaluation.
- **Stack overflow:** Recursive calls from the infinite loop could lead to stack exhaustion and a crash.

**Attack Vectors:**
- **Crafted TFLite model:** An attacker could create a malicious TFLite model with a looped graph structure.

**Required Attacker Capabilities/Position:**
- An attacker needs the ability to create and provide a crafted TFLite model.

**Additional Details:**
- The vulnerability specifically impacts the TFLite interpreter when evaluating models with loops.
- The fix involves adding checks for recursion and ensuring that subgraphs are not used recursively.
- The commits fixing the issue are  [9c1dc920d8ffb4893d6c9d27d1f039607b326743](https://github.com/tensorflow/tensorflow/commit/9c1dc920d8ffb4893d6c9d27d1f039607b326743) (for the `While` operator) and  [c6173f5fe66cdbab74f4f869311fe6aae2ba35f4](https://github.com/tensorflow/tensorflow/commit/c6173f5fe66cdbab74f4f869311fe6aae2ba35f4) (in general).
- The vulnerability is addressed in TensorFlow versions 2.1.4, 2.2.3, 2.3.3, 2.4.2 and will be included in 2.5.0.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 1.0035 | dense, sparse, graph | dense: 0.455, sparse: 1.000, graph: 0.570 |
| 2 | CWE-824 | Access of Uninitialized Pointer | Base | Allowed | 0.9998 | dense, sparse, graph | dense: 0.448, sparse: 1.000, graph: 0.569 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.9840 | dense, sparse, graph | dense: 0.450, sparse: 1.000, graph: 0.523 |
| 4 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.9606 | dense, sparse, graph | dense: 0.406, sparse: 1.000, graph: 0.519 |
| 5 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.8542 | sparse, graph | sparse: 1.000, graph: 0.789 |
| 6 | CWE-1287 | Improper Validation of Specified Type of Input | Base | Allowed | 0.7902 | dense, sparse | dense: 0.436, sparse: 1.000 |
| 7 | CWE-663 | Use of a Non-reentrant Function in a Concurrent Context | Base | Allowed | 0.7803 | dense, sparse | dense: 0.416, sparse: 1.000 |
| 8 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7772 | dense, sparse | dense: 0.410, sparse: 1.000 |
| 9 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.7748 | dense, sparse | dense: 0.405, sparse: 1.000 |
| 10 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.7739 | dense, sparse | dense: 0.403, sparse: 1.000 |

