# Vulnerability Information: CVE-2020-15128

## Vulnerability Description
In OctoberCMS before version 1.0.468, encrypted cookie values were not tied to the name of the cookie the value belonged to. This meant that certain classes of attacks that took advantage of other theoretical vulnerabilities in user facing code (nothing exploitable in the core project itself) had a higher chance of succeeding. Specifically, if your usage exposed a way for users to provide unfiltered user input and have it returned to them as an encrypted cookie (ex. storing a user provided search query in a cookie) they could then use the generated cookie in place of other more tightly controlled cookies or if your usage exposed the plaintext version of an encrypted cookie at any point to the user they could theoretically provide encrypted content from your application back to it as an encrypted cookie and force the framework to decrypt it for them. Issue has been fixed in build 468 (v1.0.468).

### Vulnerability Description Key Phrases
- **vector:** provide unfiltered user input and have it returned as an encrypted cookie
- **product:** OctoberCMS
- **version:** before version 1.0.468

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2020-15128:

**Root Cause of Vulnerability:**

The core issue is that encrypted cookie values were not cryptographically tied to the cookie name. This means that an attacker could potentially reuse encrypted cookie values across different cookies if they had the ability to control content in a cookie.

**Weaknesses/Vulnerabilities Present:**

*   **Lack of cookie name binding:** The encryption process didn't include the cookie's name, making it possible to interchange encrypted values between cookies.
*   **Potential for replay attacks:** An attacker could potentially reuse encrypted values from one cookie in another cookie, if the attacker could control the initial cookie value.
*   **Exposure of plaintext values:** If the plaintext value of an encrypted cookie was exposed to the user, they could potentially use this to forge other encrypted cookies.
*   **Dependence on other vulnerabilities:**  This vulnerability is not directly exploitable without other vulnerabilities in the application to expose the plaintext or encrypted cookie values.

**Impact of Exploitation:**

*   **Cookie value substitution:** An attacker could potentially substitute an encrypted value from one cookie for another, potentially gaining unauthorized access or manipulating application behavior.
*   **Data exfiltration:** If an application stored user-provided data in cookies, an attacker could manipulate the application to disclose encrypted content or inject manipulated encrypted content.
*   **Session invalidation:** While the fix attempts to handle session cookies gracefully, users could potentially be logged out if the session driver uses cookies.

**Attack Vectors:**

*   **User-provided input:** If the application allows user-provided input to be stored in a cookie without proper sanitization and handling, an attacker could control the content of the encrypted cookie.
*   **Exposure of encrypted or plaintext values:** If the application exposes encrypted cookie values or their plaintext versions to the user, an attacker could leverage those to construct malicious cookie values.
*   **Man-in-the-middle:** If the attacker can intercept and modify the cookies.

**Required Attacker Capabilities/Position:**

*   **Ability to control or read cookie values:** The attacker needs the ability to control the value of a cookie or read the encrypted or plaintext value of a cookie in the targeted application.
*   **Understanding of the application's behavior:** An understanding of the application's logic is required to know which cookies to target and how to inject manipulated values.
*   **Ability to introduce other vulnerabilities**:  The exploit relies on other vulnerabilities within the application to be exploitable in the first place.

**Additional Notes:**

*   The vulnerability was found in Laravel and reported to the October CMS team by Taylor Otwell.
*   The fix was implemented by prefixing the cookie value with a hash of the cookie name and encryption key using HMAC-SHA1 (with "v2" added to the hash input), ensuring that the encrypted value is tied to a specific cookie name.
*  The fix invalidates all existing cookies except the October CMS session cookie (which is updated in the response.)
* The vulnerability was assessed as low severity because it requires other vulnerabilities to be exploited.
* This is a more detailed analysis than the official CVE description.

**Summary:**
The core issue is a lack of proper binding between cookie names and their encrypted values, allowing for potential substitution attacks. The fix implements a cookie prefix to validate the cookie's origin. This is a low-severity vulnerability requiring other application vulnerabilities to be exploited, but can lead to session hijacking or data leakage.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-614 | Sensitive Cookie in HTTPS Session Without 'Secure' Attribute | Variant | Allowed | 0.5058 | dense, sparse, graph | dense: 0.574, sparse: 0.211, graph: 0.392 |
| 2 | CWE-212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | 0.3985 | sparse, graph | sparse: 0.203, graph: 0.789 |
| 3 | CWE-257 | Storing Passwords in a Recoverable Format | Base | Allowed | 0.3919 | sparse, graph | sparse: 0.212, graph: 0.757 |
| 4 | CWE-1004 | Sensitive Cookie Without 'HttpOnly' Flag | Variant | Allowed | 0.3696 | dense, sparse | dense: 0.570, sparse: 0.201 |
| 5 | CWE-319 | Cleartext Transmission of Sensitive Information | Base | Allowed | 0.3564 | dense, sparse | dense: 0.484, sparse: 0.199 |
| 6 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.3553 | dense, sparse | dense: 0.482, sparse: 0.200 |
| 7 | CWE-312 | Cleartext Storage of Sensitive Information | Base | Allowed | 0.3410 | sparse, graph | sparse: 0.215, graph: 0.609 |
| 8 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.3127 | sparse, graph | sparse: 0.215, graph: 0.531 |
| 9 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.1895 | sparse, graph | sparse: 0.269, graph: 0.472 |
| 10 | CWE-338 | Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG) | Base | Allowed | 0.1122 | sparse | sparse: 0.196 |

