# Vulnerability Information: CVE-2021-0964

## Vulnerability Description
In C2SoftMP3process() of C2SoftMp3Dec.cpp, there is a possible **out of bounds write** due to a **heap buffer overflow**. This could lead to remote information disclosure with no additional execution privileges needed. User interaction is needed for exploitation.Product AndroidVersions Android-10 Android-11 Android-12 Android-9Android ID A-193363621

### Vulnerability Description Key Phrases
- **rootcause:** **heap buffer overflow**
- **weakness:** **out of bounds write**
- **impact:** remote information disclosure
- **product:** Android
- **version:** Android-10 and Android-11 and Android-12 and Android-9
- **component:** C2SoftMP3process() of C2SoftMp3Dec.cpp

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-0964:

**Root Cause of Vulnerability:**

- The vulnerability stems from an out-of-bounds (OOB) write in the `C2SoftMp3Dec` component, specifically related to how the output buffer size is calculated.
- The `outputFrameSize`, `calOutSize`, and `outSize` were being calculated at an 8-bit level, treating the size as bytes. However, the library expected `outputFrameSize` to be in int16 samples (16-bit).
- One of the initializations of `outputFrameSize` was incorrectly done in bytes instead of 16-bit samples.

**Weaknesses/Vulnerabilities Present:**

- **Out-of-bounds Write:** The primary vulnerability is an OOB write due to the incorrect calculation of output buffer size. This write occurs when the calculated buffer size based on bytes does not match the expected size based on 16-bit samples, leading to writes beyond the allocated buffer.

**Impact of Exploitation:**

- The vulnerability could lead to memory corruption, which could further lead to arbitrary code execution.
- The Android Security Bulletin mentions this vulnerability could lead to remote information disclosure.

**Attack Vectors:**

- The attack vector involves exploiting the `C2SoftMp3Dec` component, which is part of the media framework, via a crafted MP3 file, or a data stream that triggers the vulnerable code path in `C2SoftMp3Dec`. This could happen via applications that process untrusted media input.
- The content also mentions that a clusterfuzz generated proof-of-concept (POC) existed for this bug, which highlights that automated fuzzing could discover this issue.

**Required Attacker Capabilities/Position:**

- The attacker needs the ability to provide a crafted MP3 file or data stream to a vulnerable Android device that uses the affected library. This could be done through various avenues, like malicious apps or websites that trigger media processing.

**Additional Details:**

- The fix involves correcting the initialization of `outputFrameSize` to use 16-bit samples instead of bytes.
- Testing included clusterfuzz generated POC, `android.mediav2.cts.CodecDecoderTest`, and `VtsHalMediaC2V1_0TargetAudioDecTest`, indicating thorough testing of the fix.
- The vulnerability affects Android versions 9, 10, 11, and 12.
- The vulnerability is related to the `Media Framework` component and is included in Google Play system updates.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.9824 | dense, sparse, graph | dense: 0.589, sparse: 0.577, graph: 1.000 |
| 2 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.9639 | dense, sparse, graph | dense: 0.595, sparse: 0.608, graph: 0.890 |
| 3 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.8645 | dense, sparse, graph | dense: 0.609, sparse: 0.600, graph: 0.607 |
| 4 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.8345 | dense, sparse, graph | dense: 0.616, sparse: 0.541, graph: 0.606 |
| 5 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.5839 | dense, sparse | dense: 0.611, sparse: 0.571 |
| 6 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.5828 | dense, sparse | dense: 0.573, sparse: 0.518 |
| 7 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.5782 | dense, sparse | dense: 0.597, sparse: 0.488 |
| 8 | CWE-416 | Use After Free | Variant | Allowed | 0.5294 | dense, sparse | dense: 0.574, sparse: 0.500 |
| 9 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.4916 | sparse, graph | sparse: 0.483, graph: 0.602 |
| 10 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4905 | sparse, graph | sparse: 0.500, graph: 0.572 |

