# Vulnerability Information: CVE-2021-42341

## Vulnerability Description
checkpath in OpenRC before 0.44.7 **uses the direct output of strlen() to allocate strings, which does not account for the \0 byte at the end of the string**. This results in memory corruption. CVE-2021-42341 was introduced in git commit 63db2d99e730547339d1bdd28e8437999c380cae, which was introduced as part of OpenRC 0.44.0 development.

### Vulnerability Description Key Phrases
- **rootcause:** **uses the direct output of strlen() to allocate strings, which does not account for the \0 byte at the end of the string**
- **impact:** memory corruption
- **product:** checkpath in OpenRC
- **version:** before 0.44.7

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The `clean_path` function in `src/rc/checkpath.c` allocates memory for a string using `xmalloc(strlen(path))` which doesn't account for the null terminator, leading to a heap buffer overflow.",
    "weaknesses": [
      "Heap buffer overflow due to incorrect memory allocation size"
    ],
    "impact": "The `checkpath` utility crashes with `free(): invalid pointer` due to memory corruption.",
    "attack_vectors": "The vulnerability is triggered when `checkpath` is invoked with an argument. For example: `/lib/rc/bin/checkpath -d /tmp/tmp`",
    "required_capabilities": "No special privileges are needed besides the ability to execute the `checkpath` program with a path argument."
  },
  "fix": {
    "description": "The fix modifies the `clean_path` function to allocate `strlen(path) + 1` bytes for the string, accounting for the null terminator.",
    "commit_details": [
      {
        "commit_hash": "bb8334104baf4d5a4a442a8647fb9204738f2204",
        "fix_type": "Code fix",
          "file_changes": [
            {
              "file_path": "src/rc/checkpath.c",
              "original_line": "str = xmalloc(strlen(path));",
              "fixed_line": "str = xmalloc(strlen(path) + 1);"
            }
        ]
    },
        {
        "commit_hash": "cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7",
        "fix_type": "Code fix",
          "file_changes": [
            {
              "file_path": "src/rc/checkpath.c",
               "original_line": "str = xmalloc(strlen(path));",
               "fixed_line": "str = xmalloc(strlen(path) + 1);"
            }
        ]
      }
    ]
  },
  "additional_notes": "The issue was originally reported in Gentoo bug #816900. The fix was backported to older versions of OpenRC in Gentoo."
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-170 | Improper Null Termination | Base | Allowed | 0.9605 | dense, sparse, graph | dense: 0.483, sparse: 0.632, graph: 1.000 |
| 2 | CWE-193 | Off-by-one Error | Base | Allowed | 0.7989 | dense, sparse, graph | dense: 0.486, sparse: 0.346, graph: 1.000 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7300 | dense, sparse, graph | dense: 0.506, sparse: 0.308, graph: 0.841 |
| 4 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5501 | sparse, graph | sparse: 0.337, graph: 1.000 |
| 5 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.4629 | sparse, graph | sparse: 0.354, graph: 0.729 |
| 6 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.4097 | sparse, graph | sparse: 0.321, graph: 0.729 |
| 7 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.4018 | sparse, graph | sparse: 0.308, graph: 0.631 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3998 | dense, sparse | dense: 0.496, sparse: 0.324 |
| 9 | CWE-335 | Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG) | Base | Allowed | 0.1923 | sparse | sparse: 0.336 |
| 10 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.1824 | sparse | sparse: 0.319 |

