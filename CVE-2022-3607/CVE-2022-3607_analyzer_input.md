# Vulnerability Information: CVE-2022-3607

## Vulnerability Description
Failure to Sanitize Special Elements into a Different Plane (**Special Element Injection**) in GitHub repository octoprint/octoprint prior to 1.8.3.

### Vulnerability Description Key Phrases
- **rootcause:** **Special Element Injection**
- **product:** octoprint/octoprint
- **version:** prior to 1.8.3

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root cause of vulnerability:**
The vulnerability stems from insufficient sanitization of uploaded language packs in the OctoPrint software. Specifically, it was possible to include a directory-traversing symbolic link within a language pack.

**Weaknesses/vulnerabilities present:**
- **Path traversal via symbolic links:** The system did not properly validate the contents of uploaded ZIP or TAR archives, allowing the inclusion of symbolic links that point to arbitrary locations on the server's file system.
- **Insufficient input validation:** The system lacked proper checks to ensure that file names within the archives did not contain path traversal sequences (e.g., `..`).

**Impact of exploitation:**
- **Information disclosure:** An attacker with administrative permissions could upload a malicious language pack containing a symbolic link. When a backup is created, the symbolic link would be followed, potentially leading to the inclusion of sensitive files or directories in the backup. This could be used to extract information from the server.

**Attack vectors:**
- **Malicious language pack upload:** An attacker with administrative privileges can upload a crafted language pack containing malicious symlinks.

**Required attacker capabilities/position:**
- **Administrative access:** The attacker must have administrative privileges on the OctoPrint instance to upload language packs.

**Additional details from the content:**
- The vulnerability was present in the language pack handling logic within the `src/octoprint/server/api/languages.py` file.
- The fix involved modifying the `_validate_archive_name` function to check if the path constructed by joining the archive entry name to the target path starts with the target directory, preventing access outside the target directory
- The original code checked if name started with `/` or contained `..` but failed to prevent symlink to be used to escape target directory.
- The vulnerability was fixed by adding a check that the resulting path must start with the target directory.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-791 | Incomplete Filtering of Special Elements | Base | Allowed | 0.5222 | dense, sparse, graph | dense: 0.522, sparse: 0.092, graph: 0.584 |
| 2 | CWE-90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | 0.3623 | sparse, graph | sparse: 0.113, graph: 0.832 |
| 3 | CWE-75 | Failure to Sanitize Special Elements into a Different Plane (Special Element Injection) | Class | Discouraged | 0.3059 | dense, sparse, graph | dense: 0.791, sparse: 0.266, graph: 0.378 |
| 4 | CWE-93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | 0.2762 | sparse, graph | sparse: 0.113, graph: 0.591 |
| 5 | CWE-794 | Incomplete Filtering of Multiple Instances of Special Elements | Variant | Allowed | 0.2744 | dense, sparse | dense: 0.475, sparse: 0.104 |
| 6 | CWE-792 | Incomplete Filtering of One or More Instances of Special Elements | Variant | Allowed | 0.2743 | dense, sparse | dense: 0.483, sparse: 0.096 |
| 7 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.2705 | sparse, graph | sparse: 0.113, graph: 0.576 |
| 8 | CWE-917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | 0.2464 | sparse, graph | sparse: 0.091, graph: 0.543 |
| 9 | CWE-138 | Improper Neutralization of Special Elements | Class | Discouraged | 0.2059 | dense, sparse, graph | dense: 0.499, sparse: 0.126, graph: 0.386 |
| 10 | CWE-790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | 0.1781 | dense, sparse | dense: 0.482, sparse: 0.108 |

