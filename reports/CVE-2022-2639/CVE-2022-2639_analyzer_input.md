# Vulnerability Information: CVE-2022-2639

## Vulnerability Description
An **integer coercion error** was found in the openvswitch kernel module. Given a sufficiently large number of actions, while copying and reserving memory for a new action of a new flow, the reserve_sfa_size() function does not return -EMSGSIZE as expected, potentially leading to an out-of-bounds write access. This flaw allows a local user to crash or potentially escalate their privileges on the system.

### Vulnerability Description Key Phrases
- **rootcause:** **integer coercion error**
- **impact:** crash or potentially escalate privileges
- **vector:** out-of-bounds write access
- **attacker:** local user
- **product:** openvswitch kernel module

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-2639:

**Root cause of vulnerability:**

*   An integer underflow vulnerability exists within the `reserve_sfa_size()` function in the openvswitch kernel module.
*   The vulnerability occurs when calculating the required size for flow actions. Specifically, when `next_offset` is close to `MAX_ACTIONS_BUFSIZE` and a new action with `req_size` is added, instead of returning `-EMSGSIZE`, the code allocates `MAX_ACTIONS_BUFSIZE` bytes, incrementing `actions_len` by `req_size`. This leads to `actions_len` exceeding the allocated buffer size.

**Weaknesses/vulnerabilities present:**

*   **Integer Underflow:** The core issue is an incorrect check for sufficient buffer space before allocating memory for flow actions, which leads to an integer underflow and an out-of-bounds (OOB) write.
*   **Out-of-Bounds Write:** The incorrect size calculation causes `reserve_sfa_size()` to allocate a larger buffer size than intended and when subsequent actions are copied, they are written past the end of the allocated memory.

**Impact of exploitation:**

*   **Crash:** A local user can trigger the vulnerability, resulting in a system crash due to the out-of-bounds write.
*   **Potential Privilege Escalation:** The vulnerability may also allow a local user to potentially escalate their privileges due to memory corruption.

**Attack vectors:**

*   **Local User:** The attack vector is a local user interacting with the system and the openvswitch module.
*   **Flow Actions:** Exploitation involves crafting a flow with a large number of actions, causing the `reserve_sfa_size()` function to miscalculate the memory requirements for the flow actions.

**Required attacker capabilities/position:**

*   **Local Access:** The attacker needs local access to the system to trigger the vulnerability.
*   **Ability to Create Flows:** The attacker needs the ability to create or modify network flows using the openvswitch module.
*   **Crafted Actions:** They need to be able to craft network flows with a large number of actions to trigger the integer underflow condition.

**Additional details:**

*   The vulnerability was found in the Linux Kernel's openvswitch module.
*   The vulnerability is fixed by rearranging the flow action size check, as per the provided commit.
*   The fix is included in Linux kernel version 5.18.
*   Multiple Red Hat errata (RHSA, RHBA) have been released to address this vulnerability in different versions of Red Hat Enterprise Linux.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7365 | dense, sparse, graph | dense: 0.542, sparse: 0.330, graph: 0.774 |
| 2 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.6619 | dense, sparse, graph | dense: 0.545, sparse: 0.315, graph: 0.585 |
| 3 | CWE-192 | Integer Coercion Error | Variant | Allowed | 0.6039 | dense, sparse | dense: 0.619, sparse: 0.603 |
| 4 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4982 | sparse, graph | sparse: 0.313, graph: 0.893 |
| 5 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.4852 | sparse, graph | sparse: 0.313, graph: 0.857 |
| 6 | CWE-823 | Use of Out-of-range Pointer Offset | Base | Allowed | 0.4420 | sparse, graph | sparse: 0.279, graph: 0.789 |
| 7 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4170 | dense, sparse | dense: 0.484, sparse: 0.305 |
| 8 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4118 | dense, sparse | dense: 0.486, sparse: 0.294 |
| 9 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.4049 | dense, sparse | dense: 0.486, sparse: 0.282 |
| 10 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4028 | dense, sparse | dense: 0.476, sparse: 0.288 |

