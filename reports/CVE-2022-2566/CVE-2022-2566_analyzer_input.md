# Vulnerability Information: CVE-2022-2566

## Vulnerability Description
A **heap out-of-bounds memory write** exists in FFMPEG since version 5.1. The size calculation in `build_open_gop_key_points()` goes through all entries in the loop and adds `sc->ctts_data[i].count` to `sc->sample_offsets_count`. This can lead to an **integer overflow** resulting in a small allocation with `av_calloc()`. An attacker can cause remote code execution via a malicious mp4 file. We recommend upgrading past commit c953baa084607dd1d84c3bfcce3cf6a87c3e6e05

### Vulnerability Description Key Phrases
- **rootcause:** **integer overflow**
- **weakness:** **heap out-of-bounds memory write**
- **impact:** remote code execution
- **vector:** malicious mp4 file
- **product:** FFMPEG
- **version:** 5.1

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-2566:

**Root Cause:**
- Integer overflow in the `build_open_gop_key_points()` function within the `libavformat/mov.c` file of the FFmpeg project.

**Weaknesses/Vulnerabilities:**
- **Integer Overflow:** The code calculates the size of required memory by adding the `count` values from the `ctts_data` and `sync_group` structures. If the accumulated sum exceeds `INT_MAX`, an integer overflow occurs, leading to a small memory allocation with `av_calloc()`.
- **Heap Out-of-Bounds Write:** The smaller-than-required allocation then causes a heap out-of-bounds write when the function attempts to write more data than the allocated buffer can hold.

**Impact of Exploitation:**
- **Remote Code Execution:** An attacker can exploit this vulnerability to achieve remote code execution by crafting a malicious MP4 file that triggers the integer overflow and subsequent out-of-bounds write.
- **High Severity:** The vulnerability is rated as high severity due to the potential for remote code execution, and the high impact on confidentiality, integrity, and availability.

**Attack Vectors:**
- **Malicious MP4 File:** The vulnerability is triggered when a specially crafted MP4 file is processed by FFmpeg.
- **Local Attack Vector:** While a remote code execution is possible, the CVSS score indicates a local attack vector. This means the attacker needs to get the vulnerable program (FFmpeg) to process the crafted malicious MP4 file on the target machine. This could be done through various means such as convincing a user to play the file, or through a different process chain.

**Required Attacker Capabilities/Position:**
- The attacker needs to provide a malicious MP4 file to the vulnerable application.
- User interaction is required to trigger the vulnerability.
- No privileges are required to exploit the vulnerability.

**Additional details:**
- The vulnerability exists in FFmpeg since version 5.1.
- The fix was introduced in commit `c953baa084607dd1d84c3bfcce3cf6a87c3e6e05`, which adds a check to prevent the integer overflow.
- The vulnerability is classified under CWE-122 (Heap-based Buffer Overflow), CWE-190 (Integer Overflow or Wraparound), and CWE-787 (Out-of-bounds Write).
- The EPSS score of 0.202% indicates a relatively low probability of exploitation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 1.0329 | dense, sparse, graph | dense: 0.593, sparse: 0.724, graph: 0.901 |
| 2 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.8961 | dense, sparse, graph | dense: 0.527, sparse: 0.589, graph: 0.826 |
| 3 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.8662 | dense, sparse, graph | dense: 0.524, sparse: 0.595, graph: 0.739 |
| 4 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6874 | sparse, graph | sparse: 0.577, graph: 1.000 |
| 5 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.6132 | dense, sparse, graph | dense: 0.502, sparse: 0.280, graph: 0.564 |
| 6 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.6106 | sparse, graph | sparse: 0.559, graph: 0.813 |
| 7 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.5814 | dense, sparse | dense: 0.586, sparse: 0.588 |
| 8 | CWE-193 | Off-by-one Error | Base | Allowed | 0.5813 | dense, sparse | dense: 0.511, sparse: 0.569 |
| 9 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.5573 | dense, sparse | dense: 0.509, sparse: 0.529 |
| 10 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.5532 | dense, sparse | dense: 0.513, sparse: 0.518 |

