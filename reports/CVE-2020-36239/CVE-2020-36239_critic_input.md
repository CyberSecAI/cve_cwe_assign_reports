# Critic Input for CVE-2020-36239



# Original Analyzer Input
## Vulnerability Description
Jira Data Center, Jira Core Data Center, Jira Software Data Center from version 6.3.0 before 8.5.16, from 8.6.0 before 8.13.8, from 8.14.0 before 8.17.0 and Jira Service Management Data Center from version 2.0.2 before 4.5.16, from version 4.6.0 before 4.13.8, and from version 4.14.0 before 4.17.0 exposed a Ehcache RMI network service which attackers, who can connect to the service, on port 40001 and potentially 40011[0][1], could execute arbitrary code of their choice in Jira through deserialization due to a **missing authentication vulnerability**. While Atlassian strongly suggests restricting access to the Ehcache ports to only Data Center instances, fixed versions of Jira will now require a shared secret in order to allow access to the Ehcache service. [0] In Jira Data Center, Jira Core Data Center, and Jira Software Data Center versions prior to 7.13.1, the Ehcache object port can be randomly allocated. [1] In Jira Service Management Data Center versions prior to 3.16.1, the Ehcache object port can be randomly allocated.

### Vulnerability Description Key Phrases
- **rootcause:** **missing authentication vulnerability**
- **impact:** execute arbitrary code
- **vector:** deserialization
- **attacker:** attackers
- **product:** ['Jira Data Center', 'Jira Core Data Center', 'Jira Software Data Center', 'Jira Service Management Data Center']
- **version:** ['6.3.0 before 8.5.16', '8.6.0 before 8.13.8', '8.14.0 before 8.17.0', '2.0.2 before 4.5.16', '4.6.0 before 4.13.8', '4.14.0 before 4.17.0']
- **component:** Ehcache RMI network service

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause of Vulnerability:**

*   The vulnerability stems from a missing authentication check for the Ehcache RMI network service in Jira Data Center, Jira Core Data Center, Jira Software Data Center, and Jira Service Management Data Center. This allows attackers to connect to the service without proper authorization.

**Weaknesses/Vulnerabilities Present:**

*   **Missing Authentication:** The core issue is the lack of authentication for the Ehcache RMI service, which exposes it to unauthorized access.
*   **Unprotected RMI Service:** The RMI service is exposed without access controls on ports 40001 and potentially 40011. These ports can also be configured to be different.
*   **Java Deserialization Vulnerability:** The missing authentication allows for exploitation of Java deserialization vulnerabilities, allowing arbitrary code execution.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** Successful exploitation allows attackers to execute arbitrary code on the affected Jira server.
*   **Complete System Compromise:** This could potentially lead to full compromise of the Jira server and the data it manages.

**Attack Vectors:**

*   **Network Access:** Attackers need network access to the exposed Ehcache RMI service ports (40001, 40011 or configured custom ports). This includes attackers able to connect to the service from within the internal network.

**Required Attacker Capabilities/Position:**

*   **Network Connectivity:** The attacker needs network connectivity to the affected Jira Data Center instance.
*   **Understanding of Java Deserialization:**  The attacker would need to craft a malicious payload to exploit the deserialization vulnerability.
*   **No authentication required:** Attackers can connect to the Ehcache RMI service without authentication.

**Additional Information:**

*   The vulnerability affects various versions of Jira Data Center, Jira Core Data Center, Jira Software Data Center, and Jira Service Management Data Center.
*   Jira Cloud, Jira Service Management Cloud, and non-Data Center instances of Jira Server are not affected.
*   The fix involves requiring a shared secret for access to the Ehcache service.
*   Mitigation involves restricting access to the Ehcache RMI ports to only cluster instances using firewalls or similar technologies.
*   The issue is tracked under JRASERVER-72566 and JSDSERVER-8454.
*   The vulnerability is rated as "critical" with a CVSS score of 9.8.

The provided information gives a good understanding of the vulnerability, its impact, and how to remediate it, and aligns with the CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.8735 | sparse, graph | sparse: 0.976, graph: 0.882 |
| 2 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.7938 | dense, sparse, graph | dense: 0.460, sparse: 0.659, graph: 0.521 |
| 3 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.7876 | sparse, graph | sparse: 0.904, graph: 0.757 |
| 4 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.6761 | sparse, graph | sparse: 0.811, graph: 0.593 |
| 5 | CWE-917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | 0.6352 | dense, sparse | dense: 0.446, sparse: 0.720 |
| 6 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.6116 | dense, sparse | dense: 0.449, sparse: 0.676 |
| 7 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.6074 | dense, sparse | dense: 0.458, sparse: 0.661 |
| 8 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.4331 | sparse | sparse: 0.757 |
| 9 | CWE-295 | Improper Certificate Validation | Base | Allowed | 0.4000 | sparse | sparse: 0.699 |
| 10 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.3771 | sparse | sparse: 0.659 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-306 | Missing Authentication for Critical Function | 0.95 | Base | Allowed | The vulnerability stems from a **missing authentication vulnerability** for the Ehcache RMI network service, allowing attackers to execute arbitrary code. |
| CWE-502 | Deserialization of Untrusted Data | 0.75 | Base | Allowed | The **deserialization** vulnerability is a direct consequence of the missing authentication, allowing attackers to inject malicious serialized objects. |

## Evidence and Confidence

*   **Confidence Score:** 0.9
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* "The primary weakness is the **missing authentication vulnerability** (CWE-306) for the Ehcache RMI network service. This allows attackers to connect to the service without any form of identity verification. The CVE description and the Retriever Results both strongly support this. The vulnerability description states 'attackers, who can connect to the service, on port 40001 and potentially 40011, could execute arbitrary code of their choice in Jira through deserialization due to a **missing authentication vulnerability**.' The Retriever results show that CWE-306 has the highest score with 0.8735. The description aligns directly with CWE-306, as it highlights the absence of authentication for critical functionality. MITRE mapping guidance for CWE-306 indicates this is ALLOWED for cases where authentication is missing for critical functions."

  - *Relationship Analysis:* "CWE-306 is a base-level CWE. It's related to authentication bypass issues. While CWE-287 (Improper Authentication) is a parent, CWE-306 is more specific, indicating the complete absence of authentication rather than a flawed implementation. CWE-322 (Key Exchange without Entity Authentication) is also related, but less relevant as the issue isn't about key exchange, but a total lack of authentication. CWE-613 is related as the lack of authentication may improve the likely success of certain attacks."

- **Confidence Score:**  
  - *Example:* Confidence: 0.95 (Strong evidence from the vulnerability description and CVE reference materials.)

---
- **Analysis and Justification:**  
  - *Explanation:* "CWE-502 (Deserialization of Untrusted Data) is a secondary weakness. Because there is **missing authentication**, the attacker is able to exploit a deserialization vulnerability. The vulnerability description indicates that attackers can execute arbitrary code of their choice in Jira through deserialization. The retriever score is 0.6074. MITRE mapping guidance for CWE-502 indicates this is ALLOWED."
  
  - *Relationship Analysis:* "CWE-502 is a base-level CWE. It's related to weaknesses like CWE-917 (Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')) and CWE-1336 (Improper Neutralization of Special Elements Used in a Template Engine) because the attacker is able to inject code."
- **Confidence Score:**  
  - *Example:* Confidence: 0.75 (High evidence from technical description and CVE reference materials)

# CWE Examples from Database


## Known Examples for CWE-613: Insufficient Session Expiration
### Top 25 Examples
- **CVE-2021-25985**: In Factor (App Framework & Headless CMS) v1.0.4 to v1.8.30, improperly invalidate a user’s session even after the user logs out of the application. In addition, user sessions are stored in the browser’s local storage, which by default does not have an expiration time. This makes it possible for an attacker to steal and reuse the cookies using techniques such as XSS attacks, followed by a local account takeover.
- **CVE-2021-31408**: Authentication.logout() helper in com.vaadin:flow-client versions 5.0.0 prior to 6.0.0 (Vaadin 18), and 6.0.0 through 6.0.4 (Vaadin 19.0.0 through 19.0.3) uses incorrect HTTP method, which, in combination with Spring Security CSRF protection, allows local attackers to access Fusion endpoints after the user attempted to log out.
- **CVE-2021-3183**: Files.com Fat Client 3.3.6 allows authentication bypass because the client continues to have access after a logout and a removal of a login profile.
- **CVE-2021-20378**: IBM Guardium Data Encryption (GDE) 3.0.0.2 and 4.0.0.4 does not invalidate session after logout which could allow an authenticated user to impersonate another user on the system. IBM X-Force ID: 195709.
- **CVE-2021-3144**: In SaltStack Salt before 3002.5, eauth tokens can be used once after expiration. (They might be used to run command against the salt master or minions.)
- **CVE-2020-18701**: Incorrect Access Control in Lin-CMS-Flask v0.1.1 allows remote attackers to obtain sensitive information and/or gain privileges due to the application not invalidating a user's authentication token upon logout, which allows for replaying packets.
- **CVE-2021-22820**: A CWE-614 Insufficient Session Expiration vulnerability exists that could allow an attacker to maintain an unauthorized access over a hijacked session to the charger station web server even after the legitimate user account holder has changed his password. Affected Products: EVlink City EVC1S22P4 / EVC1S7P4 (All versions prior to R8 V3.4.0.2 ), EVlink Parking EVW2 / EVF2 / EVP2PE (All versions prior to R8 V3.4.0.2), and EVlink Smart Wallbox EVB1A (All versions prior to R8 V3.4.0.2)
- **CVE-2022-24895**: Symfony is a PHP framework for web and console applications and a set of reusable PHP components. When authenticating users Symfony by default regenerates the session ID upon login, but preserves the rest of session attributes. Because this does not clear CSRF tokens upon login, this might enables same-site attackers to bypass the CSRF protection mechanism by performing an attack similar to a session-fixation. This issue has been fixed in the 4.4 branch. 
- **CVE-2022-43844**: IBM Robotic Process Automation for Cloud Pak 20.12 through 21.0.3 is vulnerable to broken access control. A user is not correctly redirected to the platform log out screen when logging out of IBM RPA for Cloud Pak. IBM X-Force ID: 239081.
- **CVE-2022-30277**: BD Synapsys™, versions 4.20, 4.20 SR1, and 4.30, contain an insufficient session expiration vulnerability. If exploited, threat actors may be able to access, modify or delete sensitive information, including electronic protected health information (ePHI), protected health information (PHI) and personally identifiable information (PII).


# Relevant CWE Specifications

## CWE-613: Insufficient Session Expiration
**Abstraction:** Base
**Status:** Incomplete

### Description
According to WASC, "Insufficient Session Expiration is when a web site permits an attacker to reuse old session credentials or session IDs for authorization."

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-672
ChildOf -> CWE-672
CanPrecede -> CWE-287
RequiredBy -> CWE-352

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Description:** Set sessions/credentials expiration date.



### Additional Notes
**[Other]** The lack of proper session expiration may improve the likely success of certain attacks. For example, an attacker may intercept a session ID, possibly via a network sniffer or Cross-site Scripting attack. Although short session expiration times do not help if a stolen token is immediately used, they will protect against ongoing replaying of the session ID. In another scenario, a user might access a web site from a shared computer (such as at a library, Internet cafe, or open work environment). Insufficient Session Expiration could allow an attacker to use the browser's back button to access web pages previously accessed by the victim.





## CWE-502: Deserialization of Untrusted Data
**Abstraction:** Base
**Status:** Draft

### Description
The product deserializes untrusted data without sufficiently ensuring that the resulting data will be valid.

### Extended Description
Not provided

### Alternative Terms
Marshaling, Unmarshaling: Marshaling and unmarshaling are effectively synonyms for serialization and deserialization, respectively.
Pickling, Unpickling: In Python, the "pickle" functionality is used to perform serialization and deserialization.
PHP Object Injection: Some PHP application researchers use this term when attacking unsafe use of the unserialize() function; but it is also used for CWE-915.

### Relationships
ChildOf -> CWE-913
ChildOf -> CWE-913
PeerOf -> CWE-915

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Implementation
- **Description:** If available, use the signing/sealing features of the programming language to assure that deserialized data has not been tainted. For example, a hash-based message authentication code (HMAC) could be used to ensure that data has not been modified.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** When deserializing data, populate a new object rather than just deserializing. The result is that the data flows through safe input validation and that the functions are safe.

**Mitigation 3:**
- **Phase:** Implementation
- **Description:** Explicitly define a final object() to prevent deserialization.



### Additional Notes
**[Maintenance]** The relationships between CWE-502 and CWE-915 need further exploration. CWE-915 is more narrowly scoped to object modification, and is not necessarily used for deserialization.



### Observed Examples
- **CVE-2019-12799:** chain: bypass of untrusted deserialization issue (CWE-502) by using an assumed-trusted class (CWE-183)
- **CVE-2015-8103:** Deserialization issue in commonly-used Java library allows remote execution.
- **CVE-2015-4852:** Deserialization issue in commonly-used Java library allows remote execution.



## CWE-917: Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')
**Abstraction:** Base
**Status:** Incomplete

### Description
The product constructs all or part of an expression language (EL) statement in a framework such as a Java Server Page (JSP) using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended EL statement before it is executed.

### Extended Description
Frameworks such as Java Server Page (JSP) allow a developer to insert executable expressions within otherwise-static content. When the developer is not aware of the executable nature of these expressions and/or does not disable them, then if an attacker can inject expressions, this could lead to code execution or other unexpected behaviors.

### Alternative Terms
EL Injection

### Relationships
ChildOf -> CWE-77
PeerOf -> CWE-1336
ChildOf -> CWE-74
ChildOf -> CWE-77
ChildOf -> CWE-77

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** Avoid adding user-controlled data into an expression interpreter when possible.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** 

If user-controlled data must be added to an expression interpreter, one or more of the following should be performed:


  - Validate that the user input will not evaluate as an expression

  - Encode the user input in a way that ensures it is not evaluated as an expression



**Mitigation 3:**
- **Phase:** System Configuration, Operation
- **Description:** The framework or tooling might allow the developer to disable or deactivate the processing of EL expressions, such as setting the isELIgnored attribute for a JSP page to "true".



### Additional Notes
**[Maintenance]** The interrelationships and differences between CWE-917 and CWE-1336 need to be further clarified.

**[Relationship]** In certain versions of Spring 3.0.5 and earlier, there was a vulnerability (CVE-2011-2730) in which Expression Language tags would be evaluated twice, which effectively exposed any application to EL injection. However, even for later versions, this weakness is still possible depending on configuration.



### Observed Examples
- **CVE-2021-44228:** Product does not neutralize ${xyz} style expressions, allowing remote code execution. (log4shell vulnerability in log4j)



## CWE-287: Improper Authentication
**Abstraction:** Class
**Status:** Draft

### Description
When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.

### Extended Description
Not provided

### Alternative Terms
authentification: An alternate term is "authentification", which appears to be most commonly used by people from non-English-speaking countries.
AuthN: "AuthN" is typically used as an abbreviation of "authentication" within the web application security community. It is also distinct from "AuthZ," which is an abbreviation of "authorization." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.
AuthC: "AuthC" is used as an abbreviation of "authentication," but it appears to used less frequently than "AuthN."

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1390
ParentOf -> CWE-290
ParentOf -> CWE-294
ParentOf -> CWE-295
ParentOf -> CWE-306
ParentOf -> CWE-307
ParentOf -> CWE-521
ParentOf -> CWE-522
CanFollow -> CWE-613
ParentOf -> CWE-640
ParentOf -> CWE-645
ParentOf -> CWE-798

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry might be misused when lower-level CWE entries are likely to be applicable. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children or descendants, beginning with CWE-1390: Weak Authentication or CWE-306: Missing Authentication for Critical Function.
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1390: Weak Authentication
- CWE-306: Missing Authentication for Critical Function


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an authentication framework or library such as the OWASP ESAPI Authentication feature.



### Additional Notes
**[Relationship]** This can be resultant from SQL injection vulnerabilities and other issues.

**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-35248:** Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436:** Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034:** Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).



## CWE-322: Key Exchange without Entity Authentication
**Abstraction:** Base
**Status:** Draft

### Description
The product performs a key exchange with an actor without verifying the identity of that actor.

### Extended Description
Performing a key exchange will preserve the integrity of the information sent between two entities, but this will not guarantee that the entities are who they claim they are. This may enable an attacker to impersonate an actor by modifying traffic between the two entities. Typically, this involves a victim client that contacts a malicious server that is impersonating a trusted server. If the client skips authentication or ignores an authentication failure, the malicious server may request authentication information from the user. The malicious server can then use this authentication information to log in to the trusted server using the victim's credentials, sniff traffic between the victim and trusted server, etc.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-306
CanPrecede -> CWE-923
PeerOf -> CWE-295

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** Ensure that proper authentication is included in the system design.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** Understand and properly implement all checks necessary to ensure the identity of entities involved in encrypted communications.






## CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine
**Abstraction:** Base
**Status:** Incomplete

### Description
The product uses a template engine to insert or process externally-influenced input, but it does not neutralize or incorrectly neutralizes special elements or syntax that can be interpreted as template expressions or other code directives when processed by the engine.

### Extended Description


Many web applications use template engines that allow developers to insert externally-influenced values into free text or messages in order to generate a full web page, document, message, etc. Such engines include Twig, Jinja2, Pug, Java Server Pages, FreeMarker, Velocity, ColdFusion, Smarty, and many others - including PHP itself. Some CMS (Content Management Systems) also use templates.


Template engines often have their own custom command or expression language. If an attacker can influence input into a template before it is processed, then the attacker can invoke arbitrary expressions, i.e. perform injection attacks. For example, in some template languages, an attacker could inject the expression "{{7*7}}" and determine if the output returns "49" instead. The syntax varies depending on the language.


In some cases, XSS-style attacks can work, which can obscure the root cause if the developer does not closely investigate the root cause of the error.


Template engines can be used on the server or client, so both "sides" could be affected by injection. The mechanisms of attack or the affected technologies might be different, but the mistake is fundamentally the same.


### Alternative Terms
Server-Side Template Injection / SSTI: This term is used for injection into template engines being used by a server.
Client-Side Template Injection / CSTI: This term is used for injection into template engines being used by a client.

### Relationships
ChildOf -> CWE-94

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** Choose a template engine that offers a sandbox or restricted mode, or at least limits the power of any available expressions, function calls, or commands.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** Use the template engine's sandbox or restricted mode, if available.



### Additional Notes
**[Relationship]** Since expression languages are often used in templating languages, there may be some overlap with CWE-917 (Expression Language Injection). XSS (CWE-79) is also co-located with template injection.

**[Maintenance]** The interrelationships and differences between CWE-917 and CWE-1336 need to be further clarified.



### Observed Examples
- **CVE-2024-34359:** Chain: Python bindings for LLM library do not use a sandboxed environment when parsing a template and constructing a prompt, allowing jinja2 Server Side Template Injection and code execution - one variant of a "prompt injection" attack.
- **CVE-2017-16783:** server-side template injection in content management server
- **CVE-2020-9437:** authentication / identity management product has client-side template injection



## CWE-306: Missing Authentication for Critical Function
**Abstraction:** Base
**Status:** Draft

### Description
The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-287
ChildOf -> CWE-287
ParentOf -> CWE-288
ParentOf -> CWE-322

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the software into anonymous, normal, privileged, and administrative areas. Identify which of these areas require a proven user identity, and use a centralized authentication capability.


Identify all potential communication channels, or other means of interaction with the software, to ensure that all channels are appropriately protected, including those channels that are assumed to be accessible only by authorized parties. Developers sometimes perform authentication at the primary channel, but open up a secondary channel that is assumed to be private. For example, a login mechanism may be listening on one network port, but after successful authentication, it may open up a second port where it waits for the connection, but avoids authentication because it assumes that only the authenticated party will connect to the port.


In general, if the software or protocol allows a single session or user state to persist across multiple connections or channels, authentication and appropriate credential management need to be used throughout.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** 

Where possible, avoid implementing custom, "grow-your-own" authentication routines and consider using authentication capabilities as provided by the surrounding framework, operating system, or environment. These capabilities may avoid common weaknesses that are unique to authentication; support automatic auditing and tracking; and make it easier to provide a clear separation between authentication tasks and authorization tasks.


In environments such as the World Wide Web, the line between authentication and authorization is sometimes blurred. If custom authentication routines are required instead of those provided by the server, then these routines must be applied to every single page, since these pages could be requested directly.





### Observed Examples
- **CVE-2022-31260:** Chain: a digital asset management program has an undisclosed backdoor in the legacy version of a PHP script (CWE-912) that could allow an unauthenticated user to export metadata (CWE-306)
- **CVE-2022-29951:** TCP-based protocol in Programmable Logic Controller (PLC) has no authentication.
- **CVE-2022-29952:** Condition Monitor firmware uses a protocol that does not require authentication.

