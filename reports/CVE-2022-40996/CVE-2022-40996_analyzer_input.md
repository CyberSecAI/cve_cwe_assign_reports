# Vulnerability Information: CVE-2022-40996

## Vulnerability Description
Several **stack-based buffer overflow** vulnerabilities exist in the DetranCLI command parsing functionality of Siretta QUARTZ-GOLD G5.0.1.5-210720-141020. A specially-crafted network packet can lead to arbitrary command execution. An attacker can send a sequence of requests to trigger these vulnerabilities.This buffer overflow is in the function that manages the no firmwall srcmac (WORD|null) srcip (A.B.C.D|null) dstip (A.B.C.D|null) protocol (none|tcp|udp|icmp) srcport (|null) dstport (|null) policy (drop|accept) description (WORD|null) command template.

### Vulnerability Description Key Phrases
- **rootcause:** **stack-based buffer overflow**
- **impact:** arbitrary command execution
- **vector:** specially-crafted network packet
- **attacker:** attacker
- **product:** Siretta QUARTZ-GOLD
- **version:** G5.0.1.5-210720-141020
- **component:** DetranCLI command parsing functionality

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-120

#### Top CWEs
- CWE-120 (Count: 86)
- CWE-787 (Count: 30)

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The `DetranCLI` binary uses `sprintf` with format strings to construct commands. The size of the input parameters are not validated against the buffer size, which leads to stack-based buffer overflows.
- **Weaknesses/vulnerabilities present:** Stack-based buffer overflow vulnerabilities due to the usage of `sprintf` without size checks when handling command parameters.
- **Impact of exploitation:** Arbitrary command execution by sending a sequence of crafted network packets. This can lead to full control of the device.
- **Attack vectors:** Sending specially crafted network packets to the device.
- **Required attacker capabilities/position:** The attacker needs the ability to send network packets to the device. Access to the device's CLI interface is also needed which may imply needing valid credentials.

**Specific details for CVE-2022-40996:**

- **Vulnerable command template:**
  ```
  no firmwall srcmac (WORD|null) srcip (A.B.C.D|null) dstip (A.B.C.D|null) protocol (none|tcp|udp|icmp) srcport (<1-65535>|null) dstport (<1-65535>|null) policy (drop|accept) description (WORD|null)
  ```
- **Vulnerable code:**
  ```c
  sprintf(buff_0x100,"%d<%s<%s<%s<%d<%s<%s<%d<%s",1,*argv,argv[1],argv[2],depentent_on_argv[3],argv[4],argv[5],depentent_on_argv[6],argv[7]);
  ```
- This command is used to remove firewall rules based on source MAC address.
- The `sprintf` function copies the command parameters into `buff_0x100` (a 256-byte buffer). If any of the parameters are too long, a stack-based buffer overflow occurs.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 1.2236 | dense, sparse, graph | dense: 0.704, sparse: 1.000, graph: 1.000 |
| 2 | CWE-193 | Off-by-one Error | Base | Allowed | 0.8651 | dense, sparse, graph | dense: 0.561, sparse: 0.396, graph: 1.000 |
| 3 | CWE-170 | Improper Null Termination | Base | Allowed | 0.5995 | sparse, graph | sparse: 0.423, graph: 1.000 |
| 4 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5194 | dense, sparse | dense: 0.668, sparse: 0.399 |
| 5 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5082 | dense, sparse | dense: 0.556, sparse: 0.402 |
| 6 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.5060 | dense, sparse | dense: 0.569, sparse: 0.387 |
| 7 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4845 | dense, sparse | dense: 0.567, sparse: 0.351 |
| 8 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4791 | dense, sparse | dense: 0.552, sparse: 0.355 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4604 | dense, sparse | dense: 0.585, sparse: 0.360 |
| 10 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 0.2183 | sparse | sparse: 0.382 |

