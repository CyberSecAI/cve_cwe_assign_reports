# Vulnerability Information: CVE-2021-28918

## Vulnerability Description
**Improper input validation** of octal strings in netmask npm package v1.0.6 and below allows unauthenticated remote attackers to perform indeterminate SSRF, RFI, and LFI attacks on many of the dependent packages. A remote unauthenticated attacker can bypass packages relying on netmask to filter IPs and reach critical VPN or LAN hosts.

### Vulnerability Description Key Phrases
- **rootcause:** **Improper input validation**
- **impact:** SSRF and RFI and LFI
- **attacker:** remote unauthenticated attacker
- **product:** netmask npm package
- **version:** v1.0.6 and below

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described in relation to CVE-2021-28918:

**Root Cause of Vulnerability:**

The `netmask` npm package incorrectly parses IPv4 addresses that contain leading zeros. It treats octal representations (numbers prefixed with "0") as decimal numbers, stripping the leading zeros, rather than interpreting them as octal values. This behavior deviates from how other systems, like web browsers, interpret such mixed-format IP addresses.

**Weaknesses/Vulnerabilities Present:**

*   **Improper Input Validation:** The core issue is the lack of proper validation and handling of octal strings within IPv4 address inputs.
*   **Incorrect IP Parsing:** The library fails to correctly interpret octal representations of IPv4 addresses leading to misinterpretations of the actual IP address.

**Impact of Exploitation:**

*   **SSRF Bypass:** Attackers can bypass Server-Side Request Forgery (SSRF) protections by crafting IP addresses with leading zeros. For example, `0177.0.0.1` (octal for 127.0.0.1) could be used to access the local loopback address even if the application filters for private IP addresses.
*   **RFI/LFI:** By manipulating the octets of IP addresses with leading zeros, attackers can cause the application to treat public IPs as private IPs or vice-versa. This can lead to Remote File Inclusion (RFI) or Local File Inclusion (LFI) vulnerabilities.
*   **ACL Bypass:** IP-based Access Control Lists (ACLs) can be bypassed, as `netmask` would interpret the crafted IP addresses differently than the systems it is intended to protect. This can lead to unauthorized access to systems and networks.

**Attack Vectors:**

*   **Network Requests:** Attacker influences the IP address input that is parsed by the application.
*   **Webhooks:** Systems that expose webhooks and validate user URLs using `netmask` are vulnerable.
*   **IP Filtering:** Systems using netmask for IP filtering (e.g. WAFs) can be bypassed by providing crafted IP addresses with leading zeros.

**Required Attacker Capabilities/Position:**

*   **Ability to Influence IP Input:** The attacker needs the ability to provide the input to a system or application that parses IP addresses using the vulnerable `netmask` library.
*   **No Authentication Required:** The vulnerability can be exploited by unauthenticated attackers in many cases.
*   **Network Access:** Attackers exploit this vulnerability remotely over a network.

**Additional details from the content:**

*   The vulnerability was initially addressed in `netmask` version 2.0.0 but was found to be incomplete. The issue was assigned a new CVE (CVE-2021-29418). A complete fix was released in version 2.0.1.
*   The Perl component `Net::Netmask` also had the same vulnerability.
*   The `private-ip` package, which uses `netmask` as a dependency was also vulnerable.

This vulnerability is a supply chain issue because it affects many applications that depend on the vulnerable `netmask` library.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1389 | Incorrect Parsing of Numbers with Different Radices | Base | Allowed | 0.6103 | dense, sparse | dense: 0.646, sparse: 0.502 |
| 2 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.6009 | dense, sparse, graph | dense: 0.497, sparse: 0.235, graph: 0.609 |
| 3 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.5925 | dense, sparse, graph | dense: 0.526, sparse: 0.204, graph: 0.594 |
| 4 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.5764 | dense, sparse, graph | dense: 0.497, sparse: 0.212, graph: 0.577 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4753 | sparse, graph | sparse: 0.206, graph: 1.000 |
| 6 | CWE-73 | External Control of File Name or Path | Base | Allowed | 0.4669 | sparse, graph | sparse: 0.191, graph: 1.000 |
| 7 | CWE-1333 | Inefficient Regular Expression Complexity | Base | Allowed | 0.3896 | sparse, graph | sparse: 0.208, graph: 0.757 |
| 8 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.3343 | sparse, graph | sparse: 0.190, graph: 0.631 |
| 9 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.2710 | dense, sparse, graph | dense: 0.530, sparse: 0.203, graph: 0.628 |
| 10 | CWE-287 | Improper Authentication | Class | Discouraged | 0.1648 | dense, sparse | dense: 0.509, sparse: 0.199 |

