# Vulnerability Information: CVE-2020-5232

## Vulnerability Description
A user who owns an ENS domain can **set a trapdoor**, allowing them to transfer ownership to another user, and later regain ownership without the new owners consent or awareness. A new ENS deployment is being rolled out that fixes this vulnerability in the ENS registry.

### Vulnerability Description Key Phrases
- **weakness:** **set a trapdoor**
- **impact:** transfer ownership to another user, and later regain ownership without the new owners consent or awareness
- **attacker:** user who owns an ENS domain
- **product:** ENS registry

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2020-5232:

**Root Cause of Vulnerability:**
The vulnerability stems from a flaw in the ENS (Ethereum Name Service) registry contract. Specifically, a malicious owner of an ENS domain could create a "trapdoor" allowing them to transfer ownership to another user, but subsequently regain ownership without the new owner's consent or knowledge. This implies an issue in how ownership transfers were handled in the old contract.

**Weaknesses/Vulnerabilities Present:**
- **Flawed Ownership Transfer Logic:** The core issue was a vulnerability in the logic governing how ownership of ENS domains was transferred. This allowed a previous owner to circumvent normal ownership transfer mechanisms.

**Impact of Exploitation:**
- **Malicious Takeover:** An attacker who previously owned an ENS domain could regain control of the domain even after transferring it to a new owner. This is a complete takeover, effectively rendering the new owner powerless over their purchased domain.
- **Loss of Control:** Legitimate owners of ENS domains who had received a transfer of ownership were vulnerable to having their domains seized without their consent.
- **Deception and Unawareness:** The new owner would not be aware of the trapdoor mechanism, leading to a deceptive seizure of the domain.

**Attack Vectors:**
- The attack vector is through the `setSubnodeOwner` function of the old ENS registry.
- An attacker first owns an ENS domain.
- The attacker transfers the domain to a victim using the flawed method.
- The attacker then uses the exploit to regain ownership of the domain.

**Required Attacker Capabilities/Position:**
- **Previous ENS Domain Ownership:** The attacker must have previously owned the ENS domain they intend to seize.
- **Knowledge of Vulnerability:** The attacker needs to understand how the "trapdoor" within the old ENS registry contract could be exploited.
- **Ability to Interact with Contract:** The attacker must be able to interact directly with the vulnerable smart contract, specifically the transfer of ownership functionality of the old contract.

**Additional Details:**
- **Patches:** A new ENS deployment at address `0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e` was rolled out to fix the vulnerability in the ENS registry.
- **Workarounds:** Users were advised not to accept ENS domain transfers from others using the old registrar.
- **Migration Guide:** A migration guide was provided to assist dApp developers with the transition to the new ENS registry.
- **Affected Versions:** Versions 0.1.0 and greater of the `@ensdomains/ens` npm package were affected.
- **Patched Versions:** Version 0.4.0 of the `@ensdomains/ens` npm package contains the fix.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-283 | Unverified Ownership | Base | Allowed | 0.7429 | dense, sparse, graph | dense: 0.486, sparse: 0.491, graph: 0.614 |
| 2 | CWE-708 | Incorrect Ownership Assignment | Base | Allowed | 0.5142 | dense, sparse, graph | dense: 0.387, sparse: 0.185, graph: 0.600 |
| 3 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.3753 | sparse, graph | sparse: 0.163, graph: 0.789 |
| 4 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.3745 | sparse, graph | sparse: 0.182, graph: 0.757 |
| 5 | CWE-212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | 0.3741 | sparse, graph | sparse: 0.181, graph: 0.757 |
| 6 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.0994 | sparse | sparse: 0.174 |
| 7 | CWE-776 | Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion') | Base | Allowed | 0.0954 | sparse | sparse: 0.167 |
| 8 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.0930 | sparse | sparse: 0.163 |
| 9 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.0925 | sparse | sparse: 0.162 |
| 10 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.0923 | sparse | sparse: 0.161 |

