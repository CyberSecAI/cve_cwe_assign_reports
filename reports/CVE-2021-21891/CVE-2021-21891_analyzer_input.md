# Vulnerability Information: CVE-2021-21891

## Vulnerability Description
A **stack-based buffer overflow** vulnerability exists in the Web Manager FsBrowseClean functionality of Lantronix PremierWave 2050 8.9.0.0R4 (in QEMU). A specially crafted HTTP request can lead to remote code execution in the vulnerable portion of the branch (deletefile). An attacker can make an authenticated HTTP request to trigger this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **stack-based buffer overflow**
- **impact:** remote code execution
- **vector:** specially crafted HTTP request
- **attacker:** attacker
- **product:** Lantronix PremierWave 2050
- **version:** 8.9.0.0R4
- **component:** Web Manager FsBrowseClean functionality

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 9)

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2021-21891

**Root Cause:** Stack-based buffer overflow vulnerability within the `FsBrowseClean` functionality of the Lantronix PremierWave 2050 Web Manager application (`ltrx_evo`). The vulnerability is caused by the use of `sprintf` with a fixed-size buffer and a user-controlled source, without any size validation, leading to a buffer overflow.

**Vulnerabilities:**
*   **CWE-121 Stack-based Buffer Overflow:** Two exploitable calls to `sprintf` exist within the function handling `FsBrowseClean`. Both are vulnerable because the `path` parameter, which is user-controlled, is copied into a fixed-size buffer on the stack using `sprintf` without any validation of its length.
*   The vulnerable code is triggered based on the `action` POST parameter being either `"deletedir"` or `"deletefile"`.

**Impact:**
*   **Remote Code Execution:** Successful exploitation allows an authenticated attacker to overflow a buffer on the stack, corrupt the stack frame, and gain control of the program counter, resulting in remote code execution.
*   **Denial of Service:** Overflows can cause crashes and potentially cause denial of service.

**Attack Vectors:**
*   **HTTP Request:** The vulnerability is triggered by sending a specially crafted authenticated HTTP request to the `/` endpoint, targeting the `FsBrowseClean` AJAX directive.
*   **POST Parameters:** The attacker must include the following POST parameters:
    *   `ajax=FsBrowseClean` to target the vulnerable functionality.
    *   `action` set to either `"deletedir"` or `"deletefile"` to trigger the specific vulnerable code paths
    *   `dir` with any non empty value
    *   `path` with a string large enough to overflow the fixed-size buffer.

**Required Attacker Capabilities/Position:**
*   **Authentication:** The attacker must be authenticated to the web management interface of the Lantronix PremierWave 2050 device.
*   **`filesystem` Permission:** The authenticated user must have `filesystem` permissions to access the vulnerable functionality.
*   **Network Access:** Attacker requires network connectivity to the target device's web interface.

**Additional Notes:**
* The report provides assembly code snippets and a decompiled snippet of the vulnerable code, making it easier to understand the vulnerability's mechanics and locate the vulnerable `sprintf` calls.
*  The content provides specific exploit Proof of Concepts (PoCs) using `curl`, showing how to trigger the overflow with both `action` values.
*   The crash information provides register values from a crash caused by the buffer overflow, confirming successful exploitation.
*  The report mentions that there are two different overflows possible, depending on the "action" parameter value, and are tracked under the same Talos report ID (TALOS-2021-1334) as well as two different CVE IDs (CVE-2021-21890 and CVE-2021-21891).

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.8202 | dense, sparse, graph | dense: 0.574, sparse: 0.307, graph: 1.000 |
| 2 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.7034 | dense, sparse, graph | dense: 0.576, sparse: 0.310, graph: 0.758 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5240 | sparse, graph | sparse: 0.291, graph: 1.000 |
| 4 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4875 | dense, sparse | dense: 0.662, sparse: 0.344 |
| 5 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4295 | sparse, graph | sparse: 0.258, graph: 0.789 |
| 6 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4181 | dense, sparse | dense: 0.586, sparse: 0.279 |
| 7 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.4092 | dense, sparse | dense: 0.581, sparse: 0.266 |
| 8 | CWE-195 | Signed to Unsigned Conversion Error | Variant | Allowed | 0.3764 | sparse, graph | sparse: 0.258, graph: 0.729 |
| 9 | CWE-119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | 0.2980 | dense, sparse, graph | dense: 0.583, sparse: 0.256, graph: 0.637 |
| 10 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.2638 | dense, sparse | dense: 0.563, sparse: 0.292 |

