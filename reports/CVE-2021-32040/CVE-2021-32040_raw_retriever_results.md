# Raw Retriever Results for CVE-2021-32040

# Raw Retriever Results for CVE-2021-32040

## Query
It may be possible to have an extremely long aggregation pipeline in conjunction with a specific stage/operator and cause a stack overflow due to the size of the stack frames used by that stage. If an attacker could cause such an aggregation to occur, they could maliciously crash MongoDB in a DoS attack. This vulnerability affects MongoDB Server v4.4 versions prior to and including 4.4.28, MongoDB Server v5.0 versions prior to 5.0.4 and MongoDB Server v4.2 versions prior to 4.2.16. Workaround >= v4.2.16 users and all v4.4 users can add the --setParameter internalPipelineLengthLimit=50 instead of the default 1000 to mongod at startup to prevent a crash.

## Keyphrases
- **rootcause**: extremely long aggregation pipeline, stack overflow

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.3443 | 0.4213 | 0.3707 | 0.3687 | 20 |
| Sparse | 593.1682 | 689.3243 | 627.9187 | 615.2563 | 20 |
| Graph | 1.3010 | 2.8143 | 1.7116 | 1.5758 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | 2.8143 | Allowed |
| 2 | 789 | Memory Allocation with Excessive Size Value | Variant | 2.5264 | Allowed |
| 3 | 476 | NULL Pointer Dereference | base | 2.2100 | Allowed |
| 4 | 129 | Improper Validation of Array Index | variant | 2.0400 | Allowed |
| 5 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | base | 1.7680 | Allowed |
| 6 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 7 | 823 | Use of Out-of-range Pointer Offset | base | 1.7680 | Allowed |
| 8 | 252 | Unchecked Return Value | base | 1.6848 | Allowed |
| 9 | 770 | Allocation of Resources Without Limits or Throttling | Base | 1.6506 | Allowed |
| 10 | 409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | 1.5817 | Allowed |
| 11 | 1049 | Excessive Data Query Operations in a Large Data Table | Base | 1.5699 | Allowed |
| 12 | 1339 | Insufficient Precision or Accuracy of a Real Number | base | 1.5350 | Allowed |
| 13 | 787 | Out-of-bounds Write | base | 1.5262 | Allowed |
| 14 | 410 | Insufficient Resource Pool | Base | 1.4997 | Allowed |
| 15 | 1284 | Improper Validation of Specified Quantity in Input | Base | 1.4808 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | 0.4213 | 0.4213 | Allowed |
| 2 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | 0.4030 | 0.4030 | Allowed |
| 3 | 774 | Allocation of File Descriptors or Handles Without Limits or Throttling | Variant | 0.3927 | 0.3927 | Allowed |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | Base | 0.3898 | 0.3898 | Allowed |
| 5 | 1049 | Excessive Data Query Operations in a Large Data Table | Base | 0.3897 | 0.3897 | Allowed |
| 6 | 674 | Uncontrolled Recursion | Class | 0.3815 | 0.3815 | Allowed-with-Review |
| 7 | 410 | Insufficient Resource Pool | Base | 0.3802 | 0.3802 | Allowed |
| 8 | 1089 | Large Data Table with Excessive Number of Indices | Base | 0.3795 | 0.3795 | Allowed |
| 9 | 789 | Memory Allocation with Excessive Size Value | Variant | 0.3702 | 0.3702 | Allowed |
| 10 | 779 | Logging of Excessive Data | Base | 0.3697 | 0.3697 | Allowed |
| 11 | 1176 | Inefficient CPU Computation | Class | 0.3678 | 0.3678 | Allowed-with-Review |
| 12 | 834 | Excessive Iteration | Class | 0.3646 | 0.3646 | Discouraged |
| 13 | 121 | Stack-based Buffer Overflow | Variant | 0.3596 | 0.3596 | Allowed |
| 14 | 406 | Insufficient Control of Network Message Volume (Network Amplification) | Class | 0.3576 | 0.3576 | Allowed-with-Review |
| 15 | 1050 | Excessive Platform Resource Consumption within a Loop | Base | 0.3508 | 0.3508 | Allowed |

## Sparse Retriever Results (20)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | CWE-400 | Uncontrolled Resource Consumption | 689.3243 | 689.3243 | Discouraged |
| 2 | CWE-121 | Stack-based Buffer Overflow | 682.2444 | 682.2444 | Allowed |
| 3 | CWE-674 | Uncontrolled Recursion | 664.2504 | 664.2504 | Allowed-with-Review |
| 4 | CWE-755 | Improper Handling of Exceptional Conditions | 654.7361 | 654.7361 | Discouraged |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | 653.4656 | 653.4656 | Allowed |
| 6 | CWE-770 | Allocation of Resources Without Limits or Throttling | 651.4077 | 651.4077 | Allowed |
| 7 | CWE-295 | Improper Certificate Validation | 634.7035 | 634.7035 | Allowed |
| 8 | CWE-1284 | Improper Validation of Specified Quantity in Input | 632.8778 | 632.8778 | Allowed |
| 9 | CWE-20 | Improper Input Validation | 629.2707 | 629.2707 | Discouraged |
| 10 | CWE-269 | Improper Privilege Management | 616.2043 | 616.2043 | Discouraged |
| 11 | CWE-306 | Missing Authentication for Critical Function | 614.3083 | 614.3083 | Allowed |
| 12 | CWE-190 | Integer Overflow or Wraparound | 613.3144 | 613.3144 | Allowed |
| 13 | CWE-126 | Buffer Over-read | 609.1626 | 609.1626 | Allowed |
| 14 | CWE-193 | Off-by-one Error | 607.8791 | 607.8791 | Allowed |
| 15 | CWE-1333 | Inefficient Regular Expression Complexity | 607.2147 | 607.2147 | Allowed |
