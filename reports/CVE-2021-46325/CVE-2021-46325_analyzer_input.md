# Vulnerability Information: CVE-2021-46325

## Vulnerability Description
Espruino 2v10.246 was discovered to contain a **stack buffer overflow** via src/jsutils.c in vcbprintf.

### Vulnerability Description Key Phrases
- **weakness:** **stack buffer overflow**
- **product:** Espruino 2
- **version:** v10.246
- **component:** src/jsutils.c in vcbprintf

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

- The vulnerability stems from a stack buffer overflow in the `vcbprintf` function within `src/jsutils.c`.
- The issue occurs when formatting a string, specifically within the context of `JSON.stringify` when an object is used for the whitespace argument. The object is converted to string, but it's not null-terminated properly.
- Additionally, there is a secondary cause within `vcbprintf` related to format strings ending with `"%0"`. The function increments the `fmt` pointer without checking for the null terminator, causing it to read out of bounds of the string.

**Weaknesses/Vulnerabilities Present:**

- **Stack Buffer Overflow:** The `vcbprintf` function attempts to write past the end of allocated buffer in the stack. This is caused by a missing null termination of an intermediate string, and by incrementing the `fmt` pointer without checking for null termination, leading to reads out of bounds.

**Impact of Exploitation:**

- **Crash/Denial of Service:** The stack buffer overflow causes a crash due to the AddressSanitizer detecting the overflow in memory, leading to a denial of service condition.
- **Potential Arbitrary Code Execution:** While not explicitly stated, stack buffer overflows can potentially lead to arbitrary code execution if exploited with carefully crafted inputs.

**Attack Vectors:**

- **`JSON.stringify` with Object as Whitespace:** Passing a non-string object as the `whitespace` argument to `JSON.stringify`, will lead to the object being converted to string, with missing null termination, this string is then passed to `cbprintf`, leading to the overflow.
- **Malicious Format String:** Passing format strings ending in "%0" will cause the `vcbprintf` function to read out of bounds of the format string.

**Required Attacker Capabilities/Position:**

- The attacker needs to be able to execute Javascript code that uses `JSON.stringify` with an object as the `whitespace` parameter or provide format strings ending in "%0".

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.5797 | dense, sparse, graph | dense: 0.559, sparse: 0.091, graph: 0.693 |
| 2 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.5377 | dense, sparse, graph | dense: 0.537, sparse: 0.103, graph: 0.586 |
| 3 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5340 | dense, sparse, graph | dense: 0.558, sparse: 0.089, graph: 0.694 |
| 4 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3979 | sparse, graph | sparse: 0.104, graph: 1.000 |
| 5 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3344 | dense, sparse | dense: 0.571, sparse: 0.133 |
| 6 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3303 | sparse, graph | sparse: 0.084, graph: 0.789 |
| 7 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.3303 | dense, sparse | dense: 0.554, sparse: 0.093 |
| 8 | CWE-193 | Off-by-one Error | Base | Allowed | 0.3248 | dense, sparse | dense: 0.536, sparse: 0.099 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3161 | dense, sparse | dense: 0.561, sparse: 0.108 |
| 10 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3148 | dense, sparse | dense: 0.512, sparse: 0.103 |

