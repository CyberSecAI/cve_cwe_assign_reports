# Vulnerability Information: CVE-2022-20371

## Vulnerability Description
In dm_bow_dtr and related functions of dm-bow.c, there is a possible **use after free** due to a **race condition**. This could lead to local escalation of privilege with System execution privileges needed. User interaction is not needed for exploitation.Product AndroidVersions Android kernelAndroid ID A-195565510References Upstream kernel

### Vulnerability Description Key Phrases
- **rootcause:** **race condition**
- **weakness:** **use after free**
- **impact:** local escalation of privilege
- **product:** Android kernel
- **component:** dm_bow_dtr and related functions of dm-bow.c

## CVE Reference Links Content Summary
```
{
  "Root cause of vulnerability": "The commit message indicates a fix for protecting ranges fetched and erased from the RB tree in the dm-bow (Device Mapper Block Oriented Write) component.",
  "Weaknesses/vulnerabilities present": "The vulnerability lies in the lack of proper protection for ranges fetched and erased from the RB tree, which could lead to incorrect memory management or data corruption.",
  "Impact of exploitation": "The impact is described as 'Elevation of Privilege' (EoP) with a 'Moderate' severity rating, indicating that a successful exploit could allow an attacker to gain higher privileges than intended. This could potentially lead to unauthorized access, data modification, or system compromise.",
  "Attack vectors": "The specific attack vector isn't detailed in the provided information but it involves exploiting the vulnerable memory management related to ranges in the RB tree within the dm-bow component.",
  "Required attacker capabilities/position": "The attacker needs to be able to interact with the dm-bow component to trigger the vulnerable memory operations. It is likely the attacker needs some level of access to the system already."
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-413 | Improper Resource Locking | Base | Allowed | 0.8971 | dense, sparse, graph | dense: 0.569, sparse: 0.684, graph: 0.618 |
| 2 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.8018 | dense, sparse, graph | dense: 0.560, sparse: 0.473, graph: 0.701 |
| 3 | CWE-366 | Race Condition within a Thread | Base | Allowed | 0.7846 | dense, sparse, graph | dense: 0.571, sparse: 0.488, graph: 0.614 |
| 4 | CWE-416 | Use After Free | Variant | Allowed | 0.7355 | dense, sparse, graph | dense: 0.564, sparse: 0.488, graph: 0.658 |
| 5 | CWE-1021 | Improper Restriction of Rendered UI Layers or Frames | Base | Allowed | 0.5193 | dense, sparse | dense: 0.534, sparse: 0.441 |
| 6 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.5156 | dense, sparse | dense: 0.534, sparse: 0.434 |
| 7 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.5111 | dense, sparse | dense: 0.538, sparse: 0.423 |
| 8 | CWE-415 | Double Free | Variant | Allowed | 0.5052 | dense, sparse | dense: 0.551, sparse: 0.475 |
| 9 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.4570 | sparse, graph | sparse: 0.444, graph: 0.568 |
| 10 | CWE-667 | Improper Locking | Class | Allowed-with-Review | 0.3613 | dense, sparse | dense: 0.575, sparse: 0.573 |

