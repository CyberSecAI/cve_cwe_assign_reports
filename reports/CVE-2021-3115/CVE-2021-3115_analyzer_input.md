# Vulnerability Information: CVE-2021-3115

## Vulnerability Description
Go before 1.14.14 and 1.15.x before 1.15.7 on Windows is vulnerable to Command Injection and remote code execution when using the go get command to fetch modules that make use of cgo (for example, cgo can execute a gcc program from an untrusted download).

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **impact:** remote code execution
- **product:** Go
- **version:** before 1.14.14 and 1.15.x before 1.15.7
- **component:** go get command

## CVE Reference Links Content Summary
Based on the provided documents, here's a breakdown of the vulnerability associated with CVE-2021-3115:

**Root Cause of Vulnerability:**

The `go` command, when handling packages that use `cgo`, was vulnerable to arbitrary code execution during build time. This occurred because `cgo`, when invoked by `go get` or similar commands, would search for the host C compiler (`gcc` or `clang`) in the directory of the package being built, instead of relying on the system's PATH. This vulnerability was particularly exploitable on Windows systems, which by default search the current directory before directories listed in the PATH.

**Weaknesses/Vulnerabilities Present:**

*   **Insecure PATH lookup in `cgo`:** The `cgo` tool, when invoked from a directory with untrusted content, would perform a PATH lookup that could lead to running a malicious compiler (e.g., `gcc.exe`) located in the current directory instead of the intended system compiler.
*   **Implicit search of the current directory on Windows:** Windows systems automatically search the current directory for executables before consulting the system's PATH, making them more vulnerable to this type of attack.
*   **Lack of full path specification for host compiler:** The `go` command did not pass the full path to the host C compiler to `cgo`, which made `cgo` to perform PATH lookups itself.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** An attacker could craft a malicious Go package that uses `cgo` and includes a fake compiler executable (`gcc.exe`). When a user builds this package with `go get` or a similar command, the attacker's `gcc.exe` will be executed, resulting in arbitrary code execution on the user's system.

**Attack Vectors:**

*   **Malicious Go Packages:** The attack vector involves distributing a crafted malicious package that uses `cgo` and includes a malicious executable within its directory.
*   **`go get` or other build commands:**  The vulnerability is triggered when a user attempts to download and build the malicious package using the `go get` command or similar commands, in Windows systems, or in Unix systems where the current directory is included in the user's PATH.

**Required Attacker Capabilities/Position:**

*   **Ability to Create/Distribute Go Packages:** The attacker needs to be able to create and distribute malicious Go packages that use `cgo` and include malicious executables within the package's directory.
*   **Target User Conditions:** The target user must be using a vulnerable version of Go and be on Windows system or a Unix system that has the current directory (".") in their PATH, and perform build operations on the malicious package.

**Additional Notes**

* The vulnerability was reported by RyotaK, and the Go project has addressed it in Go versions 1.15.7 and 1.14.14.
*  The vulnerability could be triggered by other build commands, not only `go get`, but all that involves `cgo` usage.
* Go versions prior to 1.14.14 and 1.15.x prior to 1.15.7 are susceptible to this vulnerability.
*  The vulnerability is not exploitable in common scenarios on Unix due to the absence of "." in the PATH.
* The fix includes passing the full host C compiler path to `cgo` and preventing the usage of executables from the current directory (".") during PATH lookups in `cgo`, `go` and other related tools.

This information provides a comprehensive view of the CVE-2021-3115 vulnerability, its causes, impacts, and required attacker conditions.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.7282 | dense, sparse, graph | dense: 0.490, sparse: 0.222, graph: 0.997 |
| 2 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.7091 | dense, sparse, graph | dense: 0.533, sparse: 0.235, graph: 0.861 |
| 3 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.6194 | dense, sparse, graph | dense: 0.506, sparse: 0.270, graph: 0.592 |
| 4 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.5088 | dense, sparse, graph | dense: 0.481, sparse: 0.213, graph: 0.477 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4822 | sparse, graph | sparse: 0.221, graph: 0.995 |
| 6 | CWE-93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | 0.3643 | dense, sparse | dense: 0.484, sparse: 0.214 |
| 7 | CWE-95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | 0.3383 | dense, sparse | dense: 0.494, sparse: 0.209 |
| 8 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.2165 | dense, sparse | dense: 0.483, sparse: 0.222 |
| 9 | CWE-790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | 0.2100 | dense, sparse | dense: 0.480, sparse: 0.205 |
| 10 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.1321 | sparse, graph | sparse: 0.212, graph: 0.486 |

