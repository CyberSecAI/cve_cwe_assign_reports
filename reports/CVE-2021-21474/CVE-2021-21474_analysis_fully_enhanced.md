# Fully Enhanced Analysis for Critic Review - CVE-2021-21474

# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-328 | Use of Weak Hash | 0.9 | Base | Allowed | Primary CWE |
| CWE-347 | Improper Verification of Cryptographic Signature | 0.6 | Base | Allowed | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.75
*   **Evidence Strength:** MEDIUM

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability description clearly states that the SAP HANA Database accepts SAML tokens with MD5 digest. This indicates a **use of a weak hash**, specifically MD5, which is vulnerable to collision attacks. An attacker can manipulate the SAML assertion without invalidating the digital signature due to the weakness of MD5. This directly aligns with CWE-328, "Use of Weak Hash," because MD5 does not meet security expectations for a hash function, as attackers can find collisions. CWE-328 is a Base level CWE, which is preferred. While other CWEs such as CWE-916 (Use of Password Hash With Insufficient Computational Effort) are also relevant, CWE-328 is more appropriate as it focuses on the general weakness of the hash algorithm used in the signature, rather than specifically focusing on password hashing. The MITRE mapping guidance for CWE-328 specifies that its usage is ALLOWED.
  
  - *Relationship Analysis:* CWE-328 is a Base level CWE. CWE-328 is a parent of CWE-916 (Use of Password Hash With Insufficient Computational Effort). Given the vulnerability focuses on the general use of a weak hash (MD5) for signatures, CWE-328 is more fitting.

- **Confidence Score:**  
  - *Example:* Confidence: 0.9 (High confidence due to explicit mention of MD5 usage and the ability to tamper with signatures)

---

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability also involves the ability to alter a signed SAML assertion in a way that the digest remains the same, effectively spoofing the signature. This points towards CWE-347, "Improper Verification of Cryptographic Signature". While the **root cause** is the **use of a weak hash**, the direct consequence is the **failure to properly verify the digital signature**, enabling impersonation. However, the primary issue stems from using MD5 and not necessarily from the verification process itself. So, this is added as a secondary candidate. The MITRE mapping guidance for CWE-347 specifies that its usage is ALLOWED.
  
  - *Relationship Analysis:* There is no direct relationship between CWE-328 and CWE-347. CWE-347 highlights a failure in verifying the signature, which is a consequence of the weak hash algorithm used.

- **Confidence Score:**  
  - *Example:* Confidence: 0.6 (Medium confidence as this is a consequence of the weak hash rather than a direct implementation flaw in the signature verification logic)



## Known Examples for CWE-347: Improper Verification of Cryptographic Signature
### Observed Examples
- **CVE-2002-1796** [https://www.cve.org/CVERecord?id=CVE-2002-1796](https://www.cve.org/CVERecord?id=CVE-2002-1796): Does not properly verify signatures for "trusted" entities.
- **CVE-2005-2181** [https://www.cve.org/CVERecord?id=CVE-2005-2181](https://www.cve.org/CVERecord?id=CVE-2005-2181): Insufficient verification allows spoofing.
- **CVE-2005-2182** [https://www.cve.org/CVERecord?id=CVE-2005-2182](https://www.cve.org/CVERecord?id=CVE-2005-2182): Insufficient verification allows spoofing.
- **CVE-2002-1706** [https://www.cve.org/CVERecord?id=CVE-2002-1706](https://www.cve.org/CVERecord?id=CVE-2002-1706): Accepts a configuration file without a Message Integrity Check (MIC) signature.
### Top 25 Examples
- **CVE-2021-21405**: Lotus is an Implementation of the Filecoin protocol written in Go. BLS signature validation in lotus uses blst library method VerifyCompressed. This method accepts signatures in 2 forms: "serialized", and "compressed", meaning that BLS signatures can be provided as either of 2 unique byte arrays. Lotus block validation functions perform a uniqueness check on provided blocks. Two blocks are considered distinct if the CIDs of their blockheader do not match. The CID method for blockheader includes the BlockSig of the block. The result of these issues is that it would be possible to punish miners for valid blocks, as there are two different valid block CIDs available for each block, even though this must be unique. By switching from the go based `blst` bindings over to the bindings in `filecoin-ffi`, the code paths now ensure that all signatures are compressed by size and the way they are deserialized. This happened in https://github.com/filecoin-project/lotus/pull/5393.
- **CVE-2020-23533**: Union Pay up to 1.2.0, for web based versions contains a CWE-347: Improper Verification of Cryptographic Signature vulnerability, allows attackers to shop for free in merchants' websites and mobile apps, via a crafted authentication code (MAC) which is generated based on a secret key which is NULL.
- **CVE-2021-0152**: Improper verification of cryptographic signature in the installer for some Intel(R) Wireless Bluetooth(R) and Killer(TM) Bluetooth(R) products in Windows 10 may allow an authenticated user to potentially enable denial of service via local access.
- **CVE-2021-21238**: PySAML2 is a pure python implementation of SAML Version 2 Standard. PySAML2 before 6.5.0 has an improper verification of cryptographic signature vulnerability. All users of pysaml2 that need to validate signed SAML documents are impacted. The vulnerability is a variant of XML Signature wrapping because it did not validate the SAML document against an XML schema. This allowed invalid XML documents to be processed and such a document can trick pysaml2 with a wrapped signature. This is fixed in PySAML2 6.5.0.
- **CVE-2021-21239**: PySAML2 is a pure python implementation of SAML Version 2 Standard. PySAML2 before 6.5.0 has an improper verification of cryptographic signature vulnerability. Users of pysaml2 that use the default CryptoBackendXmlSec1 backend and need to verify signed SAML documents are impacted. PySAML2 does not ensure that a signed SAML document is correctly signed. The default CryptoBackendXmlSec1 backend is using the xmlsec1 binary to verify the signature of signed SAML documents, but by default xmlsec1 accepts any type of key found within the given document. xmlsec1 needs to be configured explicitly to only use only _x509 certificates_ for the verification process of the SAML document signature. This is fixed in PySAML2 6.5.0.
- **CVE-2021-22708**: A CWE-347: Improper Verification of Cryptographic Signature vulnerability exists in EVlink City (EVC1S22P4 / EVC1S7P4 all versions prior to R8 V3.4.0.1), EVlink Parking (EVW2 / EVF2 / EV.2 all versions prior to R8 V3.4.0.1), and EVlink Smart Wallbox (EVB1A all versions prior to R8 V3.4.0.1 ) that could allow an attacker to craft a malicious firmware package and bypass the signature verification mechanism.
