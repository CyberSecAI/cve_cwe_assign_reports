# Critic Input for CVE-2021-28965



# Original Analyzer Input
## Vulnerability Description
The REXML gem before 3.2.5 in Ruby before 2.6.7, 2.7.x before 2.7.3, and 3.x before 3.0.1 does not properly address **XML round-trip issues**. An incorrect document can be produced after parsing and serializing.

### Vulnerability Description Key Phrases
- **weakness:** **XML round-trip issues**
- **impact:** incorrect document can be produced
- **product:** REXML gem
- **version:** before 3.2.5

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information for CVE-2021-28965:

**Root Cause of Vulnerability:**
- The vulnerability lies in the `REXML` gem (library) bundled with Ruby.
- When parsing and serializing a crafted XML document, `REXML` can create an incorrect XML document with a different structure than the original. This is an XML round-trip vulnerability.

**Weaknesses/Vulnerabilities Present:**
- **XML Round-Trip Issue:** The core weakness is the failure of `REXML` to correctly preserve the structure of an XML document during parsing and serialization. This means that the XML output is not guaranteed to match the input.

**Impact of Exploitation:**
- **Data Modification:** Successful exploitation can lead to the addition or modification of data due to the altered XML structure.
- **Context-Dependent Impact:** The severity of the impact depends heavily on the context and how the application uses REXML. It might lead to vulnerabilities in programs relying on REXML.

**Attack Vectors:**
- **Crafted XML Document:** The attack vector involves providing a specially crafted XML document as input to a vulnerable application using REXML.
- **Parsing and Serialization:** The vulnerability is triggered during the process of parsing the crafted XML document and subsequently serializing it back into XML.

**Required Attacker Capabilities/Position:**
- **Ability to Supply Malicious XML:** An attacker needs to be able to provide a malicious XML document to an application that uses the vulnerable REXML library.

**Additional Details:**
- **Affected Ruby Versions:**
    - Ruby 2.5.8 or prior (cannot use `gem update rexml`)
    - Ruby 2.6.6 or prior
    - Ruby 2.7.2 or prior
    - Ruby 3.0.0
    - REXML gem 3.2.4 or prior
- **Mitigation:**
    - Upgrade Ruby to versions 2.6.7, 2.7.3, or 3.0.1 or later.
    - Alternatively, update the `rexml` gem to version 3.2.5 or later (except for Ruby 2.5.8 or prior)
- **NetApp Products:** Although the vulnerability is in Ruby, NetApp explicitly states that their products are not affected. This implies they either do not use the vulnerable versions of ruby/REXML or they have mitigated the issue in other ways.

The provided information is more detailed than the CVE description placeholder.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-776 | Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion') | Base | Allowed | 0.5514 | dense, sparse, graph | dense: 0.539, sparse: 0.153, graph: 0.542 |
| 2 | CWE-611 | Improper Restriction of XML External Entity Reference | Base | Allowed | 0.5404 | dense, sparse, graph | dense: 0.507, sparse: 0.166, graph: 0.536 |
| 3 | CWE-777 | Regular Expression without Anchors | Variant | Allowed | 0.4083 | dense, sparse | dense: 0.467, sparse: 0.365 |
| 4 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.3901 | sparse, graph | sparse: 0.162, graph: 0.832 |
| 5 | CWE-1333 | Inefficient Regular Expression Complexity | Base | Allowed | 0.3141 | dense, sparse | dense: 0.453, sparse: 0.153 |
| 6 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.3003 | dense, sparse | dense: 0.426, sparse: 0.152 |
| 7 | CWE-115 | Misinterpretation of Input | Base | Allowed | 0.2802 | sparse, graph | sparse: 0.164, graph: 0.522 |
| 8 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.1753 | dense, sparse | dense: 0.421, sparse: 0.153 |
| 9 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.1551 | sparse, graph | sparse: 0.167, graph: 0.472 |
| 10 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.0925 | sparse | sparse: 0.162 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-776 | Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion') | 0.75 | Base | Allowed | Primary CWE |
| CWE-611 | Improper Restriction of XML External Entity Reference | 0.65 | Base | Allowed | Secondary Candidate |
| CWE-112 | Improper Neutralization of Special Elements Used in Command Injection | 0.50 | Base | Allowed | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.70
*   **Evidence Strength:** MEDIUM

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability involves the REXML gem in Ruby failing to properly handle XML round-trip issues, leading to the potential creation of an incorrect document after parsing and serializing. This aligns with the core concept of CWE-776, which deals with the improper restriction of recursive entity references in DTDs, potentially leading to XML entity expansion issues. The vulnerability description emphasizes that parsing and serializing a crafted XML document results in a different structure than the original, fitting the scenario where an incorrect document is produced due to issues related to DTD entity handling.
  CWE-611 (Improper Restriction of XML External Entity Reference) is also considered because the vulnerability mentions crafted XML documents which could potentially include external entity references, even though the primary issue is round-trip. The "CVE Reference Links Content Summary" section supports this interpretation.
  CWE-112 (Improper Neutralization of Special Elements Used in Command Injection) is considered because the product accepts XML from an untrusted source but does not validate the XML against the proper schema.

  - *Relationship Analysis:* CWE-776 is a Base-level CWE and has child relationships to CWE-405 (Resource Consumption) and CWE-674 (Uncontrolled Recursion), indicating potential resource exhaustion issues related to recursive entity definitions. CWE-776 can precede CWE-827 (Improper Control of Document Type Definition) and can follow CWE-827. CWE-611 has no direct relationships, but it is related to XML injection vulnerabilities. CWE-112 is a parent of CWE-1286 and child of CWE-20

- **Confidence Score:**  
  - *Example:* Confidence: 0.75 (Medium evidence from technical description and CVE reference materials)

# CWE Examples from Database


## Known Examples for CWE-827: Improper Control of Document Type Definition
### Observed Examples
- **CVE-2010-2076** [https://www.cve.org/CVERecord?id=CVE-2010-2076](https://www.cve.org/CVERecord?id=CVE-2010-2076): Product does not properly reject DTDs in SOAP messages, which allows remote attackers to read arbitrary files, send HTTP requests to intranet servers, or cause a denial of service.


## Known Examples for CWE-611: Improper Restriction of XML External Entity Reference
### Observed Examples
- **CVE-2022-42745** [https://www.cve.org/CVERecord?id=CVE-2022-42745](https://www.cve.org/CVERecord?id=CVE-2022-42745): Recruiter software allows reading arbitrary files using XXE
- **CVE-2005-1306** [https://www.cve.org/CVERecord?id=CVE-2005-1306](https://www.cve.org/CVERecord?id=CVE-2005-1306): A browser control can allow remote attackers to determine the existence of files via Javascript containing XML script.
- **CVE-2012-5656** [https://www.cve.org/CVERecord?id=CVE-2012-5656](https://www.cve.org/CVERecord?id=CVE-2012-5656): XXE during SVG image conversion
- **CVE-2012-2239** [https://www.cve.org/CVERecord?id=CVE-2012-2239](https://www.cve.org/CVERecord?id=CVE-2012-2239): XXE in PHP application allows reading the application's configuration file.
- **CVE-2012-3489** [https://www.cve.org/CVERecord?id=CVE-2012-3489](https://www.cve.org/CVERecord?id=CVE-2012-3489): XXE in database server
- **CVE-2012-4399** [https://www.cve.org/CVERecord?id=CVE-2012-4399](https://www.cve.org/CVERecord?id=CVE-2012-4399): XXE in rapid web application development framework allows reading arbitrary files.
- **CVE-2012-3363** [https://www.cve.org/CVERecord?id=CVE-2012-3363](https://www.cve.org/CVERecord?id=CVE-2012-3363): XXE via XML-RPC request.
- **CVE-2012-0037** [https://www.cve.org/CVERecord?id=CVE-2012-0037](https://www.cve.org/CVERecord?id=CVE-2012-0037): XXE in office document product using RDF.
- **CVE-2011-4107** [https://www.cve.org/CVERecord?id=CVE-2011-4107](https://www.cve.org/CVERecord?id=CVE-2011-4107): XXE in web-based administration tool for database.


# Relevant CWE Specifications

## CWE-827: Improper Control of Document Type Definition
**Abstraction:** Variant
**Status:** Incomplete

### Description
The product does not restrict a reference to a Document Type Definition (DTD) to the intended control sphere. This might allow attackers to reference arbitrary DTDs, possibly causing the product to expose files, consume excessive system resources, or execute arbitrary http requests on behalf of the attacker.

### Extended Description


As DTDs are processed, they might try to read or include files on the machine performing the parsing. If an attacker is able to control the DTD, then the attacker might be able to specify sensitive resources or requests or provide malicious content.


For example, the SOAP specification prohibits SOAP messages from containing DTDs.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-706
ChildOf -> CWE-829
CanPrecede -> CWE-776

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use




### Observed Examples
- **CVE-2010-2076:** Product does not properly reject DTDs in SOAP messages, which allows remote attackers to read arbitrary files, send HTTP requests to intranet servers, or cause a denial of service.



## CWE-611: Improper Restriction of XML External Entity Reference
**Abstraction:** Base
**Status:** Draft

### Description
The product processes an XML document that can contain XML entities with URIs that resolve to documents outside of the intended sphere of control, causing the product to embed incorrect documents into its output.

### Extended Description


XML documents optionally contain a Document Type Definition (DTD), which, among other features, enables the definition of XML entities. It is possible to define an entity by providing a substitution string in the form of a URI. The XML parser can access the contents of this URI and embed these contents back into the XML document for further processing.


By submitting an XML file that defines an external entity with a file:// URI, an attacker can cause the processing application to read the contents of a local file. For example, a URI such as "file:///c:/winnt/win.ini" designates (in Windows) the file C:\Winnt\win.ini, or file:///etc/passwd designates the password file in Unix-based systems. Using URIs with other schemes such as http://, the attacker can force the application to make outgoing requests to servers that the attacker cannot reach directly, which can be used to bypass firewall restrictions or hide the source of attacks such as port scanning.


Once the content of the URI is read, it is fed back into the application that is processing the XML. This application may echo back the data (e.g. in an error message), thereby exposing the file contents.


### Alternative Terms
XXE: An acronym used for the term "XML eXternal Entities"

### Relationships
ChildOf -> CWE-610
ChildOf -> CWE-610
PeerOf -> CWE-441

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation, System Configuration
- **Description:** Many XML parsers and validators can be configured to disable external entity expansion.



### Additional Notes
**[Relationship]** CWE-918 (SSRF) and CWE-611 (XXE) are closely related, because they both involve web-related technologies and can launch outbound requests to unexpected destinations. However, XXE can be performed client-side, or in other contexts in which the software is not acting directly as a server, so the "Server" portion of the SSRF acronym does not necessarily apply.



### Observed Examples
- **CVE-2022-42745:** Recruiter software allows reading arbitrary files using XXE
- **CVE-2005-1306:** A browser control can allow remote attackers to determine the existence of files via Javascript containing XML script.
- **CVE-2012-5656:** XXE during SVG image conversion



## CWE-112: Missing XML Validation
**Abstraction:** Base
**Status:** Draft

### Description
The product accepts XML from an untrusted source but does not validate the XML against the proper schema.

### Extended Description
Most successful attacks begin with a violation of the programmer's assumptions. By accepting an XML document without validating it against a DTD or XML schema, the programmer leaves a door open for attackers to provide unexpected, unreasonable, or malicious input.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-1286
ChildOf -> CWE-20

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Input Validation
- **Description:** 

Always validate XML input against a known XML Schema or DTD.


It is not possible for an XML parser to validate all aspects of a document's content because a parser cannot understand the complete semantics of the data. However, a parser can do a complete and thorough job of checking the document's structure and therefore guarantee to the code that processes the document that the content is well-formed.







## CWE-20: Improper Input Validation
**Abstraction:** Class
**Status:** Stable

### Description
The product receives input or data, but it does
        not validate or incorrectly validates that the input has the
        properties that are required to process the data safely and
        correctly.

### Extended Description


Input validation is a frequently-used technique for checking potentially dangerous inputs in order to ensure that the inputs are safe for processing within the code, or when communicating with other components. When software does not validate input properly, an attacker is able to craft the input in a form that is not expected by the rest of the application. This will lead to parts of the system receiving unintended input, which may result in altered control flow, arbitrary control of a resource, or arbitrary code execution.


Input validation is not the only technique for processing input, however. Other techniques attempt to transform potentially-dangerous input into something safe, such as filtering (CWE-790) - which attempts to remove dangerous inputs - or encoding/escaping (CWE-116), which attempts to ensure that the input is not misinterpreted when it is included in output to another component. Other techniques exist as well (see CWE-138 for more examples.)


Input validation can be applied to:


  - raw data - strings, numbers, parameters, file contents, etc.

  - metadata - information about the raw data, such as headers or size

Data can be simple or structured. Structured data can be composed of many nested layers, composed of combinations of metadata and raw data, with other simple or structured data.

Many properties of raw data or metadata may need to be validated upon entry into the code, such as:


  - specified quantities such as size, length, frequency, price, rate, number of operations, time, etc.

  - implied or derived quantities, such as the actual size of a file instead of a specified size

  - indexes, offsets, or positions into more complex data structures

  - symbolic keys or other elements into hash tables, associative arrays, etc.

  - well-formedness, i.e. syntactic correctness - compliance with expected syntax 

  - lexical token correctness - compliance with rules for what is treated as a token

  - specified or derived type - the actual type of the input (or what the input appears to be)

  - consistency - between individual data elements, between raw data and metadata, between references, etc.

  - conformance to domain-specific rules, e.g. business logic 

  - equivalence - ensuring that equivalent inputs are treated the same

  - authenticity, ownership, or other attestations about the input, e.g. a cryptographic signature to prove the source of the data

Implied or derived properties of data must often be calculated or inferred by the code itself. Errors in deriving properties may be considered a contributing factor to improper input validation. 

Note that "input validation" has very different meanings to different people, or within different classification schemes. Caution must be used when referencing this CWE entry or mapping to it. For example, some weaknesses might involve inadvertently giving control to an attacker over an input when they should not be able to provide an input at all, but sometimes this is referred to as input validation.


Finally, it is important to emphasize that the distinctions between input validation and output escaping are often blurred, and developers must be careful to understand the difference, including how input validation is not always sufficient to prevent vulnerabilities, especially when less stringent data types must be supported, such as free-form text. Consider a SQL injection scenario in which a person's last name is inserted into a query. The name "O'Reilly" would likely pass the validation step since it is a common last name in the English language. However, this valid name cannot be directly inserted into the database because it contains the "'" apostrophe character, which would need to be escaped or otherwise transformed. In this case, removing the apostrophe might reduce the risk of SQL injection, but it would produce incorrect behavior because the wrong name would be recorded.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-707
PeerOf -> CWE-345
CanPrecede -> CWE-22
CanPrecede -> CWE-41
CanPrecede -> CWE-74
CanPrecede -> CWE-119
CanPrecede -> CWE-770
ParentOf -> CWE-102
ParentOf -> CWE-103
ParentOf -> CWE-104
ParentOf -> CWE-105
ParentOf -> CWE-106
ParentOf -> CWE-107
ParentOf -> CWE-108
ParentOf -> CWE-109
ParentOf -> CWE-110
ParentOf -> CWE-111
ParentOf -> CWE-112
ParentOf -> CWE-113
ParentOf -> CWE-114
ParentOf -> CWE-117
ParentOf -> CWE-1173
ParentOf -> CWE-119
ParentOf -> CWE-120
ParentOf -> CWE-1284
ParentOf -> CWE-1285
ParentOf -> CWE-1286
ParentOf -> CWE-1287
ParentOf -> CWE-1288
ParentOf -> CWE-1289
ParentOf -> CWE-129
ParentOf -> CWE-134
ParentOf -> CWE-15
ParentOf -> CWE-170
ParentOf -> CWE-179
ParentOf -> CWE-190
ParentOf -> CWE-466
ParentOf -> CWE-470
ParentOf -> CWE-622
ParentOf -> CWE-73
ParentOf -> CWE-785

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-20 is commonly misused in low-information vulnerability reports when lower-level CWEs could be used instead, or when more details about the vulnerability are available [REF-1287]. It is not useful for trend analysis. It is also a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider lower-level children such as Improper Use of Validation Framework (CWE-1173) or improper validation involving specific types or properties of input such as Specified Quantity (CWE-1284); Specified Index, Position, or Offset (CWE-1285); Syntactic Correctness (CWE-1286); Specified Type (CWE-1287); Consistency within Input (CWE-1288); or Unsafe Equivalence (CWE-1289).
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1284: Specified Quantity
- CWE-1285: Specified Index, Position, or Offset
- CWE-1286: Syntactic Correctness
- CWE-1287: Specified Type
- CWE-1288: Consistency within Input
- CWE-1289: Unsafe Equivalence
- CWE-116: Improper Encoding or Escaping of Output


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Attack Surface Reduction
- **Description:** Consider using language-theoretic security (LangSec) techniques that characterize inputs using a formal language and build "recognizers" for that language. This effectively requires parsing to be a distinct layer that effectively enforces a boundary between raw input and internal data representations, instead of allowing parser code to be scattered throughout the program, where it could be subject to errors or inconsistencies that create weaknesses. [REF-1109] [REF-1110] [REF-1111]

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an input validation framework such as Struts or the OWASP ESAPI Validation API. Note that using a framework does not automatically address all input validation problems; be mindful of weaknesses that could arise from misusing the framework itself (CWE-1173).

**Mitigation 3:**
- **Phase:** Architecture and Design, Implementation
- **Strategy:** Attack Surface Reduction
- **Description:** Understand all the potential areas where untrusted inputs can enter your software: parameters or arguments, cookies, anything read from the network, environment variables, reverse DNS lookups, query results, request headers, URL components, e-mail, files, filenames, databases, and any external systems that provide data to the application. Remember that such inputs may be obtained indirectly through API calls.



### Additional Notes
**[Relationship]** 

CWE-116 and CWE-20 have a close association because, depending on the nature of the structured message, proper input validation can indirectly prevent special characters from changing the meaning of a structured message. For example, by validating that a numeric ID field should only contain the 0-9 characters, the programmer effectively prevents injection attacks.


**[Maintenance]** As of 2020, this entry is used more often than preferred, and it is a source of frequent confusion. It is being actively modified for CWE 4.1 and subsequent versions.

**[Maintenance]** Concepts such as validation, data transformation, and neutralization are being refined, so relationships between CWE-20 and other entries such as CWE-707 may change in future versions, along with an update to the Vulnerability Theory document.

**[Maintenance]** Input validation - whether missing or incorrect - is such an essential and widespread part of secure development that it is implicit in many different weaknesses. Traditionally, problems such as buffer overflows and XSS have been classified as input validation problems by many security professionals. However, input validation is not necessarily the only protection mechanism available for avoiding such problems, and in some cases it is not even sufficient. The CWE team has begun capturing these subtleties in chains within the Research Concepts view (CWE-1000), but more work is needed.

**[Terminology]** 

The "input validation" term is extremely common, but it is used in many different ways. In some cases its usage can obscure the real underlying weakness or otherwise hide chaining and composite relationships.


Some people use "input validation" as a general term that covers many different neutralization techniques for ensuring that input is appropriate, such as filtering, canonicalization, and escaping. Others use the term in a more narrow context to simply mean "checking if an input conforms to expectations without changing it." CWE uses this more narrow interpretation.




### Observed Examples
- **CVE-2024-37032:** Large language model (LLM) management tool does not validate the format of a digest value (CWE-1287) from a private, untrusted model registry, enabling relative path traversal (CWE-23), a.k.a. Probllama
- **CVE-2022-45918:** Chain: a learning management tool debugger uses external input to locate previous session logs (CWE-73) and does not properly validate the given path (CWE-20), allowing for filesystem path traversal using "../" sequences (CWE-24)
- **CVE-2021-30860:** Chain: improper input validation (CWE-20) leads to integer overflow (CWE-190) in mobile OS, as exploited in the wild per CISA KEV.



## CWE-674: Uncontrolled Recursion
**Abstraction:** Class
**Status:** Draft

### Description
The product does not properly control the amount of recursion that takes place,  consuming excessive resources, such as allocated memory or the program stack.

### Extended Description
Not provided

### Alternative Terms
Stack Exhaustion

### Relationships
ChildOf -> CWE-834
ParentOf -> CWE-776

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** This CWE entry is a Class and might have Base-level children that would be more appropriate
**Comments:** Examine children of this entry to see if there is a better fit
**Reasons:**
- Abstraction


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Effectiveness:** Moderate
- **Description:** Ensure an end condition will be reached under all logic conditions. The end condition may include testing against the depth of recursion and exiting with an error if the recursion goes too deep. The complexity of the end condition contributes to the effectiveness of this action.

**Mitigation 2:**
- **Phase:** Implementation
- **Effectiveness:** Limited
- **Description:** Increase the stack size.




### Observed Examples
- **CVE-2007-1285:** Deeply nested arrays trigger stack exhaustion.
- **CVE-2007-3409:** Self-referencing pointers create infinite loop and resultant stack exhaustion.
- **CVE-2016-10707:** Javascript application accidentally changes input in a way that prevents a recursive call from detecting an exit condition.



## CWE-1286: Improper Validation of Syntactic Correctness of Input
**Abstraction:** Base
**Status:** Incomplete

### Description
The product receives input that is expected to be well-formed - i.e., to comply with a certain syntax - but it does not validate or incorrectly validates that the input complies with the syntax.

### Extended Description


Often, complex inputs are expected to follow a particular syntax, which is either assumed by the input itself, or declared within metadata such as headers. The syntax could be for data exchange formats, markup languages, or even programming languages. When untrusted input is not properly validated for the expected syntax, attackers could cause parsing failures, trigger unexpected errors, or expose latent vulnerabilities that might not be directly exploitable if the input had conformed to the syntax.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-20
ParentOf -> CWE-112

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Effectiveness:** High
- **Strategy:** Input Validation
- **Description:** 

Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a list of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.


When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, "boat" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as "red" or "blue."


Do not rely exclusively on looking for malicious or malformed inputs. This is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, denylists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.




### Additional Notes
**[Maintenance]** This entry is still under development and will continue to see updates and content improvements.



### Observed Examples
- **CVE-2016-4029:** Chain: incorrect validation of intended decimal-based IP address format (CWE-1286) enables parsing of octal or hexadecimal formats (CWE-1389), allowing bypass of an SSRF protection mechanism (CWE-918).
- **CVE-2007-5893:** HTTP request with missing protocol version number leads to crash



## CWE-405: Asymmetric Resource Consumption (Amplification)
**Abstraction:** Class
**Status:** Incomplete

### Description
The product does not properly control situations in which an adversary can cause the product to consume or produce excessive resources without requiring the adversary to invest equivalent work or otherwise prove authorization, i.e., the adversary's influence is "asymmetric."

### Extended Description
This can lead to poor performance due to "amplification" of resource consumption, typically in a non-linear fashion. This situation is worsened if the product allows malicious users or attackers to consume more resources than their access level permits.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-400
ParentOf -> CWE-1050
ParentOf -> CWE-1089
ParentOf -> CWE-1176
ParentOf -> CWE-406
ParentOf -> CWE-407
ParentOf -> CWE-408
ParentOf -> CWE-409
ParentOf -> CWE-776

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** This CWE entry is a Class and might have Base-level children that would be more appropriate
**Comments:** Examine children of this entry to see if there is a better fit
**Reasons:**
- Abstraction


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** An application must make resources available to a client commensurate with the client's access level.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** An application must, at all times, keep track of allocated resources and meter their usage appropriately.

**Mitigation 3:**
- **Phase:** System Configuration
- **Effectiveness:** High
- **Description:** Consider disabling resource-intensive algorithms on the server side, such as Diffie-Hellman key exchange.




### Observed Examples
- **CVE-1999-0513:** Classic "Smurf" attack, using spoofed ICMP packets to broadcast addresses.
- **CVE-2003-1564:** Parsing library allows XML bomb
- **CVE-2004-2458:** Tool creates directories before authenticating user.



## CWE-776: Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion')
**Abstraction:** Base
**Status:** Draft

### Description
The product uses XML documents and allows their structure to be defined with a Document Type Definition (DTD), but it does not properly control the number of recursive definitions of entities.

### Extended Description
If the DTD contains a large number of nested or recursive entities, this can lead to explosive growth of data when parsed, causing a denial of service.

### Alternative Terms
XEE: XEE is the acronym commonly used for XML Entity Expansion.
Billion Laughs Attack
XML Bomb: While the "XML Bomb" term was used in the early years of knowledge of this issue, the XEE term seems to be more commonly used.

### Relationships
ChildOf -> CWE-674
ChildOf -> CWE-674
ChildOf -> CWE-405
CanFollow -> CWE-827

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Operation
- **Description:** If possible, prohibit the use of DTDs or use an XML parser that limits the expansion of recursive DTD entities.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** Before parsing XML files with associated DTDs, scan for recursive entity declarations and do not continue parsing potentially explosive content.




### Observed Examples
- **CVE-2008-3281:** XEE in XML-parsing library.
- **CVE-2011-3288:** XML bomb / XEE in enterprise communication product.
- **CVE-2011-1755:** "Billion laughs" attack in XMPP server daemon.

