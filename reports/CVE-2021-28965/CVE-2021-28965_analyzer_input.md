# Vulnerability Information: CVE-2021-28965

## Vulnerability Description
The REXML gem before 3.2.5 in Ruby before 2.6.7, 2.7.x before 2.7.3, and 3.x before 3.0.1 does not properly address **XML round-trip issues**. An incorrect document can be produced after parsing and serializing.

### Vulnerability Description Key Phrases
- **weakness:** **XML round-trip issues**
- **impact:** incorrect document can be produced
- **product:** REXML gem
- **version:** before 3.2.5

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information for CVE-2021-28965:

**Root Cause of Vulnerability:**
- The vulnerability lies in the `REXML` gem (library) bundled with Ruby.
- When parsing and serializing a crafted XML document, `REXML` can create an incorrect XML document with a different structure than the original. This is an XML round-trip vulnerability.

**Weaknesses/Vulnerabilities Present:**
- **XML Round-Trip Issue:** The core weakness is the failure of `REXML` to correctly preserve the structure of an XML document during parsing and serialization. This means that the XML output is not guaranteed to match the input.

**Impact of Exploitation:**
- **Data Modification:** Successful exploitation can lead to the addition or modification of data due to the altered XML structure.
- **Context-Dependent Impact:** The severity of the impact depends heavily on the context and how the application uses REXML. It might lead to vulnerabilities in programs relying on REXML.

**Attack Vectors:**
- **Crafted XML Document:** The attack vector involves providing a specially crafted XML document as input to a vulnerable application using REXML.
- **Parsing and Serialization:** The vulnerability is triggered during the process of parsing the crafted XML document and subsequently serializing it back into XML.

**Required Attacker Capabilities/Position:**
- **Ability to Supply Malicious XML:** An attacker needs to be able to provide a malicious XML document to an application that uses the vulnerable REXML library.

**Additional Details:**
- **Affected Ruby Versions:**
    - Ruby 2.5.8 or prior (cannot use `gem update rexml`)
    - Ruby 2.6.6 or prior
    - Ruby 2.7.2 or prior
    - Ruby 3.0.0
    - REXML gem 3.2.4 or prior
- **Mitigation:**
    - Upgrade Ruby to versions 2.6.7, 2.7.3, or 3.0.1 or later.
    - Alternatively, update the `rexml` gem to version 3.2.5 or later (except for Ruby 2.5.8 or prior)
- **NetApp Products:** Although the vulnerability is in Ruby, NetApp explicitly states that their products are not affected. This implies they either do not use the vulnerable versions of ruby/REXML or they have mitigated the issue in other ways.

The provided information is more detailed than the CVE description placeholder.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-776 | Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion') | Base | Allowed | 0.5514 | dense, sparse, graph | dense: 0.539, sparse: 0.153, graph: 0.542 |
| 2 | CWE-611 | Improper Restriction of XML External Entity Reference | Base | Allowed | 0.5404 | dense, sparse, graph | dense: 0.507, sparse: 0.166, graph: 0.536 |
| 3 | CWE-777 | Regular Expression without Anchors | Variant | Allowed | 0.4083 | dense, sparse | dense: 0.467, sparse: 0.365 |
| 4 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.3901 | sparse, graph | sparse: 0.162, graph: 0.832 |
| 5 | CWE-1333 | Inefficient Regular Expression Complexity | Base | Allowed | 0.3141 | dense, sparse | dense: 0.453, sparse: 0.153 |
| 6 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.3003 | dense, sparse | dense: 0.426, sparse: 0.152 |
| 7 | CWE-115 | Misinterpretation of Input | Base | Allowed | 0.2802 | sparse, graph | sparse: 0.164, graph: 0.522 |
| 8 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.1753 | dense, sparse | dense: 0.421, sparse: 0.153 |
| 9 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.1551 | sparse, graph | sparse: 0.167, graph: 0.472 |
| 10 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.0925 | sparse | sparse: 0.162 |

