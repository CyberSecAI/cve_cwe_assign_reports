# Vulnerability Information: CVE-2022-0544

## Vulnerability Description
An **integer underflow** in the DDS loader of Blender leads to an **out-of-bounds read**, possibly allowing an attacker to read sensitive data using a crafted DDS image file. This flaw affects Blender versions prior to 2.83.19, 2.93.8 and 3.1.

### Vulnerability Description Key Phrases
- **rootcause:** **integer underflow**
- **weakness:** **out-of-bounds read**
- **impact:** read sensitive data
- **vector:** crafted DDS image file
- **product:** Blender
- **version:** prior to 2.83.19 and 2.93.8 and 3.1
- **component:** DDS loader

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2022-0544:

**Root Cause:**

*   Integer underflow in the DDS image loader during size calculation.
*   The vulnerability lies in the `DirectDrawSurface::readData()` function at `source/blender/imbuf/intern/dds/DirectDrawSurface.cpp:1117`, where the code assumes the file size is larger than the DDS header (128 bytes).
*   If a crafted DDS image file has a size smaller than 128 bytes, the `uint size` variable underflows to a very large value (0xffffffff).
*   This large size bypasses bounds checks during memory access, leading to an out-of-bounds read.

**Weaknesses/Vulnerabilities:**

*   **Integer Underflow:** The calculation of the size of the DDS image data results in an integer underflow, causing `size` to become a large positive number when the file is smaller than the header.
*   **Out-of-bounds read:** Due to the integer underflow, the subsequent read operation attempts to access memory beyond the allocated buffer.
*   **Missing Bounds Check:** There's a lack of proper validation of the file size against the allocated buffer size.

**Impact of Exploitation:**

*   **Out-of-bounds read**: An attacker can trigger the out-of-bounds read.
*   **Information Leakage**: The out-of-bounds read could leak sensitive information from memory.
*   **Crash:** The out-of-bounds read can cause a crash.
*   **Potential Security Bypass**:  The vulnerability could potentially be exploited to bypass security mechanisms like stack cookies or pointer encryption.

**Attack Vectors:**

*   **Malicious DDS image file:** The primary attack vector involves using a specially crafted DDS image file with a size smaller than 128 bytes.
*   **Loading the crafted image:** The vulnerability is triggered when Blender loads this crafted image file through the DDS loader.

**Required Attacker Capabilities/Position:**

*   **Ability to provide a crafted DDS image file**: The attacker must be able to provide the malicious DDS file to the Blender application.
*   **User interaction:** The user of Blender would need to load the crafted image file, e.g. as a texture.

**Additional Notes:**

*   The issue was initially reported and tracked as issue #94661 on the Blender developer platform.
*   The issue was fixed through commit `0ac83d05d7cccec436bb939e0aa768f6a3d77d72`, `bbad834f1c2a1f7030ed9741c486b23241e8885e`, and `d9dd8c287f57716a827483973c31bbb2face2816`
*   The provided content also mentions related issues, including out-of-bounds access in `IMB_flipy()` and heap buffer overflows in DDS thumbnail viewing.
*   The fix involves adding a bounds check in `DirectDrawSurface::readData()` and potentially hardening the DDS stream code to prevent similar integer overflows.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.8070 | dense, sparse, graph | dense: 0.493, sparse: 0.609, graph: 0.593 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7446 | dense, sparse, graph | dense: 0.487, sparse: 0.415, graph: 0.737 |
| 3 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.6759 | dense, sparse, graph | dense: 0.463, sparse: 0.407, graph: 0.591 |
| 4 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.6583 | dense, sparse, graph | dense: 0.463, sparse: 0.348, graph: 0.636 |
| 5 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.6459 | dense, sparse, graph | dense: 0.439, sparse: 0.379, graph: 0.586 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.5553 | sparse, graph | sparse: 0.416, graph: 0.887 |
| 7 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4349 | dense, sparse | dense: 0.440, sparse: 0.375 |
| 8 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.4334 | dense, sparse | dense: 0.438, sparse: 0.374 |
| 9 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.4332 | dense, sparse | dense: 0.451, sparse: 0.363 |
| 10 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4186 | dense, sparse | dense: 0.432, sparse: 0.354 |

