# Vulnerability Information: CVE-2022-31019

## Vulnerability Description
Vapor is a server-side Swift HTTP web framework. When using automatic content decoding an attacker can craft a request body that can make the server crash with the following request `curl -d array[_0][0][array][_0][0][array]$(for f in $(seq 1100) do echo -n [_0][0][array] done)[string][_0]=hello%20world http//localhost8080/foo`. The issue is unbounded, attacker controlled stack growth which will at some point lead to a **stack overflow** and a process crash. This issue has been fixed in version 4.61.1.

### Vulnerability Description Key Phrases
- **rootcause:** **unbounded stack growth**
- **weakness:** **stack overflow**
- **impact:** process crash
- **vector:** crafted request body
- **attacker:** attacker
- **product:** Vapor
- **version:** prior to 4.61.1

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-31019:

**Root cause of vulnerability:**
The vulnerability stems from unbounded stack growth in the `URLEncodedFormDecoder` when parsing deeply nested URL-encoded form data. The parser recursively processes the nested structure, and an attacker can craft a malicious request with excessive nesting, leading to a stack overflow.

**Weaknesses/vulnerabilities present:**
- Unbounded recursion in `URLEncodedFormDecoder`.
- Lack of proper input validation or limits on nesting depth.

**Impact of exploitation:**
- Denial of Service (DoS) - The server crashes due to a stack overflow.

**Attack vectors:**
- Network-based attack. The attacker sends a specially crafted HTTP request with a deeply nested URL-encoded form.

**Required attacker capabilities/position:**
- The attacker needs to be able to send HTTP requests to the vulnerable server.
- No special privileges or user interaction is needed.

**Additional details from the content:**

*   The fix includes adding a `maxRecursionDepth` limit to prevent excessive stack usage. An `URLEncodedFormError.reachedNestingLimit` is thrown if the limit is reached.
*   A test case (`testHeavilyNestedArray`) has been added to prevent regressions.
*   A workaround is provided which involves disabling the `ContentConfiguration` for `application/x-www-form-urlencoded` data if it's not required.
*   The vulnerability is fixed in version 4.61.1 of the Vapor framework.
*   The CVSS score is 7.5, with the following vector string: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H.
*   The CWE is CWE-121 which is a Stack-based Buffer Overflow.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.9150 | dense, sparse, graph | dense: 0.450, sparse: 0.581, graph: 1.000 |
| 2 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.6945 | sparse, graph | sparse: 0.589, graph: 1.000 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6049 | sparse, graph | sparse: 0.564, graph: 0.789 |
| 4 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.5591 | dense, sparse | dense: 0.468, sparse: 0.567 |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.5384 | dense, sparse | dense: 0.479, sparse: 0.601 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.5338 | dense, sparse | dense: 0.446, sparse: 0.543 |
| 7 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.5220 | dense, sparse | dense: 0.456, sparse: 0.513 |
| 8 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5215 | dense, sparse | dense: 0.468, sparse: 0.578 |
| 9 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.5204 | dense, sparse | dense: 0.453, sparse: 0.513 |
| 10 | CWE-113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | 0.4946 | dense, sparse | dense: 0.484, sparse: 0.513 |

