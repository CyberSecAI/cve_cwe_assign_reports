# Vulnerability Information: CVE-2021-43300

## Vulnerability Description
Stack overflow in PJSUA API when calling pjsua_recorder_create. An attacker-controlled filename argument may cause a buffer overflow since it is copied to a fixed-size stack buffer without any size validation.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **attacker:** attacker
- **product:** PJSUA

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-43300:

**Root cause of vulnerability:**

*   The vulnerability is a stack buffer overflow in the PJSUA API within the `pjsua_recorder_create` function.

**Weaknesses/vulnerabilities present:**

*   **Stack Buffer Overflow:** The `filename` argument, controlled by the attacker, is copied to a fixed-size stack buffer without proper size validation. This allows an attacker to overwrite adjacent memory on the stack.
*   **Missing Size Validation:** The code lacks a check on the length of the filename before copying it to the stack buffer. This is the core weakness enabling the overflow.

**Impact of exploitation:**

*   **Arbitrary Code Execution:** A successful stack buffer overflow can allow an attacker to overwrite the return address on the stack, potentially leading to arbitrary code execution.
*   **Denial of Service:** Even if arbitrary code execution isn't achieved, a buffer overflow can cause the program to crash, resulting in a denial-of-service.

**Attack vectors:**

*   The attacker needs to be able to control the `filename` argument passed to the `pjsua_recorder_create` function.
*   This could be achieved through malicious input provided via an application using the vulnerable library.

**Required attacker capabilities/position:**

*   The attacker needs to have the ability to make the application call `pjsua_recorder_create` with a crafted, overly long, filename.
*   This implies the attacker must have some form of access to the application's input mechanisms.

**Additional Notes:**

*   The issue also has a related out-of-bounds read vulnerability when using a filename shorter than 4 characters in `pjsua_recorder_create`.
*   The vulnerability is present in `pjproject` versions 2.11.1 and below, and fixed in version 2.12 and later.
*   The advisory also mentions the same type of vulnerability impacting `pjsua_player_create` and `pjsua_playlist_create` functions.
*   A workaround is to validate the length of the filename before calling the vulnerable functions.

In summary, CVE-2021-43300 describes a stack buffer overflow in the `pjsua_recorder_create` function of `pjproject` due to missing size validation on the filename, potentially leading to code execution or denial-of-service. The attacker needs to be able to control the filename parameter.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6399 | dense, sparse, graph | dense: 0.480, sparse: 0.173, graph: 0.840 |
| 2 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.6242 | dense, sparse, graph | dense: 0.484, sparse: 0.168, graph: 0.801 |
| 3 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.5954 | dense, sparse, graph | dense: 0.470, sparse: 0.200, graph: 0.767 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5361 | dense, sparse, graph | dense: 0.493, sparse: 0.156, graph: 0.685 |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.5157 | dense, sparse, graph | dense: 0.454, sparse: 0.173, graph: 0.651 |
| 6 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4655 | sparse, graph | sparse: 0.189, graph: 1.000 |
| 7 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4313 | sparse, graph | sparse: 0.189, graph: 0.904 |
| 8 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3391 | dense, sparse | dense: 0.494, sparse: 0.210 |
| 9 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.3347 | dense, sparse | dense: 0.479, sparse: 0.166 |
| 10 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.3202 | dense, sparse | dense: 0.462, sparse: 0.155 |

