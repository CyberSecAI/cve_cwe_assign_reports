# Vulnerability Information: CVE-2020-29072

## Vulnerability Description
A Cross-Site Script Inclusion vulnerability was found on LiquidFiles before 3.3.19. This client-side attack requires user interaction (opening a link) and successful exploitation could lead to encrypted e-mail content leakage via messages/sent?format=js and popup?format=js.

### Vulnerability Description Key Phrases
- **weakness:** **cross-site script inclusion**
- **impact:** encrypted email content leakage
- **vector:** opening a link
- **product:** LiquidFiles
- **version:** before 3.3.19

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described in CVE-2020-29072:

**Root Cause of Vulnerability:**
- The application uses a pattern called "Server-Generated Javascript Responses." This method bypasses cross-origin protections by returning data as Javascript code, similar to JSONP.

**Weaknesses/Vulnerabilities Present:**
- **Information Disclosure:** Sensitive data, such as email content and message details (recipients, subject, file names, sizes, sent and expiry dates, download counts) is exposed through Javascript responses.
- **Lack of proper access control**: Various endpoints return sensitive information as Javascript without proper authorization checks.
- **Cross-Origin Bypass**: The server-generated javascript responses bypass cross-origin restrictions allowing for the embedding of the vulnerable endpoint on a malicious website.

**Impact of Exploitation:**
- **Information Leakage:** An attacker can steal sensitive information about previously sent encrypted messages by embedding the vulnerable endpoint in a malicious website.
- **Full Message Disclosure**: After obtaining message IDs, the attacker can retrieve the content of the messages using another vulnerable endpoint.
- Attackers can retrieve user information and potentially use it in other attacks.

**Attack Vectors:**
- **Client-Side Exploitation:** An attacker would need to lure a logged-in user to access a malicious webpage or a webpage controlled by the attacker.
- **Embedded Malicious Content**: The attacker embeds a malicious script into a webpage or sends a malicious link, which, when accessed by a logged-in user, would then execute the vulnerable endpoint, leaking sensitive information.

**Required Attacker Capabilities/Position:**
- **Knowledge of Vulnerable Endpoints:** The attacker must be aware of the specific URLs that return data using the "Server-Generated Javascript Responses" pattern (e.g. `/messages/sent?format=js`, `/message/<ID>/popup?format=js`).
- **Ability to Host Malicious Content:** The attacker needs to be able to host a web page or send a malicious link to a victim.
- **Victim Interaction**: The victim must be logged into the LiquidFiles application and must visit the attacker's malicious page in their browser.

**Additional Information:**
- The vulnerability is not limited to the examples given and approximately 109 ERB views were found to be vulnerable.
- The vulnerability is fixed in LiquidFiles Virtual Appliance v3.3.19 or higher.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.7599 | dense, sparse, graph | dense: 0.601, sparse: 0.178, graph: 1.000 |
| 2 | CWE-80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | 0.5373 | dense, sparse, graph | dense: 0.581, sparse: 0.164, graph: 0.553 |
| 3 | CWE-830 | Inclusion of Web Functionality from an Untrusted Source | Variant | Allowed | 0.4801 | dense, sparse | dense: 0.641, sparse: 0.349 |
| 4 | CWE-352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | 0.4370 | dense, sparse, graph | dense: 0.557, sparse: 0.164, graph: 0.547 |
| 5 | CWE-319 | Cleartext Transmission of Sensitive Information | Base | Allowed | 0.3457 | dense, sparse | dense: 0.531, sparse: 0.140 |
| 6 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.3142 | sparse, graph | sparse: 0.155, graph: 0.631 |
| 7 | CWE-113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | 0.2532 | sparse, graph | sparse: 0.156, graph: 0.518 |
| 8 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.2481 | sparse, graph | sparse: 0.149, graph: 0.488 |
| 9 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.2124 | dense, sparse | dense: 0.540, sparse: 0.160 |
| 10 | CWE-346 | Origin Validation Error | Class | Allowed-with-Review | 0.2046 | dense, sparse | dense: 0.532, sparse: 0.143 |

