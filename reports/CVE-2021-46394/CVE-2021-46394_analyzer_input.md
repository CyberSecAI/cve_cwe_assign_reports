# Vulnerability Information: CVE-2021-46394

## Vulnerability Description
There is a **stack buffer overflow** vulnerability in the formSetPPTPServer function of Tenda-AX3 router V16.03.12.10_CN. The v13 variable is directly retrieved from the http request parameter startIp. Then v13 will be splice to stack by function sscanf without any security check, which causes stack overflow. By POSTing the page /goform/SetPptpServerCfg with proper startIp, the attacker can easily perform remote code execution with carefully crafted overflow data.

### Vulnerability Description Key Phrases
- **weakness:** **stack buffer overflow**
- **impact:** remote code execution
- **vector:** POSTing to /goform/SetPptpServerCfg with proper startIp
- **product:** Tenda-AX3 router
- **version:** V16.03.12.10_CN
- **component:** formSetPPTPServer function

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 6)

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**
- Stack buffer overflow in the `formSetPPTPServer` function due to insufficient input validation.

**Weaknesses/Vulnerabilities:**
- The `endIp` parameter from the HTTP request is directly used in `sscanf` without proper length validation which can cause a stack buffer overflow.

**Impact of Exploitation:**
- Remote Code Execution (RCE). An attacker can execute arbitrary code on the router.

**Attack Vectors:**
- Sending a POST request to `/goform/SetPptpServerCfg` with an overly long `endIp` parameter.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to send HTTP POST requests to the vulnerable router.
- The attacker does not need any prior authentication.

**Additional Details:**

- The vulnerable function is `formSetPPTPServer`.
- The vulnerability occurs because the `sscanf` function is used to write to a stack buffer based on the `endIp` without checking its length.
- The proof-of-concept code demonstrates how to send the malicious request.
- The affected product is Tenda Router AX3, specifically version V16.03.12.10\_CN.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.5334 | sparse, graph | sparse: 0.307, graph: 1.000 |
| 2 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5117 | dense, sparse | dense: 0.615, sparse: 0.431 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4790 | sparse, graph | sparse: 0.302, graph: 0.857 |
| 4 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.4673 | sparse, graph | sparse: 0.297, graph: 0.832 |
| 5 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.4120 | dense, sparse | dense: 0.534, sparse: 0.253 |
| 6 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3991 | dense, sparse | dense: 0.472, sparse: 0.284 |
| 7 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.3964 | dense, sparse | dense: 0.482, sparse: 0.271 |
| 8 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3915 | dense, sparse | dense: 0.483, sparse: 0.294 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3726 | dense, sparse | dense: 0.482, sparse: 0.284 |
| 10 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.3600 | sparse, graph | sparse: 0.279, graph: 0.645 |

