# Vulnerability Information: CVE-2021-33393

## Vulnerability Description
lfs/backup in IPFire 2.25-core155 does not ensure that /var/ipfire/backup/bin/backup.pl is owned by the root account. It might be owned by an unprivileged account, which could potentially be used to install a Trojan horse backup.pl script that is later executed by root. Similar problems with the ownership/permissions of other files may be present as well.

### Vulnerability Description Key Phrases
- **rootcause:** **ownership of /var/ipfire/backup/bin/backup.pl is not checked**
- **impact:** execute Trojan horse backup.pl script
- **attacker:** unprivileged account
- **product:** IPFire
- **version:** 2.25-core155
- **component:** lfs/backup

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability described:

**Root Cause of Vulnerability:**

The vulnerability stems from the insecure file permissions and ownership of the `/var/ipfire/backup/bin/backup.pl` script in IPFire. The script was initially owned by the `nobody` user, which allowed any process running as `nobody` to overwrite the script with arbitrary content. Since this script is later executed, this could lead to arbitrary code execution.

**Weaknesses/Vulnerabilities Present:**

*   **Insecure File Permissions:** The primary weakness was the write access granted to the `nobody` user on the `backup.pl` script, leading to an exploitable condition.
*   **Code Injection:** By overwriting the script, an attacker could inject and execute arbitrary code.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** An attacker could achieve remote code execution on the IPFire system by exploiting this vulnerability.
*   **Privilege Escalation:** While the script initially runs with the privileges of `nobody`, the attacker can write code that escalates to `root`.

**Attack Vectors:**

1.  **Web Interface Access:** An authenticated attacker can install a malicious package, triggering the execution of the backup script through the web interface.
2.  **File Overwrite:** By leveraging the write permissions of the `nobody` user, the attacker overwrites the `backup.pl` script with malicious code.
3.  **Script Execution:** The system runs the modified backup script, executing the attacker's injected code.

**Required Attacker Capabilities/Position:**

*   **Authentication:** The attacker needs valid credentials to log into the IPFire web interface.
*   **Network Access:** The attacker must be able to communicate with the IPFire system through the network.
*   **Web Interface Interaction:** The attacker needs to be able to install packages to trigger the vulnerable code.

**Additional Details:**

*   The vulnerability is present in IPFire version 2.25, core update 156.
*   A fix was implemented to change the ownership of `/var/ipfire/backup/bin/backup.pl` to `root:root` to prevent unauthorized modification.
*   The provided commit `6769d909306d7bdc43d64598872126fcf1b217f6` addresses the vulnerability.
*   The attacker can leverage the vulnerability to gain a root shell by injecting a malicious script that calls `setuid(0)`.
*   The exploit relies on the fact that the backup script is executed with elevated privileges after the user logs in and installs a package, even though it is run as the 'nobody' user.

This information provides a comprehensive understanding of the vulnerability based on the given content.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-708 | Incorrect Ownership Assignment | Base | Allowed | 0.9046 | dense, sparse, graph | dense: 0.477, sparse: 0.785, graph: 0.607 |
| 2 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.5816 | dense, sparse, graph | dense: 0.370, sparse: 0.305, graph: 0.621 |
| 3 | CWE-276 | Incorrect Default Permissions | Base | Allowed | 0.5640 | dense, sparse, graph | dense: 0.383, sparse: 0.299, graph: 0.564 |
| 4 | CWE-250 | Execution with Unnecessary Privileges | Base | Allowed | 0.5606 | dense, sparse, graph | dense: 0.396, sparse: 0.282, graph: 0.563 |
| 5 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.3818 | sparse, graph | sparse: 0.310, graph: 0.571 |
| 6 | CWE-283 | Unverified Ownership | Base | Allowed | 0.3609 | dense, sparse | dense: 0.380, sparse: 0.299 |
| 7 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.3542 | sparse, graph | sparse: 0.299, graph: 0.512 |
| 8 | CWE-798 | Use of Hard-coded Credentials | Base | Allowed | 0.3432 | dense, sparse | dense: 0.358, sparse: 0.287 |
| 9 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.3375 | sparse, graph | sparse: 0.285, graph: 0.488 |
| 10 | CWE-259 | Use of Hard-coded Password | Variant | Allowed | 0.3153 | dense, sparse | dense: 0.368, sparse: 0.275 |

