# Vulnerability Information: CVE-2021-0955

## Vulnerability Description
In pf_write_buf of FuseDaemon.cpp, there is possible memory corruption due to a **race condition**. This could lead to local escalation of privilege with no additional execution privileges needed. User interaction is not needed for exploitation.Product AndroidVersions Android-11Android ID A-192085766

### Vulnerability Description Key Phrases
- **rootcause:** **race condition**
- **impact:** memory corruption
- **product:** Android
- **version:** 11
- **component:** pf_write_buf of FuseDaemon.cpp

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-0955:

**Root cause of vulnerability:**
- A race condition in FuseDaemon leads to a use-after-free vulnerability.

**Weaknesses/vulnerabilities present:**
- Use-after-free: The code attempts to use a handle after it has been freed.
- Race condition: The vulnerability occurs because of a race condition between different threads or processes.

**Impact of exploitation:**
- The commit message does not specify the impact other than "use-after-free". The Android Security Bulletin describes the impact as: "The most severe vulnerability in this section could lead to memory corruption by a local attacker, with no privileges or user interaction required."

**Attack vectors:**
- A local attacker could exploit the race condition to trigger the use-after-free vulnerability.

**Required attacker capabilities/position:**
- Local access to the device is required.
- No special privileges or user interaction is needed to trigger the vulnerability.

**Technical Details:**
- The FuseDaemon periodically runs `fadvise` on the lower file system to avoid double caching.
- The vulnerability occurs in the process of 'recording' the write for the `fadvise` queue.
- The race condition occurs due to the following sequence of events:
    - T1: `fuse_reply_write` is called.
    - T2: `pf_release` is called, destroying the handle.
    - T1: `Record` is called, using the already destroyed handle.
- The fix involves calling `Record` before `fuse_reply_write` to avoid the race.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.7740 | dense, sparse, graph | dense: 0.519, sparse: 0.274, graph: 1.000 |
| 2 | CWE-366 | Race Condition within a Thread | Base | Allowed | 0.6427 | dense, sparse, graph | dense: 0.541, sparse: 0.268, graph: 0.612 |
| 3 | CWE-413 | Improper Resource Locking | Base | Allowed | 0.6404 | dense, sparse, graph | dense: 0.523, sparse: 0.279, graph: 0.613 |
| 4 | CWE-1021 | Improper Restriction of Rendered UI Layers or Frames | Base | Allowed | 0.6158 | dense, sparse, graph | dense: 0.517, sparse: 0.288, graph: 0.538 |
| 5 | CWE-416 | Use After Free | Variant | Allowed | 0.5505 | dense, sparse, graph | dense: 0.523, sparse: 0.261, graph: 0.518 |
| 6 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.4109 | dense, sparse | dense: 0.532, sparse: 0.253 |
| 7 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.4105 | dense, sparse | dense: 0.529, sparse: 0.255 |
| 8 | CWE-248 | Uncaught Exception | Base | Allowed | 0.3922 | dense, sparse | dense: 0.515, sparse: 0.235 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3641 | dense, sparse | dense: 0.519, sparse: 0.235 |
| 10 | CWE-415 | Double Free | Variant | Allowed | 0.3145 | sparse, graph | sparse: 0.266, graph: 0.528 |

