# Vulnerability Information: CVE-2021-28302

## Vulnerability Description
A **stack overflow** in pupnp before version 1.14.5 can cause the denial of service through the Parser_parseDocument() function. ixmlNode_free() will release a child node recursively, which will consume stack space and lead to a crash.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **impact:** denial of service
- **product:** pupnp
- **version:** before version 1.14.5
- **component:** Parser_parseDocument() function

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-28302:

**1. Verification of CVE Relevance:**

The provided content directly references CVE-2021-28302, specifically in the GitHub Advisory Database entry and in the commit message for the fix. The issue described aligns with the CVE description of a stack overflow vulnerability in pupnp.

**2. Root Cause of Vulnerability:**

*   The vulnerability lies within the `Parser_parseDocument()` function in `pupnp` version 1.16.1.
*   The function is susceptible to a stack overflow due to unbounded recursive calls within the `ixmlNode_free()` function.
*   Specifically, when parsing an XML document with deeply nested tags (e.g., `<a>` repeated many times without closing tags), `ixmlNode_free()` is called recursively to release child nodes, consuming stack space and leading to a crash due to stack exhaustion.

**3. Weaknesses/Vulnerabilities Present:**

*   **Stack Overflow:** The primary vulnerability is a stack overflow caused by uncontrolled recursion.
*   **Lack of Recursion Depth Limit:**  There was no limit on the depth of the recursive calls, which allowed for an attacker to trigger the overflow.
*   **Insecure XML Parsing:** The XML parser does not properly handle malformed XML with excessively nested tags, leading to an exploitable condition.

**4. Impact of Exploitation:**

*   **Denial of Service (DoS):** The most direct impact is a denial of service. The stack overflow crashes the process and makes the service unavailable.
*   **System Instability:** A crash can destabilize the system or service that is using the vulnerable library.

**5. Attack Vectors:**

*   **Network:** The vulnerability is triggered by parsing a specially crafted XML document over a network connection.
*   **Malicious XML Payload:** The attack vector involves sending an XML document with a large number of nested tags to the vulnerable service.

**6. Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker must be able to send a crafted XML payload to a service using the vulnerable pupnp library.
*   **No authentication required:** The vulnerability can be triggered without any privileges or user interaction, provided that the malformed XML payload is sent to a vulnerable service.
*   **Low Complexity:** The attack has a low complexity, as demonstrated by the readily available proof-of-concept exploit code.

**Additional Details (Beyond the CVE Description):**

*   The provided issue thread on GitHub provides specific code examples and crash reports.
*   It shows that a non-recursive version of `ixmlNode_free()` was introduced as a fix for this vulnerability.
*   The issue was initially identified in version 1.12.1, but deemed applicable to other versions as the faulty code remained unchanged in newer versions.
*   The GitHub issue conversation reveals that the maintainers considered replacing IXML altogether, but decided against it due to the C++ nature of available replacements like tinyxml2.
*   The fix was included in release 1.14.5 of pupnp.

In summary, CVE-2021-28302 describes a network-based stack overflow vulnerability in the `pupnp` library stemming from an insecure implementation of a recursive node-freeing function when processing a malformed XML document containing deeply nested tags. A remote attacker could easily cause a denial of service without authentication.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-776 | Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion') | Base | Allowed | 0.6246 | dense, sparse, graph | dense: 0.496, sparse: 0.278, graph: 0.608 |
| 2 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.5517 | dense, sparse, graph | dense: 0.457, sparse: 0.198, graph: 0.587 |
| 3 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.5407 | dense, sparse, graph | dense: 0.476, sparse: 0.199, graph: 0.528 |
| 4 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3598 | sparse, graph | sparse: 0.166, graph: 0.789 |
| 5 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3342 | dense, sparse | dense: 0.491, sparse: 0.203 |
| 6 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.3337 | dense, sparse | dense: 0.473, sparse: 0.170 |
| 7 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3317 | dense, sparse | dense: 0.440, sparse: 0.195 |
| 8 | CWE-193 | Off-by-one Error | Base | Allowed | 0.3265 | dense, sparse | dense: 0.454, sparse: 0.174 |
| 9 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3247 | dense, sparse | dense: 0.454, sparse: 0.171 |
| 10 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.3061 | dense, sparse | dense: 0.458, sparse: 0.179 |

