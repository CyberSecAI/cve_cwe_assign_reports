# Vulnerability Information: CVE-2022-1240

## Vulnerability Description
Heap buffer overflow in libr/bin/format/mach0/mach0.c in GitHub repository radareorg/radare2 prior to 5.8.6. If address sanitizer is disabled during the compiling, the program should executes into the `r_str_ncpy` function. Therefore I think it is very likely to be exploitable. For more general description of **heap buffer overflow**, see [CWE](https//cwe.mitre.org/data/definitions/122.html).

### Vulnerability Description Key Phrases
- **weakness:** **heap buffer overflow**
- **product:** radare2
- **version:** prior to 5.8.6
- **component:** libr/bin/format/mach0/mach0.c

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis:

**Vulnerability:** Out-of-bounds read in the macho parser of radare2.

**Root Cause:**
The vulnerability stems from a missing or incorrect bounds check when accessing the symbol table in the `parse_relocation_info` function within the macho parser. Specifically, the code uses the `r_symbolnum` from `relocation_info` to access the symbol table. If `r_symbolnum` is greater than or equal to `bin->nsymtab`, it results in an out-of-bounds read.

**Weaknesses/Vulnerabilities:**
- **Out-of-bounds read:**  The primary weakness is the potential to read memory outside of the allocated symbol table when processing relocation information.

**Impact of Exploitation:**
- **Crash:** The commit message mentions "##crash," indicating that this out-of-bounds read can lead to a crash of the application. This can be used for denial of service or to gain some memory information.

**Attack Vectors:**
- **Malicious Mach-O file:** An attacker could craft a malicious Mach-O file with a manipulated relocation entry having an invalid `r_symbolnum` value. When radare2 parses this file, it will attempt to access the symbol table at the invalid index, causing a crash and potentially other impacts depending on the memory layout.

**Required Attacker Capabilities/Position:**
- **File creation/modification:** The attacker must be able to create or modify a Mach-O file.
- **Target interaction:** The attacker must be able to have the vulnerable application process the crafted Mach-O file.
- **No special privileges:** The exploitation requires no special privileges, it is enough to run radare2 with the malicious file.

**Additional notes:**
- The provided code shows the fix which is adding the check `if (sym_num >= bin->nsymtab)` before accessing the symbol table to prevent the OOB read.
- The vulnerability was reported by @Han0nly via huntr.dev, and a bounty was associated with this report.
- The reproducer is referenced as "heapoverflow1", which may be a misnomer given the vulnerability type is a read OOB and not write OOB.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7872 | dense, sparse, graph | dense: 0.604, sparse: 0.282, graph: 0.904 |
| 2 | CWE-193 | Off-by-one Error | Base | Allowed | 0.7864 | dense, sparse, graph | dense: 0.583, sparse: 0.290, graph: 0.919 |
| 3 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 0.7284 | dense, sparse, graph | dense: 0.573, sparse: 0.324, graph: 0.717 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.6718 | dense, sparse, graph | dense: 0.638, sparse: 0.264, graph: 0.721 |
| 5 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.6572 | dense, sparse, graph | dense: 0.628, sparse: 0.348, graph: 0.556 |
| 6 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.6223 | dense, sparse, graph | dense: 0.562, sparse: 0.249, graph: 0.556 |
| 7 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4796 | sparse, graph | sparse: 0.267, graph: 0.914 |
| 8 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.4405 | dense, sparse | dense: 0.578, sparse: 0.265 |
| 9 | CWE-194 | Unexpected Sign Extension | Variant | Allowed | 0.4028 | dense, sparse | dense: 0.578, sparse: 0.257 |
| 10 | CWE-129 | Improper Validation of Array Index | Variant | Allowed | 0.3937 | dense, sparse | dense: 0.567, sparse: 0.250 |

