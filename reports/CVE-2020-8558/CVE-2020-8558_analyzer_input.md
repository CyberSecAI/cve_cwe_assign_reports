# Vulnerability Information: CVE-2020-8558

## Vulnerability Description
The Kubelet and kube-proxy components in versions 1.1.0-1.16.10, 1.17.0-1.17.6, and 1.18.0-1.18.3 were found to contain a security issue which allows adjacent hosts to reach TCP and UDP services bound to 127.0.0.1 running on the node or in the nodes network namespace. Such a service is generally thought to be reachable only by other processes on the same host, but due to this defeect, could be reachable by other hosts on the same LAN as the node, or by containers running on the same node as the service.

### Vulnerability Description Key Phrases
- **impact:** reach TCP and UDP services bound to 127.0.0.1
- **attacker:** adjacent hosts
- **product:** Kubelet and kube-proxy
- **version:** 1.1.0-1.16.10, 1.17.0-1.17.6, and 1.18.0-1.18.3

## CVE Reference Links Content Summary
Based on the provided documents, here's an analysis of CVE-2020-8558:

**1. Verification of CVE Relevance:**

The provided content directly references "CVE-2020-8558 Kubernetes Vulnerability in NetApp Products" and includes details regarding the vulnerability, its impact, affected Kubernetes versions, and mitigation strategies, confirming its relevance to the specified CVE.

**2. Root Cause of Vulnerability:**

The root cause of the vulnerability lies in the way `kube-proxy` sets the `net.ipv4.conf.all.route_localnet` sysctl parameter in Linux systems. Specifically, kube-proxy was setting this parameter to `1`, which caused the system to not reject traffic destined for localhost (`127.0.0.1`) even if it originated from other hosts on the same network.

**3. Weaknesses/Vulnerabilities Present:**

- The primary weakness is the incorrect setting of the `net.ipv4.conf.all.route_localnet` sysctl by `kube-proxy` in IPVS mode, which enables traffic originating from other hosts to reach localhost-bound services.
- The vulnerability is present in Kubelet and kube-proxy components versions v1.18.0 prior to 1.18.4, v1.17.0 prior to 1.17.7, and 1.1.0 prior to 1.16.11.
- Additionally, clusters with API servers using the default insecure port setting are more susceptible, as the API server listens on `127.0.0.1:8080` without authentication.

**4. Impact of Exploitation:**

Successful exploitation of this vulnerability could lead to:

- **Disclosure of sensitive information:**  An attacker could potentially access sensitive data from localhost-bound services that weren't designed to be exposed to external hosts.
- **Addition or Modification of Data:** An attacker could potentially add or modify data if the localhost-bound service allows such actions without proper authentication.
- **Arbitrary API Request Execution:** If the insecure API server port (8080) is enabled, an attacker could execute arbitrary API requests on the cluster from a neighboring system.

**5. Attack Vectors:**

- **Adjacent Network Access:** Attackers on the same layer 2 network as a vulnerable node can exploit this vulnerability.
- **Compromised Container Access:** Attackers controlling a container on a node can exploit this issue to access services bound to localhost on the same node.

**6. Required Attacker Capabilities/Position:**

- The attacker must have a network position that is adjacent to a node with a vulnerable Kubernetes setup. This typically means they must be on the same LAN as the targeted node, or have control of a container on the node.
- In addition, the attacker should have some understanding of the services running locally on the node and the data they handle.

**Additional Information:**

-   **Affected Products:** According to the NetApp advisory, no NetApp products were affected by this vulnerability.
-   **Mitigation:** The primary mitigation is to avoid setting the `net.ipv4.conf.all.route_localnet` sysctl parameter when running in IPVS mode. Additionally, disabling the API server's insecure port mitigates the risk of arbitrary API requests.
-   **Fix:** The fix was implemented in the `kubelet` component by blocking non-forwarded packets from crossing the localhost boundary, and the versions containing the fix are listed in the github pull request.
-   **Workaround:** A manual workaround involves adding an iptables rule to reject traffic to 127.0.0.1 which does not originate on the node.
-   **Discussion of the fix:** The github issue and pull request contain detailed technical discussions related to this vulnerability, its exploitation and potential fixes.

In summary, CVE-2020-8558 is a network-level vulnerability within Kubernetes that could allow adjacent attackers to access localhost-bound services on vulnerable nodes, resulting in potential information disclosure or data modification. While the immediate vulnerability is related to kube-proxy, the mitigation primarily lies in a fix applied to the kubelet.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-420 | Unprotected Alternate Channel | Base | Allowed | 0.6059 | dense, sparse, graph | dense: 0.480, sparse: 0.260, graph: 0.607 |
| 2 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.5498 | dense, sparse, graph | dense: 0.494, sparse: 0.150, graph: 0.607 |
| 3 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4734 | dense, sparse, graph | dense: 0.461, sparse: 0.142, graph: 0.451 |
| 4 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.3835 | sparse, graph | sparse: 0.150, graph: 0.832 |
| 5 | CWE-212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | 0.3640 | sparse, graph | sparse: 0.143, graph: 0.789 |
| 6 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.3178 | dense, sparse | dense: 0.472, sparse: 0.142 |
| 7 | CWE-250 | Execution with Unnecessary Privileges | Base | Allowed | 0.3165 | dense, sparse | dense: 0.471, sparse: 0.141 |
| 8 | CWE-617 | Reachable Assertion | Base | Allowed | 0.3150 | dense, sparse | dense: 0.468, sparse: 0.141 |
| 9 | CWE-401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | 0.3038 | dense, sparse | dense: 0.491, sparse: 0.146 |
| 10 | CWE-277 | Insecure Inherited Permissions | Variant | Allowed | 0.2938 | dense, sparse | dense: 0.477, sparse: 0.139 |

