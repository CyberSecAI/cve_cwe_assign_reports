# Vulnerability Information: CVE-2021-32647

## Vulnerability Description
Emissary is a P2P based data-driven workflow engine. Affected versions of Emissary are vulnerable to post-authentication **Remote Code Execution** (RCE). The [`CreatePlace`](https//github.com/NationalSecurityAgency/emissary/blob/30c54ef16c6eb6ed09604a929939fb9f66868382/src/main/java/emissary/server/mvc/internal/CreatePlaceAction.java#L36) REST endpoint accepts an `sppClassName` parameter which is used to load an arbitrary class. This class is later instantiated using a constructor with the following signature `(String, String, String)`. An attacker may find a gadget (class) in the application classpath that could be used to achieve **Remote Code Execution** (RCE) or disrupt the application. Even though the chances to find a gadget (class) that allow arbitrary code execution are low, an attacker can still find gadgets that could potentially crash the application or leak sensitive data. As a work around disable network access to Emissary from untrusted sources.

### Vulnerability Description Key Phrases
- **weakness:** **Remote Code Execution**
- **product:** Emissary
- **component:** CreatePlace REST endpoint

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-32647:

**Root Cause of Vulnerability:**

*   The vulnerability lies in the `CreatePlaceAction` REST endpoint which accepts an `sppClassName` parameter. This parameter is used to load an arbitrary class, which is then instantiated using a constructor with the signature `<constructor>(String, String, String)`.

**Weaknesses/Vulnerabilities Present:**

*   **Arbitrary Class Loading:** The application allows loading of an arbitrary class based on user-supplied input (`sppClassName` parameter), without proper validation or sanitization.
*   **Gadget Exploitation:** The vulnerability can be exploited by finding a gadget (a class) within the application's classpath that, when instantiated, leads to remote code execution or denial of service.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** An attacker can potentially execute arbitrary code on the server if a suitable gadget class is found.
*   **Application Disruption:** An attacker can cause a denial of service by exploiting gadgets that crash the application.
*  **Sensitive Data Leakage:** It is possible for the attacker to find a class that allows for sensitive data leakage.

**Attack Vectors:**

*   **Network:** The vulnerability is exploitable through the network via the `CreatePlace` REST endpoint.

**Required Attacker Capabilities/Position:**

*   **Authentication:** The attacker needs to be authenticated to access the vulnerable REST endpoint.
*   **Knowledge of Gadgets:** The attacker needs knowledge of existing classes within the application classpath that can be used as gadgets to achieve RCE or denial of service.

**Additional details:**

*   The vulnerability is present in `emissary:emissary` version 6.4.0.
*   It was patched in version 7.0.0.
*   The vulnerability has a CVSS score of 8.1 (High).
*   The attack complexity is high due to the need to find suitable gadget classes.

The provided information is more detailed than a typical CVE description, explaining the root cause and providing the vulnerable code location.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-470 | Use of Externally-Controlled Input to Select Classes or Code ('Unsafe Reflection') | Base | Allowed | 1.0514 | dense, sparse, graph | dense: 0.532, sparse: 1.000, graph: 0.596 |
| 2 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.7322 | dense, sparse, graph | dense: 0.501, sparse: 0.511, graph: 0.530 |
| 3 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.7201 | dense, sparse, graph | dense: 0.510, sparse: 0.481, graph: 0.532 |
| 4 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.7174 | dense, sparse, graph | dense: 0.509, sparse: 0.490, graph: 0.606 |
| 5 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.5962 | sparse, graph | sparse: 0.491, graph: 0.882 |
| 6 | CWE-917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | 0.5164 | dense, sparse | dense: 0.508, sparse: 0.458 |
| 7 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4480 | sparse, graph | sparse: 0.478, graph: 0.488 |
| 8 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.2730 | sparse | sparse: 0.477 |
| 9 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.2716 | sparse | sparse: 0.475 |
| 10 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.2678 | sparse | sparse: 0.468 |

