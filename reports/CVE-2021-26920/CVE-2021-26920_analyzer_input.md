# Vulnerability Information: CVE-2021-26920

## Vulnerability Description
In the Druid ingestion system, the InputSource is used for reading data from a certain data source. However, the HTTP InputSource allows authenticated users to read data from other sources than intended, such as the local file system, with the privileges of the Druid server process. This is not an elevation of privilege when users access Druid directly, since Druid also provides the Local InputSource, which allows the same level of access. But it is problematic when users interact with Druid indirectly through an application that allows users to specify the HTTP InputSource, but not the Local InputSource. In this case, users could bypass the application-level restriction by passing a file URL to the HTTP InputSource.

### Vulnerability Description Key Phrases
- **rootcause:** **InputSource allows access to unintended data sources**
- **impact:** access to local file system
- **attacker:** authenticated users
- **product:** Druid
- **component:** InputSource

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-26920:

**Root cause of vulnerability:**
The vulnerability stems from the way Apache Druid's HTTP InputSource handles data retrieval. It allows authenticated users to read data from unintended sources. Specifically, users can supply file URLs to the HTTP InputSource.

**Weaknesses/vulnerabilities present:**
- **Insecure Input Handling:** The HTTP InputSource does not properly validate the provided URL, allowing access to local files.
- **Bypass of Application-Level Restrictions:** When an application restricts users from accessing certain InputSources (like Local), users can still access local files by using the HTTP InputSource with a `file://` URL.

**Impact of exploitation:**
- **Unauthorized Data Access:** Attackers can read arbitrary files on the server, potentially exposing sensitive information.
- **Bypass access control:** By using the HTTP InputSource an attacker could potentially bypass application-level restrictions on access to the local file system.

**Attack vectors:**
- Users can supply a specially crafted URL to the HTTP InputSource, specifying local files using the `file://` URI scheme.

**Required attacker capabilities/position:**
- An attacker must be an authenticated user of Apache Druid.
- The attacker does not require any special privilege within Druid.

**Additional notes:**
- The provided text indicates that the fix for this issue in 0.21.0 was incomplete and a second CVE (CVE-2021-36749) was issued to address the same vulnerability that was not fixed in 0.21.0 or 0.21.1.
- The recommended mitigation is to upgrade to version 0.22.0 or higher. In earlier versions, applications should disallow the Local, HTTP, and HDFS InputSources if local file system access needs to be restricted.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.5590 | sparse, graph | sparse: 0.504, graph: 0.757 |
| 2 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.3119 | sparse, graph | sparse: 0.614, graph: 0.503 |
| 3 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.2853 | sparse | sparse: 0.499 |
| 4 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.2809 | sparse | sparse: 0.491 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.2805 | sparse | sparse: 0.490 |
| 6 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.2789 | sparse | sparse: 0.488 |
| 7 | CWE-266 | Incorrect Privilege Assignment | Base | Allowed | 0.2787 | sparse | sparse: 0.487 |
| 8 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.2778 | sparse | sparse: 0.486 |
| 9 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.2777 | sparse | sparse: 0.486 |
| 10 | CWE-1289 | Improper Validation of Unsafe Equivalence in Input | Base | Allowed | 0.2768 | sparse | sparse: 0.484 |

