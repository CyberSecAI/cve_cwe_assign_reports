# Vulnerability Information: CVE-2022-3178

## Vulnerability Description
**Buffer Over-read** in GitHub repository gpac/gpac prior to 2.1.0-DEV.

### Vulnerability Description Key Phrases
- **weakness:** **Buffer Over-read**
- **product:** gpac
- **version:** prior to 2.1.0-DEV

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-125

#### Top CWEs
- CWE-125 (Count: 17)
- CWE-126 (Count: 2)

## CVE Reference Links Content Summary
The provided content is related to a commit in the GPAC project that fixes an issue described in issue #2255. The commit modifies the `src/isomedia/box_code_base.c` file, specifically addressing a memory allocation issue within the `xtra_box_read` function.

Here's a breakdown of the relevant information:

**Root Cause:**

- The vulnerability was due to incorrect memory allocation size in `xtra_box_read` function when handling UTF16 strings.

**Weaknesses/Vulnerabilities Present:**

- **Incorrect Memory Allocation:** The original code allocated `prop_size + 2` bytes for `data2`, intended to accommodate a potential UTF-16 string and a null terminator. However, this was not sufficient in all cases, leading to a heap buffer overflow.
- **Heap Buffer Overflow:** The updated code now allocates `prop_size + 3` bytes for `data2`. This change addresses the allocation issue. The extra byte is for null-aligning a potential short value when decoding a UTF-16 string.

**Impact of Exploitation:**

- **Heap-based buffer overflow** could lead to arbitrary code execution, denial of service, or other undefined behavior. While there's no specific mention of arbitrary code execution, such an overflow can have severe consequences.

**Attack Vectors:**

- A crafted input file or stream containing a specially crafted `xtra` box with a specific `prop_size` could trigger the overflow when the `xtra_box_read` function is invoked to process the box's content.

**Required Attacker Capabilities/Position:**

- The attacker needs to be able to provide a malicious media file to an application utilizing the affected version of GPAC. No other explicit capabilities or access is specified.

**Additional Details:**

- The commit message indicates that this change fixes issue #2255, and the code changes clearly focus on adjusting the memory allocation size within the `xtra_box_read` function to handle UTF-16 strings properly. The code also adds an additional null terminator after the read data.
- The code diff shows that the allocation of `data2` was changed from `sizeof(char) * (prop_size+2)` to `sizeof(char) * (prop_size+3)`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.6393 | dense, sparse, graph | dense: 0.539, sparse: 0.062, graph: 0.935 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6047 | dense, sparse, graph | dense: 0.486, sparse: 0.094, graph: 0.860 |
| 3 | CWE-805 | Buffer Access with Incorrect Length Value | Base | Allowed | 0.5281 | dense, sparse, graph | dense: 0.542, sparse: 0.076, graph: 0.598 |
| 4 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.4905 | dense, sparse, graph | dense: 0.504, sparse: 0.069, graph: 0.556 |
| 5 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.4075 | sparse, graph | sparse: 0.087, graph: 1.000 |
| 6 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.3460 | dense, sparse | dense: 0.603, sparse: 0.127 |
| 7 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3178 | sparse, graph | sparse: 0.062, graph: 0.789 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.2848 | dense, sparse | dense: 0.516, sparse: 0.088 |
| 9 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.2848 | dense, sparse | dense: 0.486, sparse: 0.072 |
| 10 | CWE-193 | Off-by-one Error | Base | Allowed | 0.2837 | dense, sparse | dense: 0.489, sparse: 0.068 |

