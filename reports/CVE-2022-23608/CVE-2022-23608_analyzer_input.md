# Vulnerability Information: CVE-2022-23608

## Vulnerability Description
PJSIP is a free and open source multimedia communication library written in C language implementing standard based protocols such as SIP, SDP, RTP, STUN, TURN, and ICE. In versions up to and including 2.11.1 when in a dialog set (or forking) scenario, a **hash key shared by multiple UAC dialogs can potentially be prematurely freed** when one of the dialogs is destroyed . The issue may cause a dialog set to be registered in the hash table multiple times (with different hash keys) leading to undefined behavior such as dialog list collision which eventually leading to endless loop. A patch is available in commit db3235953baa56d2fb0e276ca510fefca751643f which will be included in the next release. There are no known workarounds for this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **hash key shared by multiple UAC dialogs can potentially be prematurely freed**
- **impact:** undefined behavior such as dialog list collision which eventually leading to endless loop
- **vector:** dialog set (or forking) scenario
- **product:** PJSIP
- **version:** up to and including 2.11.1

## CVE Reference Links Content Summary
Based on the provided documents, here's a breakdown of the vulnerability described by CVE-2022-23608:

**Root Cause:**
The vulnerability stems from a use-after-free condition in PJSIP when handling dialog sets in forking scenarios. Specifically, a hash key associated with a dialog set, shared by multiple User Agent Client (UAC) dialogs, can be prematurely freed when one of those dialogs is destroyed.

**Weaknesses/Vulnerabilities:**
*   **Use-After-Free:** The core issue is that memory associated with the hash key is freed while still in use, leading to a use-after-free condition.
*   **Incorrect Hash Table Management**: The premature freeing leads to inconsistencies in the hash table. The dialog set could be re-registered with different hash keys due to the use-after-free.

**Impact of Exploitation:**
*   **Undefined Behavior:** The use-after-free can cause unpredictable behavior, including crashes and hangs.
*   **Denial of Service:** The vulnerability can result in a denial-of-service (DoS) condition due to crashes, hangs, or an endless loop. Specifically, the incorrect hash table handling can cause a dialog list collision that leads to an endless loop.

**Attack Vectors:**
*   **Remote, Unauthenticated Sessions**: The vulnerability can be triggered remotely by an attacker initiating calls to a target that forks, which causes the dialog set to be created and then potentially freed prematurely.
*   **SIP Forking**: The vulnerability is specifically triggered when PJSIP is acting as a UAC and placing an outgoing call to a target that then forks.

**Required Attacker Capabilities/Position:**
*   The attacker needs to be able to initiate SIP calls that cause the forking behavior in PJSIP
*   The attacker does not need authentication, this can be exploited through unauthenticated sessions.

**Additional details from the provided content:**
*   The fix involves updating the hash key if the dialog being unregistered is used as a hash key and adding an assertion check to ensure the dlg_set to be removed is valid.
*   The vulnerability affects all PJSIP users, including those using Asterisk if `with-pjproject-bundled` is enabled.

The provided information gives a more detailed explanation of the vulnerability than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.7177 | dense, sparse, graph | dense: 0.381, sparse: 0.507, graph: 0.664 |
| 2 | CWE-416 | Use After Free | Variant | Allowed | 0.7111 | dense, sparse, graph | dense: 0.426, sparse: 0.500, graph: 0.759 |
| 3 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.6430 | dense, sparse, graph | dense: 0.369, sparse: 0.529, graph: 0.586 |
| 4 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 0.5937 | sparse, graph | sparse: 0.497, graph: 0.865 |
| 5 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5369 | sparse, graph | sparse: 0.526, graph: 0.660 |
| 6 | CWE-415 | Double Free | Variant | Allowed | 0.5261 | sparse, graph | sparse: 0.512, graph: 0.776 |
| 7 | CWE-401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | 0.4578 | dense, sparse | dense: 0.417, sparse: 0.502 |
| 8 | CWE-754 | Improper Check for Unusual or Exceptional Conditions | Class | Allowed-with-Review | 0.4285 | dense, sparse, graph | dense: 0.377, sparse: 0.565, graph: 0.609 |
| 9 | CWE-667 | Improper Locking | Class | Allowed-with-Review | 0.2977 | dense, sparse | dense: 0.355, sparse: 0.575 |
| 10 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.2953 | sparse | sparse: 0.516 |

