# Critic Input for CVE-2021-35534



# Original Analyzer Input
## Vulnerability Description
**Insufficient security control** vulnerability in internal database access mechanism of Hitachi Energy Relion 670/650/SAM600-IO, Relion 650, GMS600, PWC600 allows attacker who successfully exploited this vulnerability, of which the product does not sufficiently restrict access to an internal database tables, could allow anybody with user credentials to bypass security controls that is enforced by the product. Consequently, exploitation may lead to unauthorized modifications on data/firmware, and/or to permanently disabling the product. This issue affects Hitachi Energy Relion 670 Series 2.0 all revisions 2.2.2 all revisions 2.2.3 versions prior to 2.2.3.5. Hitachi Energy Relion 670/650 Series 2.1 all revisions. 2.2.0 all revisions 2.2.4 all revisions Hitachi Energy Relion 670/650/SAM600-IO 2.2.1 all revisions 2.2.5 versions prior to 2.2.5.2. Hitachi Energy Relion 650 1.0 all revisions. 1.1 all revisions 1.2 all revisions 1.3 versions prior to 1.3.0.8 Hitachi Energy GMS600 1.3.0 1.3.0.1 1.2.0. Hitachi Energy PWC600 1.0.1 version 1.0.1.4 and prior versions 1.1.0 version 1.1.0.1 and prior versions.

### Vulnerability Description Key Phrases
- **rootcause:** **Insufficient security control**
- **impact:** bypass security controls, unauthorized modifications
- **attacker:** attacker
- **product:** Hitachi Energy Relion 670 and 650 and SAM600-IO and Relion 650 and GMS600 and PWC600
- **version:** 670 Series 2.0 all revisions and 2.1 all revisions and 2.2.0 all revisions and 2.2.1 all revisions and 2.2.2 all revisions and 2.2.3 versions prior to 2.2.3.5 and 2.2.4 all revisions and 2.2.5 versions prior to 2.2.5.2 and 1.0 all revisions and 1.1 all revisions and 1.2 all revisions and 1.3 versions prior to 1.3.0.8 and 1.3.0 and 1.3.0.1 and 1.2.0 and 1.0.1 and 1.0.1.4 and prior versions and 1.1.0 and 1.1.0.1 and prior versions
- **component:** internal database access mechanism

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-274 | Improper Handling of Insufficient Privileges | Base | Discouraged | 0.8547 | dense, sparse, graph | dense: 0.583, sparse: 1.000, graph: 0.871 |
| 2 | CWE-209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | 0.7002 | sparse, graph | sparse: 0.688, graph: 0.857 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6919 | sparse, graph | sparse: 0.658, graph: 0.882 |
| 4 | CWE-288 | Authentication Bypass Using an Alternate Path or Channel | Base | Allowed | 0.6555 | dense, sparse | dense: 0.573, sparse: 0.645 |
| 5 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.6404 | dense, sparse | dense: 0.573, sparse: 0.619 |
| 6 | CWE-326 | Inadequate Encryption Strength | Class | Allowed-with-Review | 0.3997 | dense, sparse | dense: 0.636, sparse: 0.633 |
| 7 | CWE-522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | 0.3888 | dense, sparse | dense: 0.581, sparse: 0.649 |
| 8 | CWE-521 | Weak Password Requirements | Base | Allowed | 0.3575 | sparse | sparse: 0.625 |
| 9 | CWE-266 | Incorrect Privilege Assignment | Base | Allowed | 0.3547 | sparse | sparse: 0.620 |
| 10 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.3276 | sparse | sparse: 0.573 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-285 | Improper Authorization | 0.85 | Class | Primary | The primary weakness is the lack of proper authorization checks, leading to unauthorized access to an internal database. |
| CWE-668 | Exposure of Resource to Wrong Sphere | 0.65 | Class | Secondary | The internal database is exposed to users who should not have access to it, resulting in unauthorized data modifications. |
| CWE-306 | Missing Authentication for Critical Function | 0.50 | Base | Secondary | Authentication may be missing for certain database functions, exacerbating the authorization issue. |

## Evidence and Confidence

*   **Confidence Score:** 0.70
*   **Evidence Strength:** MEDIUM

- **Analysis and Justification:**
  - *Explanation:* The vulnerability description highlights an **insufficient security control** in the internal database access mechanism, enabling attackers with user credentials to bypass enforced security controls. This leads to unauthorized modifications of data/firmware and potentially disabling the product. The core issue here is the lack of proper authorization checks when accessing the internal database, which aligns with CWE-285 (Improper Authorization). While CWE-285 is a class-level CWE, it appropriately describes the high-level issue. CWE-668 (Exposure of Resource to Wrong Sphere) is a related weakness, as the internal database is exposed to users who should not have access. The description also suggests a possible lack of authentication for certain critical database functions, which maps to CWE-306 (Missing Authentication for Critical Function).

  - *Relationship Analysis:* CWE-285 is a Class-level CWE and is a child of CWE Pillar: Concurrency. CWE-668 represents a scenario where a resource is exposed to the wrong control sphere, potentially overlapping with the authorization issue. CWE-306 (Missing Authentication for Critical Function) relates to scenarios where authentication is absent for critical functions, and it is a child of CWE-287(Improper Authentication). CWE-285 is the primary issue as it focuses on authorization problems, while CWE-668 and CWE-306 provide additional context on related missing security controls.

- **Confidence Score:**
  - Confidence: 0.85 (The description clearly states a problem with authorization to the database.)

---

# CWE Examples from Database


## Known Examples for CWE-668: Exposure of Resource to Wrong Sphere
### Top 25 Examples
- **CVE-2020-16247**: Philips Clinical Collaboration Platform, Versions 12.2.1 and prior. The product exposes a resource to the wrong control sphere, providing unintended actors with inappropriate access to the resource.
- **CVE-2020-15824**: In JetBrains Kotlin from 1.4-M1 to 1.4-RC (as Kotlin 1.3.7x is not affected by the issue. Fixed version is 1.4.0) there is a script-cache privilege escalation vulnerability due to kotlin-main-kts cached scripts in the system temp directory, which is shared by all users by default.
- **CVE-2021-22118**: In Spring Framework, versions 5.2.x prior to 5.2.15 and versions 5.3.x prior to 5.3.7, a WebFlux application is vulnerable to a privilege escalation: by (re)creating the temporary storage directory, a locally authenticated malicious user can read or modify files that have been uploaded to the WebFlux application, or overwrite arbitrary files with multipart request data.
- **CVE-2021-21334**: In containerd (an industry-standard container runtime) before versions 1.3.10 and 1.4.4, containers launched through containerd's CRI implementation (through Kubernetes, crictl, or any other pod/container client that uses the containerd CRI service) that share the same image may receive incorrect environment variables, including values that are defined for other containers. If the affected containers have different security contexts, this may allow sensitive information to be unintentionally shared. If you are not using containerd's CRI implementation (through one of the mechanisms described above), you are not vulnerable to this issue. If you are not launching multiple containers or Kubernetes pods from the same image which have different environment variables, you are not vulnerable to this issue. If you are not launching multiple containers or Kubernetes pods from the same image in rapid succession, you have reduced likelihood of being vulnerable to this issue This vulnerability has been fixed in containerd 1.3.10 and containerd 1.4.4. Users should update to these versions.
- **CVE-2021-22047**: In Spring Data REST versions 3.4.0 - 3.4.13, 3.5.0 - 3.5.5, and older unsupported versions, HTTP resources implemented by custom controllers using a configured base API path and a controller type-level request mapping are additionally exposed under URIs that can potentially be exposed for unauthorized access depending on the Spring Security configuration.
- **CVE-2021-22550**: An attacker can modify the pointers in enclave memory to overwrite arbitrary memory addresses within the secure enclave. It is recommended to update past 0.6.3 or git commit https://github.com/google/asylo/commit/a47ef55db2337d29de19c50cd29b0deb2871d31c
- **CVE-2021-38712**: OneNav 0.9.12 allows Information Disclosure of the onenav.db3 contents. NOTE: the vendor's recommended solution is to block the access via an NGINX configuration file.
- **CVE-2021-40496**: SAP Internet Communication framework (ICM) - versions 700, 701, 702, 730, 731, 740, 750, 751, 752, 753, 754, 755, 756, 785, allows an attacker with logon functionality, to exploit the authentication function by using POST and form field to repeat executions of the initial command by a GET request and exposing sensitive data. This vulnerability is normally exposed over the network and successful exploitation can lead to exposure of data like system details.
- **CVE-2021-40497**: SAP BusinessObjects Analysis (edition for OLAP) - versions 420, 430, allows an attacker to exploit certain application endpoints to read sensitive data. These endpoints are normally exposed over the network and successful exploitation could lead to exposure of some system specific data like its version.
- **CVE-2021-22044**: In Spring Cloud OpenFeign 3.0.0 to 3.0.4, 2.2.0.RELEASE to 2.2.9.RELEASE, and older unsupported versions, applications using type-level `@RequestMapping`annotations over Feign client interfaces, can be involuntarily exposing endpoints corresponding to `@RequestMapping`-annotated interface methods.


# Relevant CWE Specifications

## CWE-668: Exposure of Resource to Wrong Sphere
**Abstraction:** Class
**Status:** Draft

### Description
The product exposes a resource to the wrong control sphere, providing unintended actors with inappropriate access to the resource.

### Extended Description


Resources such as files and directories may be inadvertently exposed through mechanisms such as insecure permissions, or when a program accidentally operates on the wrong object. For example, a program may intend that private files can only be provided to a specific user. This effectively defines a control sphere that is intended to prevent attackers from accessing these private files. If the file permissions are insecure, then parties other than the user will be able to access those files.


A separate control sphere might effectively require that the user can only access the private files, but not any other files on the system. If the program does not ensure that the user is only requesting private files, then the user might be able to access other files on the system.


In either case, the end result is that a resource has been exposed to the wrong party.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-664
ParentOf -> CWE-1189
ParentOf -> CWE-1282
ParentOf -> CWE-1327
ParentOf -> CWE-1331
ParentOf -> CWE-134
ParentOf -> CWE-200
ParentOf -> CWE-22
ParentOf -> CWE-374
ParentOf -> CWE-375
ParentOf -> CWE-377
ParentOf -> CWE-402
ParentOf -> CWE-426
ParentOf -> CWE-427
ParentOf -> CWE-428
CanFollow -> CWE-441
ParentOf -> CWE-488
ParentOf -> CWE-491
ParentOf -> CWE-492
ParentOf -> CWE-493
ParentOf -> CWE-498
ParentOf -> CWE-499
ParentOf -> CWE-522
ParentOf -> CWE-524
ParentOf -> CWE-552
ParentOf -> CWE-582
ParentOf -> CWE-583
ParentOf -> CWE-608
ParentOf -> CWE-642
ParentOf -> CWE-732
ParentOf -> CWE-767
ParentOf -> CWE-8
ParentOf -> CWE-927
CanFollow -> CWE-942

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-668 is high-level and is often misused as a catch-all when lower-level CWE IDs might be applicable. It is sometimes used for low-information vulnerability reports [REF-1287]. It is a level-1 Class (i.e., a child of a Pillar). It is not useful for trend analysis.
**Comments:** Closely analyze the specific mistake that is allowing the resource to be exposed, and perform a CWE mapping for that mistake.
**Reasons:**
- Frequent Misuse
- Abstraction



### Additional Notes
**[Theoretical]** A "control sphere" is a set of resources and behaviors that are accessible to a single actor, or a group of actors. A product's security model will typically define multiple spheres, possibly implicitly. For example, a server might define one sphere for "administrators" who can create new user accounts with subdirectories under /home/server/, and a second sphere might cover the set of users who can create or delete files within their own subdirectories. A third sphere might be "users who are authenticated to the operating system on which the product is installed." Each sphere has different sets of actors and allowable behaviors.





## CWE-306: Missing Authentication for Critical Function
**Abstraction:** Base
**Status:** Draft

### Description
The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-287
ChildOf -> CWE-287
ParentOf -> CWE-288
ParentOf -> CWE-322

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the software into anonymous, normal, privileged, and administrative areas. Identify which of these areas require a proven user identity, and use a centralized authentication capability.


Identify all potential communication channels, or other means of interaction with the software, to ensure that all channels are appropriately protected, including those channels that are assumed to be accessible only by authorized parties. Developers sometimes perform authentication at the primary channel, but open up a secondary channel that is assumed to be private. For example, a login mechanism may be listening on one network port, but after successful authentication, it may open up a second port where it waits for the connection, but avoids authentication because it assumes that only the authenticated party will connect to the port.


In general, if the software or protocol allows a single session or user state to persist across multiple connections or channels, authentication and appropriate credential management need to be used throughout.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** 

Where possible, avoid implementing custom, "grow-your-own" authentication routines and consider using authentication capabilities as provided by the surrounding framework, operating system, or environment. These capabilities may avoid common weaknesses that are unique to authentication; support automatic auditing and tracking; and make it easier to provide a clear separation between authentication tasks and authorization tasks.


In environments such as the World Wide Web, the line between authentication and authorization is sometimes blurred. If custom authentication routines are required instead of those provided by the server, then these routines must be applied to every single page, since these pages could be requested directly.





### Observed Examples
- **CVE-2022-31260:** Chain: a digital asset management program has an undisclosed backdoor in the legacy version of a PHP script (CWE-912) that could allow an unauthenticated user to export metadata (CWE-306)
- **CVE-2022-29951:** TCP-based protocol in Programmable Logic Controller (PLC) has no authentication.
- **CVE-2022-29952:** Condition Monitor firmware uses a protocol that does not require authentication.



## CWE-287: Improper Authentication
**Abstraction:** Class
**Status:** Draft

### Description
When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.

### Extended Description
Not provided

### Alternative Terms
authentification: An alternate term is "authentification", which appears to be most commonly used by people from non-English-speaking countries.
AuthN: "AuthN" is typically used as an abbreviation of "authentication" within the web application security community. It is also distinct from "AuthZ," which is an abbreviation of "authorization." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.
AuthC: "AuthC" is used as an abbreviation of "authentication," but it appears to used less frequently than "AuthN."

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1390
ParentOf -> CWE-290
ParentOf -> CWE-294
ParentOf -> CWE-295
ParentOf -> CWE-306
ParentOf -> CWE-307
ParentOf -> CWE-521
ParentOf -> CWE-522
CanFollow -> CWE-613
ParentOf -> CWE-640
ParentOf -> CWE-645
ParentOf -> CWE-798

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry might be misused when lower-level CWE entries are likely to be applicable. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children or descendants, beginning with CWE-1390: Weak Authentication or CWE-306: Missing Authentication for Critical Function.
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1390: Weak Authentication
- CWE-306: Missing Authentication for Critical Function


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an authentication framework or library such as the OWASP ESAPI Authentication feature.



### Additional Notes
**[Relationship]** This can be resultant from SQL injection vulnerabilities and other issues.

**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-35248:** Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436:** Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034:** Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).



## CWE-285: Improper Authorization
**Abstraction:** Class
**Status:** Draft

### Description
The product does not perform or incorrectly performs an authorization check when an actor attempts to access a resource or perform an action.

### Extended Description


Assuming a user with a given identity, authorization is the process of determining whether that user can access a given resource, based on the user's privileges and any permissions or other access-control specifications that apply to the resource.


When access control checks are not applied consistently - or not at all - users are able to access data or perform actions that they should not be allowed to perform. This can lead to a wide range of problems, including information exposures, denial of service, and arbitrary code execution.


### Alternative Terms
AuthZ: "AuthZ" is typically used as an abbreviation of "authorization" within the web application security community. It is distinct from "AuthN" (or, sometimes, "AuthC") which is an abbreviation of "authentication." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1230
ParentOf -> CWE-1256
ParentOf -> CWE-1297
ParentOf -> CWE-1328
ParentOf -> CWE-552
ParentOf -> CWE-732
ParentOf -> CWE-862
ParentOf -> CWE-863
ParentOf -> CWE-926
ParentOf -> CWE-927

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-285 is high-level and lower-level CWEs can frequently be used instead. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Look at CWE-285's children and consider mapping to CWEs such as CWE-862: Missing Authorization, CWE-863: Incorrect Authorization, CWE-732: Incorrect Permission Assignment for Critical Resource, or others.
**Reasons:**
- Abstraction
**Suggested Alternatives:**
- CWE-862: Missing Authorization
- CWE-863: Incorrect Authorization
- CWE-732: Incorrect Permission Assignment for Critical Resource


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the product into anonymous, normal, privileged, and administrative areas. Reduce the attack surface by carefully mapping roles with data and functionality. Use role-based access control (RBAC) to enforce the roles at the appropriate boundaries.


Note that this approach may not protect against horizontal authorization, i.e., it will not protect a user from attacking others with the same role.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Ensure that you perform access control checks related to your business logic. These checks may be different than the access control checks that you apply to more generic resources such as files, connections, processes, memory, and database records. For example, a database may restrict access for medical records to a specific database user, but each record might only be intended to be accessible to the patient and the patient's doctor.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


For example, consider using authorization frameworks such as the JAAS Authorization Framework [REF-233] and the OWASP ESAPI Access Control feature [REF-45].





### Observed Examples
- **CVE-2022-24730:** Go-based continuous deployment product does not check that a user has certain privileges to update or create an app, allowing adversaries to read sensitive repository information
- **CVE-2009-3168:** Web application does not restrict access to admin scripts, allowing authenticated users to reset administrative passwords.
- **CVE-2009-2960:** Web application does not restrict access to admin scripts, allowing authenticated users to modify passwords of other users.

