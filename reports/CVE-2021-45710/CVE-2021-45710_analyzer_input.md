# Vulnerability Information: CVE-2021-45710

## Vulnerability Description
An issue was discovered in the tokio crate before 1.8.4, and 1.9.x through 1.13.x before 1.13.1, for Rust. In certain circumstances involving a closed oneshot channel, there is a **data race and memory corruption**.

### Vulnerability Description Key Phrases
- **weakness:** **data race and memory corruption**
- **product:** tokio crate
- **version:** before 1.8.4, and 1.9.x through 1.13.x before 1.13.1

## CVE Reference Links Content Summary
- **Root cause of vulnerability**: A data race occurs when a `tokio::sync::oneshot` channel is closed via `oneshot::Receiver::close` and, concurrently, `oneshot::Sender::send` is called while the corresponding `oneshot::Receiver` is being `await`ed or calling `try_recv`.
- **Weaknesses/vulnerabilities present**: Data race due to concurrent access of a shared memory location by the sender and receiver halves of the channel after the receiver has been closed.
- **Impact of exploitation**: Memory corruption can occur due to the data race.
- **Attack vectors**: Concurrent calls to `oneshot::Sender::send` and either `await` or `try_recv` on the `oneshot::Receiver` after `oneshot::Receiver::close` has been called.
- **Required attacker capabilities/position**: The attacker needs to be able to trigger the described race condition by concurrently interacting with the `oneshot` channel after it has been closed. Specifically, they must trigger `close()` on the receiver end, and concurrently call `send()` on the sender, and either `await` or `try_recv` on the receiver.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-366 | Race Condition within a Thread | Base | Allowed | 0.5996 | dense, sparse, graph | dense: 0.517, sparse: 0.214, graph: 0.611 |
| 2 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.5825 | dense, sparse, graph | dense: 0.510, sparse: 0.191, graph: 0.609 |
| 3 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.5709 | dense, sparse, graph | dense: 0.473, sparse: 0.216, graph: 0.590 |
| 4 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.5014 | dense, sparse, graph | dense: 0.495, sparse: 0.173, graph: 0.550 |
| 5 | CWE-415 | Double Free | Variant | Allowed | 0.3838 | sparse, graph | sparse: 0.187, graph: 0.864 |
| 6 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3376 | dense, sparse | dense: 0.477, sparse: 0.173 |
| 7 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3338 | dense, sparse | dense: 0.475, sparse: 0.167 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3096 | dense, sparse | dense: 0.470, sparse: 0.175 |
| 9 | CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | 0.2276 | dense, sparse | dense: 0.510, sparse: 0.231 |
| 10 | CWE-667 | Improper Locking | Class | Allowed-with-Review | 0.2015 | dense, sparse | dense: 0.472, sparse: 0.186 |

