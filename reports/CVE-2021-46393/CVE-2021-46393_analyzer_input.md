# Vulnerability Information: CVE-2021-46393

## Vulnerability Description
There is a **stack buffer overflow** vulnerability in the formSetPPTPServer function of Tenda-AX3 router V16.03.12.10_CN. The v10 variable is directly retrieved from the http request parameter startIp. Then v10 will be splice to stack by function sscanf without any security check,which causes stack overflow. By POSTing the page /goform/SetPptpServerCfg with proper startIp, the attacker can easily perform remote code execution with carefully crafted overflow data.

### Vulnerability Description Key Phrases
- **weakness:** **stack buffer overflow**
- **impact:** remote code execution
- **vector:** POSTing to /goform/SetPptpServerCfg with proper startIp
- **product:** Tenda-AX3 router
- **version:** V16.03.12.10_CN
- **component:** formSetPPTPServer function

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 6)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause of Vulnerability:**
- The root cause is a stack buffer overflow vulnerability in the `formSetPPTPServer` function within the Tenda AX3 router firmware.

**Weaknesses/Vulnerabilities Present:**
- **Stack Buffer Overflow:** The vulnerability occurs because the `v10` variable, derived from the `startIp` HTTP request parameter, is directly used in the `sscanf` function without any length checks. This allows an attacker to write beyond the allocated buffer on the stack.

**Impact of Exploitation:**
- **Remote Code Execution (RCE):** By exploiting the stack buffer overflow, an attacker can gain the ability to execute arbitrary code on the router.

**Attack Vectors:**
- **HTTP POST Request:** The attacker needs to send an HTTP POST request to the `/goform/SetPptpServerCfg` endpoint.
- **`startIp` Parameter:** The malicious input is sent through the `startIp` parameter in the POST request.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker needs to have network access to the Tenda AX3 router to send the crafted HTTP request.
- **Knowledge of Vulnerable Endpoint:** The attacker needs to know the vulnerable endpoint (`/goform/SetPptpServerCfg`) and the vulnerable parameter (`startIp`).
- **Ability to Craft Malicious Input:** The attacker needs to craft a malicious input string for `startIp` that exceeds the buffer size, allowing for RCE.

**Additional Details:**
- The vulnerability affects the Tenda AX3 router, specifically version V16.03.12.10\_CN.
- A Proof of Concept (POC) is provided in the content, using `requests` and `pwn` python libraries to demonstrate the exploitation. It shows that by sending a `startIp` parameter with a value of "a" repeated 1024 times results in a stack buffer overflow.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.5302 | sparse, graph | sparse: 0.302, graph: 1.000 |
| 2 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5148 | dense, sparse | dense: 0.621, sparse: 0.431 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4790 | sparse, graph | sparse: 0.302, graph: 0.857 |
| 4 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.4673 | sparse, graph | sparse: 0.297, graph: 0.832 |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.4627 | sparse, graph | sparse: 0.279, graph: 0.957 |
| 6 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.4161 | dense, sparse | dense: 0.541, sparse: 0.254 |
| 7 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.3976 | dense, sparse | dense: 0.485, sparse: 0.271 |
| 8 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3939 | dense, sparse | dense: 0.488, sparse: 0.294 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3773 | dense, sparse | dense: 0.488, sparse: 0.288 |
| 10 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.2385 | dense, sparse | dense: 0.481, sparse: 0.288 |

