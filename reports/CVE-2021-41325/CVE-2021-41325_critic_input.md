# Critic Input for CVE-2021-41325



# Original Analyzer Input
## Vulnerability Description
Broken access control for user creation in Pydio Cells 2.2.9 allows remote anonymous users to create standard users via the profile parameter. (In addition, such users can be granted several admin permissions via the Roles parameter.)

### Vulnerability Description Key Phrases
- **rootcause:** **broken access control**
- **impact:** create standard users
- **vector:** profile parameter
- **attacker:** remote anonymous users
- **product:** Pydio Cells
- **version:** 2.2.9
- **component:** user creation

## CVE Reference Links Content Summary
Based on the provided content, here's the breakdown of CVE-2021-41325:

**Root Cause:** The vulnerability stems from the ability to create a user with an empty profile value (`""`) instead of the expected values ("admin", "standard", "shared", or "anon"). This allows an attacker with a valid public share link to create a persistent user and then escalate its privileges.

**Weaknesses/Vulnerabilities Present:**

*   **Broken Access Control:** An anonymous user, authenticated through a public share link, gains the ability to perform actions they should not be authorized to do.
*   **Privilege Escalation:** The attacker elevates the newly created user's privileges to the "ADMINS" role.
*   **Insufficient Input Validation:** The application does not properly validate the user profile value during user creation, allowing an empty string to be used.

**Impact of Exploitation:**

*   **User Enumeration:** An attacker can enumerate all usernames (including admins) on the Cells instance.
*   **Persistent User Creation:** An attacker can create a standard user account that persists beyond the session.
*   **Privilege Escalation:** The attacker can escalate their privileges to admin, granting them significant control.
*   **Configuration Access:** The attacker can read parts of the configuration.
*   **User/Role Deletion:** The attacker can delete any user or role.

**Attack Vectors:**

*   **Public Share Link:** The attacker requires a valid "/public/" link to initiate the attack.
*   **Web Request Tampering:** The attacker manipulates web requests to create a user with an empty profile value and then assigns administrative roles.

**Required Attacker Capabilities/Position:**

*   **Access to a Public Share Link:** The attacker needs a valid share link.
*   **Network Access:** The attacker must be able to send HTTP requests to the Pydio Cells server.
*   **Knowledge of the Pydio API:** The attacker needs to be able to craft or modify web requests to exploit the vulnerability.

**Additional Notes:**

*   The vulnerability is exploited in multiple steps, starting with the anonymous user access via a public link (partially related to CVE-2020-12848).
*   The vulnerability is specifically related to the profile value being set to `""` during user creation.
*   The provided content details the specific web requests involved in each stage of the exploit, including user creation and privilege escalation.
*   The fix involves updating Pydio Cells to version 2.2.12 or above.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-472 | External Control of Assumed-Immutable Web Parameter | Base | Allowed | 0.5498 | dense, sparse, graph | dense: 0.442, sparse: 0.161, graph: 0.662 |
| 2 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.5401 | dense, sparse, graph | dense: 0.444, sparse: 0.180, graph: 0.602 |
| 3 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.2990 | dense, sparse | dense: 0.431, sparse: 0.145 |
| 4 | CWE-267 | Privilege Defined With Unsafe Actions | Base | Allowed | 0.2987 | dense, sparse | dense: 0.421, sparse: 0.154 |
| 5 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.2963 | dense, sparse | dense: 0.408, sparse: 0.161 |
| 6 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.2922 | dense, sparse | dense: 0.415, sparse: 0.148 |
| 7 | CWE-266 | Incorrect Privilege Assignment | Base | Allowed | 0.2652 | sparse, graph | sparse: 0.149, graph: 0.504 |
| 8 | CWE-286 | Incorrect User Management | Class | Allowed-with-Review | 0.2425 | dense, sparse | dense: 0.491, sparse: 0.292 |
| 9 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.1797 | dense, sparse | dense: 0.422, sparse: 0.165 |
| 10 | CWE-862 | Missing Authorization | Class | Allowed-with-Review | 0.1789 | dense, sparse | dense: 0.443, sparse: 0.145 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-285 | Improper Authorization | 0.85 | Class | Primary | Allowed-with-Review |
| CWE-639 | Authorization Bypass Through User-Controlled Key | 0.75 | Base | Secondary Candidate | Allowed |
| CWE-267 | Privilege Defined With Unsafe Actions | 0.65 | Base | Secondary Candidate | Allowed |

## Evidence and Confidence

*   **Confidence Score:** 0.80
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**
  - *Explanation:* The vulnerability description clearly states **broken access control** as the root cause, allowing remote anonymous users to create standard users, which is a form of **improper authorization**. The attacker is able to bypass intended access restrictions during user creation. This aligns well with the general concept of CWE-285 (Improper Authorization), where the product does not perform or incorrectly performs an authorization check when an actor attempts to access a resource or perform an action. While CWE-285 is a Class-level CWE, the specific details of user creation and privilege escalation suggest a more targeted authorization failure. CWE-285 is selected because it encompasses the high-level problem, while other CWEs define related or contributing weaknesses. I am overriding the discouraged usage of CWE-285 due to the lack of more specific CWE entries.
  
  - *Relationship Analysis:* While CWE-285 is a higher-level Class, its parent is CWE-284 (Improper Access Control), which is even more general and thus less appropriate. The Retriever Results list several potential child CWEs such as CWE-639, CWE-267, and CWE-306. These are considered as contributing factors.

- **Confidence Score:**
  - Confidence: 0.85 (High confidence due to direct evidence of broken access control during user creation from the vulnerability description and CVE reference materials)

---
- **Analysis and Justification:**
  - *Explanation:* CWE-639 (Authorization Bypass Through User-Controlled Key) is relevant because the vulnerability allows an attacker to bypass authorization by manipulating the 'profile' parameter during user creation. The attacker is essentially using a user-controlled key (the profile parameter) to gain unauthorized access (creating a user and escalating privileges). This fits the description of CWE-639, which focuses on authorization bypass via modification of key values identifying data. This is a contributing weakness to the overall improper authorization, as it details the mechanism of the bypass. The "**profile parameter**" allows the **attacker** to create users.
  
  - *Relationship Analysis:* CWE-639 is a child of CWE-284 (Improper Access Control) and CWE-863 (Incorrect Authorization). It is also related to CWE-472 (External Control of Assumed-Immutable Web Parameter).
  
- **Confidence Score:**
  - Confidence: 0.75 (Medium confidence due to the user-controlled key aspect aligning with the vulnerability description.)

---
- **Analysis and Justification:**
  - *Explanation:* CWE-267 (Privilege Defined With Unsafe Actions) is also relevant because the vulnerability allows the attacker to escalate the newly created user's privileges to the "ADMINS" role. This means that a particular privilege or role is being used to perform unsafe actions (gaining admin access) that were not intended for users created in this manner. The vulnerability stems from the ability to create a user with an empty profile value (`""`) and escalate its privileges which represents the unsafe action.
  
  - *Relationship Analysis:* CWE-267 is a base level CWE. CWE-266 (Incorrect Privilege Assignment) is a child of CWE-269 (Incomplete or Missing Check of Return Value).
  
- **Confidence Score:**
  - Confidence: 0.65 (Medium confidence because while privilege escalation is present, the root cause is primarily related to the initial authorization bypass.)

# CWE Examples from Database


## Known Examples for CWE-269: Improper Privilege Management
### Observed Examples
- **CVE-2001-1555** [https://www.cve.org/CVERecord?id=CVE-2001-1555](https://www.cve.org/CVERecord?id=CVE-2001-1555): Terminal privileges are not reset when a user logs out.
- **CVE-2001-1514** [https://www.cve.org/CVERecord?id=CVE-2001-1514](https://www.cve.org/CVERecord?id=CVE-2001-1514): Does not properly pass security context to child processes in certain cases, allows privilege escalation.
- **CVE-2001-0128** [https://www.cve.org/CVERecord?id=CVE-2001-0128](https://www.cve.org/CVERecord?id=CVE-2001-0128): Does not properly compute roles.
- **CVE-1999-1193** [https://www.cve.org/CVERecord?id=CVE-1999-1193](https://www.cve.org/CVERecord?id=CVE-1999-1193): untrusted user placed in unix "wheel" group
- **CVE-2005-2741** [https://www.cve.org/CVERecord?id=CVE-2005-2741](https://www.cve.org/CVERecord?id=CVE-2005-2741): Product allows users to grant themselves certain rights that can be used to escalate privileges.
- **CVE-2005-2496** [https://www.cve.org/CVERecord?id=CVE-2005-2496](https://www.cve.org/CVERecord?id=CVE-2005-2496): Product uses group ID of a user instead of the group, causing it to run with different privileges. This is resultant from some other unknown issue.
- **CVE-2004-0274** [https://www.cve.org/CVERecord?id=CVE-2004-0274](https://www.cve.org/CVERecord?id=CVE-2004-0274): Product mistakenly assigns a particular status to an entity, leading to increased privileges.
- **CVE-2007-4217** [https://www.cve.org/CVERecord?id=CVE-2007-4217](https://www.cve.org/CVERecord?id=CVE-2007-4217): FTP client program on a certain OS runs with setuid privileges and has a buffer overflow. Most clients do not need extra privileges, so an overflow is not a vulnerability for those clients.
- **CVE-2007-5159** [https://www.cve.org/CVERecord?id=CVE-2007-5159](https://www.cve.org/CVERecord?id=CVE-2007-5159): OS incorrectly installs a program with setuid privileges, allowing users to gain privileges.
- **CVE-2008-4638** [https://www.cve.org/CVERecord?id=CVE-2008-4638](https://www.cve.org/CVERecord?id=CVE-2008-4638): Composite: application running with high privileges (CWE-250) allows user to specify a restricted file to process, which generates a parsing error that leaks the contents of the file (CWE-209).


# Relevant CWE Specifications

## CWE-269: Improper Privilege Management
**Abstraction:** Class
**Status:** Draft

### Description
The product does not properly assign, modify, track, or check privileges for an actor, creating an unintended sphere of control for that actor.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-284
ParentOf -> CWE-250
ParentOf -> CWE-266
ParentOf -> CWE-267
ParentOf -> CWE-268
ParentOf -> CWE-270
ParentOf -> CWE-271
ParentOf -> CWE-274
ParentOf -> CWE-648

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-269 is commonly misused. It can be conflated with "privilege escalation," which is a technical impact that is listed in many low-information vulnerability reports [REF-1287]. It is not useful for trend analysis.
**Comments:** If an error or mistake allows privilege escalation, then use the CWE ID for that mistake. Avoid using CWE-269 when only phrases such as "privilege escalation" or "gain privileges" are available, as these indicate technical impact of the vulnerability - not the root cause weakness. If the root cause seems to be directly related to privileges, then examine the children of CWE-269 for additional hints, such as Execution with Unnecessary Privileges (CWE-250) or Incorrect Privilege Assignment (CWE-266).
**Reasons:**
- Frequent Misuse


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Very carefully manage the setting, management, and handling of privileges. Explicitly manage trust zones in the software.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Separation of Privilege
- **Description:** Follow the principle of least privilege when assigning access rights to entities in a software system.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Separation of Privilege
- **Description:** Consider following the principle of separation of privilege. Require multiple conditions to be met before permitting access to a system resource.



### Additional Notes
**[Maintenance]** The relationships between privileges, permissions, and actors (e.g. users and groups) need further refinement within the Research view. One complication is that these concepts apply to two different pillars, related to control of resources (CWE-664) and protection mechanism failures (CWE-693).



### Observed Examples
- **CVE-2001-1555:** Terminal privileges are not reset when a user logs out.
- **CVE-2001-1514:** Does not properly pass security context to child processes in certain cases, allows privilege escalation.
- **CVE-2001-0128:** Does not properly compute roles.



## CWE-284: Improper Access Control
**Abstraction:** Pillar
**Status:** Incomplete

### Description
The product does not restrict or incorrectly restricts access to a resource from an unauthorized actor.

### Extended Description


Access control involves the use of several protection mechanisms such as:


  - Authentication (proving the identity of an actor)

  - Authorization (ensuring that a given actor can access a resource), and

  - Accountability (tracking of activities that were performed)

When any mechanism is not applied or otherwise fails, attackers can compromise the security of the product by gaining privileges, reading sensitive information, executing commands, evading detection, etc.

There are two distinct behaviors that can introduce access control weaknesses:


  - Specification: incorrect privileges, permissions, ownership, etc. are explicitly specified for either the user or the resource (for example, setting a password file to be world-writable, or giving administrator capabilities to a guest user). This action could be performed by the program or the administrator.

  - Enforcement: the mechanism contains errors that prevent it from properly enforcing the specified access control requirements (e.g., allowing the user to specify their own privileges, or allowing a syntactically-incorrect ACL to produce insecure settings). This problem occurs within the program itself, in that it does not actually enforce the intended security policy that the administrator specifies.



### Alternative Terms
Authorization: The terms "access control" and "authorization" are often used interchangeably, although many people have distinct definitions. The CWE usage of "access control" is intended as a general term for the various mechanisms that restrict which users can access which resources, and "authorization" is more narrowly defined. It is unlikely that there will be community consensus on the use of these terms.

### Relationships
ParentOf -> CWE-1191
ParentOf -> CWE-1220
ParentOf -> CWE-1224
ParentOf -> CWE-1231
ParentOf -> CWE-1233
ParentOf -> CWE-1242
ParentOf -> CWE-1252
ParentOf -> CWE-1257
ParentOf -> CWE-1259
ParentOf -> CWE-1260
ParentOf -> CWE-1262
ParentOf -> CWE-1263
ParentOf -> CWE-1267
ParentOf -> CWE-1268
ParentOf -> CWE-1270
ParentOf -> CWE-1274
ParentOf -> CWE-1276
ParentOf -> CWE-1280
ParentOf -> CWE-1283
ParentOf -> CWE-1290
ParentOf -> CWE-1292
ParentOf -> CWE-1294
ParentOf -> CWE-1296
ParentOf -> CWE-1304
ParentOf -> CWE-1311
ParentOf -> CWE-1312
ParentOf -> CWE-1313
ParentOf -> CWE-1315
ParentOf -> CWE-1316
ParentOf -> CWE-1317
ParentOf -> CWE-1320
ParentOf -> CWE-1323
ParentOf -> CWE-1334
ParentOf -> CWE-269
ParentOf -> CWE-282
ParentOf -> CWE-285
ParentOf -> CWE-286
ParentOf -> CWE-287
ParentOf -> CWE-288
ParentOf -> CWE-346
ParentOf -> CWE-639
ParentOf -> CWE-749
ParentOf -> CWE-862
ParentOf -> CWE-863
ParentOf -> CWE-923

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-284 is extremely high-level, a Pillar. Its name, "Improper Access Control," is often misused in low-information vulnerability reports [REF-1287] or by active use of the OWASP Top Ten, such as "A01:2021-Broken Access Control". It is not useful for trend analysis.
**Comments:** Consider using descendants of CWE-284 that are more specific to the kind of access control involved, such as those involving authorization (Missing Authorization (CWE-862), Incorrect Authorization (CWE-863), Incorrect Permission Assignment for Critical Resource (CWE-732), etc.); authentication (Missing Authentication (CWE-306) or Weak Authentication (CWE-1390)); Incorrect User Management (CWE-286); Improper Restriction of Communication Channel to Intended Endpoints (CWE-923); etc.
**Reasons:**
- Frequent Misuse
- Abstraction
**Suggested Alternatives:**
- CWE-862: Missing Authorization
- CWE-863: Incorrect Authorization
- CWE-732: Incorrect Permission Assignment for Critical Resource
- CWE-306: Missing Authentication
- CWE-1390: Weak Authentication
- CWE-923: Improper Restriction of Communication Channel to Intended Endpoints


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Very carefully manage the setting, management, and handling of privileges. Explicitly manage trust zones in the software.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Separation of Privilege
- **Description:** 

Compartmentalize the system to have "safe" areas where trust boundaries can be unambiguously drawn. Do not allow sensitive data to go outside of the trust boundary and always be careful when interfacing with a compartment outside of the safe area.


Ensure that appropriate compartmentalization is built into the system design, and the compartmentalization allows for and reinforces privilege separation functionality. Architects and designers should rely on the principle of least privilege to decide the appropriate time to use privileges and the time to drop privileges.




### Additional Notes
**[Maintenance]** 

This entry needs more work. Possible sub-categories include:


  - Trusted group includes undesired entities (partially covered by CWE-286)

  - Group can perform undesired actions

  - ACL parse error does not fail closed





### Observed Examples
- **CVE-2022-24985:** A form hosting website only checks the session authentication status for a single form, making it possible to bypass authentication when there are multiple forms
- **CVE-2022-29238:** Access-control setting in web-based document collaboration tool is not properly implemented by the code, which prevents listing hidden directories but does not prevent direct requests to files in those directories.
- **CVE-2022-23607:** Python-based HTTP library did not scope cookies to a particular domain such that "supercookies" could be sent to any domain on redirect



## CWE-306: Missing Authentication for Critical Function
**Abstraction:** Base
**Status:** Draft

### Description
The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-287
ChildOf -> CWE-287
ParentOf -> CWE-288
ParentOf -> CWE-322

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the software into anonymous, normal, privileged, and administrative areas. Identify which of these areas require a proven user identity, and use a centralized authentication capability.


Identify all potential communication channels, or other means of interaction with the software, to ensure that all channels are appropriately protected, including those channels that are assumed to be accessible only by authorized parties. Developers sometimes perform authentication at the primary channel, but open up a secondary channel that is assumed to be private. For example, a login mechanism may be listening on one network port, but after successful authentication, it may open up a second port where it waits for the connection, but avoids authentication because it assumes that only the authenticated party will connect to the port.


In general, if the software or protocol allows a single session or user state to persist across multiple connections or channels, authentication and appropriate credential management need to be used throughout.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** 

Where possible, avoid implementing custom, "grow-your-own" authentication routines and consider using authentication capabilities as provided by the surrounding framework, operating system, or environment. These capabilities may avoid common weaknesses that are unique to authentication; support automatic auditing and tracking; and make it easier to provide a clear separation between authentication tasks and authorization tasks.


In environments such as the World Wide Web, the line between authentication and authorization is sometimes blurred. If custom authentication routines are required instead of those provided by the server, then these routines must be applied to every single page, since these pages could be requested directly.





### Observed Examples
- **CVE-2022-31260:** Chain: a digital asset management program has an undisclosed backdoor in the legacy version of a PHP script (CWE-912) that could allow an unauthenticated user to export metadata (CWE-306)
- **CVE-2022-29951:** TCP-based protocol in Programmable Logic Controller (PLC) has no authentication.
- **CVE-2022-29952:** Condition Monitor firmware uses a protocol that does not require authentication.



## CWE-267: Privilege Defined With Unsafe Actions
**Abstraction:** Base
**Status:** Incomplete

### Description
A particular privilege, role, capability, or right can be used to perform unsafe actions that were not intended, even when it is assigned to the correct entity.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-269
ParentOf -> CWE-623

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Very carefully manage the setting, management, and handling of privileges. Explicitly manage trust zones in the software.

**Mitigation 2:**
- **Phase:** Architecture and Design, Operation
- **Strategy:** Environment Hardening
- **Description:** Run your code using the lowest privileges that are required to accomplish the necessary tasks [REF-76]. If possible, create isolated accounts with limited privileges that are only used for a single task. That way, a successful attack will not immediately give the attacker access to the rest of the software or its environment. For example, database applications rarely need to run as the database administrator, especially in day-to-day operations.



### Additional Notes
**[Maintenance]** 

Note: there are 2 separate sub-categories here:

```
		- privilege incorrectly allows entities to perform certain actions
		- object is incorrectly accessible to entities with a given privilege
```




### Observed Examples
- **CVE-2002-1981:** Roles have access to dangerous procedures (Accessible entities).
- **CVE-2002-1671:** Untrusted object/method gets access to clipboard (Accessible entities).
- **CVE-2004-2204:** Gain privileges using functions/tags that should be restricted (Accessible entities).



## CWE-863: Incorrect Authorization
**Abstraction:** Class
**Status:** Incomplete

### Description
The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check.

### Extended Description
Not provided

### Alternative Terms
AuthZ: "AuthZ" is typically used as an abbreviation of "authorization" within the web application security community. It is distinct from "AuthN" (or, sometimes, "AuthC") which is an abbreviation of "authentication." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.

### Relationships
ChildOf -> CWE-285
ChildOf -> CWE-284
ParentOf -> CWE-1244
ParentOf -> CWE-551
ParentOf -> CWE-639
ParentOf -> CWE-647
ParentOf -> CWE-804
ParentOf -> CWE-942

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** This CWE entry is a Class and might have Base-level children that would be more appropriate
**Comments:** Examine children of this entry to see if there is a better fit
**Reasons:**
- Abstraction


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the product into anonymous, normal, privileged, and administrative areas. Reduce the attack surface by carefully mapping roles with data and functionality. Use role-based access control (RBAC) [REF-229] to enforce the roles at the appropriate boundaries.


Note that this approach may not protect against horizontal authorization, i.e., it will not protect a user from attacking others with the same role.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Ensure that access control checks are performed related to the business logic. These checks may be different than the access control checks that are applied to more generic resources such as files, connections, processes, memory, and database records. For example, a database may restrict access for medical records to a specific database user, but each record might only be intended to be accessible to the patient and the patient's doctor [REF-7].

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


For example, consider using authorization frameworks such as the JAAS Authorization Framework [REF-233] and the OWASP ESAPI Access Control feature [REF-45].




### Additional Notes
**[Terminology]** 

Assuming a user with a given identity, authorization is the process of determining whether that user can access a given resource, based on the user's privileges and any permissions or other access-control specifications that apply to the resource.




### Observed Examples
- **CVE-2021-39155:** Chain: A microservice integration and management platform compares the hostname in the HTTP Host header in a case-sensitive way (CWE-178, CWE-1289), allowing bypass of the authorization policy (CWE-863) using a hostname with mixed case or other variations.
- **CVE-2019-15900:** Chain: sscanf() call is used to check if a username and group exists, but the return value of sscanf() call is not checked (CWE-252), causing an uninitialized variable to be checked (CWE-457), returning success to allow authorization bypass for executing a privileged (CWE-863).
- **CVE-2009-2213:** Gateway uses default "Allow" configuration for its authorization settings.



## CWE-639: Authorization Bypass Through User-Controlled Key
**Abstraction:** Base
**Status:** Incomplete

### Description
The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.

### Extended Description


Retrieval of a user record occurs in the system based on some key value that is under user control. The key would typically identify a user-related record stored in the system and would be used to lookup that record for presentation to the user. It is likely that an attacker would have to be an authenticated user in the system. However, the authorization process would not properly check the data access operation to ensure that the authenticated user performing the operation has sufficient entitlements to perform the requested data access, hence bypassing any other authorization checks present in the system.


For example, attackers can look at places where user specific data is retrieved (e.g. search screens) and determine whether the key for the item being looked up is controllable externally. The key may be a hidden field in the HTML form field, might be passed as a URL parameter or as an unencrypted cookie variable, then in each of these cases it will be possible to tamper with the key value.


One manifestation of this weakness is when a system uses sequential or otherwise easily-guessable session IDs that would allow one user to easily switch to another user's session and read/modify their data.


### Alternative Terms
Insecure Direct Object Reference / IDOR: The "Insecure Direct Object Reference" term, as described in the OWASP Top Ten, is broader than this CWE because it also covers path traversal (CWE-22). Within the context of vulnerability theory, there is a similarity between the OWASP concept and CWE-706: Use of Incorrectly-Resolved Name or Reference.
Broken Object Level Authorization / BOLA: BOLA is used in the 2019 OWASP API Security Top 10 and is said to be the same as IDOR.
Horizontal Authorization: "Horizontal Authorization" is used to describe situations in which two users have the same privilege level, but must be prevented from accessing each other's resources. This is fairly common when using key-based access to resources in a multi-user context.

### Relationships
ChildOf -> CWE-863
ChildOf -> CWE-863
ChildOf -> CWE-284
ParentOf -> CWE-566

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** For each and every data access, ensure that the user has sufficient privilege to access the record that is being requested.

**Mitigation 2:**
- **Phase:** Architecture and Design, Implementation
- **Description:** Make sure that the key that is used in the lookup of a specific user's record is not controllable externally by the user or that any tampering can be detected.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** Use encryption in order to make it more difficult to guess other legitimate values of the key or associate a digital signature with the key so that the server can verify that there has been no tampering.




### Observed Examples
- **CVE-2021-36539:** An educational application does not appropriately restrict file IDs to a particular user. The attacker can brute-force guess IDs, indicating IDOR.



## CWE-472: External Control of Assumed-Immutable Web Parameter
**Abstraction:** Base
**Status:** Draft

### Description
The web application does not sufficiently verify inputs that are assumed to be immutable but are actually externally controllable, such as hidden form fields.

### Extended Description


If a web product does not properly protect assumed-immutable values from modification in hidden form fields, parameters, cookies, or URLs, this can lead to modification of critical data. Web applications often mistakenly make the assumption that data passed to the client in hidden fields or cookies is not susceptible to tampering. Improper validation of data that are user-controllable can lead to the application processing incorrect, and often malicious, input.


For example, custom cookies commonly store session data or persistent data across sessions. This kind of session data is normally involved in security related decisions on the server side, such as user authentication and access control. Thus, the cookies might contain sensitive data such as user credentials and privileges. This is a dangerous practice, as it can often lead to improper reliance on the value of the client-provided cookie by the server side application.


### Alternative Terms
Assumed-Immutable Parameter Tampering

### Relationships
ChildOf -> CWE-642
ChildOf -> CWE-471
RequiredBy -> CWE-384
CanFollow -> CWE-656

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** 

Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a list of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.


When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, "boat" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as "red" or "blue."


Do not rely exclusively on looking for malicious or malformed inputs. This is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, denylists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.


**Mitigation 2:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass allowlist validation schemes by introducing dangerous inputs after they have been checked.



### Additional Notes
**[Relationship]** This is a primary weakness for many other weaknesses and functional consequences, including XSS, SQL injection, path disclosure, and file inclusion.

**[Theoretical]** This is a technology-specific MAID problem.



### Observed Examples
- **CVE-2002-0108:** Forum product allows spoofed messages of other users via hidden form fields for name and e-mail address.
- **CVE-2000-0253:** Shopping cart allows price modification via hidden form field.
- **CVE-2000-0254:** Shopping cart allows price modification via hidden form field.



## CWE-285: Improper Authorization
**Abstraction:** Class
**Status:** Draft

### Description
The product does not perform or incorrectly performs an authorization check when an actor attempts to access a resource or perform an action.

### Extended Description


Assuming a user with a given identity, authorization is the process of determining whether that user can access a given resource, based on the user's privileges and any permissions or other access-control specifications that apply to the resource.


When access control checks are not applied consistently - or not at all - users are able to access data or perform actions that they should not be allowed to perform. This can lead to a wide range of problems, including information exposures, denial of service, and arbitrary code execution.


### Alternative Terms
AuthZ: "AuthZ" is typically used as an abbreviation of "authorization" within the web application security community. It is distinct from "AuthN" (or, sometimes, "AuthC") which is an abbreviation of "authentication." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1230
ParentOf -> CWE-1256
ParentOf -> CWE-1297
ParentOf -> CWE-1328
ParentOf -> CWE-552
ParentOf -> CWE-732
ParentOf -> CWE-862
ParentOf -> CWE-863
ParentOf -> CWE-926
ParentOf -> CWE-927

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-285 is high-level and lower-level CWEs can frequently be used instead. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Look at CWE-285's children and consider mapping to CWEs such as CWE-862: Missing Authorization, CWE-863: Incorrect Authorization, CWE-732: Incorrect Permission Assignment for Critical Resource, or others.
**Reasons:**
- Abstraction
**Suggested Alternatives:**
- CWE-862: Missing Authorization
- CWE-863: Incorrect Authorization
- CWE-732: Incorrect Permission Assignment for Critical Resource


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the product into anonymous, normal, privileged, and administrative areas. Reduce the attack surface by carefully mapping roles with data and functionality. Use role-based access control (RBAC) to enforce the roles at the appropriate boundaries.


Note that this approach may not protect against horizontal authorization, i.e., it will not protect a user from attacking others with the same role.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Ensure that you perform access control checks related to your business logic. These checks may be different than the access control checks that you apply to more generic resources such as files, connections, processes, memory, and database records. For example, a database may restrict access for medical records to a specific database user, but each record might only be intended to be accessible to the patient and the patient's doctor.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


For example, consider using authorization frameworks such as the JAAS Authorization Framework [REF-233] and the OWASP ESAPI Access Control feature [REF-45].





### Observed Examples
- **CVE-2022-24730:** Go-based continuous deployment product does not check that a user has certain privileges to update or create an app, allowing adversaries to read sensitive repository information
- **CVE-2009-3168:** Web application does not restrict access to admin scripts, allowing authenticated users to reset administrative passwords.
- **CVE-2009-2960:** Web application does not restrict access to admin scripts, allowing authenticated users to modify passwords of other users.



## CWE-266: Incorrect Privilege Assignment
**Abstraction:** Base
**Status:** Draft

### Description
A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-269
CanAlsoBe -> CWE-286
ParentOf -> CWE-1022
ParentOf -> CWE-520
ParentOf -> CWE-556
ParentOf -> CWE-9

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Very carefully manage the setting, management, and handling of privileges. Explicitly manage trust zones in the software.

**Mitigation 2:**
- **Phase:** Architecture and Design, Operation
- **Strategy:** Environment Hardening
- **Description:** Run your code using the lowest privileges that are required to accomplish the necessary tasks [REF-76]. If possible, create isolated accounts with limited privileges that are only used for a single task. That way, a successful attack will not immediately give the attacker access to the rest of the software or its environment. For example, database applications rarely need to run as the database administrator, especially in day-to-day operations.




### Observed Examples
- **CVE-1999-1193:** untrusted user placed in unix "wheel" group
- **CVE-2005-2741:** Product allows users to grant themselves certain rights that can be used to escalate privileges.
- **CVE-2005-2496:** Product uses group ID of a user instead of the group, causing it to run with different privileges. This is resultant from some other unknown issue.

