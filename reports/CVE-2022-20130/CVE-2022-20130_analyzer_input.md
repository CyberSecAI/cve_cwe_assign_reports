# Vulnerability Information: CVE-2022-20130

## Vulnerability Description
In transportDec_OutOfBandConfig of tpdec_lib.cpp, there is a possible **out of bounds write** due to a **heap buffer overflow**. This could lead to remote code execution with no additional execution privileges needed. User interaction is not needed for exploitation.Product AndroidVersions Android-10 Android-11 Android-12 Android-12LAndroid ID A-224314979

### Vulnerability Description Key Phrases
- **rootcause:** **heap buffer overflow**
- **weakness:** **out of bounds write**
- **impact:** remote code execution
- **product:** Android
- **version:** 10 and 11 and 12 and 12L
- **component:** transportDec_OutOfBandConfig of tpdec_lib.cpp

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-20130:

**Root Cause:**

- The vulnerability lies in the `transportDec_OutOfBandConfig()` function within the Android Media Framework's AAC decoder.
- The issue stems from improper handling of invalid out-of-band configuration data. Specifically, the decoder attempts to reallocate memory based on potentially malformed configuration data.

**Weaknesses/Vulnerabilities:**

- **Improper Input Validation:** The decoder doesn't adequately validate the out-of-band configuration data before using it to make memory allocation decisions.
- **Memory Corruption:** Processing invalid out-of-band configuration can result in an attempt to allocate a buffer that leads to a buffer overflow or other memory corruption issues.

**Impact of Exploitation:**

- **Remote Code Execution (RCE):**  The vulnerability is classified as critical and could lead to remote code execution without requiring additional execution privileges. This means an attacker could potentially execute arbitrary code on a vulnerable device.

**Attack Vectors:**

- The attack vector involves sending crafted, malformed AAC data with a malicious out-of-band configuration to a vulnerable Android device.

**Required Attacker Capabilities/Position:**

- The attacker needs to be able to provide crafted media content that includes an invalid out-of-band configuration to the targeted system. This could involve a malicious application or through a media file from a compromised source. The attacker does not need any privileges.

**Additional Notes:**

- The fix implemented prevents the decoder from reallocating memory when invalid out-of-band configuration is encountered. Instead, the decoder will now reject the configuration.
- This issue is present in Android versions 10, 11, 12, and 12L.
- The fix is included in the 2022-06-01 security patch level.
- This vulnerability also affects Google Play system updates through the Media Codecs component.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.9848 | dense, sparse, graph | dense: 0.573, sparse: 0.596, graph: 1.000 |
| 2 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.8780 | dense, sparse, graph | dense: 0.613, sparse: 0.618, graph: 0.609 |
| 3 | CWE-416 | Use After Free | Variant | Allowed | 0.7403 | dense, sparse, graph | dense: 0.547, sparse: 0.513, graph: 0.657 |
| 4 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6138 | dense, sparse | dense: 0.593, sparse: 0.554 |
| 5 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5905 | dense, sparse | dense: 0.556, sparse: 0.546 |
| 6 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.5803 | dense, sparse | dense: 0.577, sparse: 0.510 |
| 7 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.5766 | dense, sparse | dense: 0.584, sparse: 0.581 |
| 8 | CWE-1021 | Improper Restriction of Rendered UI Layers or Frames | Base | Allowed | 0.5594 | dense, sparse | dense: 0.556, sparse: 0.492 |
| 9 | CWE-909 | Missing Initialization of Resource | Class | Allowed-with-Review | 0.4096 | dense, sparse, graph | dense: 0.586, sparse: 0.308, graph: 0.638 |
| 10 | CWE-415 | Double Free | Variant | Allowed | 0.3822 | sparse, graph | sparse: 0.309, graph: 0.663 |

