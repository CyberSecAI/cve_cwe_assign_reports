# Vulnerability Information: CVE-2022-40998

## Vulnerability Description
Several **stack-based buffer overflow** vulnerabilities exist in the DetranCLI command parsing functionality of Siretta QUARTZ-GOLD G5.0.1.5-210720-141020. A specially-crafted network packet can lead to arbitrary command execution. An attacker can send a sequence of requests to trigger these vulnerabilities.This buffer overflow is in the function that manages the no gre index destination A.B.C.D/M description (WORD|null) command template.

### Vulnerability Description Key Phrases
- **rootcause:** **stack-based buffer overflow**
- **impact:** arbitrary command execution
- **product:** Siretta QUARTZ-GOLD
- **version:** G5.0.1.5-210720-141020
- **component:** DetranCLI command parsing functionality

## CVE Reference Links Content Summary
The provided content is related to CVE-2022-40998.

**Root cause of vulnerability:**
The root cause is the use of `sprintf` to format command parameters into a fixed-size stack buffer without checking the size of the input parameters. This leads to a classic stack-based buffer overflow vulnerability.

**Weaknesses/vulnerabilities present:**
The weakness is a stack-based buffer overflow (CWE-120). The `sprintf` function is used to copy user-provided input into a fixed-size buffer without proper bounds checking. This allows an attacker to overwrite adjacent memory on the stack.

**Impact of exploitation:**
Successful exploitation allows an attacker to achieve arbitrary command execution by overwriting the stack, potentially leading to a full compromise of the device.

**Attack vectors:**
The attack vector is sending specially crafted network packets containing commands to the `DetranCLI` interface.

**Required attacker capabilities/position:**
The attacker requires the ability to send network packets to the device and must have high privileges.

**Specifics for CVE-2022-40998:**
The vulnerability is triggered by the `no gre index` command using the following template:
```
no gre index <1-8> destination A.B.C.D/M description (WORD|null)
```
The vulnerable code is:
```
sprintf(buff_0x80,"%d<%s<%s<%s",1,*argv,argv[1],argv[2]);
```
The `sprintf` function copies the command parameters into `buff_0x80`, a buffer of size 0x80 bytes, without validating the length of the input parameters. This results in a buffer overflow if the concatenated string exceeds 0x80 bytes.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 1.0820 | dense, sparse, graph | dense: 0.706, sparse: 0.866, graph: 0.797 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.8160 | dense, sparse, graph | dense: 0.569, sparse: 0.365, graph: 0.901 |
| 3 | CWE-193 | Off-by-one Error | Base | Allowed | 0.8009 | dense, sparse, graph | dense: 0.557, sparse: 0.339, graph: 0.919 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.6613 | dense, sparse, graph | dense: 0.579, sparse: 0.312, graph: 0.695 |
| 5 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5013 | dense, sparse | dense: 0.659, sparse: 0.373 |
| 6 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4779 | dense, sparse | dense: 0.549, sparse: 0.355 |
| 7 | CWE-170 | Improper Null Termination | Base | Allowed | 0.4647 | sparse, graph | sparse: 0.319, graph: 0.789 |
| 8 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4621 | dense, sparse | dense: 0.575, sparse: 0.305 |
| 9 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4538 | dense, sparse | dense: 0.545, sparse: 0.317 |
| 10 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.4506 | dense, sparse | dense: 0.566, sparse: 0.292 |

