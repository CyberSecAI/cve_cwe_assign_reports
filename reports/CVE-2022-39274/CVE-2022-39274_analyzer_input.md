# Vulnerability Information: CVE-2022-39274

## Vulnerability Description
LoRaMac-node is a reference implementation and documentation of a LoRa network node. Versions of LoRaMac-node prior to 4.7.0 are vulnerable to a **buffer overflow**. **Improper size validation of the incoming radio frames** can lead to an 65280-byte out-of-bounds write. The function `ProcessRadioRxDone` implicitly expects incoming radio frames to have at least a payload of one byte or more. An empty payload leads to a 1-byte out-of-bounds read of user controlled content when the payload buffer is reused. This allows an attacker to craft a FRAME_TYPE_PROPRIETARY frame with size -1 which results in an 65280-byte out-of-bounds memcopy likely with partially controlled attacker data. Corrupting a large part if the data section is likely to cause a DoS. If the large out-of-bounds write does not immediately crash the attacker may gain control over the execution due to now controlling large parts of the data section. Users are advised to upgrade either by updating their package or by manually applying the patch commit `e851b079`.

### Vulnerability Description Key Phrases
- **rootcause:** **Improper size validation of the incoming radio frames**
- **weakness:** **buffer overflow**
- **vector:** crafting FRAME_TYPE_PROPRIETARY frame with size -1
- **product:** LoRaMac-node
- **version:** prior to 4.7.0
- **component:** ProcessRadioRxDone function

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2022-39274:

**Root cause of vulnerability:**
- The vulnerability stems from a lack of proper size validation of incoming radio frames in the `ProcessRadioRxDone` function. The function expects a payload of at least one byte, and an empty payload leads to an out-of-bounds read. Additionally, when the frame type is `FRAME_TYPE_PROPRIETARY`, a large out-of-bounds write occurs due to a flawed size calculation.

**Weaknesses/vulnerabilities present:**
- **Out-of-bounds read:** When the received radio frame has an empty payload, the code attempts to read the first byte of the payload, leading to a one-byte out-of-bounds read.
- **Out-of-bounds write:** When the frame type is `FRAME_TYPE_PROPRIETARY` and the size is zero, a `memcpy` operation occurs with an incorrect size calculation `size - pktHeaderLen`, leading to an out-of-bounds write of up to 65280 bytes.

**Impact of exploitation:**
- **Denial of Service (DoS):** The large out-of-bounds write can corrupt the data section, likely causing a crash and leading to a denial of service.
- **Remote Code Execution (RCE):** If the out-of-bounds write does not immediately crash the system, an attacker might gain control over the execution by controlling large parts of the data section.

**Attack vectors:**
- An attacker can craft a malicious LoRaWAN frame with an empty payload or a `FRAME_TYPE_PROPRIETARY` frame with a size that triggers the out-of-bounds write.
- The attack is carried out over the air (radio), through a specially crafted radio transmission.

**Required attacker capabilities/position:**
- The attacker needs to be within radio range of the vulnerable device and capable of transmitting crafted LoRaWAN frames.
- The attacker needs to understand the LoRaWAN protocol well enough to craft packets that trigger the vulnerability.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 1.1369 | dense, sparse, graph | dense: 0.482, sparse: 1.000, graph: 0.905 |
| 2 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 1.1118 | dense, sparse, graph | dense: 0.461, sparse: 1.000, graph: 0.865 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 1.0761 | dense, sparse, graph | dense: 0.475, sparse: 1.000, graph: 0.745 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.9844 | dense, sparse, graph | dense: 0.488, sparse: 1.000, graph: 0.700 |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.9587 | dense, sparse, graph | dense: 0.471, sparse: 1.000, graph: 0.645 |
| 6 | CWE-170 | Improper Null Termination | Base | Allowed | 0.8542 | sparse, graph | sparse: 1.000, graph: 0.789 |
| 7 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.8107 | sparse, graph | sparse: 1.000, graph: 0.668 |
| 8 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.8025 | dense, sparse | dense: 0.460, sparse: 1.000 |
| 9 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.7463 | dense, sparse | dense: 0.473, sparse: 1.000 |
| 10 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.7414 | dense, sparse | dense: 0.462, sparse: 1.000 |

