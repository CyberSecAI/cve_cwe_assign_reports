# Vulnerability Information: CVE-2021-31401

## Vulnerability Description
An issue was discovered in tcp_rcv() in nptcp.c in HCC embedded InterNiche 4.0.1. The TCP header processing code doesnt sanitize the value of the IP total length field (header length + data length). With a crafted IP packet, an **integer overflow** occurs whenever the value of the IP data length is calculated by subtracting the length of the header from the total length of the IP packet.

### Vulnerability Description Key Phrases
- **weakness:** **integer overflow**
- **vector:** crafted IP packet
- **product:** HCC embedded InterNiche
- **version:** 4.0.1
- **component:** tcp_rcv() in nptcp.c

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability described in CVE-2021-31401:

**Root Cause:**

*   The vulnerability stems from a lack of proper sanitization in the TCP header processing code of the NicheStack TCP/IP stack.
*   Specifically, the code does not validate the IP length field (header + data) within a TCP packet.

**Weaknesses/Vulnerabilities:**

*   **Integer Overflow:** A crafted IP packet with a manipulated IP length field can cause an integer overflow. This overflow occurs when the code calculates the length of the IP data by subtracting the header length from the total IP packet length.

*   **Improper Input Validation**: The core issue is a failure to validate the size of data provided, leading to the potential for out-of-bounds access/calculation.

**Impact of Exploitation:**

*   The impact is described as "application-dependent", meaning that the result of this integer overflow will depend on how the IP data length is then used by the specific application making use of NicheStack.
*   The provided data indicates potential impacts including denial-of-service, information disclosure or arbitrary code execution. However, this specific vulnerability is not directly linked to remote code execution in the provided texts.
*   The Siemens advisory notes that this vulnerability can cause an integrity impact (data alteration).

**Attack Vectors:**

*   **Remote Network Access**: Attackers can exploit this vulnerability by sending specially crafted network packets. The attack is done via the network itself, allowing for remote exploitation.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to have the ability to send network packets to the target device running a vulnerable version of NicheStack.
*   **Unauthenticated:** The vulnerability can be exploited without needing any prior authentication.

**Additional Notes:**

*   This vulnerability is present in all versions of NicheStack prior to version 4.3, specifically within the `in_tcp` module version 1.9.
*   The vulnerability is one of 14 discovered as part of the "INFRA:HALT" set of vulnerabilities.
*   This vulnerability exists within the TCP layer, which is an OSI Layer-4 protocol, and involves how a device handles the IP packet lengths during data processing within the TCP protocol itself.
*   The Siemens advisory notes that while the base CVSS score for this vulnerability is 7.5, this score is specific to their implementation, and suggests that a user-specific environmental score may result in higher scores.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.8356 | dense, sparse, graph | dense: 0.560, sparse: 0.346, graph: 1.000 |
| 2 | CWE-805 | Buffer Access with Incorrect Length Value | Base | Allowed | 0.8072 | dense, sparse, graph | dense: 0.536, sparse: 0.317, graph: 1.000 |
| 3 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.5112 | sparse, graph | sparse: 0.358, graph: 0.857 |
| 4 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.4908 | dense, sparse | dense: 0.540, sparse: 0.385 |
| 5 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.4468 | dense, sparse | dense: 0.494, sparse: 0.349 |
| 6 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4435 | dense, sparse | dense: 0.514, sparse: 0.326 |
| 7 | CWE-195 | Signed to Unsigned Conversion Error | Variant | Allowed | 0.4270 | sparse, graph | sparse: 0.348, graph: 0.737 |
| 8 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4148 | dense, sparse | dense: 0.489, sparse: 0.298 |
| 9 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.4124 | sparse, graph | sparse: 0.326, graph: 0.729 |
| 10 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.4015 | sparse, graph | sparse: 0.307, graph: 0.631 |

