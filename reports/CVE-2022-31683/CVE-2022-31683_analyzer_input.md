# Vulnerability Information: CVE-2022-31683

## Vulnerability Description
Concourse (7.x.y prior to 7.8.3 and 6.x.y prior to 6.7.9) contains an **authorization bypass issue**. A Concourse user can send a request with body including team_name=team2 to bypass team scope check to gain access to certain resources belong to any other team.

### Vulnerability Description Key Phrases
- **weakness:** **authorization bypass issue**
- **impact:** bypass team scope check to gain access to certain resources belong to any other team
- **vector:** A Concourse user can send a request with body including team_name=team2
- **attacker:** Concourse user
- **product:** Concourse
- **version:** 7.x.y prior to 7.8.3 and 6.x.y prior to 6.7.9

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2022-31683:

**Root Cause of Vulnerability:**

- The vulnerability stems from how Concourse parses the `:team_name` parameter in certain API endpoints. It uses `FormValue` which allows HTTP parameter pollution, where parameters in the request body take precedence over those in the URL, instead of using `URL.Query().Get()`.

**Weaknesses/Vulnerabilities Present:**

- **HTTP Parameter Pollution:** The application uses `FormValue` to extract parameters, making it susceptible to parameter pollution, where a malicious user can override URL parameters by providing the same parameter in the request body.
- **Insufficient Access Control:** The vulnerability allows a user to bypass team scope checks by manipulating the `team_name` parameter. This indicates a weakness in how access permissions are enforced.

**Impact of Exploitation:**

- **Unauthorized Access to Resources:** An attacker can gain access to and manipulate resources (pipelines, jobs, resources) belonging to a team they are not authorized to access.
- **Unauthorized Actions:** The attacker can perform actions such as pausing/unpausing pipelines, scheduling jobs, and enabling/disabling resources across different teams without proper authorization.
- **Data Modification/Manipulation:** The ability to control resources could allow an attacker to modify data or cause operational disruptions by pausing pipelines, or creating artifacts.

**Attack Vectors:**

- **HTTP POST/PUT Requests:** The vulnerability is exploited by sending crafted POST or PUT requests to specific API endpoints that include `:team_name` in the URL.
- **Request Body Manipulation:** The attacker manipulates the request body by including `:team_name=target_team`, thus overriding the `:team_name` parameter in the URL.
- `fly curl` is used in the example to create and send the crafted requests

**Required Attacker Capabilities/Position:**

- **Valid User Session:** The attacker needs to have a valid user session in the Concourse instance.
- **Membership in Any Team:** The attacker must belong to at least one team in the Concourse deployment.
- **Knowledge of Target Team:** The attacker needs to know the name of the target team to which they want to gain unauthorized access.
- **Network Access:** Requires network access to interact with the Concourse API.

**Additional Details:**

- The provided content is more detailed than the typical CVE description, providing specific vulnerable endpoints and a step-by-step reproduction example using `fly`.
- The patch implemented uses `URL.Query().Get()` which retrieves parameters only from the URL, preventing the body from overriding URL parameters.
- Affected versions are `<7.8.2`, with patched versions released as `6.7.9` and `7.8.3`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.5796 | dense, sparse, graph | dense: 0.465, sparse: 0.230, graph: 0.602 |
| 2 | CWE-235 | Improper Handling of Extra Parameters | Variant | Allowed | 0.4774 | dense, sparse | dense: 0.530, sparse: 0.440 |
| 3 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.4161 | sparse, graph | sparse: 0.207, graph: 0.832 |
| 4 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.1820 | sparse, graph | sparse: 0.227, graph: 0.503 |
| 5 | CWE-285 | Improper Authorization | Class | Discouraged | 0.1359 | sparse, graph | sparse: 0.216, graph: 0.503 |
| 6 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.1176 | sparse | sparse: 0.206 |
| 7 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.1150 | sparse | sparse: 0.201 |
| 8 | CWE-620 | Unverified Password Change | Base | Allowed | 0.1148 | sparse | sparse: 0.201 |
| 9 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.1096 | sparse | sparse: 0.192 |
| 10 | CWE-472 | External Control of Assumed-Immutable Web Parameter | Base | Allowed | 0.1088 | sparse | sparse: 0.190 |

