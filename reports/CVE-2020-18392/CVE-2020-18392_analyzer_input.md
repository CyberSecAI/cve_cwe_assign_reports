# Vulnerability Information: CVE-2020-18392

## Vulnerability Description
**Stack overflow** vulnerability in parse_array Cesanta MJS 1.20.1, allows remote attackers to cause a Denial of Service (DoS) via a crafted file.

### Vulnerability Description Key Phrases
- **weakness:** **Stack overflow**
- **impact:** Denial of Service (DoS)
- **vector:** crafted file
- **attacker:** remote attackers
- **product:** Cesanta MJS
- **version:** 1.20.1
- **component:** parse_array

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-674

#### Top CWEs
- CWE-674 (Count: 58)
- CWE-787 (Count: 3)
- CWE-119 (Count: 2)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
The root cause is a stack overflow triggered by deeply nested array structures during JSON parsing in the `mjs` library. The vulnerability occurs because the `parse_array` function recursively calls `parse_value`, which in turn calls `parse_array` again when encountering another array, which leads to excessive stack usage.

**Weaknesses/Vulnerabilities:**
- Stack overflow: Recursive calls to `parse_array` and `parse_value` without a proper limit on nesting depth leads to excessive stack usage. The specific vulnerability lies in the recursive parsing logic, where there is no check or limit on the depth of nesting allowed in JSON arrays.
- `memcpy` is called by `mjs_mk_string` on the stack when processing strings.

**Impact of Exploitation:**
- Denial of Service (DoS): The stack overflow causes the program to crash, leading to a denial of service. This renders the `mjs` interpreter unusable.

**Attack Vectors:**
- Crafted JSON input: A malicious attacker can trigger the vulnerability by providing a specially crafted JSON input with deeply nested arrays.

**Required Attacker Capabilities/Position:**
- The attacker needs the ability to provide JSON input to the `mjs` library/interpreter. This could be done through an API that accepts JSON input, a configuration file, or any other point where the interpreter processes JSON.

**Technical Details:**
- The vulnerability is triggered when parsing deeply nested arrays.
- The AddressSanitizer output shows that the stack overflow happens in `__asan_memcpy`, which is called by `mjs_mk_string`. The overflow is a result of many calls to `parse_array` and `parse_value` due to the nested arrays.
- The code references `mjs.c:14225` where the stack overflow occurs within the `mjs_mk_string` function.
- The `mjs_mk_string` is called by `mjs_get_own_property` which is called by `mjs_set_internal` ... and eventually `parse_array`

**Additional Notes:**
- The provided proof-of-concept (POC) files `so_mjs.c:14225_1.js` and `so_mjs.c:14225_2.js` (located at ntu-sec/pocs) are examples of crafted JSON payloads which can trigger the vulnerability.
- The ASAN output includes the call stack, further clarifying the sequence of function calls that lead to the stack overflow.
- The issue was reported in 2018 but the CVE was assigned in 2020.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.6943 | dense, sparse, graph | dense: 0.540, sparse: 0.116, graph: 1.000 |
| 2 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6312 | dense, sparse, graph | dense: 0.533, sparse: 0.129, graph: 0.814 |
| 3 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.5713 | dense, sparse, graph | dense: 0.541, sparse: 0.115, graph: 0.790 |
| 4 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3467 | sparse, graph | sparse: 0.113, graph: 0.789 |
| 5 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3354 | dense, sparse | dense: 0.538, sparse: 0.115 |
| 6 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3287 | dense, sparse | dense: 0.550, sparse: 0.141 |
| 7 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3257 | dense, sparse | dense: 0.528, sparse: 0.107 |
| 8 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.3254 | dense, sparse | dense: 0.525, sparse: 0.110 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3116 | dense, sparse | dense: 0.535, sparse: 0.122 |
| 10 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3114 | dense, sparse | dense: 0.505, sparse: 0.102 |

