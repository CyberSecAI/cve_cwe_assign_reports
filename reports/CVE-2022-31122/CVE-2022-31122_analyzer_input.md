# Vulnerability Information: CVE-2022-31122

## Vulnerability Description
Wire is an encrypted communication and collaboration platform. Versions prior to 2022-07-12/Chart 4.19.0 are subject to **Token Recipient Confusion**. If an attacker has certain details of SAML IdP metadata, and configures their own SAML on the same backend, the attacker can delete all SAML authenticated accounts of a targeted team, Authenticate as a user of the attacked team and create arbitrary accounts in the context of the team if it is not managed by SCIM. This issue is fixed in wire-server 2022-07-12 and is already deployed on all Wire managed services. On-premise instances of wire-server need to be updated to 2022-07-12/Chart 4.19.0, so that their backends are no longer affected. As a workaround, the risk of an attack can be reduced by disabling SAML configuration for teams (galley.config.settings.featureFlags.sso). Helm overrides are located in `values/wire-server/values.yaml` Note that the ability to configure SAML SSO as a team is disabled by default for on-premise installations.

### Vulnerability Description Key Phrases
- **rootcause:** **Token Recipient Confusion**
- **impact:** delete all SAML authenticated accounts and Authenticate as a user and create arbitrary accounts
- **vector:** certain details of SAML IdP metadata and configure own SAML on same backend
- **attacker:** attacker
- **product:** Wire
- **version:** prior to 2022-07-12/Chart 4.19.0

## CVE Reference Links Content Summary
```
{
  "Root cause of vulnerability": "The vulnerability arises from insufficient validation of SAML IdP metadata, allowing an attacker to manipulate the SAML SSO configuration of a targeted team.",
  "Weaknesses/vulnerabilities present": [
    "SAML IdP metadata confusion leading to unauthorized access and manipulation of accounts."
  ],
  "Impact of exploitation": "An attacker, by exploiting knowledge of SAML IdP metadata, can:\n  1. Delete all SAML authenticated accounts of the targeted team.\n  2. Authenticate as a user from existing accounts of the attacked team (if SAML is used for authentication).\n  3. Create arbitrary accounts within the context of the targeted team (unless managed by SCIM).",
  "Attack vectors": "Network-based attack, where an attacker needs to have knowledge of certain details of the SAML IdP metadata of a target team and also be able to configure SAML SSO for their own team on the same backend.",
   "Required attacker capabilities/position": "The attacker needs to have knowledge of specific details of a target team's SAML IdP metadata and must be able to configure SAML SSO for their own team on the same backend."
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1270 | Generation of Incorrect Security Tokens | Base | Allowed | 1.0831 | dense, sparse, graph | dense: 0.593, sparse: 1.000, graph: 0.600 |
| 2 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.8633 | dense, sparse, graph | dense: 0.439, sparse: 0.800, graph: 0.521 |
| 3 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.6423 | dense, sparse | dense: 0.418, sparse: 0.758 |
| 4 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.6317 | dense, sparse | dense: 0.432, sparse: 0.726 |
| 5 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.6264 | dense, sparse | dense: 0.431, sparse: 0.718 |
| 6 | CWE-303 | Incorrect Implementation of Authentication Algorithm | Base | Allowed | 0.6222 | dense, sparse | dense: 0.424, sparse: 0.717 |
| 7 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4115 | sparse | sparse: 0.719 |
| 8 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.4023 | sparse | sparse: 0.703 |
| 9 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.3853 | dense, sparse | dense: 0.428, sparse: 0.772 |
| 10 | CWE-1390 | Weak Authentication | Class | Allowed-with-Review | 0.3785 | sparse, graph | sparse: 0.812, graph: 0.503 |

