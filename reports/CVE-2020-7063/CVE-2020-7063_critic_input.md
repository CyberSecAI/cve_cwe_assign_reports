# Critic Input for CVE-2020-7063



# Original Analyzer Input
## Vulnerability Description
In PHP versions 7.2.x below 7.2.28, 7.3.x below 7.3.15 and 7.4.x below 7.4.3, when creating PHAR archive using PharDatabuildFromIterator() function, the **files are added with default permissions (0666, or all access)** even if the original files on the filesystem were with more restrictive permissions. This may result in files having more lax permissions than intended when such archive is extracted.

### Vulnerability Description Key Phrases
- **weakness:** **files are added with default permissions (0666, or all access)**
- **impact:** files having more lax permissions than intended
- **product:** PHP
- **version:** 7.2.x below 7.2.28, 7.3.x below 7.3.15 and 7.4.x below 7.4.3
- **component:** PharDatabuildFromIterator() function

## CVE Reference Links Content Summary
```
{
  "CVE-2020-7063": {
    "description": "In PHP versions 7.2.x below 7.2.28, 7.3.x below 7.3.15 and 7.4.x below 7.4.3, when creating PHAR archive using PharData::buildFromIterator() function, the files are added with default permissions (0666, or all access) even if the original files on the filesystem were with more restrictive permissions. This may result in files having more lax permissions than intended when such archive is extracted.",
    "root_cause": "Incorrect handling of file permissions when creating PHAR archives using PharData::buildFromIterator(). Files are added with default permissions (0666), ignoring original file permissions.",
    "vulnerabilities": [
      "Incorrect file permissions"
    ],
    "impact": "Files within created PHAR archives may have overly permissive access rights (0666) when extracted, potentially leading to sensitive information disclosure or unintended modifications.",
    "attack_vectors": [
      "Creating a PHAR archive with PharData::buildFromIterator() using files with restrictive permissions"
    ],
   "required_capabilities": "An attacker needs the ability to create PHAR archive and potentially influence the content added to the archive."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-281 | Improper Preservation of Permissions | Base | Allowed | 0.7711 | dense, sparse, graph | dense: 0.448, sparse: 0.580, graph: 0.603 |
| 2 | CWE-379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | 0.5460 | dense, sparse, graph | dense: 0.371, sparse: 0.309, graph: 0.514 |
| 3 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.5064 | sparse, graph | sparse: 0.334, graph: 0.882 |
| 4 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.4965 | sparse, graph | sparse: 0.317, graph: 0.882 |
| 5 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.4001 | sparse, graph | sparse: 0.305, graph: 0.631 |
| 6 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.3343 | sparse, graph | sparse: 0.307, graph: 0.488 |
| 7 | CWE-277 | Insecure Inherited Permissions | Variant | Allowed | 0.3167 | dense, sparse | dense: 0.351, sparse: 0.293 |
| 8 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.2973 | sparse, graph | sparse: 0.331, graph: 0.886 |
| 9 | CWE-250 | Execution with Unnecessary Privileges | Base | Allowed | 0.1693 | sparse | sparse: 0.296 |
| 10 | CWE-359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | 0.1656 | sparse | sparse: 0.289 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-281 | Improper Preservation of Permissions | 0.9 | Base | Primary | Allowed |
| CWE-732 | Incorrect Permission Assignment for Critical Resource | 0.5 | Class | Secondary | Allowed-with-Review |

## Evidence and Confidence

*   **Confidence Score:** 0.9
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* "The vulnerability lies in the fact that PHP's PharData::buildFromIterator() function creates PHAR archives where **files are added with default permissions (0666, or all access)**, regardless of the original file permissions. This directly reflects **CWE-281 (Improper Preservation of Permissions)**, as the intended file permissions are not maintained during the archive creation process. The CVE description and summary clearly state this **weakness** of incorrect handling of file permissions. While **CWE-732 (Incorrect Permission Assignment for Critical Resource)** is also a potential candidate, it is a Class-level CWE and less specific than CWE-281, which specifically addresses the preservation aspect."
  
  - *Relationship Analysis:* "CWE-281 has no direct relationships listed in the provided information, but it logically relates to the broader category of access control issues. CWE-732, being a class, encompasses various permission-related vulnerabilities, but is less precise in describing the specific issue of permission preservation. There are no direct parent-child relationships influencing this selection other than abstraction level considerations."

- **Confidence Score:**  
  - Confidence: 0.9 (Strong match based on the vulnerability description and CVE summary.)

# CWE Examples from Database


## Known Examples for CWE-732: Incorrect Permission Assignment for Critical Resource
### Observed Examples
- **CVE-2022-29527** [https://www.cve.org/CVERecord?id=CVE-2022-29527](https://www.cve.org/CVERecord?id=CVE-2022-29527): Go application for cloud management creates a world-writable sudoers file that allows local attackers to inject sudo rules and escalate privileges to root by winning a race condition.
- **CVE-2009-3482** [https://www.cve.org/CVERecord?id=CVE-2009-3482](https://www.cve.org/CVERecord?id=CVE-2009-3482): Anti-virus product sets insecure "Everyone: Full Control" permissions for files under the "Program Files" folder, allowing attackers to replace executables with Trojan horses.
- **CVE-2009-3897** [https://www.cve.org/CVERecord?id=CVE-2009-3897](https://www.cve.org/CVERecord?id=CVE-2009-3897): Product creates directories with 0777 permissions at installation, allowing users to gain privileges and access a socket used for authentication.
- **CVE-2009-3489** [https://www.cve.org/CVERecord?id=CVE-2009-3489](https://www.cve.org/CVERecord?id=CVE-2009-3489): Photo editor installs a service with an insecure security descriptor, allowing users to stop or start the service, or execute commands as SYSTEM.
- **CVE-2020-15708** [https://www.cve.org/CVERecord?id=CVE-2020-15708](https://www.cve.org/CVERecord?id=CVE-2020-15708): socket created with insecure permissions
- **CVE-2009-3289** [https://www.cve.org/CVERecord?id=CVE-2009-3289](https://www.cve.org/CVERecord?id=CVE-2009-3289): Library function copies a file to a new target and uses the source file's permissions for the target, which is incorrect when the source file is a symbolic link, which typically has 0777 permissions.
- **CVE-2009-0115** [https://www.cve.org/CVERecord?id=CVE-2009-0115](https://www.cve.org/CVERecord?id=CVE-2009-0115): Device driver uses world-writable permissions for a socket file, allowing attackers to inject arbitrary commands.
- **CVE-2009-1073** [https://www.cve.org/CVERecord?id=CVE-2009-1073](https://www.cve.org/CVERecord?id=CVE-2009-1073): LDAP server stores a cleartext password in a world-readable file.
- **CVE-2009-0141** [https://www.cve.org/CVERecord?id=CVE-2009-0141](https://www.cve.org/CVERecord?id=CVE-2009-0141): Terminal emulator creates TTY devices with world-writable permissions, allowing an attacker to write to the terminals of other users.
- **CVE-2008-0662** [https://www.cve.org/CVERecord?id=CVE-2008-0662](https://www.cve.org/CVERecord?id=CVE-2008-0662): VPN product stores user credentials in a registry key with "Everyone: Full Control" permissions, allowing attackers to steal the credentials.


# Relevant CWE Specifications

## CWE-732: Incorrect Permission Assignment for Critical Resource
**Abstraction:** Class
**Status:** Draft

### Description
The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors.

### Extended Description
When a resource is given a permission setting that provides access to a wider range of actors than required, it could lead to the exposure of sensitive information, or the modification of that resource by unintended parties. This is especially dangerous when the resource is related to program configuration, execution, or sensitive user data. For example, consider a misconfigured storage account for the cloud that can be read or written by a public or anonymous user.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-285
ChildOf -> CWE-668
ParentOf -> CWE-1004
ParentOf -> CWE-276
ParentOf -> CWE-277
ParentOf -> CWE-278
ParentOf -> CWE-279
ParentOf -> CWE-281
RequiredBy -> CWE-61
RequiredBy -> CWE-689
ParentOf -> CWE-766

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** While the name itself indicates an assignment of permissions for resources, this is often misused for vulnerabilities in which "permissions" are not checked, which is an "authorization" weakness (CWE-285 or descendants) within CWE's model [REF-1287].
**Comments:** Closely analyze the specific mistake that is allowing the resource to be exposed, and perform a CWE mapping for that mistake.
**Reasons:**
- Frequent Misuse


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Description:** When using a critical resource such as a configuration file, check to see if the resource has insecure permissions (such as being modifiable by any regular user) [REF-62], and generate an error or even exit the software if there is a possibility that the resource could have been modified by an unauthorized party.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Effectiveness:** Moderate
- **Description:** Divide the software into anonymous, normal, privileged, and administrative areas. Reduce the attack surface by carefully defining distinct user groups, privileges, and/or roles. Map these against data, functionality, and the related resources. Then set the permissions accordingly. This will allow you to maintain more fine-grained control over your resources. [REF-207]

**Mitigation 3:**
- **Phase:** Architecture and Design, Operation
- **Effectiveness:** Limited
- **Strategy:** Sandbox or Jail
- **Description:** 

Run the code in a "jail" or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict which files can be accessed in a particular directory or which commands can be executed by the software.


OS-level examples include the Unix chroot jail, AppArmor, and SELinux. In general, managed code may provide some protection. For example, java.io.FilePermission in the Java SecurityManager allows the software to specify restrictions on file operations.


This may not be a feasible solution, and it only limits the impact to the operating system; the rest of the application may still be subject to compromise.


Be careful to avoid CWE-243 and other weaknesses related to jails.




### Additional Notes
**[Maintenance]** The relationships between privileges, permissions, and actors (e.g. users and groups) need further refinement within the Research view. One complication is that these concepts apply to two different pillars, related to control of resources (CWE-664) and protection mechanism failures (CWE-693).



### Observed Examples
- **CVE-2022-29527:** Go application for cloud management creates a world-writable sudoers file that allows local attackers to inject sudo rules and escalate privileges to root by winning a race condition.
- **CVE-2009-3482:** Anti-virus product sets insecure "Everyone: Full Control" permissions for files under the "Program Files" folder, allowing attackers to replace executables with Trojan horses.
- **CVE-2009-3897:** Product creates directories with 0777 permissions at installation, allowing users to gain privileges and access a socket used for authentication.



## CWE-281: Improper Preservation of Permissions
**Abstraction:** Base
**Status:** Draft

### Description
The product does not preserve permissions or incorrectly preserves permissions when copying, restoring, or sharing objects, which can cause them to have less restrictive permissions than intended.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-732
ChildOf -> CWE-732

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use




### Observed Examples
- **CVE-2002-2323:** Incorrect ACLs used when restoring backups from directories that use symbolic links.
- **CVE-2001-1515:** Automatic modification of permissions inherited from another file system.
- **CVE-2005-1920:** Permissions on backup file are created with defaults, possibly less secure than original file.

