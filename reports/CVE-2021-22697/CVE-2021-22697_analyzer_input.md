# Vulnerability Information: CVE-2021-22697

## Vulnerability Description
A **CWE-434 Unrestricted Upload of File with Dangerous Type** vulnerability exists in the EcoStruxure Power Build - Rapsody software (V2.1.13 and prior) that could allow a **use-after-free condition** which could result in remote code execution when a malicious SSD file is uploaded and improperly parsed.

### Vulnerability Description Key Phrases
- **rootcause:** **CWE-434 Unrestricted Upload of File with Dangerous Type**
- **weakness:** **use-after-free condition**
- **impact:** remote code execution
- **vector:** malicious SSD file
- **product:** EcoStruxure Power Build - Rapsody
- **version:** V2.1.13 and prior

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2021-22697

**Root Cause of Vulnerability:**
- The vulnerability stems from a lack of proper validation of object existence before performing operations on it during the parsing of SSD files in Schneider Electric EcoStruxure Power Build software. Specifically, improper parsing of malicious SSD files can lead to a use-after-free condition.

**Weaknesses/Vulnerabilities Present:**
- Use-after-free vulnerability
- Unrestricted upload of file with dangerous type (CWE-434)
- Stack-based buffer overflow (mentioned in the CISA advisory as a potential outcome)

**Impact of Exploitation:**
- Remote code execution on affected installations.
- Attackers can execute arbitrary code within the context of the current process.
- A successful exploit could lead to a use-after-free condition or stack-based buffer overflow.

**Attack Vectors:**
-  A malicious SSD file is uploaded and improperly parsed.
- The target must open a malicious file or visit a malicious page.
- Requires user interaction

**Required Attacker Capabilities/Position:**
- A local attacker can upload a malicious SSD file.
- Low skill level is required to exploit this vulnerability.

**Additional Notes:**
- The vulnerability is present in EcoStruxure Power Build-Rapsody software versions 2.1.13 and prior.
- Schneider Electric has issued an update to correct the vulnerability.
- Mitigations include applying the principle of least privilege, using application whitelisting, and keeping antivirus software updated.
-  The vulnerability is not exploitable remotely, although the initial description mentions remote attackers, the CISA advisory clarifies that it requires local access.

The information provided is more detailed than the placeholder CVE description, offering specifics about the affected software, the nature of the vulnerability, and how to mitigate it.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 1.0867 | dense, sparse, graph | dense: 0.696, sparse: 0.666, graph: 1.000 |
| 2 | CWE-73 | External Control of File Name or Path | Base | Allowed | 0.7996 | dense, sparse, graph | dense: 0.635, sparse: 0.217, graph: 1.000 |
| 3 | CWE-184 | Incomplete List of Disallowed Inputs | Base | Allowed | 0.5776 | sparse, graph | sparse: 0.385, graph: 1.000 |
| 4 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.5157 | sparse, graph | sparse: 0.350, graph: 0.882 |
| 5 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.5028 | sparse, graph | sparse: 0.359, graph: 0.832 |
| 6 | CWE-183 | Permissive List of Allowed Inputs | Base | Allowed | 0.4768 | sparse, graph | sparse: 0.231, graph: 0.965 |
| 7 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.4074 | dense, sparse | dense: 0.613, sparse: 0.210 |
| 8 | CWE-178 | Improper Handling of Case Sensitivity | Base | Allowed | 0.1243 | sparse | sparse: 0.217 |
| 9 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.1227 | sparse | sparse: 0.215 |
| 10 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.1206 | sparse | sparse: 0.211 |

