# Vulnerability Information: CVE-2022-35104

## Vulnerability Description
SWFTools commit 772e55a2 was discovered to contain a **heap-buffer overflow** via DCTStreamreset() at /xpdf/Stream.cc.

### Vulnerability Description Key Phrases
- **weakness:** **heap-buffer overflow**
- **product:** SWFTools
- **version:** commit 772e55a2
- **component:** DCTStreamreset() at /xpdf/Stream.cc

## CVE Reference Links Content Summary
The provided content describes multiple vulnerabilities found in `swftools-pdf2swf` using fuzzing, including heap buffer overflows, stack buffer overflows, global buffer overflows, segmentation faults (SEGV), floating-point exceptions (FPE), and out-of-memory errors.

**Vulnerabilities:**

*   **Heap Buffer Overflows:**
    *   **`DCTStream::readHuffSym` (Stream.cc:2825):** A heap buffer overflow occurs while reading Huffman symbols in a DCT stream.
    *  **`GfxICCBasedColorSpace::getDefaultColor` (GfxState.cc:923):** A heap buffer overflow occurs when retrieving the default color of an ICC-based color space.
    *   **`draw_stroke` (stroke.c:212):** A heap buffer overflow occurs during the drawing of a stroke.
    *   **`DCTStream::reset` (Stream.cc:1994):** A heap buffer overflow occurs when resetting a DCT stream.
*   **Stack Buffer Overflow:**
    *   **`ImageStream::getPixel` (Stream.cc:348):** A stack buffer overflow occurs while accessing pixels in an image stream.
*   **Global Buffer Overflow:**
    *   **`DCTStream::transformDataUnit` (Stream.cc:2804):** A global buffer overflow occurs when transforming data units within a DCT stream.
*   **Segmentation Faults (SEGV):**
    *   **`FoFiTrueType::writeTTF` (FoFiTrueType.cc:910):** A segmentation fault occurs while writing TrueType font data.
    *   **`convert_gfxline` (convert.c:31):** A segmentation fault occurs during the conversion of a graphics line.
    *   **`gfxline_getbbox` (gfxtools.c:765):** A segmentation fault occurs while getting the bounding box of a graphics line.
    *  **`memset` (in `InfoOutputDev::type3D0`):** A segmentation fault due to an invalid memory access within a `memset` operation.
    *  **`InfoOutputDev::type3D1` (InfoOutputDev.cc:887):** A segmentation fault occurs when handling Type3 fonts with the cache device.
    *  **`FoFiTrueType::computeTableChecksum` (FoFiTrueType.cc:1776):** A segmentation fault during the computation of a table checksum in a TrueType font.
*   **Floating-Point Exception (FPE):**
    *   **`DCTStream::readMCURow` (Stream.cc:2123):** A floating-point exception occurs during the reading of a row in a DCT stream.
*   **Out-of-Memory:**
    *   **`malloc` (asan_malloc_linux.cpp:145):** An out-of-memory error occurs during a memory allocation.

**Root Cause:**

The root cause of these vulnerabilities lies in improper handling of input data, which leads to out-of-bounds memory access (read or write), division by zero, or excessive memory allocation. This includes issues with:

*   **Image Processing:**  Handling of DCT streams and image data, including Huffman decoding and pixel manipulation.
*   **Font Handling:**  Processing of TrueType fonts, potentially due to invalid font data structures.
*  **Graphics Operations:**  Drawing strokes and filling lines, specifically when converting and handling geometric data.
*  **Type 3 Fonts:** Specific issues in how the software handles fonts of this type.

**Impact of Exploitation:**

*   **Denial of Service (DoS):** Crashes can lead to program termination, rendering `pdf2swf` unusable for processing malicious or crafted PDF files.
*   **Arbitrary Code Execution:** Although not explicitly stated, heap and stack buffer overflows can potentially be exploited for arbitrary code execution in some circumstances.
*   **Memory Corruption:** Various buffer overflows lead to memory corruption, which may have unpredictable behavior.

**Attack Vectors:**

The attack vectors involve supplying crafted PDF files to `pdf2swf`. The tool processes these files, which then triggers the vulnerabilities.

**Required Attacker Capabilities/Position:**

*   **File Manipulation:** The attacker needs the ability to create or modify PDF files.
*   **Tool Access:** The attacker needs access to the `pdf2swf` tool to process the crafted PDF files.

The provided information is more detailed than a typical CVE description, as it includes specific crash locations with line numbers, affected functions, and example files.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6321 | dense, sparse, graph | dense: 0.482, sparse: 0.115, graph: 0.909 |
| 2 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.5862 | dense, sparse, graph | dense: 0.527, sparse: 0.133, graph: 0.689 |
| 3 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.5733 | dense, sparse, graph | dense: 0.519, sparse: 0.087, graph: 0.739 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5488 | dense, sparse, graph | dense: 0.521, sparse: 0.097, graph: 0.778 |
| 5 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.3381 | sparse, graph | sparse: 0.083, graph: 0.813 |
| 6 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3307 | dense, sparse | dense: 0.555, sparse: 0.141 |
| 7 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3291 | sparse, graph | sparse: 0.082, graph: 0.789 |
| 8 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.3247 | sparse, graph | sparse: 0.110, graph: 0.732 |
| 9 | CWE-195 | Signed to Unsigned Conversion Error | Variant | Allowed | 0.3149 | sparse, graph | sparse: 0.090, graph: 0.811 |
| 10 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3139 | dense, sparse | dense: 0.508, sparse: 0.104 |

