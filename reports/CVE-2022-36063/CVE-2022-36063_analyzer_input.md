# Vulnerability Information: CVE-2022-36063

## Vulnerability Description
Azure RTOS USBx is a USB host, device, and on-the-go (OTG) embedded stack, fully integrated with Azure RTOS ThreadX and available for all Azure RTOS ThreadXsupported processors. Azure RTOS USBX implementation of host support for USB CDC ECM includes an integer underflow and a buffer overflow in the `_ux_host_class_cdc_ecm_mac_address_get` function which may be potentially exploited to achieve remote code execution or denial of service. Setting mac address string descriptor length to a `0` or `1` allows an attacker to introduce an integer underflow followed (string_length) by a buffer overflow of the `cdc_ecm -> ux_host_class_cdc_ecm_node_id` array. This may allow one to redirect the code execution flow or introduce a denial of service. The fix has been included in USBX release [6.1.12](https//github.com/azure-rtos/usbx/releases/tag/v6.1.12_rel). Improved mac address string descriptor length validation to check for unexpectedly small values may be used as a workaround.

### Vulnerability Description Key Phrases
- **rootcause:** **integer underflow and buffer overflow**
- **impact:** remote code execution and denial of service
- **product:** Azure RTOS USBX
- **component:** _ux_host_class_cdc_ecm_mac_address_get function

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2022-36063:

**Root Cause:**

The vulnerability lies in the `_ux_host_class_cdc_ecm_mac_address_get` function within the Azure RTOS USBX library. It stems from insufficient validation of the MAC address string descriptor length received from a USB CDC ECM device. Specifically, the code doesn't properly check for unexpectedly small string lengths (0 or 1), which leads to an integer underflow.

**Weaknesses/Vulnerabilities:**

1.  **Integer Underflow:** When the MAC address string descriptor length is set to 0 or 1, a calculation involving this length results in an integer underflow.
2.  **Buffer Overflow:** The integer underflow is followed by a buffer overflow. The underflow affects the calculation of how much data to read into `cdc_ecm -> ux_host_class_cdc_ecm_node_id`, a fixed-size array.  The insufficient bounds check causes the copy operation to write past the end of this array.

**Impact of Exploitation:**

Successful exploitation of this vulnerability could lead to:

*   **Remote Code Execution (RCE):** By overflowing the buffer, an attacker might be able to overwrite critical parts of memory, redirect the code execution flow, and execute arbitrary code.
*   **Denial of Service (DoS):** A less sophisticated attack might simply crash the device by causing a memory access violation.

**Attack Vectors:**

*   **Malicious USB Device:** An attacker would need to control a malicious USB device acting as a CDC ECM device.
*   **Manipulated String Descriptor:** The malicious device would send a crafted USB descriptor that contains a MAC address string descriptor with a length of 0 or 1.

**Required Attacker Capabilities/Position:**

*   **Physical Access:** The attacker needs physical access to the vulnerable device to plug in the malicious USB device.
*   **USB Device Control:** The attacker must have the ability to create and control a USB device that can enumerate as a CDC ECM device and send crafted descriptors.

**Additional Details:**

*   The vulnerable function is located in `ux_host_class_cdc_ecm_mac_address_get.c`.
*   The fix involves improved validation of the MAC address string descriptor length to check for unexpectedly small values.
*   The vulnerability is present in USBX versions prior to 6.1.12.
*   The vulnerability is classified as moderate severity.

**Summary:**

CVE-2022-36063 details a vulnerability in Azure RTOS USBX where an attacker can cause a buffer overflow by providing a specially crafted USB descriptor with an invalid MAC address string descriptor length. This could potentially lead to remote code execution or denial of service.

The content provides much more detail than the placeholder CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 1.0939 | dense, sparse, graph | dense: 0.612, sparse: 1.000, graph: 0.603 |
| 2 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.9873 | dense, sparse, graph | dense: 0.492, sparse: 0.938, graph: 0.572 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.9376 | dense, sparse, graph | dense: 0.529, sparse: 0.719, graph: 0.732 |
| 4 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.7912 | dense, sparse, graph | dense: 0.478, sparse: 0.624, graph: 0.546 |
| 5 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.7871 | dense, sparse, graph | dense: 0.475, sparse: 0.611, graph: 0.558 |
| 6 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.6192 | sparse, graph | sparse: 0.662, graph: 0.672 |
| 7 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.6055 | dense, sparse | dense: 0.503, sparse: 0.618 |
| 8 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.6019 | dense, sparse | dense: 0.475, sparse: 0.637 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.5745 | dense, sparse | dense: 0.507, sparse: 0.644 |
| 10 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5599 | dense, sparse | dense: 0.496, sparse: 0.626 |

