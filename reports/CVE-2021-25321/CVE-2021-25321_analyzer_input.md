# Vulnerability Information: CVE-2021-25321

## Vulnerability Description
A **UNIX Symbolic Link (Symlink) Following** vulnerability in arpwatch of SUSE Linux Enterprise Server 11-SP4-LTSS, SUSE Manager Server 4.0, SUSE OpenStack Cloud Crowbar 9 openSUSE Factory, Leap 15.2 allows local attackers with control of the runtime user to run arpwatch as to escalate to root upon the next restart of arpwatch. This issue affects SUSE Linux Enterprise Server 11-SP4-LTSS arpwatch versions prior to 2.1a15. SUSE Manager Server 4.0 arpwatch versions prior to 2.1a15. SUSE OpenStack Cloud Crowbar 9 arpwatch versions prior to 2.1a15. openSUSE Factory arpwatch version 2.1a15-169.5 and prior versions. openSUSE Leap 15.2 arpwatch version 2.1a15-lp152.5.5 and prior versions.

### Vulnerability Description Key Phrases
- **rootcause:** **UNIX Symbolic Link (Symlink) Following**
- **impact:** escalate to root
- **attacker:** local attackers
- **product:** SUSE Linux Enterprise Server and SUSE Manager Server and SUSE OpenStack Cloud Crowbar and openSUSE Factory and openSUSE Leap
- **version:** 11-SP4-LTSS and 4.0 and 9 and 15.2
- **component:** arpwatch

## CVE Reference Links Content Summary
The content is related to CVE-2021-25321.

Root cause of vulnerability:
- The arpwatch daemon, when run with an unprivileged user, changes the ownership of the /var/lib/arpwatch directory and its files to the unprivileged user.
- The `dropprivileges` function in `arpwatch` uses `chown` to change the ownership of the arpwatch directory and files to the specified user.

Weaknesses/vulnerabilities present:
- Insecure file handling during privilege dropping.
- The program changes the ownership of the directory and files to the specified user, even if a symbolic link is created in place of the expected file (arp.dat in this case).
- This allows an attacker to change the ownership of any file on the filesystem if they can place a symbolic link to it within the directory before arpwatch is started using a non-root user.

Impact of exploitation:
- Local privilege escalation (LPE) from a runtime user to root.
- An attacker can gain ownership of arbitrary files on the filesystem, including sensitive files like `/etc/shadow`, by creating a symbolic link to it and running arpwatch with a specified unprivileged user.
- The attacker can then modify or read the contents of the file they gain ownership over.

Attack vectors:
- Local attacker.
- The attacker needs to have the ability to start the `arpwatch` service with a specified unprivileged user (via the `-u` command line argument).
- The attacker needs to be able to place a symbolic link in the /var/lib/arpwatch directory before the service is started.

Required attacker capabilities/position:
- Ability to execute commands as a local user.
- Knowledge of how to create symbolic links.
- Ability to run the arpwatch service using a user of choice.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.7627 | dense, sparse, graph | dense: 0.554, sparse: 0.467, graph: 0.611 |
| 2 | CWE-303 | Incorrect Implementation of Authentication Algorithm | Base | Allowed | 0.7029 | dense, sparse, graph | dense: 0.504, sparse: 0.456, graph: 0.531 |
| 3 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.7003 | dense, sparse, graph | dense: 0.526, sparse: 0.411, graph: 0.565 |
| 4 | CWE-61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | 0.6946 | dense, sparse | dense: 0.661, sparse: 1.000 |
| 5 | CWE-250 | Execution with Unnecessary Privileges | Base | Allowed | 0.6688 | dense, sparse, graph | dense: 0.541, sparse: 0.362, graph: 0.533 |
| 6 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.5830 | sparse, graph | sparse: 0.468, graph: 0.882 |
| 7 | CWE-378 | Creation of Temporary File With Insecure Permissions | Base | Allowed | 0.5589 | sparse, graph | sparse: 0.457, graph: 0.832 |
| 8 | CWE-267 | Privilege Defined With Unsafe Actions | Base | Allowed | 0.4827 | dense, sparse | dense: 0.505, sparse: 0.402 |
| 9 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.4704 | dense, sparse | dense: 0.512, sparse: 0.374 |
| 10 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4350 | sparse, graph | sparse: 0.366, graph: 0.631 |

