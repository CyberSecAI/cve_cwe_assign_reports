# Vulnerability Information: CVE-2020-36314

## Vulnerability Description
fr-archive-libarchive.c in GNOME file-roller through 3.38.0, as used by GNOME Shell and other software, allows Directory Traversal during extraction because it lacks a check of whether a files parent is a symlink in certain complex situations. NOTE this issue exists because of an incomplete fix for CVE-2020-11736.

### Vulnerability Description Key Phrases
- **weakness:** **improper symlink checking**
- **impact:** directory traversal
- **product:** GNOME file-roller
- **version:** through 3.38.0
- **component:** fr-archive-libarchive.c

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2020-36314:

**Root Cause of Vulnerability:**

The vulnerability stems from insufficient checks within the GNOME Archive Manager (file-roller) when extracting archive files, specifically when dealing with symlinks within the parent directories of extracted files. The vulnerability is present in the `libarchive` library used by file-roller, where symlinks in the parent directories of files being extracted were not properly handled.

**Weaknesses/Vulnerabilities Present:**

- **Directory Traversal:** The core weakness is a directory traversal vulnerability. By crafting a malicious archive containing symlinks in the parent directories, an attacker can force the Archive Manager to write files to locations outside of the intended extraction directory.
- **Insufficient Symlink Handling:** The application's logic failed to correctly identify and prevent the traversal through symlinks present in the parent directories of the extracted files. This allowed for bypassing previous checks that aimed to prevent files from being extracted outside the destination directory.

**Impact of Exploitation:**

- **Arbitrary File Overwrite:** An attacker could use this vulnerability to overwrite arbitrary files on the user's system. This could lead to:
    - **System Compromise:** Overwriting critical system files, potentially leading to denial of service or complete system compromise.
    - **Data Tampering:** Overwriting user data files, causing data loss or corruption.
    - **Malware Installation:** Overwriting executable files with malicious code, leading to malware infection.

**Attack Vectors:**

- **Malicious Archive:** The primary attack vector involves a crafted archive file (e.g., a .tar file). This archive would contain specially crafted directory structures with symlinks designed to cause the Archive Manager to write files to unintended locations.
- **User Interaction:** The user needs to open the malicious archive using the vulnerable version of GNOME Archive Manager to trigger the exploit.

**Required Attacker Capabilities/Position:**

- **Archive Creation:** An attacker needs the ability to create a malicious archive file with the specific structure to exploit the directory traversal vulnerability.
- **Distribution:** The attacker must find a way to distribute the malicious archive and convince a user to open it using the vulnerable Archive Manager. This could be achieved via phishing emails, malicious websites, or other methods of social engineering.

**Additional Details:**

- The provided content includes a proof-of-concept archive (`dirsymlink2a.tar`) and a video demonstrating the exploit.
- A patch was implemented by disallowing symlinks in parent directories, effectively preventing the directory traversal attack.
- Fedora's security update indicates that the vulnerability was assigned CVE-2020-36314.
- The vulnerability was addressed in `file-roller-3.38.0-3.fc34` for Fedora 34.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.7885 | dense, sparse, graph | dense: 0.514, sparse: 0.359, graph: 0.912 |
| 2 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.7196 | dense, sparse, graph | dense: 0.535, sparse: 0.219, graph: 0.914 |
| 3 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.5610 | dense, sparse, graph | dense: 0.514, sparse: 0.199, graph: 0.533 |
| 4 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.4713 | sparse, graph | sparse: 0.205, graph: 0.991 |
| 5 | CWE-61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | 0.4558 | dense, sparse, graph | dense: 0.542, sparse: 0.238, graph: 0.518 |
| 6 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.3544 | dense, sparse | dense: 0.486, sparse: 0.195 |
| 7 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.3371 | sparse, graph | sparse: 0.195, graph: 0.631 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3193 | dense, sparse | dense: 0.479, sparse: 0.186 |
| 9 | CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | 0.1851 | sparse, graph | sparse: 0.193, graph: 0.572 |
| 10 | CWE-204 | Observable Response Discrepancy | Base | Allowed | 0.1130 | sparse | sparse: 0.198 |

