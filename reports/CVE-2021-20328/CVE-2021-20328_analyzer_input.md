# Vulnerability Information: CVE-2021-20328

## Vulnerability Description
Specific versions of the Java driver that support client-side field level encryption (CSFLE) **fail to perform correct host name verification** on the KMS servers certificate. This vulnerability in combination with a privileged network position active MITM attack could result in interception of traffic between the Java driver and the KMS service rendering Field Level Encryption ineffective. This issue was discovered during internal testing and affects all versions of the Java driver that support CSFLE. The Java async, Scala, and reactive streams drivers are not impacted. This vulnerability does not impact driver traffic payloads with CSFLE-supported key services originating from applications residing inside the AWS, GCP, and Azure network fabrics due to compensating controls in these environments. This issue does not impact driver workloads that dont use Field Level Encryption.

### Vulnerability Description Key Phrases
- **rootcause:** **fail to perform correct host name verification**
- **impact:** interception of traffic between the Java driver and the KMS service
- **vector:** active MITM attack
- **product:** Java driver
- **version:** Specific versions

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The MongoDB Java driver, in versions supporting client-side field level encryption (CSFLE), fails to perform proper hostname verification of the KMS server's certificate.
- **Weaknesses/vulnerabilities present:** Improper hostname verification during TLS/SSL handshake with the KMS server.
- **Impact of exploitation:** An attacker with a privileged network position and active MITM capabilities could intercept traffic between the Java driver and the KMS service, effectively rendering field level encryption ineffective, potentially exposing sensitive data.
- **Attack vectors:** A Man-in-the-Middle (MITM) attack on the network connection between the Java driver and the KMS server.
- **Required attacker capabilities/position:** The attacker needs a privileged network position to perform the MITM attack. They also need to be able to actively intercept and modify network traffic.

The vulnerability specifically affects versions of the Java driver that support CSFLE and is not present in Java async, Scala, or reactive streams drivers. It also does not impact driver traffic with CSFLE-supported key services when originating from applications residing inside the AWS, GCP, and Azure network fabrics due to compensating controls in those environments. Workloads that do not use Field Level Encryption are also not affected. The vulnerability was discovered internally. The document provides specific details of the affected versions and the fixed versions for multiple libraries and includes the CVSS score and vector.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-297 | Improper Validation of Certificate with Host Mismatch | Variant | Allowed | 0.9993 | dense, sparse, graph | dense: 0.623, sparse: 1.000, graph: 0.555 |
| 2 | CWE-295 | Improper Certificate Validation | Base | Allowed | 0.9713 | dense, sparse, graph | dense: 0.554, sparse: 0.830, graph: 0.613 |
| 3 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.7709 | dense, sparse, graph | dense: 0.561, sparse: 0.492, graph: 0.584 |
| 4 | CWE-319 | Cleartext Transmission of Sensitive Information | Base | Allowed | 0.5523 | dense, sparse | dense: 0.554, sparse: 0.480 |
| 5 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.4990 | dense, sparse | dense: 0.547, sparse: 0.467 |
| 6 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.3420 | dense, sparse | dense: 0.589, sparse: 0.502 |
| 7 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.2736 | sparse | sparse: 0.478 |
| 8 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.2720 | sparse | sparse: 0.476 |
| 9 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.2704 | sparse | sparse: 0.473 |
| 10 | CWE-203 | Observable Discrepancy | Base | Allowed | 0.2673 | sparse | sparse: 0.467 |

