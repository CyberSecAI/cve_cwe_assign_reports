# Vulnerability Information: CVE-2021-26252

## Vulnerability Description
A flaw was found in htmldoc in v1.9.12. **Heap buffer overflow** in pspdf_prepare_page(),in ps-pdf.cxx may lead to execute arbitrary code and denial of service.

### Vulnerability Description Key Phrases
- **rootcause:** **Heap buffer overflow**
- **impact:** execute arbitrary code and denial of service
- **product:** htmldoc
- **version:** v1.9.12
- **component:** pspdf_prepare_page() in ps-pdf.cxx

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 15)
- CWE-476 (Count: 2)
- CWE-415 (Count: 1)

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability associated with CVE-2021-26252:

**Root Cause:**
- A heap-buffer-overflow vulnerability exists in the `pspdf_prepare_page()` function within the `ps-pdf.cxx` file of the htmldoc software. This occurs due to improper handling of page numbers when preparing PDF output.

**Weaknesses/Vulnerabilities:**
- **Heap-buffer-overflow:** The primary vulnerability is a heap-based buffer overflow, which allows an attacker to write data beyond the allocated memory region. This can lead to crashes or arbitrary code execution.

**Impact of Exploitation:**
- **Denial of Service (DoS):** The most immediate impact is a crash of the application due to the memory corruption, leading to a denial of service.
- **Arbitrary Code Execution:** A successful exploit could potentially allow an attacker to execute arbitrary code on the system running htmldoc, gaining unauthorized control.

**Attack Vectors:**
- **Input File:** The vulnerability is triggered by providing a crafted HTML file to htmldoc for conversion to PDF. The specific conditions within the HTML that cause the page number handling error are not described.
- **Command Line:** The vulnerable code is accessed when running `htmldoc` with the `-f` option specifying a PDF output file.

**Required Attacker Capabilities/Position:**
- **Local Access:** The attacker needs to be able to execute the `htmldoc` command with a specially crafted HTML file. This generally implies local access to the system or the ability to provide input to the service.
- **Understanding of the Vulnerability:** The attacker would need knowledge of the specific conditions to trigger the heap-buffer-overflow within the `pspdf_prepare_page()` function using the html input file.

**Additional details:**
- The vulnerability was found through fuzzing.
- The issue was fixed by changes related to issue #414 and was resolved in htmldoc version 1.9.15.
- A fix was implemented by modifying `ps-pdf.cxx` to validate the page number before using it as index, which was committed with commit ID `369b2ea1fd0d0537ba707f20a2f047b6afd2fbdc`.
- The vulnerability is present in htmldoc version 1.9.12.

This detailed breakdown provides a better understanding of the vulnerability beyond the basic CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.7063 | dense, sparse, graph | dense: 0.546, sparse: 0.183, graph: 0.919 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6570 | dense, sparse, graph | dense: 0.553, sparse: 0.200, graph: 0.743 |
| 3 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.6422 | dense, sparse, graph | dense: 0.550, sparse: 0.178, graph: 0.742 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5863 | dense, sparse, graph | dense: 0.556, sparse: 0.178, graph: 0.713 |
| 5 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3939 | dense, sparse | dense: 0.598, sparse: 0.223 |
| 6 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3695 | dense, sparse | dense: 0.584, sparse: 0.189 |
| 7 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.3678 | dense, sparse | dense: 0.542, sparse: 0.169 |
| 8 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.3613 | dense, sparse | dense: 0.524, sparse: 0.174 |
| 9 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.3567 | dense, sparse | dense: 0.530, sparse: 0.160 |
| 10 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.3546 | dense, sparse | dense: 0.519, sparse: 0.166 |

