# Vulnerability Information: CVE-2022-32040

## Vulnerability Description
Tenda M3 V1.0.0.12 was discovered to contain a **stack overflow** via the function formSetCfm.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **product:** Tenda M3
- **version:** V1.0.0.12
- **component:** function formSetCfm

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 392)
- CWE-120 (Count: 63)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause of Vulnerability:**
The root cause is a stack buffer overflow in the `formSetCfm` function of the `httpd` binary. The vulnerability occurs due to the use of `sprintf` to copy the `funcpara1` parameter to a stack buffer without proper length validation.

**Weaknesses/Vulnerabilities Present:**
- **Stack Buffer Overflow:** The primary weakness is the unbounded copy of user-supplied data (`funcpara1`) into a fixed-size stack buffer using `sprintf`.
- **Lack of Input Validation:** The code doesn't validate the length of `funcpara1` before copying it into the buffer.
- **Vulnerable Function:** The `sub_45E28` function is specifically vulnerable when the length of the `funcpara2` parameter is greater than 4, which then triggers the vulnerable code path with `sprintf`.

**Impact of Exploitation:**
- **Denial of Service (DoS):** The provided Proof-of-Concept (PoC) demonstrates a DoS attack by crashing the service due to the stack overflow.
- **Potential Remote Code Execution (RCE):** While the provided PoC only shows DoS, a stack overflow vulnerability can potentially be exploited for Remote Code Execution (RCE) if an attacker carefully crafts the overflow to overwrite return addresses on the stack.

**Attack Vectors:**
- **HTTP POST Request:** The vulnerability is triggered by sending an HTTP POST request to the `/goform/setcfm` URL.
- **Specific POST Parameters:** The request must include `funcname` set to `save_list_data`, and `funcpara2` having a length greater than 4. The `funcpara1` parameter is the payload to overflow the buffer.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker needs network access to the device running the vulnerable firmware.
- **Ability to Send HTTP Requests:** The attacker must be able to send HTTP POST requests to the device.
- **Knowledge of the vulnerable endpoint and parameters:** The attacker needs to know the URL path (`/goform/setcfm`) and the POST parameter structure (`funcname`, `funcpara1`, `funcpara2`).

**Additional Notes:**
- The content provides more detail than a typical CVE description, including a code snippet showing the vulnerable logic, the vulnerable function `sub_45E28`, and a specific PoC script.
- The content also provides the affected firmware version.
- The exploit is triggered when `funcpara2`'s length > 4.
- The `sprintf` function is used without any length limit.
- The affected device is Tenda M3.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.4074 | sparse, graph | sparse: 0.087, graph: 1.000 |
| 2 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3415 | dense, sparse | dense: 0.583, sparse: 0.137 |
| 3 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3071 | sparse, graph | sparse: 0.089, graph: 0.757 |
| 4 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.2917 | dense, sparse | dense: 0.500, sparse: 0.073 |
| 5 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.2916 | dense, sparse | dense: 0.497, sparse: 0.075 |
| 6 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.2757 | dense, sparse | dense: 0.497, sparse: 0.088 |
| 7 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.2716 | dense, sparse | dense: 0.506, sparse: 0.071 |
| 8 | CWE-193 | Off-by-one Error | Base | Allowed | 0.2708 | sparse, graph | sparse: 0.079, graph: 0.631 |
| 9 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.1783 | dense, sparse | dense: 0.491, sparse: 0.101 |
| 10 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.0484 | sparse | sparse: 0.085 |

