# Critic Input for CVE-2021-25314



# Original Analyzer Input
## Vulnerability Description
A Creation of Temporary File With Insecure Permissions vulnerability in hawk2 of SUSE Linux Enterprise High Availability 12-SP3, SUSE Linux Enterprise High Availability 12-SP5, SUSE Linux Enterprise High Availability 15-SP2 allows local attackers to escalate to root. This issue affects SUSE Linux Enterprise High Availability 12-SP3 hawk2 versions prior to 2.6.3+git.1614685906.812c31e9. SUSE Linux Enterprise High Availability 12-SP5 hawk2 versions prior to 2.6.3+git.1614685906.812c31e9. SUSE Linux Enterprise High Availability 15-SP2 hawk2 versions prior to 2.6.3+git.1614684118.af555ad9.

### Vulnerability Description Key Phrases
- **rootcause:** **creation of temporary file with insecure permissions**
- **impact:** escalate to root
- **attacker:** local attackers
- **product:** SUSE Linux Enterprise High Availability
- **version:** 12-SP3 hawk2 prior to 2.6.3+git.1614685906.812c31e9 and 12-SP5 hawk2 prior to 2.6.3+git.1614685906.812c31e9 and 15-SP2 hawk2 prior to 2.6.3+git.1614684118.af555ad9
- **component:** hawk2

## CVE Reference Links Content Summary
- **Root cause of vulnerability**: Insecure file permissions set on temporary files created by the `hawk2` application. Specifically, files were created with `0666` permissions, allowing any local user to read and write them.
- **Weaknesses/vulnerabilities present**:
    - Insecure file permissions (0666) on temporary files.
    - Ability for local users to modify the Cluster Information Base (CIB) through `hawk/app/lib/invoker.rb`.
    - Potential root exploit through `hawk/app/lib/crm_script.rb`.
- **Impact of exploitation**:
    - **Denial of Service (DoS)** through modification of graph generation files (`hawk/app/models/report.rb`).
    - **Arbitrary CIB manipulation** by local users, potentially leading to cluster disruption and unauthorized actions.
    - **Root privilege escalation** through misuse of the crm utility (`hawk/app/lib/crm_script.rb`).
- **Attack vectors**:
    - Exploitation of insecure file permissions by local users.
- **Required attacker capabilities/position**:
    - Local access to the system.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-378 | Creation of Temporary File With Insecure Permissions | Base | Allowed | 1.0900 | dense, sparse, graph | dense: 0.594, sparse: 1.000, graph: 0.617 |
| 2 | CWE-379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | 0.7095 | dense, sparse, graph | dense: 0.573, sparse: 0.356, graph: 0.613 |
| 3 | CWE-267 | Privilege Defined With Unsafe Actions | Base | Allowed | 0.6826 | dense, sparse, graph | dense: 0.503, sparse: 0.420, graph: 0.534 |
| 4 | CWE-61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | 0.5962 | dense, sparse, graph | dense: 0.507, sparse: 0.512, graph: 0.639 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4733 | dense, sparse | dense: 0.505, sparse: 0.386 |
| 6 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.4226 | dense, sparse | dense: 0.484, sparse: 0.315 |
| 7 | CWE-303 | Incorrect Implementation of Authentication Algorithm | Base | Allowed | 0.4166 | sparse, graph | sparse: 0.398, graph: 0.528 |
| 8 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.4163 | dense, sparse, graph | dense: 0.512, sparse: 0.409, graph: 0.611 |
| 9 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.2272 | sparse | sparse: 0.397 |
| 10 | CWE-285 | Improper Authorization | Class | Discouraged | 0.2023 | dense, sparse | dense: 0.494, sparse: 0.358 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-378 | Creation of Temporary File With Insecure Permissions | 1.0 | Base | Allowed | Primary CWE |
| CWE-276 | Installation of Files with Insecure Permissions | 0.6 | Base | Allowed | Secondary Candidate |
| CWE-732 | Incorrect Permission Assignment for Critical Resource | 0.5 | Class | Allowed-with-Review | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.85
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability description states a "**creation of temporary file with insecure permissions**" vulnerability in hawk2, which directly corresponds to CWE-378 (Creation of Temporary File With Insecure Permissions). The CVE reference summary confirms that temporary files are created with insecure permissions (0666), allowing local users to read and write them. This aligns perfectly with the description of CWE-378. The impact of this vulnerability, local attackers escalating to root, is a consequence of the insecure permissions. CWE-378 is a Base level CWE, which is the preferred level of abstraction. The MITRE mapping guidance for CWE-378 indicates this is ALLOWED.
  
  - *Relationship Analysis:* While there are no direct relationships for CWE-378 in the provided information, the broader context of file permission vulnerabilities suggests a potential relationship with CWE-732 (Incorrect Permission Assignment for Critical Resource), which is a Class-level weakness. However, given the specific focus on temporary files, CWE-378 is more appropriate. The relationship with CWE-276 Installation of Files with Insecure Permissions is also relevant.

- **Confidence Score:**  
  - Confidence: 1.0 (High confidence due to direct match with vulnerability description and supporting evidence from the CVE reference summary)

---
- **Analysis and Justification:**  
  - *Explanation:* The creation of temporary files with insecure permissions during installation could be related to CWE-276 (Installation of Files with Insecure Permissions). The vulnerability arises because the installed file permissions allow anyone to modify those files, which is directly relevant to the **rootcause**. However, the primary issue is the creation of temporary files with weak permissions, not the permissions of installed files. Therefore, CWE-276 is a secondary candidate.

  - *Relationship Analysis:* CWE-276 is related to CWE-732 (Incorrect Permission Assignment for Critical Resource) as they both deal with permissions. However, CWE-276 is more specific to installation, while CWE-732 is a more general class.

- **Confidence Score:**  
  - Confidence: 0.6 (Medium confidence as this is related but not the primary weakness)

---
- **Analysis and Justification:**
    - *Explanation:* CWE-732 (Incorrect Permission Assignment for Critical Resource) is a potential candidate because the vulnerability involves insecure file permissions. However, the specific issue is the creation of *temporary* files with insecure permissions, which is more precisely described by CWE-378. CWE-732 is a more general class, and its usage is "Allowed-with-Review" due to frequent misuse. Since we have a more specific Base CWE (CWE-378), we should prefer it.

    - *Relationship Analysis:* CWE-732 is a parent of CWE-276 (Installation of Files with Insecure Permissions) and has relationships with other permission-related CWEs. However, these relationships do not make it a better fit than CWE-378.

- **Confidence Score:**
    - *Example:* Confidence: 0.5 (Low confidence as the description matches only generally, and a more specific CWE is available)

# CWE Examples from Database


## Known Examples for CWE-276: Incorrect Default Permissions
### Observed Examples
- **CVE-2005-1941** [https://www.cve.org/CVERecord?id=CVE-2005-1941](https://www.cve.org/CVERecord?id=CVE-2005-1941): Executables installed world-writable.
- **CVE-2002-1713** [https://www.cve.org/CVERecord?id=CVE-2002-1713](https://www.cve.org/CVERecord?id=CVE-2002-1713): Home directories installed world-readable.
- **CVE-2001-1550** [https://www.cve.org/CVERecord?id=CVE-2001-1550](https://www.cve.org/CVERecord?id=CVE-2001-1550): World-writable log files allow information loss; world-readable file has cleartext passwords.
- **CVE-2002-1711** [https://www.cve.org/CVERecord?id=CVE-2002-1711](https://www.cve.org/CVERecord?id=CVE-2002-1711): World-readable directory.
- **CVE-2002-1844** [https://www.cve.org/CVERecord?id=CVE-2002-1844](https://www.cve.org/CVERecord?id=CVE-2002-1844): Windows product uses insecure permissions when installing on Solaris (genesis: port error).
- **CVE-2001-0497** [https://www.cve.org/CVERecord?id=CVE-2001-0497](https://www.cve.org/CVERecord?id=CVE-2001-0497): Insecure permissions for a shared secret key file. Overlaps cryptographic problem.
- **CVE-1999-0426** [https://www.cve.org/CVERecord?id=CVE-1999-0426](https://www.cve.org/CVERecord?id=CVE-1999-0426): Default permissions of a device allow IP spoofing.
### Top 25 Examples
- **CVE-2021-43037**: An issue was discovered in Kaseya Unitrends Backup Appliance before 10.5.5. The Unitrends Windows agent was vulnerable to DLL injection and binary planting due to insecure default permissions. This allowed privilege escalation from an unprivileged user to SYSTEM.
- **CVE-2020-9451**: An issue was discovered in Acronis True Image 2020 24.5.22510. anti_ransomware_service.exe keeps a log in a folder where unprivileged users have write permissions. The logs are generated in a predictable pattern, allowing an unprivileged user to create a hardlink from a (not yet created) log file to anti_ransomware_service.exe. On reboot, this forces the anti_ransomware_service to try to write its log into its own process, crashing in a SHARING VIOLATION. This crash occurs on every reboot.
- **CVE-2021-31540**: Wowza Streaming Engine through 4.8.5 (in a default installation) has incorrect file permissions of configuration files in the conf/ directory. A regular local user is able to read and write to all the configuration files, e.g., modify the application server configuration.


# Relevant CWE Specifications

## CWE-276: Incorrect Default Permissions
**Abstraction:** Base
**Status:** Draft

### Description
During installation, installed file permissions are set to allow anyone to modify those files.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-732
ChildOf -> CWE-732

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** The architecture needs to access and modification attributes for files to only those users who actually require those actions.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Separation of Privilege
- **Description:** 

Compartmentalize the system to have "safe" areas where trust boundaries can be unambiguously drawn. Do not allow sensitive data to go outside of the trust boundary and always be careful when interfacing with a compartment outside of the safe area.


Ensure that appropriate compartmentalization is built into the system design, and the compartmentalization allows for and reinforces privilege separation functionality. Architects and designers should rely on the principle of least privilege to decide the appropriate time to use privileges and the time to drop privileges.





### Observed Examples
- **CVE-2005-1941:** Executables installed world-writable.
- **CVE-2002-1713:** Home directories installed world-readable.
- **CVE-2001-1550:** World-writable log files allow information loss; world-readable file has cleartext passwords.



## CWE-378: Creation of Temporary File With Insecure Permissions
**Abstraction:** Base
**Status:** Draft

### Description
Opening temporary files without appropriate measures or controls can leave the file, its contents and any function that it impacts vulnerable to attack.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-377

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Requirements
- **Description:** Many contemporary languages have functions which properly handle this condition. Older C temp file functions are especially susceptible.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** Ensure that you use proper file permissions. This can be achieved by using a safe temp file function. Temporary files should be writable and readable only by the process that owns the file.

**Mitigation 3:**
- **Phase:** Implementation
- **Description:** Randomize temporary file names. This can also be achieved by using a safe temp-file function. This will ensure that temporary files will not be created in predictable places.




### Observed Examples
- **CVE-2022-24823:** A network application framework uses the Java function createTempFile(), which will create a file that is readable by other local users of the system



## CWE-732: Incorrect Permission Assignment for Critical Resource
**Abstraction:** Class
**Status:** Draft

### Description
The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors.

### Extended Description
When a resource is given a permission setting that provides access to a wider range of actors than required, it could lead to the exposure of sensitive information, or the modification of that resource by unintended parties. This is especially dangerous when the resource is related to program configuration, execution, or sensitive user data. For example, consider a misconfigured storage account for the cloud that can be read or written by a public or anonymous user.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-285
ChildOf -> CWE-668
ParentOf -> CWE-1004
ParentOf -> CWE-276
ParentOf -> CWE-277
ParentOf -> CWE-278
ParentOf -> CWE-279
ParentOf -> CWE-281
RequiredBy -> CWE-61
RequiredBy -> CWE-689
ParentOf -> CWE-766

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** While the name itself indicates an assignment of permissions for resources, this is often misused for vulnerabilities in which "permissions" are not checked, which is an "authorization" weakness (CWE-285 or descendants) within CWE's model [REF-1287].
**Comments:** Closely analyze the specific mistake that is allowing the resource to be exposed, and perform a CWE mapping for that mistake.
**Reasons:**
- Frequent Misuse


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Description:** When using a critical resource such as a configuration file, check to see if the resource has insecure permissions (such as being modifiable by any regular user) [REF-62], and generate an error or even exit the software if there is a possibility that the resource could have been modified by an unauthorized party.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Effectiveness:** Moderate
- **Description:** Divide the software into anonymous, normal, privileged, and administrative areas. Reduce the attack surface by carefully defining distinct user groups, privileges, and/or roles. Map these against data, functionality, and the related resources. Then set the permissions accordingly. This will allow you to maintain more fine-grained control over your resources. [REF-207]

**Mitigation 3:**
- **Phase:** Architecture and Design, Operation
- **Effectiveness:** Limited
- **Strategy:** Sandbox or Jail
- **Description:** 

Run the code in a "jail" or similar sandbox environment that enforces strict boundaries between the process and the operating system. This may effectively restrict which files can be accessed in a particular directory or which commands can be executed by the software.


OS-level examples include the Unix chroot jail, AppArmor, and SELinux. In general, managed code may provide some protection. For example, java.io.FilePermission in the Java SecurityManager allows the software to specify restrictions on file operations.


This may not be a feasible solution, and it only limits the impact to the operating system; the rest of the application may still be subject to compromise.


Be careful to avoid CWE-243 and other weaknesses related to jails.




### Additional Notes
**[Maintenance]** The relationships between privileges, permissions, and actors (e.g. users and groups) need further refinement within the Research view. One complication is that these concepts apply to two different pillars, related to control of resources (CWE-664) and protection mechanism failures (CWE-693).



### Observed Examples
- **CVE-2022-29527:** Go application for cloud management creates a world-writable sudoers file that allows local attackers to inject sudo rules and escalate privileges to root by winning a race condition.
- **CVE-2009-3482:** Anti-virus product sets insecure "Everyone: Full Control" permissions for files under the "Program Files" folder, allowing attackers to replace executables with Trojan horses.
- **CVE-2009-3897:** Product creates directories with 0777 permissions at installation, allowing users to gain privileges and access a socket used for authentication.

