# Vulnerability Information: CVE-2022-0565

## Vulnerability Description
Cross-site Scripting in Packagist pimcore/pimcore prior to 10.3.1.

### Vulnerability Description Key Phrases
- **weakness:** **Cross-site scripting**
- **product:** pimcore/pimcore
- **version:** prior to 10.3.1

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis related to CVE-2022-0565:

**1. Verification of CVE Relevance:**

The provided content, specifically the commit message "Svg sanitization (#11386)" and the changes made in `AssetSanitizationListener.php`, `SettingsController.php`, and `composer.json`  strongly suggest that this commit is a fix for a vulnerability related to unsanitized SVG uploads, which could potentially lead to Cross-Site Scripting (XSS) or other security issues.  This commit directly addresses SVG sanitization in Pimcore, which was later assigned the CVE.

**2. Root Cause of Vulnerability:**

The root cause of the vulnerability is the lack of proper sanitization of SVG files uploaded through Pimcore. Without sanitization, malicious SVG files containing embedded JavaScript or other executable content could be uploaded and potentially executed in a user's browser.

**3. Weaknesses/Vulnerabilities Present:**

*   **Insecure SVG Uploads:** The system was not properly sanitizing SVG files, allowing potentially malicious code to be injected through them.
*   **Potential XSS:** By injecting malicious code into SVG files, attackers could potentially execute JavaScript within the context of the application user's browser, leading to XSS attacks.
* **Initial File Extension Check:** The code initially relied on file extension checks, which can be easily bypassed, rather than mime type checks, for image uploads.

**4. Impact of Exploitation:**

*   **Cross-Site Scripting (XSS):** Attackers could execute malicious JavaScript code in the context of other users' browsers, enabling them to potentially steal session cookies, redirect users to malicious sites, deface the website, or perform other malicious actions.
*   **Privilege Escalation:** If an attacker could gain control of an administrator account through XSS, they could potentially escalate their privileges within the application.

**5. Attack Vectors:**

*   **Upload of Malicious SVG Files:** Attackers could upload a specially crafted SVG file containing malicious JavaScript to the application through an upload functionality.
*   **Logo Upload:** The `SettingsController.php` code indicates the custom logo upload function was vulnerable. 
*   **Asset Upload:** The `AssetSanitizationListener.php` indicates that any image asset upload was potentially vulnerable, and in need of sanitization.

**6. Required Attacker Capabilities/Position:**

*   **Access to Upload Functionality:** Attackers would need the ability to upload files through Pimcore's interface, either through a public-facing upload function or a compromised user account.
*   **Knowledge of SVG Structure:** Attackers would need to be familiar with SVG syntax to embed malicious code within SVG files.

**Detailed Explanation of Changes:**

*   **`SettingsController.php`:**
    *   The commit adds a check for the mime type and uses the `symfony/mime` component to determine the content type.
    *   Implements sanitization of SVG content using the `enshrined/svg-sanitize` library on logo uploads. It throws an exception if sanitization fails.
    *   The code now sanitizes the SVG before writing it to storage, using `enshrined\svgSanitize\Sanitizer`.
*   **`AssetSanitizationListener.php`:**
    *   This listener implements sanitization for image asset uploads on `PRE_ADD` and `PRE_UPDATE` events.
    *   It uses `symfony/mime` component to determine the mime type, and if it's SVG, it sanitizes the content.
*   **`composer.json`:**
    *   The dependency on `enshrined/svg-sanitize` is added.
*   **`event_listeners.yaml`:**
    *  The `AssetSanitizationListener` is registered as an event listener.

These changes ensure that SVG files are sanitized before being stored, mitigating the risk of XSS and other related vulnerabilities.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.6577 | dense, sparse, graph | dense: 0.577, sparse: 0.102, graph: 0.870 |
| 2 | CWE-83 | Improper Neutralization of Script in Attributes in a Web Page | Variant | Allowed | 0.4969 | dense, sparse, graph | dense: 0.522, sparse: 0.142, graph: 0.548 |
| 3 | CWE-80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | 0.4878 | dense, sparse, graph | dense: 0.557, sparse: 0.092, graph: 0.550 |
| 4 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.4542 | dense, sparse, graph | dense: 0.491, sparse: 0.076, graph: 0.462 |
| 5 | CWE-352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | 0.4442 | dense, sparse, graph | dense: 0.576, sparse: 0.098, graph: 0.652 |
| 6 | CWE-942 | Permissive Cross-domain Policy with Untrusted Domains | Variant | Allowed | 0.4410 | dense, sparse, graph | dense: 0.498, sparse: 0.090, graph: 0.495 |
| 7 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.3032 | dense, sparse | dense: 0.513, sparse: 0.081 |
| 8 | CWE-113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | 0.2758 | sparse, graph | sparse: 0.067, graph: 0.729 |
| 9 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.1766 | dense, sparse | dense: 0.503, sparse: 0.086 |
| 10 | CWE-692 | Incomplete Denylist to Cross-Site Scripting | Compound | Discouraged | 0.1631 | dense, sparse | dense: 0.504, sparse: 0.069 |

