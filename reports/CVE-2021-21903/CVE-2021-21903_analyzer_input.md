# Vulnerability Information: CVE-2021-21903

## Vulnerability Description
A **stack-based buffer overflow** vulnerability exists in the CMA check_udp_crc function of Garrett Metal Detectors iC Module CMA Version 5.0. A specially-crafted packet can lead to a **stack-based buffer overflow** during a call to **strcpy**. An attacker can send a malicious packet to trigger this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **strcpy**
- **weakness:** **stack-based buffer overflow**
- **vector:** specially-crafted packet
- **attacker:** attacker
- **product:** Garrett Metal Detectors iC Module
- **version:** CMA Version 5.0
- **component:** CMA check_udp_crc function

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 13)

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** A stack-based buffer overflow exists in the `check_udp_crc` function of the Garrett iC Module CMA due to an unbounded `strcpy` operation.
- **Weaknesses/vulnerabilities present:** The vulnerability stems from the use of `strcpy` to copy the CRC field into a fixed-size buffer (`input_crc_str`) without proper size validation. The software searches for the last semicolon (`;`) in the UDP packet and assumes the following data to be the CRC, copying this data into the buffer. If the provided CRC string is longer than 8 bytes, it overflows the buffer.
- **Impact of exploitation:**  Successful exploitation allows an attacker to overwrite the stack, gaining control of the program counter, potentially allowing arbitrary code execution. The provided crash information shows that the program counter (`pc`) is overwritten with `0x4d4d4d4c` ("LMMM"), indicating control over the execution flow.
- **Attack vectors:** The vulnerability can be triggered by sending a specially-crafted UDP packet to the Garrett iC Module's discovery service on UDP port 6877. The crafted packet includes a CRC field that exceeds the allocated buffer size.
- **Required attacker capabilities/position:** The attacker needs to be able to send network packets to the device on the local network.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.8220 | dense, sparse, graph | dense: 0.534, sparse: 0.555, graph: 0.773 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7981 | dense, sparse, graph | dense: 0.531, sparse: 0.471, graph: 0.735 |
| 3 | CWE-676 | Use of Potentially Dangerous Function | Base | Allowed | 0.7496 | dense, sparse, graph | dense: 0.549, sparse: 0.456, graph: 0.598 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.7180 | dense, sparse, graph | dense: 0.554, sparse: 0.444, graph: 0.690 |
| 5 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.5736 | sparse, graph | sparse: 0.483, graph: 0.832 |
| 6 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5411 | dense, sparse | dense: 0.556, sparse: 0.539 |
| 7 | CWE-193 | Off-by-one Error | Base | Allowed | 0.5194 | dense, sparse | dense: 0.521, sparse: 0.452 |
| 8 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.5051 | dense, sparse | dense: 0.531, sparse: 0.419 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4921 | dense, sparse | dense: 0.535, sparse: 0.464 |
| 10 | CWE-130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | 0.3959 | dense, sparse | dense: 0.515, sparse: 0.242 |

