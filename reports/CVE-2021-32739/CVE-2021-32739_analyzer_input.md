# Vulnerability Information: CVE-2021-32739

## Vulnerability Description
Icinga is a monitoring system which checks the availability of network resources, notifies users of outages, and generates performance data for reporting. From version 2.4.0 through version 2.12.4, a vulnerability exists that may allow privilege escalation for authenticated API users. With a read-ony users credentials, an attacker can view most attributes of all config objects including `ticket_salt` of `ApiListener`. This salt is enough to compute a ticket for every possible common name (CN). A ticket, the master nodes certificate, and a self-signed certificate are enough to successfully request the desired certificate from Icinga. That certificate may in turn be used to steal an endpoint or API users identity. Versions 2.12.5 and 2.11.10 both contain a fix the vulnerability. As a workaround, one may either specify queryable types explicitly or filter out ApiListener objects.

### Vulnerability Description Key Phrases
- **impact:** view most attributes of all config objects including `ticket_salt` of `ApiListener`
- **attacker:** authenticated API users
- **product:** Icinga
- **version:** 2.4.0 through 2.12.4

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-32739:

**Root Cause of Vulnerability:**
The vulnerability stems from the fact that the `ticket_salt` attribute of the `ApiListener` object in Icinga 2 is accessible via the web API to authenticated users with read-only permissions.

**Weaknesses/Vulnerabilities Present:**
- **Information Disclosure:** The API exposes the `ticket_salt` which is meant to be a secret, to unauthorized (read-only) users.
- **Privilege Escalation:**  The exposed `ticket_salt` allows an attacker to compute a ticket, which can be used in combination with the master node's certificate and a self-signed certificate to request a new certificate, potentially impersonating other users or endpoints.

**Impact of Exploitation:**
- **Identity Theft/Impersonation:** An attacker can use the generated certificate to steal the identity of an endpoint or API user. This includes highly privileged API users authenticated by certificates, potentially resulting in full control over the Icinga instance and its connected systems.
- **Unauthorized Access:** The attacker gains unauthorized access to the Icinga 2 system using stolen identities.

**Attack Vectors:**
- **Web API:** The vulnerability is exploited by querying the Icinga 2 web API using read-only API user credentials to retrieve the `ticket_salt` value.
- **Certificate Request Manipulation:**  The attacker crafts a certificate request with a generated ticket and the master node's certificate to obtain a valid certificate from Icinga.

**Required Attacker Capabilities/Position:**
- **Authenticated API User:**  The attacker needs valid credentials for a read-only API user.
- **Network Access:** The attacker needs network access to the Icinga 2 API endpoint.
- **Knowledge of Icinga's PKI:** The attacker needs to have a basic understanding of how Icinga handles certificates and tickets.

**Additional Notes:**
- The provided content includes detailed steps on how to exploit the vulnerability.
- The advisory provides workarounds and highlights the importance of upgrading to patched versions.
- The vulnerability allows to escalate privileges from a read-only user to an administrator, if an administrator is configured to use certificate authentication.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-267 | Privilege Defined With Unsafe Actions | Base | Allowed | 0.6104 | dense, sparse, graph | dense: 0.476, sparse: 0.320, graph: 0.529 |
| 2 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.5608 | dense, sparse, graph | dense: 0.485, sparse: 0.187, graph: 0.589 |
| 3 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.5334 | dense, sparse, graph | dense: 0.459, sparse: 0.202, graph: 0.526 |
| 4 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.3808 | sparse, graph | sparse: 0.193, graph: 0.757 |
| 5 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.3417 | dense, sparse | dense: 0.468, sparse: 0.188 |
| 6 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.3409 | dense, sparse | dense: 0.464, sparse: 0.190 |
| 7 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.2866 | dense, sparse, graph | dense: 0.477, sparse: 0.201, graph: 0.375 |
| 8 | CWE-285 | Improper Authorization | Class | Discouraged | 0.2123 | dense, sparse, graph | dense: 0.459, sparse: 0.194, graph: 0.372 |
| 9 | CWE-522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | 0.1990 | dense, sparse | dense: 0.465, sparse: 0.185 |
| 10 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.1972 | dense, sparse | dense: 0.463, sparse: 0.182 |

