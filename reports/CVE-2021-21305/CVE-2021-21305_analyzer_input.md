# Vulnerability Information: CVE-2021-21305

## Vulnerability Description
CarrierWave is an open-source RubyGem which provides a simple and flexible way to upload files from Ruby applications. In CarrierWave before versions 1.3.2 and 2.1.1, there is a **code injection** vulnerability. The #manipulate! method inappropriately evals the content of mutation option(read/write), allowing attackers to craft a string that can be executed as a Ruby code. If an application developer supplies untrusted inputs to the option, it will lead to remote code execution(RCE). This is fixed in versions 1.3.2 and 2.1.1.

### Vulnerability Description Key Phrases
- **rootcause:** **inappropriate eval**
- **weakness:** **code injection**
- **impact:** remote code execution
- **vector:** crafted string
- **attacker:** attackers
- **product:** CarrierWave
- **version:** before 1.3.2 and 2.1.1
- **component:** manipulate! method

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The `manipulate!` method in `CarrierWave::RMagick` inappropriately uses `eval` on the provided options, allowing arbitrary code execution.",
    "weaknesses": [
      "Code Injection"
    ],
    "impact": "Remote code execution (RCE) if an attacker can control the input to the `manipulate!` method's mutation options.",
     "attack_vectors": [
        "By supplying crafted strings to the `:read` or `:write` options within the `manipulate!` method of `CarrierWave::RMagick`."
    ],
    "required_attacker_capabilities": "The attacker needs to be able to supply untrusted input to the `manipulate!` method's mutation options (`:read`/`:write`).",
    "details": "The `manipulate!` method in `CarrierWave::RMagick` constructs a Ruby code string based on the provided options and then evaluates this string using `eval`. This allows an attacker to inject arbitrary Ruby code by crafting a malicious string within the `read` or `write` options. The vulnerability arises due to the lack of proper sanitization or validation of these options before they are used in the `eval` statement."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | 0.9186 | dense, sparse, graph | dense: 0.516, sparse: 0.951, graph: 0.540 |
| 2 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.8813 | dense, sparse, graph | dense: 0.504, sparse: 0.702, graph: 0.636 |
| 3 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.8791 | dense, sparse, graph | dense: 0.513, sparse: 0.647, graph: 0.824 |
| 4 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.8423 | dense, sparse, graph | dense: 0.509, sparse: 0.605, graph: 0.675 |
| 5 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.7073 | sparse, graph | sparse: 0.654, graph: 0.932 |
| 6 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6573 | sparse, graph | sparse: 0.598, graph: 0.882 |
| 7 | CWE-184 | Incomplete List of Disallowed Inputs | Base | Allowed | 0.6192 | sparse, graph | sparse: 0.589, graph: 0.789 |
| 8 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.6184 | dense, sparse | dense: 0.498, sparse: 0.645 |
| 9 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.5671 | sparse, graph | sparse: 0.597, graph: 0.631 |
| 10 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.5667 | sparse, graph | sparse: 0.596, graph: 0.631 |

