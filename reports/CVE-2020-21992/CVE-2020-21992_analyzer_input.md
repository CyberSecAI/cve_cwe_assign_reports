# Vulnerability Information: CVE-2020-21992

## Vulnerability Description
Inim Electronics SmartLiving SmartLAN/G/SI <=6.x suffers from an authenticated remote **command injection** vulnerability. The issue exist due to the **par POST parameter not being sanitized** when called with the testemail module through web.cgi binary. The vulnerable CGI binary (ELF 32-bit LSB executable, ARM) is calling the sh executable via the system() function to issue a command using the mailx service and its vulnerable string format parameter allowing for OS **command injection** with root privileges. An attacker can remotely execute system commands as the root user using default credentials and bypass access controls in place.

### Vulnerability Description Key Phrases
- **rootcause:** **par POST parameter not being sanitized**
- **weakness:** **command injection**
- **impact:** execute system commands as the root user
- **attacker:** authenticated remote attacker
- **product:** Inim Electronics SmartLiving SmartLAN/G/SI
- **version:** <= 6.x
- **component:** testemail module

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2020-21992:

**Root Cause of Vulnerability:**

*   The vulnerability lies in the `web.cgi` binary of Inim Electronics SmartLiving SmartLAN devices. Specifically, the `testemail` module within this binary is vulnerable.
*   The `par` POST parameter, when used with the `testemail` module, is not properly sanitized.
*   The `web.cgi` binary (an ARM executable) uses the `system()` function to execute commands via the `mailx` service.
*   A format string vulnerability in how `mailx` is used allows for OS command injection.

**Weaknesses/Vulnerabilities Present:**

*   **Remote Command Injection:**  The primary vulnerability is the ability to inject and execute arbitrary operating system commands.
*   **Lack of Input Sanitization:** The `par` parameter is not properly sanitized before being used in a `system()` call.
*   **Use of `system()`:** The use of `system()` with unsanitized input is a classic security risk.
*   **Format String Vulnerability:** The manner in which mailx is called allows for format string exploitation.

**Impact of Exploitation:**

*   **Remote Code Execution:** An attacker can execute arbitrary system commands on the vulnerable device with root privileges.
*   **Full System Access:**  Successful exploitation grants the attacker complete control of the device.
*   **Bypass of Access Controls:** Default credentials can be used to bypass access restrictions.
*   **Potential DoS:** Although the primary impact is RCE, DoS is also listed as an impact.

**Attack Vectors:**

*   **Remote:** The vulnerability is remotely exploitable over HTTP/HTTPS.
*   **HTTP POST Request:**  The attacker sends a POST request to the `web.cgi` with the `mod=testemail` parameter.
*   **`par` Parameter Injection:** The attacker injects malicious OS commands into the `par` parameter, which are executed when the `system()` function is called by the vulnerable code.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs network access to the vulnerable device (SmartLAN).
*   **Authentication Credentials:** The attacker requires valid credentials for the web interface. The exploit code indicates that default credentials such as `user=admin;pass=pass;code=9999` can be used.

**Additional Technical Details:**

*   The `web.cgi` binary is an ELF 32-bit LSB executable for ARM architecture.
*   The vulnerable code calls `snprintf` to construct the command string, incorporating the attacker-controlled `par` parameter.
*   The assembled command string passed to `system()` looks something like this: `sh -c echo "Hello!" | mailx -s "Email test" <injected-command>`.
*   The vulnerability is triggered due to the `mailx` command usage which allows for format string injection.

**Affected Devices:**

*   SmartLiving 505
*   SmartLiving 515
*   SmartLiving 1050, SmartLiving 1050/G3
*   SmartLiving 10100L, SmartLiving10100L/G3
*   SmartLAN/SI and SmartLAN/G boards

**Important Note:**

The Ubuntu security notice explicitly states: "Does not apply to software found in Ubuntu." This indicates that while the CVE is registered, the vulnerability does not affect any software within Ubuntu's repositories, it's an issue with the embedded device firmware.

The provided exploit script, `smartlan_exploit.sh`, clearly demonstrates the exploitation process by sending a crafted POST request containing the malicious command within the `par` parameter.

This vulnerability was discovered by Gjoko 'LiquidWorm' Krstic of Zero Science Lab.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 1.1130 | dense, sparse, graph | dense: 0.640, sparse: 0.761, graph: 1.000 |
| 2 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.9916 | dense, sparse, graph | dense: 0.562, sparse: 0.701, graph: 0.865 |
| 3 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.9270 | dense, sparse, graph | dense: 0.592, sparse: 0.657, graph: 0.836 |
| 4 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.8501 | dense, sparse, graph | dense: 0.580, sparse: 0.640, graph: 0.541 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.6743 | sparse, graph | sparse: 0.660, graph: 0.830 |
| 6 | CWE-93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | 0.6464 | dense, sparse | dense: 0.563, sparse: 0.637 |
| 7 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.6422 | sparse, graph | sparse: 0.660, graph: 0.740 |
| 8 | CWE-790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | 0.3864 | dense, sparse | dense: 0.584, sparse: 0.639 |
| 9 | CWE-77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | 0.3774 | dense, sparse | dense: 0.594, sparse: 0.604 |
| 10 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.3539 | sparse | sparse: 0.619 |

