# Vulnerability Information: CVE-2022-24795

## Vulnerability Description
yajl-ruby is a C binding to the YAJL JSON parsing and generation library. The 1.x branch and the 2.x branch of `yajl` contain an **integer overflow** which leads to subsequent heap memory corruption when dealing with large (~2GB) inputs. The reallocation logic at `yajl_buf.c#L64` may result in the `need` 32bit integer wrapping to 0 when `need` approaches a value of 0x80000000 (i.e. ~2GB of data), which results in a reallocation of buf->alloc into a small heap chunk. These integers are declared as `size_t` in the 2.x branch of `yajl`, which practically prevents the issue from triggering on 64bit platforms, however this does not preclude this issue triggering on 32bit builds on which `size_t` is a 32bit integer. Subsequent population of this under-allocated heap chunk is based on the original buffer size, leading to heap memory corruption. This vulnerability mostly impacts process availability. Maintainers believe exploitation for arbitrary code execution is unlikely. A patch is available and anticipated to be part of yajl-ruby version 1.4.2. As a workaround, avoid passing large inputs to YAJL.

### Vulnerability Description Key Phrases
- **rootcause:** **integer overflow**
- **impact:** heap memory corruption
- **vector:** large (~2GB) inputs
- **product:** yajl
- **version:** 1.x branch and the 2.x branch
- **component:** yajl_buf.c#L64

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described in CVE-2022-24795:

**Root Cause of Vulnerability:**
- The vulnerability stems from an integer overflow in the `yajl` library's buffer reallocation logic (`yajl_buf.c#L64`). Specifically, when handling large inputs (close to 2GB), the `need` variable can wrap to 0 due to an integer overflow.

**Weaknesses/Vulnerabilities Present:**
- **Integer Overflow:** The core issue is the potential for an integer overflow in the calculation of the new buffer size.
- **Heap Memory Corruption:** This overflow leads to a reallocation of the buffer into a small heap chunk. Subsequent writing to this under-allocated chunk corrupts the heap.

**Impact of Exploitation:**
- **Heap Memory Corruption**: The primary impact is heap corruption due to the insufficient buffer allocation.
- **Denial of Service (DoS):** While arbitrary code execution is considered unlikely, the heap corruption can lead to process instability and crashes, resulting in a denial of service.
- **Process Availability Impact**: The vulnerability mostly impacts the availability of the affected process.

**Attack Vectors:**
- **Large JSON Input:** An attacker can trigger the vulnerability by providing a specially crafted, large JSON input (close to 2GB).
- **Network:** The vulnerability is network exploitable.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to supply a large JSON input to an application that utilizes a vulnerable version of `yajl`.
- No special privileges or user interaction is required to exploit the vulnerability.

**Additional Details:**
- The vulnerability affects both the 1.x and 2.x branches of the `yajl` library.
- The issue is more likely to be triggered on 32-bit systems, where `size_t` is a 32-bit integer, but can also be triggered on 64-bit systems if the integer overflow occurs within 32-bit calculations, as is the case with `yajl-ruby`.
- Patches were released in `yajl-ruby` version 1.4.3.
- The vulnerability is classified as having a "moderate" severity.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 1.0804 | dense, sparse, graph | dense: 0.528, sparse: 1.000, graph: 0.682 |
| 2 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.9420 | dense, sparse, graph | dense: 0.472, sparse: 0.839, graph: 0.632 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.9177 | dense, sparse, graph | dense: 0.463, sparse: 0.843, graph: 0.570 |
| 4 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.7949 | dense, sparse, graph | dense: 0.480, sparse: 0.765, graph: 0.513 |
| 5 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.6756 | dense, sparse | dense: 0.479, sparse: 0.762 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6753 | dense, sparse | dense: 0.455, sparse: 0.783 |
| 7 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.6746 | dense, sparse | dense: 0.476, sparse: 0.763 |
| 8 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.6667 | dense, sparse | dense: 0.463, sparse: 0.760 |
| 9 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.6605 | dense, sparse | dense: 0.477, sparse: 0.738 |
| 10 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.6538 | dense, sparse | dense: 0.506, sparse: 0.796 |

