# Vulnerability Information: CVE-2022-25219

## Vulnerability Description
A **null byte interaction error** has been discovered in the code that the telnetd_startup daemon uses to construct a pair of ephemeral passwords that allow a user to spawn a telnet service on the router, and to ensure that the telnet service persists upon reboot. By means of a crafted exchange of UDP packets, an unauthenticated attacker on the local network can leverage this **null byte interaction error** in such a way as to make those ephemeral passwords predictable (with 1-in-94 odds). Since the attacker must manipulate data processed by the OpenSSL function RSA_public_decrypt(), successful exploitation of this vulnerability depends on the use of an unpadded RSA cipher (CVE-2022-25218).

### Vulnerability Description Key Phrases
- **rootcause:** **null byte interaction error**
- **impact:** make those ephemeral passwords predictable
- **vector:** crafted exchange of UDP packets
- **attacker:** unauthenticated attacker on the local network
- **component:** telnetd_startup daemon

## CVE Reference Links Content Summary
The provided document describes multiple vulnerabilities in Phicomm router firmware.  Here's the breakdown of the vulnerability specifically related to CVE-2022-25219:

**CVE-2022-25219:** This CVE is related to an insecure backdoor in the Phicomm router firmware that allows attackers on the local network to obtain a root shell.

*   **Root Cause:** The `telnetd_startup` daemon listens on UDP port 21210 and is intended to allow a client with a specific RSA private key to launch a `telnetd` service for root shell access without further authentication. However, the implementation is flawed due to insufficient validation of the decrypted data and the usage of `sprintf` with a `%s` specifier which is vulnerable to null byte injection.

*  **Weaknesses/Vulnerabilities:**
    *   **Insecure Backdoor:** A hidden service (`telnetd_startup`) listening on UDP port 21210 intended to provide privileged access.
    *   **Flawed Cryptographic Implementation:** The design of the backdoor relies on flawed assumptions about the security of public key encryption, particularly regarding predictable outputs of public key decryption with crafted ciphertext.
    *   **Null Byte Injection:** By crafting specific ciphertext, attackers can inject a null byte at the start of a buffer used to construct the ephemeral password for telnet access. The use of sprintf with %s causes it to interpret this buffer as an empty string, resulting in predictable passwords.
    *   **Lack of Rate Limiting:** The absence of a rate-limiting mechanism allows attackers to rapidly attempt the exploit.

*   **Impact of Exploitation:**
    *   **Root Shell Access:** Successful exploitation allows an attacker to obtain a root shell on the device.
    *   **Full Control:**  A root shell provides complete control over the router.

*   **Attack Vectors:**
    *   **Local Network:** Attackers must be on the same local network as the vulnerable router.
    *   **UDP Port 21210:** Exploitation occurs through sending specially crafted packets to UDP port 21210.

*   **Required Attacker Capabilities/Position:**
    *   The attacker needs to be on the local network of the target device.
    *   The attacker must be able to send UDP packets to the router on port 21210.
    *   The attacker must have the ability to craft and send the malicious packets to exploit the backdoor.

**Additional Details:**

*   The advisory mentions that different versions of the firmware have variations in the protocol, but all are vulnerable to the null byte injection attack.
*   The advisory includes a detailed explanation of the protocol and how the attack works, including diagrams.
*   A tool has been designed to exploit this vulnerability.
*   The vendor, Phicomm, is defunct, meaning no official patches will be available.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-626 | Null Byte Interaction Error (Poison Null Byte) | Variant | Allowed | 0.8435 | dense, sparse | dense: 0.683, sparse: 1.000 |
| 2 | CWE-780 | Use of RSA Algorithm without OAEP | Variant | Allowed | 0.7839 | dense, sparse, graph | dense: 0.596, sparse: 0.615, graph: 0.557 |
| 3 | CWE-1204 | Generation of Weak Initialization Vector (IV) | Base | Allowed | 0.7595 | dense, sparse, graph | dense: 0.554, sparse: 0.476, graph: 0.587 |
| 4 | CWE-259 | Use of Hard-coded Password | Variant | Allowed | 0.6969 | dense, sparse, graph | dense: 0.554, sparse: 0.490, graph: 0.552 |
| 5 | CWE-193 | Off-by-one Error | Base | Allowed | 0.5625 | sparse, graph | sparse: 0.510, graph: 0.757 |
| 6 | CWE-617 | Reachable Assertion | Base | Allowed | 0.5561 | sparse, graph | sparse: 0.479, graph: 0.789 |
| 7 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.5398 | dense, sparse | dense: 0.566, sparse: 0.527 |
| 8 | CWE-158 | Improper Neutralization of Null Byte or NUL Character | Variant | Allowed | 0.5276 | dense, sparse | dense: 0.586, sparse: 0.487 |
| 9 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4876 | sparse, graph | sparse: 0.476, graph: 0.602 |
| 10 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.2873 | sparse | sparse: 0.502 |

