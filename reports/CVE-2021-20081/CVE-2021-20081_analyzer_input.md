# Vulnerability Information: CVE-2021-20081

## Vulnerability Description
Incomplete List of Disallowed Inputs in ManageEngine ServiceDesk Plus before version 11205 allows a remote, authenticated attacker to execute arbitrary commands with SYSTEM privileges.

### Vulnerability Description Key Phrases
- **rootcause:** **incomplete list of disallowed inputs**
- **impact:** execute arbitrary commands
- **attacker:** remote authenticated attacker
- **product:** ManageEngine ServiceDesk Plus
- **version:** before version 11205

## CVE Reference Links Content Summary
Based on the provided content, here's the breakdown of the vulnerability:

**Root Cause:**
The vulnerability stems from an insufficient input sanitization implementation when processing custom scheduled script commands in ManageEngine ServiceDesk Plus. The application attempts to restrict the use of certain keywords (e.g., "echo") in script commands, but only splits the input string by spaces (" ") when checking for these keywords. Attackers can bypass this restriction by using other delimiters such as commas (",") or semicolons (";") to separate arguments.

**Weaknesses/Vulnerabilities Present:**
- **Incomplete input sanitization:** The application fails to account for multiple argument delimiters, allowing attackers to inject restricted keywords and commands.
- **Arbitrary command execution:** The application allows the execution of user-provided script commands, which, when combined with the input sanitization weakness, results in arbitrary command execution.

**Impact of Exploitation:**
- **Remote Code Execution:** Successful exploitation allows a remote attacker to execute arbitrary commands on the affected system.
- **Privilege Escalation:** The executed commands are run with SYSTEM privileges, granting the attacker full control over the server.

**Attack Vectors:**
- **Network:** The attacker can exploit this vulnerability by sending a malicious HTTP POST request to the `/api/v3/custom_schedules` endpoint.

**Required Attacker Capabilities/Position:**
- **Authenticated Access:** The attacker needs administrator-level privileges on the ManageEngine ServiceDesk Plus instance.

**Technical Details:**
- The vulnerability is present in the `com.adventnet.servicedesk.utils.ServiceDeskUtil.java` file, specifically in the `containsScriptRestrictedWords` method.
- The `servicedesk.xml` file contains the list of "Script Restricted words," but the filtering logic can be bypassed by manipulating delimiters.
- The attacker can create a new custom schedule and input a command like `cmd /c "echo,testing > C:\\test.txt"` in the "executor" field to exploit the vulnerability.
- The vulnerability allows command execution with SYSTEM privileges.

**Affected Products:**
- ManageEngine ServiceDesk Plus versions before build 11205 on Windows

**Mitigation:**
- Upgrade to ManageEngine ServiceDesk Plus build 11205 or later.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-184 | Incomplete List of Disallowed Inputs | Base | Allowed | 0.7760 | dense, sparse, graph | dense: 0.588, sparse: 0.217, graph: 1.000 |
| 2 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6949 | dense, sparse, graph | dense: 0.553, sparse: 0.106, graph: 1.000 |
| 3 | CWE-807 | Reliance on Untrusted Inputs in a Security Decision | Base | Allowed | 0.5710 | dense, sparse, graph | dense: 0.570, sparse: 0.120, graph: 0.607 |
| 4 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.5545 | dense, sparse, graph | dense: 0.549, sparse: 0.113, graph: 0.601 |
| 5 | CWE-183 | Permissive List of Allowed Inputs | Base | Allowed | 0.4254 | sparse, graph | sparse: 0.119, graph: 1.000 |
| 6 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.3452 | sparse, graph | sparse: 0.110, graph: 0.789 |
| 7 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.3353 | sparse, graph | sparse: 0.119, graph: 0.748 |
| 8 | CWE-269 | Improper Privilege Management | Class | Discouraged | 0.1546 | dense, sparse | dense: 0.575, sparse: 0.101 |
| 9 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.1486 | dense, sparse | dense: 0.543, sparse: 0.106 |
| 10 | CWE-287 | Improper Authentication | Class | Discouraged | 0.1455 | dense, sparse | dense: 0.532, sparse: 0.103 |

