# Vulnerability Information: CVE-2021-46523

## Vulnerability Description
Cesanta MJS v2.20.0 was discovered to contain a **heap buffer overflow** via to_json_or_debug at mjs/src/mjs_json.c.

### Vulnerability Description Key Phrases
- **weakness:** **heap buffer overflow**
- **vector:** to_json_or_debug at mjs/src/mjs_json.c
- **product:** Cesanta MJS
- **version:** v2.20.0

## CVE Reference Links Content Summary
The provided content is related to CVE-2021-46523.

**Root cause of vulnerability:**
A heap-buffer-overflow vulnerability exists in the `to_json_or_debug` function within the `mjs_json.c` file. Specifically, line 154 is identified as the source of the overflow.

**Weaknesses/vulnerabilities present:**
- Heap-buffer-overflow: A memory safety issue where data is written beyond the allocated buffer on the heap. This can lead to memory corruption, application crashes, and potentially arbitrary code execution.

**Impact of exploitation:**
- Application crash: The provided execution steps demonstrate a crash due to a heap-buffer-overflow detected by AddressSanitizer.
- Potential for arbitrary code execution: While not explicitly stated, heap-buffer-overflow vulnerabilities can often be exploited to achieve arbitrary code execution.

**Attack vectors:**
- Crafted JavaScript input: The vulnerability is triggered by a specially crafted JavaScript string passed to the `JSON.stringify` function. Specifically the input is `(JSON.stringify([1, 2, 3]))((JSON.stringify - 6.5 - 321e2)(JSON.stringify([1, 2, 3])));`

**Required attacker capabilities/position:**
- Ability to provide input to the `mjs` interpreter. The attacker needs to be able to run a malicious javascript file through the mjs interpreter.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6875 | dense, sparse, graph | dense: 0.547, sparse: 0.149, graph: 0.919 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6397 | dense, sparse, graph | dense: 0.572, sparse: 0.113, graph: 0.808 |
| 3 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5179 | dense, sparse, graph | dense: 0.597, sparse: 0.103, graph: 0.569 |
| 4 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4799 | dense, sparse, graph | dense: 0.539, sparse: 0.088, graph: 0.447 |
| 5 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3706 | dense, sparse | dense: 0.609, sparse: 0.169 |
| 6 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3390 | sparse, graph | sparse: 0.099, graph: 0.789 |
| 7 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3316 | dense, sparse | dense: 0.573, sparse: 0.127 |
| 8 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3254 | dense, sparse | dense: 0.550, sparse: 0.087 |
| 9 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3209 | dense, sparse | dense: 0.531, sparse: 0.097 |
| 10 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.3176 | dense, sparse | dense: 0.533, sparse: 0.089 |

