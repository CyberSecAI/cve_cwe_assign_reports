# Vulnerability Information: CVE-2022-1148

## Vulnerability Description
**Improper authorization** in GitLab Pages included with GitLab CE/EE affecting all versions from 11.5 prior to 14.7.7, 14.8 prior to 14.8.5, and 14.9 prior to 14.9.2 allowed an attacker to steal a users access token on an attacker-controlled private GitLab Pages website and reuse that token on the victims other private websites

### Vulnerability Description Key Phrases
- **rootcause:** **Improper authorization**
- **impact:** steal a users access token
- **attacker:** attacker
- **product:** GitLab Pages
- **version:** all versions from 11.5 prior to 14.7.7 and 14.8 prior to 14.8.5 and 14.9 prior to 14.9.2

## CVE Reference Links Content Summary
```json
{
  "vulnerability": {
    "root_cause": "The gitlab-pages session cookies are not properly validated to ensure that the requested subdomain is the same as the subdomain to which the session cookie was issued for.",
    "weaknesses": [
      "Improper validation of session cookies",
      "Cross-subdomain usage of session cookies"
    ],
    "impact": "An attacker can steal Gitlab Pages session tokens and access every private Gitlab Pages site that the victim has access to.",
    "attack_vectors": [
      "Service worker interception of requests to the `/auth` endpoint on a Pages site",
      "Bypassing CSRF protection (OAuth2 `state` parameter) by obtaining a valid session cookie and redirection URL from an attacker-controlled website",
       "Interception of the OAuth2 response containing the code and state by an attacker's service worker."
    ],
    "required_capabilities": "The attacker needs to create a private Gitlab Pages site, invite the victim to collaborate on the project, and host an attacker-controlled server to intercept and store the session token."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-565 | Reliance on Cookies without Validation and Integrity Checking | Base | Allowed | 0.7435 | dense, sparse, graph | dense: 0.540, sparse: 0.490, graph: 0.540 |
| 2 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.7083 | dense, sparse, graph | dense: 0.560, sparse: 0.362, graph: 0.618 |
| 3 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.6333 | dense, sparse, graph | dense: 0.536, sparse: 0.301, graph: 0.540 |
| 4 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.4407 | dense, sparse | dense: 0.496, sparse: 0.336 |
| 5 | CWE-267 | Privilege Defined With Unsafe Actions | Base | Allowed | 0.4357 | dense, sparse | dense: 0.522, sparse: 0.305 |
| 6 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.4291 | dense, sparse | dense: 0.502, sparse: 0.311 |
| 7 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.3734 | dense, sparse, graph | dense: 0.554, sparse: 0.385, graph: 0.386 |
| 8 | CWE-285 | Improper Authorization | Class | Discouraged | 0.2833 | dense, sparse, graph | dense: 0.559, sparse: 0.376, graph: 0.387 |
| 9 | CWE-862 | Missing Authorization | Class | Allowed-with-Review | 0.2581 | dense, sparse | dense: 0.525, sparse: 0.308 |
| 10 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.2523 | dense, sparse | dense: 0.497, sparse: 0.316 |

