# Vulnerability Information: CVE-2021-31920

## Vulnerability Description
Istio before 1.8.6 and 1.9.x before 1.9.5 has a remotely exploitable vulnerability where an HTTP request path with multiple slashes or escaped slash characters (%2F or %5C) could potentially bypass an Istio authorization policy when path based authorization rules are used.

### Vulnerability Description Key Phrases
- **rootcause:** **improper URL encoding handling**
- **impact:** bypass Istio authorization policy
- **vector:** HTTP request path with multiple slashes or escaped slash characters
- **product:** Istio
- **version:** before 1.8.6 and 1.9.x before 1.9.5

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** HTTP request paths with multiple slashes or escaped slash characters (`%2F` or `%5C`) are not normalized consistently by Istio's authorization policies and backend services.
- **Weaknesses/vulnerabilities present:** Inconsistent path normalization between Istio's authorization policies and backend services allows for authorization bypass. Specifically, authorization policies that use `ALLOW action + notPaths field` or `DENY action + paths field` are vulnerable.
- **Impact of exploitation:** Attackers can bypass path-based authorization policies, gaining access to resources that should be restricted. For example, a request to `//admin` can bypass a policy that denies access to `/admin`. This can lead to unauthorized access to sensitive areas of the backend service.
- **Attack vectors:** Sending HTTP requests with multiple slashes or escaped slash characters in the URL path.
- **Required attacker capabilities/position:** An attacker needs to be able to send HTTP requests to the Istio service mesh with manipulated URL paths, with knowledge of the authorization policies in place.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-50 | Path Equivalence: '//multiple/leading/slash' | Variant | Allowed | 0.6592 | dense, sparse, graph | dense: 0.610, sparse: 0.364, graph: 0.561 |
| 2 | CWE-177 | Improper Handling of URL Encoding (Hex Encoding) | Variant | Allowed | 0.5216 | dense, sparse, graph | dense: 0.545, sparse: 0.185, graph: 0.521 |
| 3 | CWE-41 | Improper Resolution of Path Equivalence | Base | Allowed | 0.4807 | sparse, graph | sparse: 0.269, graph: 0.915 |
| 4 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.3423 | dense, sparse | dense: 0.501, sparse: 0.160 |
| 5 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.3419 | dense, sparse | dense: 0.505, sparse: 0.156 |
| 6 | CWE-113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | 0.3247 | dense, sparse | dense: 0.521, sparse: 0.159 |
| 7 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.2161 | dense, sparse | dense: 0.513, sparse: 0.194 |
| 8 | CWE-116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | 0.1845 | sparse, graph | sparse: 0.172, graph: 0.604 |
| 9 | CWE-285 | Improper Authorization | Class | Discouraged | 0.1549 | dense, sparse | dense: 0.500, sparse: 0.168 |
| 10 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.0960 | sparse | sparse: 0.168 |

