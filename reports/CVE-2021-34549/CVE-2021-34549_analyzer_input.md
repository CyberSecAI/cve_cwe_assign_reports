# Vulnerability Information: CVE-2021-34549

## Vulnerability Description
An issue was discovered in Tor before 0.4.6.5, aka TROVE-2021-005. Hashing is mishandled for certain retrieval of circuit data. Consequently. an attacker can trigger the use of an attacker-chosen circuit ID to cause algorithm inefficiency.

### Vulnerability Description Key Phrases
- **rootcause:** **mishandling of hashing**
- **impact:** algorithm inefficiency
- **vector:** retrieval of circuit data
- **attacker:** attacker
- **product:** Tor
- **version:** before 0.4.6.5

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The `chanid_circid_entry_hash()` function used in the circuit muxinfo hashtable employs an unsafe hash function, making it vulnerable to HashDoS attacks.",
    "weaknesses": [
      "The hash function `chanid_circid_entry_hash()` does not use SipHash, which is designed to prevent HashDoS attacks. This allows an attacker to create hash collisions."
    ],
    "impact": "An attacker can cause a denial-of-service (DoS) by creating many hash collisions, leading to excessive CPU usage by the Tor relay. Additionally, a timing oracle exists that can leak information about the number of circuits established by a relay.",
    "attack_vectors": [
      "An attacker needs to connect directly to an Onion Router.",
      "The attacker needs to craft specific circuit IDs to create hash collisions."
    ],
    "required_capabilities": "The attacker must know the number of channels established by the target Tor instance (or use the timing oracle to discover it). The attacker also needs the ability to connect to an Onion Router and send traffic to it."
  },
  "additional_information": {
    "timing_oracle": "A timing oracle exists where a ~3ms timing delta (amplified when queries are batched) reveals whether a Tor relay has established a specific number of channels.",
    "dos_traffic": "The DoS attack requires the attacker to send ~1.3 Mbit/s of traffic to the relay, potentially reaching 100% CPU utilization. The test program needed ~2.8 Mbits/s.",
        "mitigation": "The vulnerability is addressed by using SipHash instead of the naive hash function for circuit lookups in the circuitmux object. This change was included in Tor versions 0.3.5.15, 0.4.4.9, 0.4.5.9, and 0.4.6.5."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-328 | Use of Weak Hash | Base | Allowed | 0.6124 | dense, sparse, graph | dense: 0.552, sparse: 0.201, graph: 0.619 |
| 2 | CWE-916 | Use of Password Hash With Insufficient Computational Effort | Base | Allowed | 0.5804 | dense, sparse, graph | dense: 0.512, sparse: 0.183, graph: 0.613 |
| 3 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.4694 | dense, sparse, graph | dense: 0.518, sparse: 0.162, graph: 0.439 |
| 4 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.3405 | dense, sparse | dense: 0.490, sparse: 0.166 |
| 5 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.3147 | dense, sparse, graph | dense: 0.498, sparse: 0.186, graph: 0.503 |
| 6 | CWE-407 | Inefficient Algorithmic Complexity | Class | Allowed-with-Review | 0.2549 | dense, sparse | dense: 0.511, sparse: 0.311 |
| 7 | CWE-330 | Use of Insufficiently Random Values | Class | Discouraged | 0.2154 | dense, sparse, graph | dense: 0.489, sparse: 0.178, graph: 0.377 |
| 8 | CWE-617 | Reachable Assertion | Base | Allowed | 0.0994 | sparse | sparse: 0.174 |
| 9 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.0979 | sparse | sparse: 0.171 |
| 10 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.0974 | sparse | sparse: 0.170 |

