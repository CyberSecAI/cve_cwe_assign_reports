# Vulnerability Information: CVE-2022-41013

## Vulnerability Description
Several **stack-based buffer overflow** vulnerabilities exist in the DetranCLI command parsing functionality of Siretta QUARTZ-GOLD G5.0.1.5-210720-141020. A specially-crafted network packet can lead to arbitrary command execution. An attacker can send a sequence of requests to trigger these vulnerabilities.This buffer overflow is in the function that manages the static dhcp mac WORD (WORD|null) ip A.B.C.D hostname (WORD|null) description (WORD|null) command template.

### Vulnerability Description Key Phrases
- **rootcause:** **stack-based buffer overflow**
- **impact:** arbitrary command execution
- **attacker:** attacker
- **product:** Siretta QUARTZ-GOLD
- **version:** G5.0.1.5-210720-141020
- **component:** DetranCLI command parsing functionality

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-120

#### Top CWEs
- CWE-120 (Count: 127)
- CWE-787 (Count: 39)
- CWE-78 (Count: 4)

## CVE Reference Links Content Summary
The provided content is a Talos vulnerability report that includes details for CVE-2022-41013.

**Root cause of vulnerability:**
The root cause is a stack-based buffer overflow in the `DetranCLI` command parsing functionality of Siretta QUARTZ-GOLD G5.0.1.5-210720-141020. The `sprintf` function is used to format strings, and the size of the input parameters is not checked against the buffer size, allowing for an overflow when processing specially crafted network packets.

**Weaknesses/vulnerabilities present:**
The vulnerability is a classic stack-based buffer overflow (CWE-120). This occurs because the `sprintf` function is used to construct a string based on user-supplied input, without validating the size of that input against the size of the destination buffer on the stack.

**Impact of exploitation:**
Exploitation can lead to arbitrary command execution. An attacker could overwrite return addresses on the stack and potentially gain control of the device.

**Attack vectors:**
The attack vector is network-based. An attacker can send specially crafted network packets containing malicious command sequences to the vulnerable device.

**Required attacker capabilities/position:**
The attacker needs to be able to send network packets to the vulnerable device. The attacker also needs to have knowledge of the vulnerable commands and their parameters. The CVSS score indicates that the attacker requires high privileges to exploit this vulnerability, which likely means they would need to authenticate to the device's CLI.

**Specific details for CVE-2022-41013:**

The vulnerability is triggered via the `static dhcp mac` command.

```
static dhcp mac WORD (WORD|null) ip A.B.C.D hostname (WORD|null) description (WORD|null)
```

The vulnerable code snippet is:

```c
if (*argv[1] == '\x00'){
    format_string = "%s%s<%s<%s<%s";
}
else{
    format_string = "%s,%s<%s<%s<%s";
}
sprintf(buff_0x40,format_string,*argv,argv[1],argv[2],argv[3],argv[4]);
```

Here, `buff_0x40` is a stack buffer of size 0x40 bytes. The `sprintf` function will copy data into this buffer based on the format string. The format string changes based on whether `*argv[1]` is a null byte. However, in both cases, the size of the input `argv[x]` is not checked, thus leading to buffer overflow if the combined lengths of arguments provided to `sprintf` exceed 0x40.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 1.1987 | dense, sparse, graph | dense: 0.690, sparse: 0.966, graph: 1.000 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.8009 | dense, sparse, graph | dense: 0.563, sparse: 0.365, graph: 0.868 |
| 3 | CWE-170 | Improper Null Termination | Base | Allowed | 0.5690 | sparse, graph | sparse: 0.370, graph: 1.000 |
| 4 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5024 | dense, sparse | dense: 0.660, sparse: 0.375 |
| 5 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4812 | dense, sparse | dense: 0.560, sparse: 0.351 |
| 6 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.4637 | dense, sparse | dense: 0.565, sparse: 0.316 |
| 7 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4455 | dense, sparse | dense: 0.580, sparse: 0.337 |
| 8 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.4382 | dense, sparse | dense: 0.578, sparse: 0.324 |
| 9 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 0.4058 | sparse, graph | sparse: 0.315, graph: 0.631 |
| 10 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.2687 | dense, sparse | dense: 0.565, sparse: 0.305 |

