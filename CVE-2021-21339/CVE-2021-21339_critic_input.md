# Critic Input for CVE-2021-21339



# Original Analyzer Input
## Vulnerability Description
TYPO3 is an open source PHP based web content management system. In TYPO3 before versions 6.2.57, 7.6.51, 8.7.40, 9.5.25, 10.4.14, 11.1.1 user session identifiers were stored in cleartext - without processing of additional cryptographic hashing algorithms. This vulnerability cannot be exploited directly and occurs in combination with a chained attack - like for instance SQL injection in any other component of the system. This is fixed in versions 6.2.57, 7.6.51, 8.7.40, 9.5.25, 10.4.14, 11.1.1.

### Vulnerability Description Key Phrases
- **weakness:** **cleartext storage of user session identifiers**
- **product:** TYPO3
- **version:** before versions 6.2.57, 7.6.51, 8.7.40, 9.5.25, 10.4.14, 11.1.1

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2021-21339

**Root Cause of Vulnerability:**
The root cause of this vulnerability is the storage of user session identifiers in cleartext within TYPO3 CMS. These session identifiers were not processed with any additional cryptographic hashing algorithms before storage.

**Weaknesses/Vulnerabilities Present:**
The primary weakness is the **sensitive data exposure** due to the lack of cryptographic protection for session identifiers. This corresponds to **CWE-312** (Cleartext Storage of Sensitive Information).

**Impact of Exploitation:**
The direct impact of this vulnerability is limited. It can't be exploited on its own. However, if combined with a chained attack, such as a SQL injection vulnerability in another part of the system, an attacker could potentially gain access to sensitive session data. This could lead to session hijacking and further compromise of the system. The severity is rated as **high**, due to the potential for high impact in the presence of a chained attack

**Attack Vectors:**
The attack vector is indirect. An attacker would first need to exploit another vulnerability (like SQL injection) in the system to gain access to the cleartext session identifiers.

**Required Attacker Capabilities/Position:**
The attacker needs to be able to:
1. Exploit an existing vulnerability in the TYPO3 CMS (e.g. SQL Injection) or other system components.
2. Have the ability to read the cleartext stored session identifiers after exploiting the other vulnerability.

**Affected Versions:**
- 6.2.0-6.2.56
- 7.0.0-7.6.50
- 8.0.0-8.7.39
- 9.0.0-9.5.24
- 10.0.0-10.4.13
- 11.0.0-11.1.0

**Patched Versions:**
- 6.2.57
- 7.6.51
- 8.7.40
- 9.5.25
- 10.4.14
- 11.1.1

**Additional Information:**
- The vulnerability is located in the core session storage component of TYPO3.
- The advisory highlights that the issue was reported by Oliver Hader, and fixed by Benni Mack and Oliver Hader.
- The advisory provides a CVSS score of 7.5 (High).

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-312 | Cleartext Storage of Sensitive Information | Base | Allowed | 0.8295 | dense, sparse, graph | dense: 0.536, sparse: 0.582, graph: 0.639 |
| 2 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.7109 | dense, sparse, graph | dense: 0.530, sparse: 0.359, graph: 0.673 |
| 3 | CWE-209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | 0.6602 | dense, sparse, graph | dense: 0.511, sparse: 0.375, graph: 0.532 |
| 4 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.4170 | sparse, graph | sparse: 0.334, graph: 0.631 |
| 5 | CWE-287 | Improper Authentication | Class | Discouraged | 0.2370 | sparse, graph | sparse: 0.356, graph: 0.911 |
| 6 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.2010 | sparse | sparse: 0.351 |
| 7 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.1964 | sparse | sparse: 0.343 |
| 8 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.1943 | sparse | sparse: 0.340 |
| 9 | CWE-532 | Insertion of Sensitive Information into Log File | Base | Allowed | 0.1937 | sparse | sparse: 0.339 |
| 10 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.1817 | sparse | sparse: 0.333 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-312 | Cleartext Storage of Sensitive Information | 1.0 | Base | Allowed | Primary CWE: The session identifiers are stored in cleartext without cryptographic hashing. |
| CWE-613 | Insufficient Session Expiration | 0.6 | Base | Allowed | Secondary Candidate: If sessions don't expire, the impact of stolen session data increases. |

## Evidence and Confidence

*   **Confidence Score:** 0.9
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability description explicitly states that user session identifiers are stored in **cleartext**, without any cryptographic hashing. This directly matches the description of CWE-312 (Cleartext Storage of Sensitive Information). The "CVE Reference Links Content Summary" section confirms this, emphasizing the **sensitive data exposure** due to the lack of cryptographic protection. The retriever results give the highest score to CWE-312, confirming its appropriateness.
  
  - *Relationship Analysis:* While CWE-312 has no direct relationships, its impact is increased in combination with other weaknesses. For example, if session expiration is too long (CWE-613), the window of opportunity for an attacker to exploit the cleartext session identifier increases. The vulnerability description mentions that this vulnerability "cannot be exploited directly and occurs in combination with a chained attack - like for instance SQL injection." This confirms that the described vulnerability is only dangerous when combined with other vulnerabilities in the application.

- **Confidence Score:**  
  - *Example:* Confidence: 1.0 (Direct evidence from the vulnerability description and the CVE reference summary)

---

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability mentions that "user session identifiers were stored in cleartext". CWE-613 (Insufficient Session Expiration) is a plausible secondary candidate. The weakness here is the risk of credential reuse, and the time window in which stolen session data remains useful to an attacker. Although the core issue is not about the expiration itself, the impact of cleartext storage is amplified if sessions don't expire promptly.
  
  - *Relationship Analysis:* CWE-613 is a child of CWE-672 (Operation on Resource After Expiry). CWE-613 can precede CWE-287 (Improper Authentication).

- **Confidence Score:**  
  - *Example:* Confidence: 0.6 (Indirect relationship due to potential impact on session hijacking)

# CWE Examples from Database


## Known Examples for CWE-312: Cleartext Storage of Sensitive Information
### Observed Examples
- **CVE-2022-30275** [https://www.cve.org/CVERecord?id=CVE-2022-30275](https://www.cve.org/CVERecord?id=CVE-2022-30275): Remote Terminal Unit (RTU) uses a driver that relies on a password stored in plaintext.
- **CVE-2009-2272** [https://www.cve.org/CVERecord?id=CVE-2009-2272](https://www.cve.org/CVERecord?id=CVE-2009-2272): password and username stored in cleartext in a cookie
- **CVE-2009-1466** [https://www.cve.org/CVERecord?id=CVE-2009-1466](https://www.cve.org/CVERecord?id=CVE-2009-1466): password stored in cleartext in a file with insecure permissions
- **CVE-2009-0152** [https://www.cve.org/CVERecord?id=CVE-2009-0152](https://www.cve.org/CVERecord?id=CVE-2009-0152): chat program disables SSL in some circumstances even when the user says to use SSL.
- **CVE-2009-1603** [https://www.cve.org/CVERecord?id=CVE-2009-1603](https://www.cve.org/CVERecord?id=CVE-2009-1603): Chain: product uses an incorrect public exponent when generating an RSA key, which effectively disables the encryption
- **CVE-2009-0964** [https://www.cve.org/CVERecord?id=CVE-2009-0964](https://www.cve.org/CVERecord?id=CVE-2009-0964): storage of unencrypted passwords in a database
- **CVE-2008-6157** [https://www.cve.org/CVERecord?id=CVE-2008-6157](https://www.cve.org/CVERecord?id=CVE-2008-6157): storage of unencrypted passwords in a database
- **CVE-2008-6828** [https://www.cve.org/CVERecord?id=CVE-2008-6828](https://www.cve.org/CVERecord?id=CVE-2008-6828): product stores a password in cleartext in memory
- **CVE-2008-1567** [https://www.cve.org/CVERecord?id=CVE-2008-1567](https://www.cve.org/CVERecord?id=CVE-2008-1567): storage of a secret key in cleartext in a temporary file
- **CVE-2008-0174** [https://www.cve.org/CVERecord?id=CVE-2008-0174](https://www.cve.org/CVERecord?id=CVE-2008-0174): SCADA product uses HTTP Basic Authentication, which is not encrypted


# Relevant CWE Specifications

## CWE-312: Cleartext Storage of Sensitive Information
**Abstraction:** Base
**Status:** Draft

### Description
The product stores sensitive information in cleartext within a resource that might be accessible to another control sphere.

### Extended Description


Because the information is stored in cleartext (i.e., unencrypted), attackers could potentially read it. Even if the information is encoded in a way that is not human-readable, certain techniques could determine which encoding is being used, then decode the information.


When organizations adopt cloud services, it can be easier for attackers to access the data from anywhere on the Internet.


In some systems/environments such as cloud, the use of "double encryption" (at both the software and hardware layer) might be required, and the developer might be solely responsible for both layers, instead of shared responsibility with the administrator of the broader system/environment.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-311
ChildOf -> CWE-311
ChildOf -> CWE-922
ParentOf -> CWE-313
ParentOf -> CWE-314
ParentOf -> CWE-315
ParentOf -> CWE-316
ParentOf -> CWE-317
ParentOf -> CWE-318
ParentOf -> CWE-526

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation, System Configuration, Operation
- **Description:** When storing data in the cloud (e.g., S3 buckets, Azure blobs, Google Cloud Storage, etc.), use the provider's controls to encrypt the data at rest. [REF-1297] [REF-1299] [REF-1301]



### Additional Notes
**[Terminology]** Different people use "cleartext" and "plaintext" to mean the same thing: the lack of encryption. However, within cryptography, these have more precise meanings. Plaintext is the information just before it is fed into a cryptographic algorithm, including already-encrypted text. Cleartext is any information that is unencrypted, although it might be in an encoded form that is not easily human-readable (such as base64 encoding).



### Observed Examples
- **CVE-2022-30275:** Remote Terminal Unit (RTU) uses a driver that relies on a password stored in plaintext.
- **CVE-2009-2272:** password and username stored in cleartext in a cookie
- **CVE-2009-1466:** password stored in cleartext in a file with insecure permissions



## CWE-613: Insufficient Session Expiration
**Abstraction:** Base
**Status:** Incomplete

### Description
According to WASC, "Insufficient Session Expiration is when a web site permits an attacker to reuse old session credentials or session IDs for authorization."

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-672
ChildOf -> CWE-672
CanPrecede -> CWE-287
RequiredBy -> CWE-352

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Description:** Set sessions/credentials expiration date.



### Additional Notes
**[Other]** The lack of proper session expiration may improve the likely success of certain attacks. For example, an attacker may intercept a session ID, possibly via a network sniffer or Cross-site Scripting attack. Although short session expiration times do not help if a stolen token is immediately used, they will protect against ongoing replaying of the session ID. In another scenario, a user might access a web site from a shared computer (such as at a library, Internet cafe, or open work environment). Insufficient Session Expiration could allow an attacker to use the browser's back button to access web pages previously accessed by the victim.





## CWE-287: Improper Authentication
**Abstraction:** Class
**Status:** Draft

### Description
When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.

### Extended Description
Not provided

### Alternative Terms
authentification: An alternate term is "authentification", which appears to be most commonly used by people from non-English-speaking countries.
AuthN: "AuthN" is typically used as an abbreviation of "authentication" within the web application security community. It is also distinct from "AuthZ," which is an abbreviation of "authorization." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.
AuthC: "AuthC" is used as an abbreviation of "authentication," but it appears to used less frequently than "AuthN."

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1390
ParentOf -> CWE-290
ParentOf -> CWE-294
ParentOf -> CWE-295
ParentOf -> CWE-306
ParentOf -> CWE-307
ParentOf -> CWE-521
ParentOf -> CWE-522
CanFollow -> CWE-613
ParentOf -> CWE-640
ParentOf -> CWE-645
ParentOf -> CWE-798

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry might be misused when lower-level CWE entries are likely to be applicable. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children or descendants, beginning with CWE-1390: Weak Authentication or CWE-306: Missing Authentication for Critical Function.
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1390: Weak Authentication
- CWE-306: Missing Authentication for Critical Function


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an authentication framework or library such as the OWASP ESAPI Authentication feature.



### Additional Notes
**[Relationship]** This can be resultant from SQL injection vulnerabilities and other issues.

**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-35248:** Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436:** Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034:** Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).



## CWE-672: Operation on a Resource after Expiration or Release
**Abstraction:** Class
**Status:** Draft

### Description
The product uses, accesses, or otherwise operates on a resource after that resource has been expired, released, or revoked.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-666
CanFollow -> CWE-1341
ParentOf -> CWE-298
ParentOf -> CWE-324
ParentOf -> CWE-415
ParentOf -> CWE-416
CanFollow -> CWE-562
ParentOf -> CWE-613
ParentOf -> CWE-825
CanFollow -> CWE-826
ParentOf -> CWE-910
CanFollow -> CWE-911

### Mapping Guidance
**Usage:** Allowed-with-Review
**Rationale:** This CWE entry is a Class and might have Base-level children that would be more appropriate
**Comments:** Examine children of this entry to see if there is a better fit
**Reasons:**
- Abstraction




### Observed Examples
- **CVE-2009-3547:** Chain: race condition (CWE-362) might allow resource to be released before operating on it, leading to NULL dereference (CWE-476)

