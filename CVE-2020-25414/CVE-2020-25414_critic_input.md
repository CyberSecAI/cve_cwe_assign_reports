# Critic Input for CVE-2020-25414



# Original Analyzer Input
## Vulnerability Description
A **local file inclusion** vulnerability was discovered in the captcha function in Monstra 3.0.4 which allows remote attackers to execute arbitrary PHP code.

### Vulnerability Description Key Phrases
- **rootcause:** **local file inclusion**
- **impact:** execute arbitrary PHP code
- **attacker:** remote attackers
- **product:** Monstra
- **version:** 3.0.4
- **component:** captcha function

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

*   The vulnerability stems from the `cryptographp.inc.php` file directly including a file path provided by the user through the `cfg` GET parameter without proper sanitization or validation.

**Weaknesses/Vulnerabilities:**

*   **Local File Inclusion (LFI):** The primary vulnerability is LFI. The application takes user-supplied input (the `cfg` parameter) and uses it to include a file on the server, allowing attackers to potentially include files outside the intended directory.
*   **Unvalidated Input:** The code directly uses `$_GET['cfg']` to set the `$_SESSION['configfile']` variable, which is then directly used in an `include` statement. There's no check to ensure that the provided value points to a valid configuration file or that it stays within an allowed path.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** By including files with PHP code, such as a custom `phpinfo.txt` or even web server access logs, an attacker can execute arbitrary PHP code on the server. This can allow the attacker to compromise the entire system.
*   **Information Disclosure:** Attackers can include any file on the server accessible by the web server user, which can lead to the disclosure of sensitive information such as configuration files, database credentials, or source code.

**Attack Vectors:**

*   **HTTP GET Request:** The attack vector is an HTTP GET request where the `cfg` parameter is manipulated to include a malicious file.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable application.
*   **No Authentication Required:** The vulnerability is present in a publicly accessible part of the application, requiring no authentication.
*   **Knowledge of File Paths:** While not strictly necessary, knowledge of specific file paths on the server can help an attacker achieve code execution (e.g., knowing the path to web server logs).

**Additional Notes:**

*   The provided examples showcase how to include a simple `phpinfo.txt` file and also how to include the Apache webserver access logs. This demonstrates the potential for information leakage or code injection through the log file if it contains injected php code.
*   The vulnerability is specifically present in Monstra CMS version 3.0.4 and earlier.
*   The file `plugins\captcha\crypt\cryptographp.inc.php` is the vulnerable file in Monstra CMS.

The provided information is more detailed than a typical CVE description, giving a concrete example with attack vectors and demonstrating impact.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | 0.6290 | dense, sparse, graph | dense: 0.563, sparse: 0.177, graph: 0.834 |
| 2 | CWE-96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | 0.5893 | dense, sparse, graph | dense: 0.602, sparse: 0.122, graph: 0.610 |
| 3 | CWE-829 | Inclusion of Functionality from Untrusted Control Sphere | Base | Allowed | 0.5484 | dense, sparse, graph | dense: 0.512, sparse: 0.127, graph: 0.613 |
| 4 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.5419 | dense, sparse, graph | dense: 0.508, sparse: 0.108, graph: 0.631 |
| 5 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.5261 | dense, sparse, graph | dense: 0.515, sparse: 0.114, graph: 0.569 |
| 6 | CWE-36 | Absolute Path Traversal | Base | Allowed | 0.3147 | dense, sparse | dense: 0.513, sparse: 0.101 |
| 7 | CWE-24 | Path Traversal: '../filedir' | Variant | Allowed | 0.3102 | dense, sparse | dense: 0.532, sparse: 0.122 |
| 8 | CWE-95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | 0.3046 | dense, sparse | dense: 0.544, sparse: 0.101 |
| 9 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.2858 | sparse, graph | sparse: 0.119, graph: 0.609 |
| 10 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.2843 | sparse, graph | sparse: 0.106, graph: 0.664 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | 0.95 | Variant | Allowed | Primary CWE |
| CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | 0.75 | Base | Allowed | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.90
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**
  - *Explanation:* The vulnerability is a **local file inclusion** in the captcha function of Monstra 3.0.4. The root cause is that the application directly includes a file path provided by the user through the `cfg` GET parameter without proper sanitization. This allows remote attackers to execute arbitrary PHP code by including files with PHP code.
  The most appropriate CWE is CWE-98 (Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')), which is a Variant level CWE that specifically describes this type of vulnerability in PHP applications. The application uses the `include` statement with a filename directly derived from user-supplied input, which aligns perfectly with CWE-98.
  CWE-98's description states: "The PHP application receives input from an upstream component, but it does not restrict or incorrectly restricts the input before its usage in 'require,' 'include,' or similar functions." The vulnerability description and CVE reference confirm this. The MITRE mapping guidance ALLOWS CWE-98 for this type of vulnerability.
  - *Relationship Analysis:* CWE-98 is a variant of CWE-829 (Inclusion of Functionality from Untrusted Control Sphere), indicating that the untrusted input is used to include functionality (in this case, a file). CWE-98 can also be a consequence of other weaknesses such as missing authorization (CWE-425) or incomplete blacklist (CWE-184), although these are not explicitly mentioned in the vulnerability description, making CWE-98 the most accurate and specific choice.

- **Confidence Score:**
  - Confidence: 0.95 (High confidence due to precise match with CWE-98 description and supporting evidence from CVE reference links.)

---

- **Analysis and Justification:**
  - *Explanation:* CWE-22 (Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')) is also relevant because the **local file inclusion** vulnerability potentially allows an attacker to traverse the file system and access files outside the intended directory. This is evident from the CVE reference which notes the potential to include files outside the intended directory.
  - *Relationship Analysis:* CWE-22 is a parent of CWE-23 (Relative Path Traversal). The key difference is that CWE-22 focuses on improper restriction, while CWE-98 focuses on the misuse of the include/require statement. Since the vulnerability description focuses on the lack of restriction leading to the inclusion of arbitrary files, CWE-98 is the primary weakness, and CWE-22 is a contributing factor.

- **Confidence Score:**
  - Confidence: 0.75 (Moderate confidence as Path Traversal is a potential attack vector but not the primary weakness.)

# CWE Examples from Database


## Known Examples for CWE-829: Inclusion of Functionality from Untrusted Control Sphere
### Observed Examples
- **CVE-2010-2076** [https://www.cve.org/CVERecord?id=CVE-2010-2076](https://www.cve.org/CVERecord?id=CVE-2010-2076): Product does not properly reject DTDs in SOAP messages, which allows remote attackers to read arbitrary files, send HTTP requests to intranet servers, or cause a denial of service.
- **CVE-2004-0285** [https://www.cve.org/CVERecord?id=CVE-2004-0285](https://www.cve.org/CVERecord?id=CVE-2004-0285): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0030** [https://www.cve.org/CVERecord?id=CVE-2004-0030](https://www.cve.org/CVERecord?id=CVE-2004-0030): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0068** [https://www.cve.org/CVERecord?id=CVE-2004-0068](https://www.cve.org/CVERecord?id=CVE-2004-0068): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2005-2157** [https://www.cve.org/CVERecord?id=CVE-2005-2157](https://www.cve.org/CVERecord?id=CVE-2005-2157): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2005-2162** [https://www.cve.org/CVERecord?id=CVE-2005-2162](https://www.cve.org/CVERecord?id=CVE-2005-2162): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2005-2198** [https://www.cve.org/CVERecord?id=CVE-2005-2198](https://www.cve.org/CVERecord?id=CVE-2005-2198): Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0128** [https://www.cve.org/CVERecord?id=CVE-2004-0128](https://www.cve.org/CVERecord?id=CVE-2004-0128): Modification of assumed-immutable variable in configuration script leads to file inclusion.
- **CVE-2005-1864** [https://www.cve.org/CVERecord?id=CVE-2005-1864](https://www.cve.org/CVERecord?id=CVE-2005-1864): PHP file inclusion.
- **CVE-2005-1869** [https://www.cve.org/CVERecord?id=CVE-2005-1869](https://www.cve.org/CVERecord?id=CVE-2005-1869): PHP file inclusion.


# Relevant CWE Specifications

## CWE-829: Inclusion of Functionality from Untrusted Control Sphere
**Abstraction:** Base
**Status:** Incomplete

### Description
The product imports, requires, or includes executable functionality (such as a library) from a source that is outside of the intended control sphere.

### Extended Description


When including third-party functionality, such as a web widget, library, or other source of functionality, the product must effectively trust that functionality. Without sufficient protection mechanisms, the functionality could be malicious in nature (either by coming from an untrusted source, being spoofed, or being modified in transit from a trusted source). The functionality might also contain its own weaknesses, or grant access to additional functionality and state information that should be kept private to the base system, such as system state information, sensitive application data, or the DOM of a web application.


This might lead to many different consequences depending on the included functionality, but some examples include injection of malware, information exposure by granting excessive privileges or permissions to the untrusted functionality, DOM-based XSS vulnerabilities, stealing user's cookies, or open redirect to malware (CWE-601).


### Alternative Terms
None

### Relationships
ChildOf -> CWE-669
ChildOf -> CWE-669
ParentOf -> CWE-827
ParentOf -> CWE-830
ParentOf -> CWE-98

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Enforcement by Conversion
- **Description:** 

When the set of acceptable objects, such as filenames or URLs, is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames or URLs, and reject all other inputs.


For example, ID 1 could map to "inbox.txt" and ID 2 could map to "profile.txt". Features such as the ESAPI AccessReferenceMap [REF-45] provide this capability.


**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.




### Observed Examples
- **CVE-2010-2076:** Product does not properly reject DTDs in SOAP messages, which allows remote attackers to read arbitrary files, send HTTP requests to intranet servers, or cause a denial of service.
- **CVE-2004-0285:** Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0030:** Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.



## CWE-425: Direct Request ('Forced Browsing')
**Abstraction:** Base
**Status:** Incomplete

### Description
The web application does not adequately enforce appropriate authorization on all restricted URLs, scripts, or files.

### Extended Description
Web applications susceptible to direct request attacks often make the false assumption that such resources can only be reached through a given navigation path and so only apply authorization at certain points in the path.

### Alternative Terms
forced browsing: The "forced browsing" term could be misinterpreted to include weaknesses such as CSRF or XSS, so its use is discouraged.

### Relationships
ChildOf -> CWE-862
ChildOf -> CWE-862
ChildOf -> CWE-288
ChildOf -> CWE-424
CanPrecede -> CWE-471
CanPrecede -> CWE-98

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Apply appropriate access control authorizations for each access to all restricted URLs, scripts or files.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Consider using MVC based frameworks such as Struts.



### Additional Notes
**[Relationship]** Overlaps Modification of Assumed-Immutable Data (MAID), authorization errors, container errors; often primary to other weaknesses such as XSS and SQL injection.

**[Theoretical]** "Forced browsing" is a step-based manipulation involving the omission of one or more steps, whose order is assumed to be immutable. The application does not verify that the first step was performed successfully before the second step. The consequence is typically "authentication bypass" or "path disclosure," although it can be primary to all kinds of weaknesses, especially in languages such as PHP, which allow external modification of assumed-immutable variables.



### Observed Examples
- **CVE-2022-29238:** Access-control setting in web-based document collaboration tool is not properly implemented by the code, which prevents listing hidden directories but does not prevent direct requests to files in those directories.
- **CVE-2022-23607:** Python-based HTTP library did not scope cookies to a particular domain such that "supercookies" could be sent to any domain on redirect.
- **CVE-2004-2144:** Bypass authentication via direct request.



## CWE-23: Relative Path Traversal
**Abstraction:** Base
**Status:** Draft

### Description
The product uses external input to construct a pathname that should be within a restricted directory, but it does not properly neutralize sequences such as ".." that can resolve to a location that is outside of that directory.

### Extended Description
This allows attackers to traverse the file system to access files or directories that are outside of the restricted directory.

### Alternative Terms
Zip Slip: "Zip slip" is an attack that uses file archives (e.g., ZIP, tar, rar, etc.) that contain filenames with path traversal sequences that cause the files to be written outside of the directory under which the archive is expected to be extracted [REF-1282]. It is most commonly used for relative path traversal (CWE-23) and link following (CWE-59).

### Relationships
ChildOf -> CWE-22
ChildOf -> CWE-22
ChildOf -> CWE-22
ParentOf -> CWE-24
ParentOf -> CWE-25
ParentOf -> CWE-26
ParentOf -> CWE-27
ParentOf -> CWE-28
ParentOf -> CWE-29
ParentOf -> CWE-30
ParentOf -> CWE-31
ParentOf -> CWE-32
ParentOf -> CWE-33
ParentOf -> CWE-34
ParentOf -> CWE-35

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** 

Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a list of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.


When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, "boat" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as "red" or "blue."


Do not rely exclusively on looking for malicious or malformed inputs. This is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, denylists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.


When validating filenames, use stringent allowlists that limit the character set to be used. If feasible, only allow a single "." character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as "/" to avoid CWE-36. Use a list of allowable file extensions, which will help to avoid CWE-434.


Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a denylist, which may be incomplete (CWE-184). For example, filtering "/" is insufficient protection if the filesystem also supports the use of "\" as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if "../" sequences are removed from the ".../...//" string in a sequential fashion, two instances of "../" would be removed from the original string, but the remaining characters would still form the "../" string.


**Mitigation 2:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** 

Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass allowlist validation schemes by introducing dangerous inputs after they have been checked.


Use a built-in path canonicalization function (such as realpath() in C) that produces the canonical version of the pathname, which effectively removes ".." sequences and symbolic links (CWE-23, CWE-59). This includes:


  - realpath() in C

  - getCanonicalPath() in Java

  - GetFullPath() in ASP.NET

  - realpath() or abs_path() in Perl

  - realpath() in PHP






### Observed Examples
- **CVE-2024-37032:** Large language model (LLM) management tool does not validate the format of a digest value (CWE-1287) from a private, untrusted model registry, enabling relative path traversal (CWE-23), a.k.a. Probllama
- **CVE-2022-45918:** Chain: a learning management tool debugger uses external input to locate previous session logs (CWE-73) and does not properly validate the given path (CWE-20), allowing for filesystem path traversal using "../" sequences (CWE-24)
- **CVE-2019-20916:** Python package manager does not correctly restrict the filename specified in a Content-Disposition header, allowing arbitrary file read using path traversal sequences such as "../"



## CWE-184: Incomplete List of Disallowed Inputs
**Abstraction:** Base
**Status:** Draft

### Description
The product implements a protection mechanism that relies on a list of inputs (or properties of inputs) that are not allowed by policy or otherwise require other action to neutralize before additional processing takes place, but the list is incomplete.

### Extended Description
Not provided

### Alternative Terms
Denylist / Deny List: This is used by CWE and CAPEC instead of other commonly-used terms. Its counterpart is allowlist.
Blocklist / Block List: This is often used by security tools such as firewalls, email or web gateways, proxies, etc.
Blacklist / Black List: This term is frequently used, but usage has been declining as organizations have started to adopt other terms.

### Relationships
ChildOf -> CWE-693
ChildOf -> CWE-1023
CanPrecede -> CWE-79
CanPrecede -> CWE-78
CanPrecede -> CWE-434
CanPrecede -> CWE-98
ParentOf -> CWE-692

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** Do not rely exclusively on detecting disallowed inputs. There are too many variants to encode a character, especially when different environments are used, so there is a high likelihood of missing some variants. Only use detection of disallowed inputs as a mechanism for detecting suspicious activity. Ensure that you are using other protection mechanisms that only identify "good" input - such as lists of allowed inputs - and ensure that you are properly encoding your outputs.



### Additional Notes
**[Relationship]** 

Multiple interpretation errors can indirectly introduce inputs that should be disallowed. For example, a list of dangerous shell metacharacters might not include a metacharacter that only has meaning in one particular shell, not all of them; or a check for XSS manipulations might ignore an unusual construct that is supported by one web browser, but not others.




### Observed Examples
- **CVE-2024-4315:** Chain: API for text generation using Large Language Models (LLMs) does not include the "\" Windows folder separator in its denylist (CWE-184) when attempting to prevent Local File Inclusion via path traversal (CWE-22), allowing deletion of arbitrary files on Windows systems.
- **CVE-2008-2309:** product uses a denylist to identify potentially dangerous content, allowing attacker to bypass a warning
- **CVE-2005-2782:** PHP remote file inclusion in web application that filters "http" and "https" URLs, but not "ftp".



## CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
**Abstraction:** Base
**Status:** Stable

### Description
The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.

### Extended Description


Many file operations are intended to take place within a restricted directory. By using special elements such as ".." and "/" separators, attackers can escape outside of the restricted location to access files or directories that are elsewhere on the system. One of the most common special elements is the "../" sequence, which in most modern operating systems is interpreted as the parent directory of the current location. This is referred to as relative path traversal. Path traversal also covers the use of absolute pathnames such as "/usr/local/bin" to access unexpected files. This is referred to as absolute path traversal.


### Alternative Terms
Directory traversal
Path traversal: "Path traversal" is preferred over "directory traversal," but both terms are attack-focused.

### Relationships
ChildOf -> CWE-706
ChildOf -> CWE-706
ChildOf -> CWE-668
CanFollow -> CWE-172
CanFollow -> CWE-20
ParentOf -> CWE-23
ParentOf -> CWE-36
CanFollow -> CWE-73

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** 

Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a list of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.


When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, "boat" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as "red" or "blue."


Do not rely exclusively on looking for malicious or malformed inputs. This is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, denylists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.


When validating filenames, use stringent allowlists that limit the character set to be used. If feasible, only allow a single "." character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as "/" to avoid CWE-36. Use a list of allowable file extensions, which will help to avoid CWE-434.


Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a denylist, which may be incomplete (CWE-184). For example, filtering "/" is insufficient protection if the filesystem also supports the use of "\" as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if "../" sequences are removed from the ".../...//" string in a sequential fashion, two instances of "../" would be removed from the original string, but the remaining characters would still form the "../" string.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.

**Mitigation 3:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** 

Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass allowlist validation schemes by introducing dangerous inputs after they have been checked.


Use a built-in path canonicalization function (such as realpath() in C) that produces the canonical version of the pathname, which effectively removes ".." sequences and symbolic links (CWE-23, CWE-59). This includes:


  - realpath() in C

  - getCanonicalPath() in Java

  - GetFullPath() in ASP.NET

  - realpath() or abs_path() in Perl

  - realpath() in PHP





### Additional Notes
**[Other]** In many programming languages, the injection of a null byte (the 0 or NUL) may allow an attacker to truncate a generated filename to apply to a wider range of files. For example, the product may add ".txt" to any pathname, thus limiting the attacker to text files, but a null injection may effectively remove this restriction.

**[Relationship]** Pathname equivalence can be regarded as a type of canonicalization error.

**[Relationship]** Some pathname equivalence issues are not directly related to directory traversal, rather are used to bypass security-relevant checks for whether a file/directory can be accessed by the attacker (e.g. a trailing "/" on a filename could bypass access rules that don't expect a trailing /, causing a server to provide the file when it normally would not).

**[Terminology]** 

Like other weaknesses, terminology is often based on the types of manipulations used, instead of the underlying weaknesses. Some people use "directory traversal" only to refer to the injection of ".." and equivalent sequences whose specific meaning is to traverse directories.


Other variants like "absolute pathname" and "drive letter" have the *effect* of directory traversal, but some people may not call it such, since it doesn't involve ".." or equivalent.


**[Research Gap]** Many variants of path traversal attacks are probably under-studied with respect to root cause. CWE-790 and CWE-182 begin to cover part of this gap.

**[Research Gap]** 

Incomplete diagnosis or reporting of vulnerabilities can make it difficult to know which variant is affected. For example, a researcher might say that "..\" is vulnerable, but not test "../" which may also be vulnerable.


Any combination of directory separators ("/", "\", etc.) and numbers of "." (e.g. "....") can produce unique variants; for example, the "//../" variant is not listed (CVE-2004-0325). See this entry's children and lower-level descendants.




### Observed Examples
- **CVE-2024-37032:** Large language model (LLM) management tool does not validate the format of a digest value (CWE-1287) from a private, untrusted model registry, enabling relative path traversal (CWE-23), a.k.a. Probllama
- **CVE-2024-4315:** Chain: API for text generation using Large Language Models (LLMs) does not include the "\" Windows folder separator in its denylist (CWE-184) when attempting to prevent Local File Inclusion via path traversal (CWE-22), allowing deletion of arbitrary files on Windows systems.
- **CVE-2022-45918:** Chain: a learning management tool debugger uses external input to locate previous session logs (CWE-73) and does not properly validate the given path (CWE-20), allowing for filesystem path traversal using "../" sequences (CWE-24)



## CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')
**Abstraction:** Variant
**Status:** Draft

### Description
The PHP application receives input from an upstream component, but it does not restrict or incorrectly restricts the input before its usage in "require," "include," or similar functions.

### Extended Description
In certain versions and configurations of PHP, this can allow an attacker to specify a URL to a remote location from which the product will obtain the code to execute. In other cases in association with path traversal, the attacker can specify a local file that may contain executable statements that can be parsed by PHP.

### Alternative Terms
Remote file include
RFI: The Remote File Inclusion (RFI) acronym is often used by vulnerability researchers.
Local file inclusion: This term is frequently used in cases in which remote download is disabled, or when the first part of the filename is not under the attacker's control, which forces use of relative path traversal (CWE-23) attack techniques to access files that may contain previously-injected PHP code, such as web access logs.

### Relationships
ChildOf -> CWE-706
ChildOf -> CWE-829
CanPrecede -> CWE-94
CanAlsoBe -> CWE-426
CanFollow -> CWE-184
CanFollow -> CWE-425
CanFollow -> CWE-456
CanFollow -> CWE-473
CanFollow -> CWE-73

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Enforcement by Conversion
- **Description:** 

When the set of acceptable objects, such as filenames or URLs, is limited or known, create a mapping from a set of fixed input values (such as numeric IDs) to the actual filenames or URLs, and reject all other inputs.


For example, ID 1 could map to "inbox.txt" and ID 2 could map to "profile.txt". Features such as the ESAPI AccessReferenceMap [REF-185] provide this capability.


**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.



### Additional Notes
**[Relationship]** 

This is frequently a functional consequence of other weaknesses. It is usually multi-factor with other factors (e.g. MAID), although not all inclusion bugs involve assumed-immutable data. Direct request weaknesses frequently play a role.


Can overlap directory traversal in local inclusion problems.




### Observed Examples
- **CVE-2004-0285:** Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0030:** Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.
- **CVE-2004-0068:** Modification of assumed-immutable configuration variable in include file allows file inclusion via direct request.

