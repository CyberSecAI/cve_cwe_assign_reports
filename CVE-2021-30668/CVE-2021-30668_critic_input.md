# Critic Input for CVE-2021-30668



# Original Analyzer Input
## Vulnerability Description
This issue was addressed with improved checks. This issue is fixed in macOS Big Sur 11.4. A person with physical access to a Mac may be able to bypass Login Window during a software update.

### Vulnerability Description Key Phrases
- **impact:** bypass Login Window during a software update
- **attacker:** person with physical access to Mac
- **product:** macOS
- **version:** Big Sur 11.4

## CVE Reference Links Content Summary
- **Root cause of vulnerability**: A logic issue in Software Update.
- **Weaknesses/vulnerabilities present**: Improper state management during software updates.
- **Impact of exploitation**: A person with physical access to a Mac may be able to bypass Login Window during a software update.
- **Attack vectors**: Physical access to the Mac during a software update.
- **Required attacker capabilities/position**: Physical access to the target machine.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.3946 | sparse, graph | sparse: 0.065, graph: 1.000 |
| 2 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.3445 | sparse, graph | sparse: 0.067, graph: 0.857 |
| 3 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.2637 | dense, sparse | dense: 0.459, sparse: 0.059 |
| 4 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.2570 | sparse, graph | sparse: 0.055, graph: 0.631 |
| 5 | CWE-288 | Authentication Bypass Using an Alternate Path or Channel | Base | Allowed | 0.2444 | dense, sparse | dense: 0.425, sparse: 0.056 |
| 6 | CWE-277 | Insecure Inherited Permissions | Variant | Allowed | 0.2396 | dense, sparse | dense: 0.449, sparse: 0.061 |
| 7 | CWE-1263 | Improper Physical Access Control | Class | Allowed-with-Review | 0.1779 | dense, sparse | dense: 0.491, sparse: 0.100 |
| 8 | CWE-667 | Improper Locking | Class | Allowed-with-Review | 0.1451 | dense, sparse | dense: 0.420, sparse: 0.064 |
| 9 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.1415 | dense, sparse | dense: 0.418, sparse: 0.055 |
| 10 | CWE-287 | Improper Authentication | Class | Discouraged | 0.1144 | dense, sparse | dense: 0.443, sparse: 0.059 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-288 | Authentication Bypass Using an Alternate Path or Channel | 0.85 | Base | Allowed | Primary CWE |
| CWE-807 | Reliance on Obsolete Input | 0.75 | Base | Allowed | Secondary Candidate CWE |

## Evidence and Confidence

*   **Confidence Score:** 0.80
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**
  - *Explanation:* The vulnerability allows a person with physical access to bypass the Login Window during a software update, indicating an **authentication bypass**. The CVE Reference Links Content Summary indicates a **logic issue in Software Update** leading to improper state management. This aligns with CWE-288 (Authentication Bypass Using an Alternate Path or Channel), as the software update process provides an alternate channel that bypasses the normal login authentication. The "Usage: Allowed" for CWE-288 supports this mapping.
  - *Relationship Analysis:* CWE-288 is a Base level CWE which makes it preferable. CWE-1299 (Missing Protection Mechanism for Alternate Hardware Interface) is a child of CWE-288, but is not a good fit since the bypass is not happening through an alternate hardware interface.

- **Confidence Score:**
  - Confidence: 0.85 (High confidence due to explicit mention of authentication bypass and supporting details.)

---

- **Analysis and Justification:**
  - *Explanation:* CWE-807 (Reliance on Obsolete Input) is a possible secondary candidate since the **logic issue in Software Update** and **improper state management during software updates** may stem from relying on input that can be modified by an untrusted actor (someone with physical access).
  - *Relationship Analysis:* CWE-807 is a base level CWE. The description of the **vulnerability** mentions that person with physical access to Mac can **bypass login window**, therefore, a malicious user is able to modify the input.

- **Confidence Score:**
  - Confidence: 0.75 (Medium confidence as it is less direct than CWE-288 but still relevant given the details.)

---

# CWE Examples from Database


## Known Examples for CWE-807: Reliance on Untrusted Inputs in a Security Decision
### Observed Examples
- **CVE-2009-1549** [https://www.cve.org/CVERecord?id=CVE-2009-1549](https://www.cve.org/CVERecord?id=CVE-2009-1549): Attacker can bypass authentication by setting a cookie to a specific value.
- **CVE-2009-1619** [https://www.cve.org/CVERecord?id=CVE-2009-1619](https://www.cve.org/CVERecord?id=CVE-2009-1619): Attacker can bypass authentication and gain admin privileges by setting an "admin" cookie to 1.
- **CVE-2009-0864** [https://www.cve.org/CVERecord?id=CVE-2009-0864](https://www.cve.org/CVERecord?id=CVE-2009-0864): Content management system allows admin privileges by setting a "login" cookie to "OK."
- **CVE-2008-5784** [https://www.cve.org/CVERecord?id=CVE-2008-5784](https://www.cve.org/CVERecord?id=CVE-2008-5784): e-dating application allows admin privileges by setting the admin cookie to 1.
- **CVE-2008-6291** [https://www.cve.org/CVERecord?id=CVE-2008-6291](https://www.cve.org/CVERecord?id=CVE-2008-6291): Web-based email list manager allows attackers to gain admin privileges by setting a login cookie to "admin."
### Top 25 Examples
- **CVE-2021-20565**: IBM Cloud Pak for Security (CP4S) 1.4.0.0, 1.5.0.0, 1.5.0.1, 1.6.0.0, and 1.6.0.1 uses a protection mechanism that relies on the existence or values of an input, but the input can be modified by an untrusted actor in a way that bypasses the protection mechanism. IBM X-Force ID: 199236.
- **CVE-2021-36777**: A Reliance on Untrusted Inputs in a Security Decision vulnerability in the login proxy of the openSUSE Build service allowed attackers to present users with a expected login form that then sends the clear text credentials to an attacker specified server. This issue affects: openSUSE Build service login-proxy-scripts versions prior to dc000cdfe9b9b715fb92195b1a57559362f689ef.
- **CVE-2021-4314**: It is possible to manipulate the JWT token without the knowledge of the JWT secret and authenticate without valid JWT token as any user. This is happening only in the situation when zOSMF doesn’t have the APAR PH12143 applied. This issue affects: 1.16 versions to 1.19. What happens is that the services using the ZAAS client or the API ML API to query will be deceived into believing the information in the JWT token is valid when it isn’t. It’s possible to use this to persuade the southbound service that different user is authenticated.
- **CVE-2022-23654**: Wiki.js is a wiki app built on Node.js. In affected versions an authenticated user with write access on a restricted set of paths can update a page outside the allowed paths by specifying a different target page ID while keeping the path intact. The access control incorrectly check the path access against the user-provided values instead of the actual path associated to the page ID. Commit https://github.com/Requarks/wiki/commit/411802ec2f654bb5ed1126c307575b81e2361c6b fixes this vulnerability by checking access control on the path associated with the page ID instead of the user-provided value. When the path is different than the current value, a second access control check is then performed on the user-provided path before the move operation.
- **CVE-2022-29518**: Screen Creator Advance2, HMI GC-A2 series, and Real time remote monitoring and control tool Screen Creator Advance2 versions prior to Ver.0.1.1.3 Build01, HMI GC-A2 series(GC-A22W-CW, GC-A24W-C(W), GC-A26W-C(W), GC-A24, GC-A24-M, GC-A25, GC-A26, and GC-A26-J2), and Real time remote monitoring and control tool(Remote GC) allows a local attacker to bypass authentication due to the improper check for the Remote control setting's account names. This may allow attacker who can access the HMI from Real time remote monitoring and control tool may perform arbitrary operations on the HMI. As a result, the information stored in the HMI may be disclosed, deleted or altered, and/or the equipment may be illegally operated via the HMI.


# Relevant CWE Specifications

## CWE-807: Reliance on Untrusted Inputs in a Security Decision
**Abstraction:** Base
**Status:** Incomplete

### Description
The product uses a protection mechanism that relies on the existence or values of an input, but the input can be modified by an untrusted actor in a way that bypasses the protection mechanism.

### Extended Description


Developers may assume that inputs such as cookies, environment variables, and hidden form fields cannot be modified. However, an attacker could change these inputs using customized clients or other attacks. This change might not be detected. When security decisions such as authentication and authorization are made based on the values of these inputs, attackers can bypass the security of the software.


Without sufficient encryption, integrity checking, or other mechanism, any input that originates from an outsider cannot be trusted.


### Alternative Terms
None

### Relationships
ChildOf -> CWE-693
ParentOf -> CWE-302
ParentOf -> CWE-350
ParentOf -> CWE-784

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Attack Surface Reduction
- **Description:** 

Store state information and sensitive data on the server side only.


Ensure that the system definitively and unambiguously keeps track of its own state and user state and has rules defined for legitimate state transitions. Do not allow any application user to affect state directly in any way other than through legitimate actions leading to state transitions.


If information must be stored on the client, do not do so without encryption and integrity checking, or otherwise having a mechanism on the server side to catch tampering. Use a message authentication code (MAC) algorithm, such as Hash Message Authentication Code (HMAC) [REF-529]. Apply this against the state or sensitive data that has to be exposed, which can guarantee the integrity of the data - i.e., that the data has not been modified. Ensure that a strong hash function is used (CWE-328).


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


With a stateless protocol such as HTTP, use a framework that maintains the state for you.


Examples include ASP.NET View State [REF-756] and the OWASP ESAPI Session Management feature [REF-45].


Be careful of language features that provide state support, since these might be provided as a convenience to the programmer and may not be considering security.


**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.




### Observed Examples
- **CVE-2009-1549:** Attacker can bypass authentication by setting a cookie to a specific value.
- **CVE-2009-1619:** Attacker can bypass authentication and gain admin privileges by setting an "admin" cookie to 1.
- **CVE-2009-0864:** Content management system allows admin privileges by setting a "login" cookie to "OK."



## CWE-288: Authentication Bypass Using an Alternate Path or Channel
**Abstraction:** Base
**Status:** Incomplete

### Description
The product requires authentication, but the product has an alternate path or channel that does not require authentication.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-306
ChildOf -> CWE-284
PeerOf -> CWE-420
ParentOf -> CWE-1299
ParentOf -> CWE-425

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** Funnel all access through a single choke point to simplify how users can access a resource. For every access, perform a check to determine if the user has permissions to access the resource.



### Additional Notes
**[Relationship]** overlaps Unprotected Alternate Channel



### Observed Examples
- **CVE-2000-1179:** Router allows remote attackers to read system logs without authentication by directly connecting to the login screen and typing certain control characters.
- **CVE-1999-1454:** Attackers with physical access to the machine may bypass the password prompt by pressing the ESC (Escape) key.
- **CVE-1999-1077:** OS allows local attackers to bypass the password protection of idled sessions via the programmer's switch or CMD-PWR keyboard sequence, which brings up a debugger that the attacker can use to disable the lock.



## CWE-1299: Missing Protection Mechanism for Alternate Hardware Interface
**Abstraction:** Base
**Status:** Draft

### Description
The lack of protections on alternate paths to access
                control-protected assets (such as unprotected shadow registers
                and other external facing unguarded interfaces) allows an
                attacker to bypass existing protections to the asset that are
		only performed against the primary path.

### Extended Description


An asset inside a chip might have access-control protections through one interface. However, if all paths to the asset are not protected, an attacker might compromise the asset through alternate paths. These alternate paths could be through shadow or mirror registers inside the IP core, or could be paths from other external-facing interfaces to the IP core or SoC.


Consider an SoC with various interfaces such as UART, SMBUS, PCIe, USB, etc. If access control is implemented for SoC internal registers only over the PCIe interface, then an attacker could still modify the SoC internal registers through alternate paths by coming through interfaces such as UART, SMBUS, USB, etc. 


Alternatively, attackers might be able to bypass existing protections by exploiting unprotected, shadow registers. Shadow registers and mirror registers typically refer to registers that can be accessed from multiple addresses. Writing to or reading from the aliased/mirrored address has the same effect as writing to the address of the main register. They are typically implemented within an IP core or SoC to temporarily hold certain data. These data will later be updated to the main register, and both registers will be in synch. If the shadow registers are not access-protected, attackers could simply initiate transactions to the shadow registers and compromise system security. 


### Alternative Terms
None

### Relationships
PeerOf -> CWE-1191
ChildOf -> CWE-420
ChildOf -> CWE-288

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Requirements
- **Effectiveness:** Defense in Depth
- **Description:** Protect assets from accesses against all potential interfaces and alternate paths.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Effectiveness:** Defense in Depth
- **Description:** Protect assets from accesses against all potential interfaces and alternate paths.

**Mitigation 3:**
- **Phase:** Implementation
- **Effectiveness:** Defense in Depth
- **Description:** Protect assets from accesses against all potential interfaces and alternate paths.




### Observed Examples
- **CVE-2022-38399:** Missing protection mechanism on serial connection allows for arbitrary OS command execution.
- **CVE-2020-9285:** Mini-PCI Express slot does not restrict direct memory access.
- **CVE-2020-8004:** When the internal flash is protected by blocking access on the Data Bus (DBUS), it can still be indirectly accessed through the Instruction Bus (IBUS).

