# Vulnerability Information: CVE-2020-25668

## Vulnerability Description
A flaw was found in Linux Kernel because **access to the global variable fg_console is not properly synchronized** leading to a use after free in con_font_op.

### Vulnerability Description Key Phrases
- **rootcause:** **access to the global variable fg_console is not properly synchronized**
- **impact:** use after free
- **product:** Linux Kernel
- **component:** con_font_op

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2020-25668:

**1. Verification of CVE Relevance:**

The provided content directly relates to CVE-2020-25668. The vulnerability is described in detail, including the root cause, affected functions, and a Proof-of-Concept (PoC) exploit.

**2. Root Cause of Vulnerability:**

   - A race condition exists in the Linux kernel's virtual terminal (vt) driver, specifically related to the global variable `fg_console` and access to `vc_cons[fg_console]`.
   - The commit  `ca4463bf8438b403596edd0ec961ca0d4fbe0220` was insufficient to handle this race condition.
   - The race occurs when the `fg_console` is changed concurrently with operations on the console font.

**3. Weaknesses/Vulnerabilities Present:**

   - **Use-After-Free (UAF) Read:** The primary vulnerability is a use-after-free read in the `con_font_op` function. Specifically:
      - The function `do_fontx_ioctl` obtains `vc_cons[fg_console]`.
      -  Simultaneously, another thread could use  `ioctl$VT_ACTIVATE` to change the value of `fg_console`.
      -  The old console data  `vc_cons[fg_console]` is freed via `ioctl$VT_DISALLOCATE`.
      - The  `con_font_op` function attempts to access the now freed `vc` pointer.

**4. Impact of Exploitation:**

   - **Denial of Service (DoS):** The use-after-free can cause a kernel crash or memory corruption, leading to a denial of service.
   - **Privilege Escalation:** The vulnerability has the potential to be leveraged for privilege escalation by a local user, though this is described as a possibility rather than a certainty.
   - **Sensitive Information Disclosure:** An out-of-bounds read vulnerability is also mentioned, which could lead to the leak of sensitive kernel information, however, this is related to CVE-2020-28974 not CVE-2020-25668.
   - **Data Modification**: NetApp notes the potential for addition or modification of data, which is likely a consequence of the memory corruption.

**5. Attack Vectors:**

   - Local user access to a virtual terminal (tty) device or having the `CAP_SYS_TTY_CONFIG` capability.
  
**6. Required Attacker Capabilities/Position:**

   - The attacker must be a local user with the ability to access a virtual terminal, or have the `CAP_SYS_TTY_CONFIG` capability to trigger the vulnerability.
   - The attacker requires the ability to use `ioctl` calls to interact with the virtual terminal driver and to control the order of free/use.
   - The PoC uses userfaultfd to control this order.

**Additional Points from the Content:**

- The bug was reported by Yuan Ming and Bodong Zhao from Tsinghua University.
- A patch addressing the issue is available as commit `90bfdeef83f1d6c696039b6a917190dcbbad3220` in the Linux kernel repository.
- NetApp's advisory `NTAP-20210702-0005` also addresses this vulnerability in their products, however, some products have been marked as "Won't Fix".
- Debian LTS advisory `DLA-2494-1` and `DLA 2483-1` cover this CVE.
- The `PIO_FONTX` ioctl is involved in triggering the UAF by interacting with the console font.
- The bug also affects other functions that read or write to `vc_cons[fg_console]`.
- The advisory from netapp mentions a CVSS score of 7.0, with a vector `CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.7122 | dense, sparse, graph | dense: 0.496, sparse: 0.186, graph: 1.000 |
| 2 | CWE-416 | Use After Free | Variant | Allowed | 0.5890 | dense, sparse, graph | dense: 0.524, sparse: 0.168, graph: 0.782 |
| 3 | CWE-364 | Signal Handler Race Condition | Base | Allowed | 0.4573 | sparse, graph | sparse: 0.174, graph: 1.000 |
| 4 | CWE-123 | Write-what-where Condition | Base | Allowed | 0.4370 | sparse, graph | sparse: 0.161, graph: 0.965 |
| 5 | CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | 0.3566 | dense, sparse, graph | dense: 0.525, sparse: 0.204, graph: 0.636 |
| 6 | CWE-606 | Unchecked Input for Loop Condition | Base | Allowed | 0.3522 | sparse, graph | sparse: 0.186, graph: 0.687 |
| 7 | CWE-909 | Missing Initialization of Resource | Class | Allowed-with-Review | 0.3448 | dense, sparse, graph | dense: 0.508, sparse: 0.184, graph: 0.635 |
| 8 | CWE-911 | Improper Update of Reference Count | Base | Allowed | 0.3367 | dense, sparse | dense: 0.465, sparse: 0.181 |
| 9 | CWE-820 | Missing Synchronization | Base | Allowed | 0.3264 | sparse, graph | sparse: 0.189, graph: 0.611 |
| 10 | CWE-401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | 0.3101 | dense, sparse | dense: 0.482, sparse: 0.166 |

