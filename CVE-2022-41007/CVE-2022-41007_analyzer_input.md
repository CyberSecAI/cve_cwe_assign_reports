# Vulnerability Information: CVE-2022-41007

## Vulnerability Description
Several **stack-based buffer overflow** vulnerabilities exist in the DetranCLI command parsing functionality of Siretta QUARTZ-GOLD G5.0.1.5-210720-141020. A specially-crafted network packet can lead to arbitrary command execution. An attacker can send a sequence of requests to trigger these vulnerabilities.This buffer overflow is in the function that manages the port redirect protocol (tcp|udp|tcp/udp) inport dstaddr A.B.C.D export description WORD command template.

### Vulnerability Description Key Phrases
- **rootcause:** **stack-based buffer overflow**
- **impact:** arbitrary command execution
- **product:** Siretta QUARTZ-GOLD
- **version:** G5.0.1.5-210720-141020
- **component:** DetranCLI command parsing functionality

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-120

#### Top CWEs
- CWE-120 (Count: 117)
- CWE-787 (Count: 41)

## CVE Reference Links Content Summary
The provided content is related to CVE-2022-41007.

**Root cause of vulnerability:**
The root cause is a stack-based buffer overflow in the `DetranCLI` command parsing functionality of the Siretta QUARTZ-GOLD router. Specifically, the `sprintf` function is used to format command parameters into a stack buffer, but the size of the input parameters is not checked against the buffer's size.

**Weaknesses/vulnerabilities present:**
The vulnerability is a classic buffer overflow (CWE-120). The `DetranCLI` binary uses `sprintf` to format user-controlled parameters into fixed-size stack buffers without validating the length of the input.

**Impact of exploitation:**
Successful exploitation can lead to arbitrary command execution on the affected device.

**Attack vectors:**
The attack vector is sending specially crafted network packets to the device. These packets contain commands with parameters designed to overflow the stack buffers in vulnerable functions.

**Required attacker capabilities/position:**
The attacker needs to be able to send network packets to the device. The CVSS score indicates that the attacker needs to have high privileges (`PR:H`) to exploit this vulnerability.
The specific command template for this CVE is:
```
port redirect protocol (tcp|udp|tcp/udp) inport <1-65535> dstaddr A.B.C.D export <1-65535> description WORD
```
The vulnerable code snippet is:
```
sprintf(buff_0x80,"%d<%d<%s<%s<%s<%s>",1,based_on_argv[0],atoi_argv[1],argv[2],atoi_argv[3],argv[4]);
```
The vulnerability is triggered by providing a long `argv[4]` string (description) that overflows the `buff_0x80` buffer.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 1.0954 | dense, sparse, graph | dense: 0.693, sparse: 0.903, graph: 0.794 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.8111 | dense, sparse, graph | dense: 0.565, sparse: 0.361, graph: 0.900 |
| 3 | CWE-193 | Off-by-one Error | Base | Allowed | 0.8029 | dense, sparse, graph | dense: 0.553, sparse: 0.347, graph: 0.918 |
| 4 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5028 | dense, sparse | dense: 0.662, sparse: 0.373 |
| 5 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.4865 | dense, sparse | dense: 0.548, sparse: 0.371 |
| 6 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.4731 | dense, sparse | dense: 0.603, sparse: 0.300 |
| 7 | CWE-170 | Improper Null Termination | Base | Allowed | 0.4585 | sparse, graph | sparse: 0.308, graph: 0.789 |
| 8 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.4580 | dense, sparse | dense: 0.545, sparse: 0.324 |
| 9 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.4444 | dense, sparse | dense: 0.582, sparse: 0.332 |
| 10 | CWE-401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | 0.4314 | dense, sparse | dense: 0.575, sparse: 0.314 |

