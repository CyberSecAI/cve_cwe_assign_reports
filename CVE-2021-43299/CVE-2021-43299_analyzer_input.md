# Vulnerability Information: CVE-2021-43299

## Vulnerability Description
Stack overflow in PJSUA API when calling pjsua_player_create. An attacker-controlled filename argument may cause a buffer overflow since it is copied to a fixed-size stack buffer without any size validation.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **attacker:** attacker
- **product:** PJSUA
- **component:** pjsua_player_create

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability described by CVE-2021-43299:

**Root cause of vulnerability:**
- A stack buffer overflow occurs in the PJSUA API when the `pjsua_player_create` function is called.

**Weaknesses/vulnerabilities present:**
- The `filename` argument passed to `pjsua_player_create` is copied to a fixed-size stack buffer without proper size validation. This allows for a buffer overflow if the provided filename exceeds the buffer's capacity.

**Impact of exploitation:**
- A stack buffer overflow can lead to a crash of the application, potentially resulting in a denial-of-service (DoS) condition.
- It is also possible that arbitrary code execution could be achieved if the overflow can be carefully crafted.

**Attack vectors:**
- The vulnerability is triggered by supplying a long filename argument to the `pjsua_player_create` API.

**Required attacker capabilities/position:**
- The attacker needs to be able to control the `filename` argument passed to the `pjsua_player_create` function. This could be through a configuration file, user input, or any mechanism where the application reads and uses filenames.

**Additional details:**

- The vulnerability is present in pjproject versions 2.11.1 and below, and is fixed in version 2.12 or later.
- A similar vulnerability was found in the `pjsua_recorder_create` and `pjsua_playlist_create` functions, which are fixed by the same patch.
- A workaround would be to validate the size of the filenames before calling the vulnerable API.
- The CVSS score for this vulnerability is 9.8 (Critical) with a vector of CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
- The weakness is categorized as CWE-121 (Stack-based Buffer Overflow) and CWE-787 (Out-of-bounds Write)

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6552 | dense, sparse, graph | dense: 0.507, sparse: 0.173, graph: 0.845 |
| 2 | CWE-1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | 0.6399 | dense, sparse, graph | dense: 0.512, sparse: 0.168, graph: 0.805 |
| 3 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.5970 | dense, sparse, graph | dense: 0.472, sparse: 0.200, graph: 0.768 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5448 | dense, sparse, graph | dense: 0.510, sparse: 0.156, graph: 0.687 |
| 5 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.5295 | dense, sparse, graph | dense: 0.481, sparse: 0.173, graph: 0.655 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4327 | sparse, graph | sparse: 0.189, graph: 0.908 |
| 7 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3638 | sparse, graph | sparse: 0.189, graph: 0.715 |
| 8 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3523 | dense, sparse | dense: 0.522, sparse: 0.210 |
| 9 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.3409 | dense, sparse | dense: 0.491, sparse: 0.166 |
| 10 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3364 | dense, sparse | dense: 0.489, sparse: 0.160 |

