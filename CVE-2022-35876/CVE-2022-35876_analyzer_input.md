# Vulnerability Information: CVE-2022-35876

## Vulnerability Description
Four **format string injection** vulnerabilities exist in the XCMD testWifiAP functionality of Abode Systems, Inc. iota All-In-One Security Kit 6.9X and 6.9Z. Specially-crafted configuration values can lead to **memory corruption**, **information disclosure** and denial of service. An attacker can modify a configuration value and then execute an XCMD to trigger these vulnerabilities.This vulnerability arises from **format string injection** via the `default_key_id` and `key` configuration parameters, as used within the `testWifiAP` XCMD handler

### Vulnerability Description Key Phrases
- **rootcause:** **format string injection**
- **weakness:** **memory corruption and information disclosure**
- **impact:** denial of service
- **product:** Abode Systems iota All-In-One Security Kit
- **version:** 6.9X and 6.9Z
- **component:** XCMD testWifiAP functionality

## CVE Reference Links Content Summary
The provided content is related to CVE-2022-35876.

**Root Cause:**
The root cause is a format string injection vulnerability in the `log` function, which is used for logging diagnostic messages to the UART console. The `log` function uses `vsnprintf` with a user-controlled format string, allowing an attacker to inject format specifiers and potentially leak stack memory or cause memory corruption.

**Weaknesses/Vulnerabilities:**
- **CWE-134:** Use of Externally-Controlled Format String
- The `do_test_wifiap` function constructs OS commands to configure the device's Wi-Fi using the `vsnprintf_nullterm` function. The `command` buffer, which becomes the format string in a call to the `log` function, contains attacker-controlled data obtained from various Wi-Fi configuration parameters, specifically `config->default_key_id` and `config->key` when the authentication mode is WEP or SHARED.

**Impact of Exploitation:**
- **Memory Corruption:** By controlling the format string, an attacker could potentially write to arbitrary memory locations.
- **Information Disclosure:** By using format string specifiers such as `%x`, an attacker can potentially leak stack memory.
- **Denial of Service:**  Memory corruption can lead to crashes and denial of service.

**Attack Vectors:**
- The vulnerability can be triggered via the `testWifiAP` XCMD, which does not expect any parameters.
- The attacker needs to modify the configuration parameters, specifically  `WL_DefaultKeyID` and `WL_Key` prior to triggering the vulnerable `testWifiAP` XCMD.
- These configuration values can be modified through the mobile application, web application, the `setWifiAP` XCMD or via the `/action/wirelessPost` or `/action/configPost` endpoints of the device's local web interface.
- The vulnerable code is executed after receiving the XCMD over UDP/55050, which does not require authentication.

**Required Attacker Capabilities/Position:**
- The attacker needs to have network access to the device on UDP/55050 to execute the `testWifiAP` XCMD.
- The attacker does not need authentication to the device or the XMPP server to trigger the vulnerability.
- The attacker must be able to modify Wi-Fi configuration values, which can be done by any of the aforementioned mechanisms.
- The output of the format string vulnerability is only visible on the physical UART console, so a physical presence and knowledge of disassembly is needed for a more severe exploit.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-134 | Use of Externally-Controlled Format String | Base | Allowed | 1.1742 | dense, sparse, graph | dense: 0.697, sparse: 1.000, graph: 0.709 |
| 2 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.6651 | sparse, graph | sparse: 0.538, graph: 1.000 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6550 | sparse, graph | sparse: 0.594, graph: 0.882 |
| 4 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6164 | dense, sparse | dense: 0.609, sparse: 0.545 |
| 5 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.5932 | sparse, graph | sparse: 0.529, graph: 0.813 |
| 6 | CWE-798 | Use of Hard-coded Credentials | Base | Allowed | 0.5851 | dense, sparse | dense: 0.569, sparse: 0.525 |
| 7 | CWE-259 | Use of Hard-coded Password | Variant | Allowed | 0.5397 | dense, sparse | dense: 0.566, sparse: 0.527 |
| 8 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.4547 | sparse, graph | sparse: 0.302, graph: 0.789 |
| 9 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.4412 | dense, sparse | dense: 0.568, sparse: 0.311 |
| 10 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.2979 | sparse | sparse: 0.521 |

