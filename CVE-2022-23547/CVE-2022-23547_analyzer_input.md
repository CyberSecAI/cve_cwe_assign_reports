# Vulnerability Information: CVE-2022-23547

## Vulnerability Description
PJSIP is a free and open source multimedia communication library written in C language implementing standard based protocols such as SIP, SDP, RTP, STUN, TURN, and ICE. This issue is similar to GHSA-9pfh-r8x4-w26w. Possible **buffer overread** when parsing a certain STUN message. The vulnerability affects applications that uses STUN including PJNATH and PJSUA-LIB. The patch is available as commit in the master branch.

### Vulnerability Description Key Phrases
- **weakness:** **buffer overread**
- **vector:** certain STUN message
- **product:** PJSIP

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2022-23547:

**Root Cause of Vulnerability:**
The vulnerability stems from a heap buffer overflow during the parsing of STUN (Session Traversal Utilities for NAT) error code attributes within a STUN message. The issue arises specifically when handling the error reason string, where a missing length check before copying the string to the attribute leads to a potential over-read.

**Weaknesses/Vulnerabilities Present:**
- **Heap Buffer Overflow:**  Specifically, the `decode_errcode_attr` function in `pjnath/src/pjnath/stun_msg.c` is vulnerable. The code does not properly validate the length of the error reason string against the available buffer, leading to a read beyond the allocated memory.
- **Missing Length Check:** The code fails to ensure that the attribute length is sufficient before attempting to copy the error reason string using `pj_strdup`.
- **Integer Parsing Issue:** The commit message also mentions a fix for "uint parsing", this suggests an issue might have existed during the parsing of unsigned integer values within the STUN message

**Impact of Exploitation:**
- **Buffer Overread:** An attacker can craft a malicious STUN message with a manipulated error code attribute that causes the application to read beyond the allocated buffer.
- **Denial of Service (DoS) and potentially Remote Code Execution (RCE):** Although not explicitly stated, a heap buffer over-read can potentially cause a crash or lead to other memory corruption issues that an attacker might leverage.

**Attack Vectors:**
- **Malicious STUN Message:** An attacker needs to send a specially crafted STUN message to a vulnerable application. This message would include an error code attribute with a crafted length.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker must have network access to send STUN messages to the vulnerable application.
- **STUN Knowledge:** The attacker needs to understand the STUN protocol and be able to construct malicious STUN messages with the vulnerable attributes.

**Additional Information:**

- The vulnerability affects applications using STUN, specifically including PJNATH and PJSUA-LIB which are part of the PJSIP project.
- The fix was implemented in commit `bc4812d`.
- The vulnerability is a continuation of `GHSA-9pfh-r8x4-w26w` suggesting an earlier similar vulnerability was found.
- The issue was reported by Google's OSS-Fuzz.
- The affected versions are 2.13 or lower. The patched version is 2.13.1

The provided content contains more details than the official CVE description, particularly around the vulnerable function, the affected libraries, and the attack vector.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.6509 | dense, sparse, graph | dense: 0.492, sparse: 0.427, graph: 0.600 |
| 2 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6098 | dense, sparse, graph | dense: 0.449, sparse: 0.253, graph: 0.672 |
| 3 | CWE-415 | Double Free | Variant | Allowed | 0.3740 | sparse, graph | sparse: 0.224, graph: 0.776 |
| 4 | CWE-754 | Improper Check for Unusual or Exceptional Conditions | Class | Allowed-with-Review | 0.3618 | dense, sparse, graph | dense: 0.442, sparse: 0.305, graph: 0.617 |
| 5 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3610 | dense, sparse | dense: 0.444, sparse: 0.243 |
| 6 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3583 | dense, sparse | dense: 0.494, sparse: 0.247 |
| 7 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3554 | dense, sparse | dense: 0.458, sparse: 0.221 |
| 8 | CWE-401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | 0.3491 | dense, sparse | dense: 0.506, sparse: 0.218 |
| 9 | CWE-193 | Off-by-one Error | Base | Allowed | 0.3409 | dense, sparse | dense: 0.432, sparse: 0.218 |
| 10 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3361 | dense, sparse | dense: 0.468, sparse: 0.227 |

