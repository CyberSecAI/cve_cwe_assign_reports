# Vulnerability Information: CVE-2020-28482

## Vulnerability Description
This affects the package fastify-csrf before 3.0.0. 1. The generated cookie used insecure defaults, and did not have the httpOnly flag on cookieOpts { path /, sameSite true } 2. The CSRF token was available in the GET query parameter

### Vulnerability Description Key Phrases
- **impact:** CSRF vulnerability
- **vector:** CSRF token in GET query parameter
- **product:** fastify-csrf
- **version:** before 3.0.0

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2020-28482:

**Root Cause of Vulnerability:**

The vulnerability stems from insecure default settings in the `fastify-csrf` package regarding how CSRF protection was implemented:

*   **Insecure Cookie Defaults:** The generated cookie lacked the `httpOnly` flag.
*   **CSRF Token in GET Query:** The CSRF token was made available in the GET query parameter.

**Weaknesses/Vulnerabilities Present:**

*   **Cross-Site Request Forgery (CSRF):** The primary vulnerability is CSRF, which allows attackers to potentially execute unauthorized actions on behalf of a user.
*   **Lack of HttpOnly Cookie Flag:** The absence of the `httpOnly` flag on the CSRF cookie made it accessible to client-side scripts, increasing the risk of the token being stolen via cross-site scripting (XSS) attacks.
*   **CSRF Token in GET Parameters:** Exposing the CSRF token in the GET query parameter makes it vulnerable to exposure through various mechanisms like browser history, server logs and referrer headers.

**Impact of Exploitation:**

Successful exploitation of this vulnerability could allow an attacker to perform actions on a web application that the user is authenticated to perform, including data manipulation or unauthorized transactions, without the user's knowledge or consent. The impact includes potential loss of confidentiality due to the exposed token and the integrity impact can range from low to high depending on the specific application's vulnerability.

**Attack Vectors:**

*   An attacker could craft a malicious web page containing a form that targets the vulnerable application and forces a logged-in user to submit the form with malicious data, because the attacker can retrieve the CSRF token from GET query or via XSS if the token is exposed due to lack of httpOnly cookie flag.
*   If the CSRF token is in a GET parameter, this token could be exposed via the referrer header and server logs, etc, enabling the attacker to use this token in a malicious request

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to make network requests to the vulnerable application.
*   **User Interaction:** The attack requires the user to visit a malicious website or perform some action that the attacker controls (e.g., clicking a link).
*   **Ability to Craft Malicious Requests:** The attacker needs to be able to craft HTTP requests that target the vulnerable application and include the correct CSRF token, or to leverage an XSS attack.

**Additional Information:**

*   The vulnerability is present in `fastify-csrf` versions prior to 3.0.0.
*   The fix involves removing the support for the token in the query parameter, and making the cookie `httpOnly` by default.
*   The suggested mitigation is to upgrade `fastify-csrf` to version 3.0.0 or higher.
*  The Snyk CVSS score is 5.9 (Medium) and NVD CVSS score is 8.8 (High).
*  The provided content includes a link to the related GitHub pull request which introduced the fix

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1275 | Sensitive Cookie with Improper SameSite Attribute | Variant | Allowed | 0.5486 | dense, sparse, graph | dense: 0.568, sparse: 0.050, graph: 0.786 |
| 2 | CWE-352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | 0.4142 | dense, sparse, graph | dense: 0.455, sparse: 0.063, graph: 0.769 |
| 3 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.3904 | sparse, graph | sparse: 0.058, graph: 1.000 |
| 4 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.3006 | sparse, graph | sparse: 0.053, graph: 0.757 |
| 5 | CWE-1004 | Sensitive Cookie Without 'HttpOnly' Flag | Variant | Allowed | 0.2989 | dense, sparse | dense: 0.534, sparse: 0.099 |
| 6 | CWE-614 | Sensitive Cookie in HTTPS Session Without 'Secure' Attribute | Variant | Allowed | 0.2677 | dense, sparse | dense: 0.517, sparse: 0.055 |
| 7 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.2552 | sparse, graph | sparse: 0.052, graph: 0.631 |
| 8 | CWE-1188 | Initialization of a Resource with an Insecure Default | Base | Allowed | 0.2298 | dense, sparse | dense: 0.404, sparse: 0.048 |
| 9 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.1938 | sparse, graph | sparse: 0.048, graph: 0.465 |
| 10 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.0296 | sparse | sparse: 0.052 |

