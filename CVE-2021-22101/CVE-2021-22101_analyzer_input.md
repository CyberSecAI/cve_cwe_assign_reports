# Vulnerability Information: CVE-2021-22101

## Vulnerability Description
Cloud Controller versions prior to 1.118.0 are vulnerable to unauthenticated denial of Service(DoS) vulnerability allowing unauthenticated attackers to cause denial of service by using REST HTTP requests with label_selectors on multiple V3 endpoints by generating an enormous SQL query.

### Vulnerability Description Key Phrases
- **impact:** denial of service
- **vector:** REST HTTP requests with label_selectors
- **attacker:** unauthenticated attackers
- **product:** Cloud Controller
- **version:** prior to 1.118.0
- **component:** multiple V3 endpoints

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described in CVE-2021-22101:

**Root Cause of Vulnerability:**
The vulnerability lies in how the Cloud Controller handles REST HTTP requests with `label_selectors` on multiple V3 endpoints. Specifically, the processing of these requests leads to the generation of extremely large SQL queries.

**Weaknesses/Vulnerabilities Present:**
- Unauthenticated Denial of Service (DoS): The system is susceptible to DoS attacks due to the inefficient processing of crafted requests.
- Inefficient SQL query generation: The application generates massive SQL queries when processing specific requests, causing the database to become unavailable.

**Impact of Exploitation:**
- Denial of Service: Attackers can cause the Cloud Controller's database (ccdb) to become unavailable, preventing legitimate users from accessing the system. This leads to a disruption of the overall service.

**Attack Vectors:**
- REST HTTP requests: Attackers exploit the vulnerability by sending specially crafted HTTP requests to multiple V3 endpoints.
- `label_selectors`: The requests include `label_selectors` parameters which trigger the generation of the problematic SQL queries.

**Required Attacker Capabilities/Position:**
- Unauthenticated access: The attacker does not need to authenticate to exploit this vulnerability. They can send the malicious requests from any network location reachable by the vulnerable Cloud Controller instance.

**Affected Products and Versions:**
- CAPI: All versions prior to 1.118.0
- CF Deployment: All versions prior to 16.24.0

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.6632 | dense, sparse, graph | dense: 0.542, sparse: 0.060, graph: 1.000 |
| 2 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.5157 | dense, sparse, graph | dense: 0.534, sparse: 0.062, graph: 0.597 |
| 3 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.3655 | sparse, graph | sparse: 0.056, graph: 0.932 |
| 4 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.2900 | dense, sparse | dense: 0.518, sparse: 0.054 |
| 5 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.1701 | dense, sparse | dense: 0.518, sparse: 0.053 |
| 6 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.1613 | sparse, graph | sparse: 0.060, graph: 0.911 |
| 7 | CWE-400 | Uncontrolled Resource Consumption | Class | Discouraged | 0.1421 | dense, sparse | dense: 0.558, sparse: 0.067 |
| 8 | CWE-285 | Improper Authorization | Class | Discouraged | 0.1288 | dense, sparse | dense: 0.515, sparse: 0.053 |
| 9 | CWE-287 | Improper Authentication | Class | Discouraged | 0.1270 | dense, sparse | dense: 0.503, sparse: 0.056 |
| 10 | CWE-284 | Improper Access Control | Pillar | Discouraged | 0.0982 | dense, sparse | dense: 0.523, sparse: 0.054 |

