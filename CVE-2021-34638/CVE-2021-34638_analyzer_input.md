# Vulnerability Information: CVE-2021-34638

## Vulnerability Description
Authenticated Directory Traversal in WordPress Download Manager <= 3.1.24 allows authenticated (Contributor+) users to obtain sensitive configuration file information, as well as allowing Author+ users to perform XSS attacks, by setting Download template to a file containing configuration information or an uploaded JavaScript with an image extension This issue affects WordPress Download Manager version 3.1.24 and prior versions.

### Vulnerability Description Key Phrases
- **weakness:** **cross-site scripting**
- **attacker:** WordPress Download Manager users
- **product:** WordPress Download Manager
- **version:** <= 3.1.24

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** Insufficient directory traversal protection in the WordPress Download Manager plugin. The plugin allows users to use templates to change how download pages are displayed.
- **Weaknesses/vulnerabilities present:**
    - Authenticated Directory Traversal: The plugin did not properly sanitize the `file[page_template]` parameter, allowing a user to traverse directories and access sensitive files like `wp-config.php`.
    - Stored Cross-Site Scripting (XSS): Due to the contents of `file[page_template]` being echoed into the page source, an attacker could upload a file with a malicious javascript and use this parameter to execute malicious javascript.
- **Impact of exploitation:**
    - Information disclosure: An attacker can retrieve sensitive information like database credentials from the `wp-config.php` file.
    - Site takeover: By obtaining database credentials or executing JavaScript in an administrator's browser session, an attacker can take over the site.
- **Attack vectors:**
    - The vulnerability is exploited by adding a new download and performing a directory traversal attack using the `file[page_template]` parameter.
    - Uploading a file with malicious JavaScript content with an image extension and setting the `file[page_template]` to the path of the uploaded file to perform XSS.
- **Required attacker capabilities/position:**
    - The attacker needs to have at least contributor-level permissions to perform directory traversal and access sensitive information.
    - Author level permissions or higher are needed to upload files and perform stored XSS.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.7746 | dense, sparse, graph | dense: 0.558, sparse: 0.293, graph: 0.917 |
| 2 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.7131 | dense, sparse, graph | dense: 0.564, sparse: 0.242, graph: 0.818 |
| 3 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.6946 | dense, sparse, graph | dense: 0.498, sparse: 0.299, graph: 0.767 |
| 4 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.6215 | dense, sparse, graph | dense: 0.516, sparse: 0.257, graph: 0.604 |
| 5 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.3958 | dense, sparse | dense: 0.505, sparse: 0.250 |
| 6 | CWE-36 | Absolute Path Traversal | Base | Allowed | 0.3922 | dense, sparse | dense: 0.521, sparse: 0.230 |
| 7 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.3904 | dense, sparse | dense: 0.516, sparse: 0.231 |
| 8 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.3855 | dense, sparse | dense: 0.498, sparse: 0.238 |
| 9 | CWE-352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | 0.3511 | dense, sparse | dense: 0.589, sparse: 0.283 |
| 10 | CWE-862 | Missing Authorization | Class | Allowed-with-Review | 0.2470 | dense, sparse | dense: 0.545, sparse: 0.258 |

