# Vulnerability Information: CVE-2022-30040

## Vulnerability Description
Tenda AX1803 v1.0.0.1_2890 is vulnerable to Buffer Overflow. The vulnerability lies in rootfs_ In / goform / setsystimecfg of / bin / tdhttpd in ubif file system, attackers can access http//ip/goform/SetSysTimeCfg, and by setting the ntpserve parameter, the **stack buffer overflow** can be caused to achieve the effect of router denial of service.

### Vulnerability Description Key Phrases
- **weakness:** **stack buffer overflow**
- **impact:** denial of service
- **vector:** setting ntpserve parameter
- **attacker:** attackers
- **product:** Tenda AX1803
- **version:** v1.0.0.1_2890
- **component:** http//ip/goform/SetSysTimeCfg in ubif file system

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**
The vulnerability is caused by a stack buffer overflow in the `fromsetsystime` function within the `/bin/tdhttpd` binary of the Tenda AX1803 router's firmware.

**Weaknesses/Vulnerabilities:**
- **Stack Buffer Overflow:** The `strcpy` function is used to copy the `ntpserver` parameter from a POST request into a fixed-size buffer (`v32`) on the stack, without any bounds checking. This allows an attacker to overwrite adjacent memory on the stack if the input exceeds the buffer's capacity.
- **Uncontrolled Input:** The `ntpserver` parameter is directly taken from a POST request, making it vulnerable to manipulation by an attacker.

**Impact of Exploitation:**
- **Denial of Service (DoS):** By overflowing the stack buffer, an attacker can overwrite the return address of the `fromsetsystime` function. This can cause the program to crash or execute arbitrary code. In the context of this router, the crash typically leads to a router restart, effectively causing a denial-of-service condition.

**Attack Vectors:**
- **HTTP POST Request:** The attack vector is an HTTP POST request to the `/goform/SetSysTimeCfg` endpoint.
- **`ntpserver` Parameter:** The attacker must provide a malicious value to the `ntpserver` parameter in the POST request that is large enough to overflow the stack buffer.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker must have network access to the router's web interface. This can either be local or remote depending on the network configuration.
- **Knowledge of Endpoint:** The attacker needs to know the vulnerable endpoint (`/goform/SetSysTimeCfg`) and the vulnerable parameter (`ntpserver`).
- **No Authentication Mentioned:** The provided information implies no authentication is needed to exploit this issue. However, the provided POC has a `Cookie: password=...`, so this may require more investigation.

**Technical Details:**

- The vulnerable code is located within the `fromsetsystime` function of the `/bin/tdhttpd` binary.
- The `strcpy(&V32[16], B4)` statement is the location of the buffer overflow. `V32` is a stack variable, and `B4` is a pointer to the attacker-controlled `ntpserver` parameter.
- The provided pseudo code includes another vulnerable function `fromSetIpMacBind` that contains a separate stack buffer overflow via the `list` parameter.

**Additional Notes:**

- The provided POC shows that sending an `ntpServer` parameter with a value of 'a' repeated more than `0x134` times triggers the crash.
- The provided content includes a detailed analysis of the vulnerable code section in assembly/pseudo-C form.
- The affected firmware version is Tenda AX1803 v1.0.0.1_2890.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6557 | dense, sparse, graph | dense: 0.593, sparse: 0.241, graph: 0.618 |
| 2 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.5021 | sparse, graph | sparse: 0.253, graph: 1.000 |
| 3 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4909 | dense, sparse | dense: 0.655, sparse: 0.356 |
| 4 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.4257 | sparse, graph | sparse: 0.236, graph: 0.813 |
| 5 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4086 | dense, sparse | dense: 0.532, sparse: 0.248 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4006 | dense, sparse | dense: 0.525, sparse: 0.241 |
| 7 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3990 | dense, sparse | dense: 0.526, sparse: 0.237 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3914 | dense, sparse | dense: 0.549, sparse: 0.261 |
| 9 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.3705 | dense, sparse | dense: 0.539, sparse: 0.230 |
| 10 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.3569 | sparse, graph | sparse: 0.263, graph: 0.578 |

