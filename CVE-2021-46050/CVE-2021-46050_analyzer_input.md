# Vulnerability Information: CVE-2021-46050

## Vulnerability Description
A **Stack Overflow** vulnerability exists in Binaryen 103 via the printf_common function.

### Vulnerability Description Key Phrases
- **weakness:** **Stack Overflow**
- **product:** Binaryen
- **version:** 103
- **component:** printf_common function

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:** The root cause is a stack overflow vulnerability triggered by excessive nesting of try-catch blocks in the WebAssembly binary being processed by `wasm-ctor-eval`. The excessive nesting leads to a very deep call stack that exceeds the available stack space causing a stack overflow during the execution of `__vfprintf_internal`.

**Weaknesses/Vulnerabilities:**
- Stack overflow: The program attempts to allocate more space on the stack than is available. This happens due to a large number of nested function calls originating from deeply nested try-catch blocks.

**Impact of Exploitation:**
- Segmentation fault: The stack overflow leads to a segmentation fault, crashing the application. The program terminates abnormally.
- Denial of Service: A malicious actor could craft a WebAssembly binary that causes the application to crash, thus causing a denial of service.

**Attack Vectors:**
- Malicious WebAssembly Binary: The vulnerability is triggered by processing a specially crafted WebAssembly binary with excessive nesting of try-catch blocks. The attacker provides the malicious binary to `wasm-ctor-eval`.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to provide a malicious WebAssembly binary to the `wasm-ctor-eval` tool. This could be done in scenarios where the tool processes untrusted or user-provided WebAssembly code.

**Technical Details:**

- The crash occurs within the `__vfprintf_internal` function, which is part of the standard C library used for formatted output. This function is called by `wasm::WasmBinaryBuilder::getNextLabel()`, which is part of the Binaryen library.
- The backtrace clearly shows the deep nesting of calls within `wasm::WasmBinaryBuilder` methods, specifically related to processing `try` and `block` expressions.
- The issue arises after around 6625 nested try-catch blocks as noted in the comment.
- The vulnerability is manifested as a stack overflow and the program crashes with a segmentation fault.
- Valgrind identified the stack overflow condition.

The provided content gives more detailed information than a typical CVE description. It includes a specific test case (POC4.zip), the backtrace of the crash, and an explanation of the root cause by a developer.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.5566 | dense, sparse, graph | dense: 0.541, sparse: 0.070, graph: 0.688 |
| 2 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5153 | dense, sparse, graph | dense: 0.550, sparse: 0.062, graph: 0.692 |
| 3 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3997 | sparse, graph | sparse: 0.074, graph: 1.000 |
| 4 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3862 | sparse, graph | sparse: 0.082, graph: 1.000 |
| 5 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.3473 | sparse, graph | sparse: 0.072, graph: 0.857 |
| 6 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3176 | sparse, graph | sparse: 0.062, graph: 0.789 |
| 7 | CWE-676 | Use of Potentially Dangerous Function | Base | Allowed | 0.3051 | dense, sparse | dense: 0.534, sparse: 0.066 |
| 8 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3039 | dense, sparse | dense: 0.529, sparse: 0.068 |
| 9 | CWE-193 | Off-by-one Error | Base | Allowed | 0.3015 | dense, sparse | dense: 0.522, sparse: 0.071 |
| 10 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.3008 | dense, sparse | dense: 0.529, sparse: 0.063 |

