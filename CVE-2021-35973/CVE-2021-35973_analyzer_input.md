# Vulnerability Information: CVE-2021-35973

## Vulnerability Description
NETGEAR WAC104 devices before 1.0.4.15 are affected by an **authentication bypass vulnerability** in /usr/sbin/mini_httpd, allowing an unauthenticated attacker to invoke any action by adding the &currentsetting.htm substring to the HTTP query, a related issue to CVE-2020-27866. This directly allows the attacker to change the web UI password, and eventually to enable debug mode (telnetd) and gain a shell on the device as the admin limited-user account (however, escalation to root is simple because of weak permissions on the /etc/ directory).

### Vulnerability Description Key Phrases
- **weakness:** **authentication bypass vulnerability**
- **impact:** change web UI password, enable debug mode, gain a shell
- **vector:** adding &currentsetting.htm substring to HTTP query
- **attacker:** unauthenticated attacker
- **product:** NETGEAR WAC104 devices
- **version:** before 1.0.4.15
- **component:** /usr/sbin/mini_httpd

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

*   The root cause is a combination of multiple vulnerabilities in the NETGEAR WAC104 access point's firmware. The vulnerabilities, when chained together, allow an attacker to gain a root shell on the device.

**Weaknesses/Vulnerabilities Present:**

1.  **HTTP Authentication Bypass (mini\_httpd):**
    *   The device uses a flag to skip authentication checks based on certain conditions in the HTTP request.
    *   The flag is set when specific substrings ("setupwizard.cgi", "currentsetting.htm") or a specific SOAPAction header are found in the request URI or headers.
    *   The vulnerability allows an attacker to bypass authentication by inserting a null byte (`%00`) before "currentsetting.htm" in the URI or by adding `currentsetting.htm` as a query parameter.
    *   This bypass grants access to any CGI script through a GET request.

2.  **.bss section Buffer Overflow in HTTP header processing (mini\_httpd):**
    *   A buffer overflow exists in the processing of the "SOAPAction:" HTTP header.
    *   The code copies data from the header into a fixed-size buffer without proper bounds checking.
    *   This vulnerability is considered less exploitable because it causes the server to exit early. However, it may be possible to exploit it to obtain read/write capabilities.

3.  **Unverified Password Change (setup.cgi):**
    *   The `setup.cgi` script has an action (`con_save_passwd`) that allows changing the admin password in NVRAM without requiring the old password.
    *   This action is accessible via GET requests, and does not have CSRF protection.
    *   The password change needs a reboot to propagate to /etc/passwd and /etc/htpasswd files.

4.  **Session ID Verification Bypass (setup.cgi):**
    *   `setup.cgi` checks if a session ID in a POST request matches the ID stored in a session file.
    *   The file name is derived from the `sp` parameter in the request, and can be manipulated.
    *   If the session file does not exist the function returns 0. This allows an attacker to send `id=0&sp=ABC` and bypass the session check.
    *   The session ID is 32 bits, which is easily brute-forcible.

5.  **/tmp/etc Directory Permission Issue:**
    *   The `/tmp/etc` directory has permissions set to 777.
    *   Although `admin` user cannot modify `/etc/passwd` directly, they can rename it due to the directory permissions. This allows them to add a new user with root privileges.

**Impact of Exploitation:**

*   An attacker can gain a root shell on the device.
*   The device can be completely taken over.
*   Allows for full control over the device and network.
*   Can be used for further attacks or lateral movement inside the network.

**Attack Vectors:**

*   **LAN-based attack:** An attacker within the same local network can exploit the vulnerabilities directly via HTTP.
*   **Internet-based reflected attack:** An attacker can trick a user on the LAN to visit a malicious website. This website can then send HTTP requests to the router to exploit the auth bypass.

**Required Attacker Capabilities/Position:**

*   **LAN-based attacker:** Must be on the same local network as the vulnerable device.
*   **Internet-based reflected attack:** Needs to lure a user on the LAN to visit a malicious website or cause them to open a malicious link.

**Additional Details:**

*   The vulnerability is a missed variant of a previously known vulnerability in other NETGEAR devices.
*   The exploit chain involves multiple steps, such as bypassing authentication, changing the password, and exploiting the directory permission issue to gain root privileges.
*   The report also includes a proof-of-concept exploit in Python.
*   The device firmware code quality was deemed poor.
*   The advisory also mentions the WNDR3700v5 model might be vulnerable, but no fix is coming.

This information provides a comprehensive understanding of the CVE-2021-35973 vulnerability, exceeding the basic description provided in a typical CVE entry.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.7401 | dense, sparse, graph | dense: 0.588, sparse: 0.394, graph: 0.617 |
| 2 | CWE-288 | Authentication Bypass Using an Alternate Path or Channel | Base | Allowed | 0.7328 | dense, sparse, graph | dense: 0.612, sparse: 0.358, graph: 0.620 |
| 3 | CWE-1188 | Initialization of a Resource with an Insecure Default | Base | Allowed | 0.6993 | dense, sparse, graph | dense: 0.596, sparse: 0.361, graph: 0.543 |
| 4 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.6712 | dense, sparse, graph | dense: 0.572, sparse: 0.357, graph: 0.506 |
| 5 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.6702 | dense, sparse, graph | dense: 0.565, sparse: 0.362, graph: 0.660 |
| 6 | CWE-259 | Use of Hard-coded Password | Variant | Allowed | 0.6432 | dense, sparse, graph | dense: 0.597, sparse: 0.376, graph: 0.512 |
| 7 | CWE-187 | Partial String Comparison | Variant | Allowed | 0.5121 | sparse, graph | sparse: 0.659, graph: 0.498 |
| 8 | CWE-798 | Use of Hard-coded Credentials | Base | Allowed | 0.5009 | dense, sparse | dense: 0.570, sparse: 0.377 |
| 9 | CWE-1390 | Weak Authentication | Class | Allowed-with-Review | 0.2333 | sparse, graph | sparse: 0.380, graph: 0.503 |
| 10 | CWE-287 | Improper Authentication | Class | Discouraged | 0.2293 | dense, sparse | dense: 0.585, sparse: 0.384 |

