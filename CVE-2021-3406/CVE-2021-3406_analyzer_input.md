# Vulnerability Information: CVE-2021-3406

## Vulnerability Description
A flaw was found in keylime 5.8.1 and older. The issue in the Keylime agent and registrar code invalidates the cryptographic chain of trust from the Endorsement Key certificate to agent attestations.

### Vulnerability Description Key Phrases
- **rootcause:** **invalid cryptographic chain of trust**
- **product:** keylime
- **version:** 5.8.1 and older
- **component:** Keylime agent and registrar code

## CVE Reference Links Content Summary
```json
{
  "CVE-2021-3406": {
    "Description": "A flaw was found in keylime 5.8.1 and older. The issue in the Keylime agent and registrar code invalidates the cryptographic chain of trust from the Endorsement Key certificate to agent attestations.",
    "Root cause": "The Keylime agent and registrar code did not properly validate the cryptographic chain of trust.",
    "Vulnerabilities": [
      "The 'ek_tpm' used for encryption was not verified against the public key in 'ek' or 'ekcert'.",
      "No checks were performed between 'pub_aik' and 'aik_name'.",
        "No checks on the object attributes of the Attestation Key were performed."
    ],
    "Impact": "An attacker could bypass the cryptographic chain of trust by providing a generated key as 'ek_tpm', a random key as 'pub_aik', and using the 'aik_name' of a trusted TPM object.",
    "Attack vectors": [
      "Manipulating the 'ek_tpm' value.",
      "Providing a generated key as 'pub_aik'.",
      "Using the 'aik_name' of a key on a trusted TPM without proper verification."
      ],
    "Required attacker capabilities": "Ability to generate keys in system memory (unprotected),  and knowledge of how to craft messages that bypass the verification checks."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-296 | Improper Following of a Certificate's Chain of Trust | Base | Allowed | 0.7060 | dense, sparse, graph | dense: 0.563, sparse: 0.356, graph: 0.616 |
| 2 | CWE-295 | Improper Certificate Validation | Base | Allowed | 0.5813 | dense, sparse, graph | dense: 0.484, sparse: 0.211, graph: 0.611 |
| 3 | CWE-325 | Missing Cryptographic Step | Base | Allowed | 0.5682 | dense, sparse, graph | dense: 0.511, sparse: 0.173, graph: 0.598 |
| 4 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.5467 | dense, sparse, graph | dense: 0.481, sparse: 0.173, graph: 0.579 |
| 5 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.3074 | dense, sparse | dense: 0.463, sparse: 0.178 |
| 6 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.1883 | dense, sparse | dense: 0.458, sparse: 0.159 |
| 7 | CWE-392 | Missing Report of Error Condition | Base | Allowed | 0.0924 | sparse | sparse: 0.162 |
| 8 | CWE-276 | Incorrect Default Permissions | Base | Allowed | 0.0917 | sparse | sparse: 0.160 |
| 9 | CWE-331 | Insufficient Entropy | Base | Allowed | 0.0916 | sparse | sparse: 0.160 |
| 10 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.0903 | sparse | sparse: 0.158 |

