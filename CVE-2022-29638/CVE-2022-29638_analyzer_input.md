# Vulnerability Information: CVE-2022-29638

## Vulnerability Description
TOTOLINK A3100R V4.1.2cu.5050_B20200504 and V4.1.2cu.5247_B20211129 were discovered to contain a **stack overflow** via the comment parameter in the function setIpQosRules. This vulnerability allows attackers to cause a Denial of Service (DoS) via a crafted POST request.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **impact:** Denial of Service (DoS)
- **vector:** crafted POST request
- **attacker:** attackers
- **product:** TOTOLINK A3100R
- **version:** V4.1.2cu.5050_B20200504 and V4.1.2cu.5247_B20211129
- **component:** setIpQosRules function

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 28)
- CWE-NVD-noinfo (Count: 9)
- CWE-120 (Count: 1)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root cause of vulnerability:**
- The `setIpQosRules` function in the `firewall.so` module of TOTOLINK A3100R firmware does not properly validate the length of the user-provided "comment" parameter before using it in a `strcpy` operation.

**Weaknesses/vulnerabilities present:**
- **Stack-based buffer overflow:** The lack of bounds checking on the "comment" parameter during the `strcpy` operation allows an attacker to write past the allocated buffer on the stack.

**Impact of exploitation:**
- **Denial of Service (DoS):** The provided Proof of Concept (POC) demonstrates that by sending a crafted POST request with an oversized "comment" parameter, the device becomes unstable, leading to a denial-of-service condition.

**Attack vectors:**
- **HTTP POST request:** The vulnerability is triggered by sending a malicious POST request to the `/cgi-bin/cstecgi.cgi` endpoint.
- **Specifically crafted "comment" parameter:** The attacker needs to include an overly long string in the "comment" field of the POST request's JSON payload to cause the overflow.

**Required attacker capabilities/position:**
- **Network Access:** The attacker needs to be able to send HTTP requests to the device. This typically implies being on the same network as the router or having remote access to it.
- **Knowledge of the vulnerable endpoint:** The attacker must know that the `setIpQosRules` function via the `setting/setIpQosRules` topicurl is vulnerable and which parameters to exploit.
- **Ability to craft HTTP requests:** The attacker must be able to send properly formatted HTTP POST requests with the necessary parameters and the oversized comment parameter.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6170 | dense, sparse, graph | dense: 0.585, sparse: 0.228, graph: 0.542 |
| 2 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4524 | dense, sparse | dense: 0.654, sparse: 0.284 |
| 3 | CWE-259 | Use of Hard-coded Password | Variant | Allowed | 0.3997 | dense, sparse | dense: 0.582, sparse: 0.248 |
| 4 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.3683 | dense, sparse | dense: 0.525, sparse: 0.184 |
| 5 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3545 | dense, sparse | dense: 0.526, sparse: 0.159 |
| 6 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.3433 | dense, sparse | dense: 0.527, sparse: 0.167 |
| 7 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3335 | dense, sparse | dense: 0.529, sparse: 0.169 |
| 8 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.3290 | dense, sparse | dense: 0.522, sparse: 0.166 |
| 9 | CWE-790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | 0.2525 | dense, sparse | dense: 0.590, sparse: 0.235 |
| 10 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.2238 | dense, sparse | dense: 0.529, sparse: 0.203 |

