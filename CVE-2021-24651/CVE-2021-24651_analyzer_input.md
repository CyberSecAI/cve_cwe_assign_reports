# Vulnerability Information: CVE-2021-24651

## Vulnerability Description
The Poll Maker WordPress plugin before 3.4.2 allows unauthenticated users to perform **SQL injection** via the ays_finish_poll AJAX action. While the result is not disclosed in the response, it is possible to use a timing attack to exfiltrate data such as password hash.

### Vulnerability Description Key Phrases
- **weakness:** **SQL injection**
- **attacker:** unauthenticated users
- **product:** Poll Maker WordPress plugin
- **version:** before 3.4.2
- **component:** ays_finish_poll AJAX action

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

*   **Root Cause:** The vulnerability is due to a lack of proper input sanitization in the `ays_finish_poll` AJAX action, allowing unauthenticated users to inject arbitrary SQL queries.

*   **Weaknesses/Vulnerabilities:**
    *   **SQL Injection:** The plugin is vulnerable to SQL injection via the `answer` parameter in the `ays_finish_poll` AJAX action. This allows attackers to manipulate database queries.
    *   **Unauthenticated Access:** The vulnerability can be exploited by unauthenticated users, which is a major security flaw.
    *   **Time-Based SQL Injection:** Although the direct results of the SQL query are not revealed, an attacker can use time delays (e.g., with `SLEEP()`) in the injected SQL to exfiltrate data, such as user password hashes, through a timing attack.
*   **Impact of Exploitation:**
    *   **Data Exfiltration:** Attackers can extract sensitive information from the database, including user credentials (password hashes).
    *   **Potential for Further Attacks:** Successfully exploiting SQL injection may allow for further attacks on the website including complete compromise of the site.
*   **Attack Vectors:**
    *   The primary attack vector is through the `ays_finish_poll` AJAX action which accepts the `answer` parameter.
    *   The attacker uses a crafted POST request via `jQuery.post` to inject malicious SQL code through the `answer` parameter.
*   **Required Attacker Capabilities/Position:**
    *   The attacker does not need to be authenticated.
    *   The attacker needs to be able to send HTTP POST requests to the server.
    *   The attacker needs to obtain a valid nonce, which can be found on a page with a published poll (value of the `ays_finish_poll` hidden input).
    *   The attacker needs to use timing attack techniques to deduce the response from the database as a direct output of the query is not exposed.

**Technical Details:**

*   The attacker uses the `UNION SELECT` statement to append their malicious query to the original query of the `ays_finish_poll` action.
*   The attacker uses the `SLEEP()` function to introduce time delays.
*   The attacker uses `LIKE` statements with `CHAR()` function, which allows the attacker to create specific patterns and bypass magic quotes.
*   The provided Proof of Concept (PoC) demonstrates how to use a time-based attack to determine if a user exists or if a user password hash starts with a specific string.
*   The vulnerable code exists within the `poll-maker` plugin version less than `3.4.2`.

The content is related to CVE-2021-24651 and provides more details than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.6400 | dense, sparse, graph | dense: 0.444, sparse: 0.197, graph: 0.852 |
| 2 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.6017 | dense, sparse, graph | dense: 0.462, sparse: 0.271, graph: 0.604 |
| 3 | CWE-96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | 0.5306 | dense, sparse, graph | dense: 0.446, sparse: 0.179, graph: 0.574 |
| 4 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.5208 | dense, sparse, graph | dense: 0.434, sparse: 0.202, graph: 0.526 |
| 5 | CWE-352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | 0.4454 | dense, sparse, graph | dense: 0.513, sparse: 0.222, graph: 0.546 |
| 6 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.3254 | sparse, graph | sparse: 0.174, graph: 0.631 |
| 7 | CWE-208 | Observable Timing Discrepancy | Base | Allowed | 0.3236 | dense, sparse | dense: 0.431, sparse: 0.189 |
| 8 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.3168 | dense, sparse | dense: 0.416, sparse: 0.190 |
| 9 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.2812 | sparse, graph | sparse: 0.174, graph: 0.545 |
| 10 | CWE-862 | Missing Authorization | Class | Allowed-with-Review | 0.1907 | dense, sparse | dense: 0.428, sparse: 0.193 |

