# Vulnerability Information: CVE-2021-22922

## Vulnerability Description
When curl is instructed to download content using the metalink feature, thecontents is verified against a hash provided in the metalink XML file.The metalink XML file points out to the client how to get the same contentfrom a set of different URLs, potentially hosted by different servers and theclient can then download the file from one or several of them. In a serial orparallel manner.If one of the servers hosting the contents has been breached and the contentsof the specific file on that server is replaced with a modified payload, curlshould detect this when the hash of the file mismatches after a completeddownload. It should remove the contents and instead try getting the contentsfrom another URL. This is not done, and instead such a hash mismatch is onlymentioned in text and the potentially malicious content is kept in the file ondisk.

### Vulnerability Description Key Phrases
- **weakness:** **download of malicious content**
- **vector:** malicious content in metalink XML file
- **product:** curl
- **component:** metalink feature

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information related to CVE-2021-22922:

**Root Cause of Vulnerability:**

*   The vulnerability lies in how `curl` handles Metalink files. When a Metalink file specifies multiple URLs for downloading content, `curl` verifies the downloaded content against a hash provided in the Metalink file. However, if a downloaded file from one of the URLs has a hash mismatch, `curl` does not discard the file. Instead, it keeps the potentially malicious content, even though a hash mismatch indicates that it's corrupted/modified, and only mentions the hash mismatch in a text message.

**Weaknesses/Vulnerabilities Present:**

*   **Improper Input Validation:** `curl` does not properly validate the integrity of downloaded content when using Metalink. It fails to discard content with mismatched hashes, which could be malicious.
*   **Lack of Automatic Fallback:** Instead of automatically discarding a file with a hash mismatch and attempting download from other URLs in Metalink file, curl stops after receiving the first file.

**Impact of Exploitation:**

*   **Delivery of malicious content:**  An attacker could potentially compromise one of the servers listed in the Metalink file, replace the legitimate content with malicious content and cause `curl` to download the altered, malicious file, while still displaying a hash mismatch message.
*   **User Misinterpretation:** The user might miss the hash mismatch message and believe that the file is correct.

**Attack Vectors:**

*   A Man-in-the-Middle (MitM) attack is not required, the attack can be done by compromising one of the servers hosting the file listed in the Metalink file.
*   The attack vector involves exploiting a flaw in how `curl` processes Metalink files when downloading content from multiple sources specified in the file.

**Required Attacker Capabilities/Position:**

*   The attacker must be able to compromise at least one of the servers hosting content specified in the Metalink XML file.
*   The attacker needs to be able to replace the legitimate file with a malicious version on the compromised server.
*   The attacker's server must be among the mirrors/locations listed in the Metalink file that `curl` uses.

**Additional Notes:**

*   This vulnerability exists only in the `curl` tool, not in the `libcurl` library.
*   The vulnerability exists from `curl` version 7.27.0 up to and including 7.77.0.
*   The `curl` project decided to remove Metalink support in version 7.78.0 instead of fixing the issue.
*   The issue is identified as CWE-354, which is "Improper Validation of Integrity Check Value."
*   The vulnerability is classified as having medium severity.

The information provided here is more detailed than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-390 | Detection of Error Condition Without Action | Base | Allowed | 0.9053 | sparse, graph | sparse: 1.000, graph: 0.932 |
| 2 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.6933 | sparse, graph | sparse: 0.587, graph: 1.000 |
| 3 | CWE-319 | Cleartext Transmission of Sensitive Information | Base | Allowed | 0.6339 | sparse, graph | sparse: 0.635, graph: 0.757 |
| 4 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.6059 | sparse, graph | sparse: 0.586, graph: 0.757 |
| 5 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.3335 | sparse | sparse: 0.583 |
| 6 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.3300 | sparse | sparse: 0.577 |
| 7 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.3266 | sparse | sparse: 0.571 |
| 8 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.3241 | sparse | sparse: 0.567 |
| 9 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.3221 | sparse | sparse: 0.563 |
| 10 | CWE-611 | Improper Restriction of XML External Entity Reference | Base | Allowed | 0.3219 | sparse | sparse: 0.563 |

