# Vulnerability Information: CVE-2022-36448

## Vulnerability Description
An issue was discovered in Insyde InsydeH2O with kernel 5.0 through 5.5. There is an **SMM memory corruption** vulnerability in the Software SMI handler in the PnpSmm driver.

### Vulnerability Description Key Phrases
- **weakness:** **SMM memory corruption**
- **product:** Insyde InsydeH2O
- **version:** kernel 5.0 through 5.5
- **component:** PnpSmm driver

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described by CVE-2022-36448:

**Root Cause:**

*   The vulnerability lies within the PnpSmm driver of InsydeH2O UEFI firmware, specifically in a Software SMI handler.
*   The handler processes a NVRAM variable called `IhisiParamBuffer`, which contains an address. This address is used to write a predictable value, with insufficient validation.

**Weaknesses/Vulnerabilities Present:**

*   **SMM Memory Corruption:** The core issue is that the SMI handler writes to a memory location specified by the `IhisiParamBuffer` variable without properly validating that the address is within a safe range. This allows a controlled write to System Management RAM (SMRAM).
*   **Unvalidated Address:** The vulnerability stems from using a user-controlled address from the `IhisiParamBuffer` NVRAM variable without proper checks.
*   **Predictable Write:** The vulnerability allows writing a predictable value.

**Impact of Exploitation:**

*   **Privilege Escalation:** An attacker can elevate privileges from ring 0 (OS kernel) to ring -2 (System Management Mode, SMM).
*   **Arbitrary Code Execution in SMM:** Exploiting the vulnerability allows arbitrary code execution within the SMM environment. SMM has higher privileges than the OS.
*   **Firmware Backdoor/Implant:** Successful exploitation bypasses SMM-based SPI flash protections, enabling an attacker to install a persistent firmware backdoor/implant into the BIOS that can survive OS reinstalls.
*  **Bypass Security Mechanisms:** The vulnerability can be leveraged to bypass UEFI firmware security mechanisms such as Secure Boot and memory isolation for hypervisors.
*   **Denial of Service (DoS):** Writing to an arbitrary memory location can also lead to a denial-of-service.

**Attack Vectors:**

*   The vulnerability is triggered through a Software SMI handler (SwSmiInputValue = 0x47).
*   The attacker must be able to modify the `IhisiParamBuffer` NVRAM variable to set the target address.

**Required Attacker Capabilities/Position:**

*   **Local Access:** The attacker likely needs local access to the system to manipulate NVRAM and trigger the vulnerability.
*   **Elevated Privileges:** The attacker likely needs elevated privileges, such as administrative rights or the ability to write to NVRAM.
*   **Knowledge of SMM:** An attacker would need knowledge of how to trigger the specific SMI handler and the structure of the data involved.

**Additional Information:**

*   The vulnerability was discovered by the Binarly efiXplorer team.
*   Affected InsydeH2O firmware versions:
    * Kernel 5.0-5.3: Unaffected
    * Kernel 5.4: Fixed in version 05.44.30
    * Kernel 5.5: Fixed in version 05.52.30
*   The vulnerability is identified as BRLY-2022-023 by Binarly.
*   The FwHunt rule for this vulnerability is available at [BRLY-2022-023](https://github.com/binarly-io/FwHunt/blob/main/rules/Vulnerabilities/Insyde/BRLY-2022-023.yml).

This information provides a more detailed description of the vulnerability than the basic CVE description placeholder.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.7885 | dense, sparse, graph | dense: 0.609, sparse: 0.220, graph: 1.000 |
| 2 | CWE-822 | Untrusted Pointer Dereference | Base | Allowed | 0.7696 | dense, sparse, graph | dense: 0.566, sparse: 0.225, graph: 1.000 |
| 3 | CWE-1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | 0.4420 | dense, sparse | dense: 0.619, sparse: 0.231 |
| 4 | CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | 0.3662 | sparse, graph | sparse: 0.167, graph: 0.757 |
| 5 | CWE-908 | Use of Uninitialized Resource | Base | Allowed | 0.3648 | dense, sparse | dense: 0.570, sparse: 0.139 |
| 6 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.3608 | sparse, graph | sparse: 0.137, graph: 0.789 |
| 7 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.3573 | dense, sparse | dense: 0.556, sparse: 0.139 |
| 8 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3295 | dense, sparse | dense: 0.554, sparse: 0.139 |
| 9 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3261 | sparse, graph | sparse: 0.134, graph: 0.698 |
| 10 | CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | 0.2122 | dense, sparse | dense: 0.552, sparse: 0.149 |

