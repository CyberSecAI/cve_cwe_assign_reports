# Vulnerability Information: CVE-2022-25218

## Vulnerability Description
The use of the RSA algorithm without OAEP, or any other padding scheme, in telnetd_startup, allows an unauthenticated attacker on the local area network to achieve a significant degree of control over the plaintext to which an arbitrary blob of ciphertext will be decrypted by OpenSSLs RSA_public_decrypt() function. This weakness allows the attacker to manipulate the various iterations of the telnetd startup state machine and eventually obtain a root shell on the device, by means of an exchange of crafted UDP packets. In all versions but K2 22.5.9.163 and K3C 32.1.15.93 a successful attack also requires the exploitation of a null-byte interaction error (CVE-2022-25219).

### Vulnerability Description Key Phrases
- **rootcause:** **use of RSA algorithm without padding scheme**
- **impact:** significant degree of control over plaintext and manipulate telnetd startup state machine and obtain root shell
- **vector:** exchange of crafted UDP packets
- **attacker:** unauthenticated attacker on local area network
- **version:** all versions but K2 22.5.9.163 and K3C 32.1.15.93
- **component:** telnetd_startup

## CVE Reference Links Content Summary
The provided content is related to CVE-2022-25218.

**Root Cause of Vulnerability:**

The root cause of the vulnerability lies within the flawed implementation of the `telnetd_startup` backdoor protocol in Phicomm routers. This backdoor is designed to allow a client with a specific RSA private key to launch a telnet service for remote access. The vulnerability arises from the server-side logic, where the server decrypts an encrypted message using a hardcoded public RSA key and then XORs the decrypted data with a secret plaintext to generate an ephemeral password. Due to the use of `sprintf` with the `%s` format specifier, a carefully crafted encrypted message can produce a null byte at the beginning of the XORed data. This results in an empty string when the XORed data is used to construct the ephemeral password, leading to a predictable password that allows unauthorized access.

**Weaknesses/Vulnerabilities Present:**

1.  **Insecure Backdoor:** The `telnetd_startup` service, intended for backdoor access, is not properly secured.
2.  **Flawed Cryptographic Implementation:** The use of a hardcoded public key and the flawed handling of decrypted data in the ephemeral password generation process are major weaknesses.
3.  **Predictable Password Generation:** The vulnerability allows an attacker to force a predictable password by crafting a specific encrypted payload, resulting in a null byte injection.
4.  **Lack of Rate Limiting:** There's no rate limiting mechanism, allowing an attacker to repeatedly try to connect to the backdoor to exploit this vulnerability.
5.  **Hardcoded Credentials:** The content also mentions hardcoded credentials ("root:admin") for the UART console in K3C routers, which can be used by attackers with physical access.

**Impact of Exploitation:**

Successful exploitation of the `telnetd_startup` vulnerability allows an attacker to:

*   Gain a root shell on the affected device.
*   Execute arbitrary commands on the router.
*   Completely control the router.

**Attack Vectors:**

*   **Network-Based Attack:** An attacker on the local network can exploit the `telnetd_startup` vulnerability by sending specifically crafted UDP packets to port 21210.
*   **Physical Access (UART Console):** An attacker with physical access to K3C routers can exploit the unprotected UART console with hardcoded credentials to gain root access.

**Required Attacker Capabilities/Position:**

*   **Local Network Access:** For exploiting the `telnetd_startup` backdoor, an attacker needs to be on the same local network as the vulnerable router.
*   **Physical Access:** To exploit the UART console vulnerability, an attacker needs physical access to the router device.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-780 | Use of RSA Algorithm without OAEP | Variant | Allowed | 1.0742 | dense, sparse, graph | dense: 0.772, sparse: 1.000, graph: 0.575 |
| 2 | CWE-321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | 0.6762 | dense, sparse, graph | dense: 0.515, sparse: 0.557, graph: 0.436 |
| 3 | CWE-203 | Observable Discrepancy | Base | Allowed | 0.6412 | sparse, graph | sparse: 0.585, graph: 0.857 |
| 4 | CWE-208 | Observable Timing Discrepancy | Base | Allowed | 0.6278 | sparse, graph | sparse: 0.473, graph: 1.000 |
| 5 | CWE-319 | Cleartext Transmission of Sensitive Information | Base | Allowed | 0.4996 | dense, sparse | dense: 0.471, sparse: 0.461 |
| 6 | CWE-626 | Null Byte Interaction Error (Poison Null Byte) | Variant | Allowed | 0.4270 | sparse, graph | sparse: 0.541, graph: 0.429 |
| 7 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.4092 | dense, sparse, graph | dense: 0.497, sparse: 0.545, graph: 0.380 |
| 8 | CWE-328 | Use of Weak Hash | Base | Allowed | 0.3956 | sparse, graph | sparse: 0.467, graph: 0.359 |
| 9 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.2740 | sparse | sparse: 0.479 |
| 10 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.2698 | sparse | sparse: 0.472 |

