# Critic Input for CVE-2021-27306



# Original Analyzer Input
## Vulnerability Description
An **improper access control** vulnerability in the JWT plugin in Kong Gateway prior to 2.3.2.0 allows unauthenticated users access to authenticated routes without a valid token JWT.

### Vulnerability Description Key Phrases
- **rootcause:** **improper access control**
- **impact:** access to authenticated routes without a valid token JWT
- **attacker:** unauthenticated users
- **product:** Kong Gateway
- **version:** prior to 2.3.2.0
- **component:** JWT plugin

## CVE Reference Links Content Summary
```json
{
  "0": {
    "Root cause of vulnerability": "Kong API Gateway prior to 2.3.2.0 does not normalize the incoming request URI before matching against the Router. This allowed an attacker to bypass authentication by using an unauthenticated route with a path traversal.",
    "Weaknesses/vulnerabilities present": "Path traversal vulnerability, authentication bypass, and incorrect subroute inheritance.",
    "Impact of exploitation": "Access to an authenticated route without proper authentication.",
    "Attack vectors": "Sending a request to an unauthenticated route with a path traversal like `public/../api/v1/customers`.",
    "Required attacker capabilities/position": "The attacker needs to be able to send requests to a Kong API Gateway that uses the JWT plugin and has an unauthenticated route. Also, the attacker requires a service or proxy in the middle which normalizes the path and send the request to the application."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.5631 | dense, sparse, graph | dense: 0.523, sparse: 0.144, graph: 0.613 |
| 2 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.3862 | sparse, graph | sparse: 0.155, graph: 0.832 |
| 3 | CWE-639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | 0.3342 | dense, sparse | dense: 0.501, sparse: 0.145 |
| 4 | CWE-425 | Direct Request ('Forced Browsing') | Base | Allowed | 0.3296 | dense, sparse | dense: 0.499, sparse: 0.139 |
| 5 | CWE-807 | Reliance on Untrusted Inputs in a Security Decision | Base | Allowed | 0.2999 | sparse, graph | sparse: 0.162, graph: 0.580 |
| 6 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.2824 | dense, sparse, graph | dense: 0.508, sparse: 0.157, graph: 0.382 |
| 7 | CWE-57 | Path Equivalence: 'fakedir/../realdir/filename' | Variant | Allowed | 0.2613 | sparse, graph | sparse: 0.227, graph: 0.429 |
| 8 | CWE-287 | Improper Authentication | Class | Discouraged | 0.2222 | dense, sparse, graph | dense: 0.515, sparse: 0.177, graph: 0.384 |
| 9 | CWE-862 | Missing Authorization | Class | Allowed-with-Review | 0.1953 | dense, sparse | dense: 0.509, sparse: 0.136 |
| 10 | CWE-522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | 0.1934 | dense, sparse | dense: 0.493, sparse: 0.145 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-306 | Missing Authentication for Critical Function | 0.85 | Base | Allowed | Primary CWE |
| CWE-57 | Path Equivalence: 'fakedir/../realdir/filename' | 0.65 | Variant | Allowed | Secondary Candidate |

## Evidence and Confidence

*   **Confidence Score:** 0.75
*   **Evidence Strength:** MEDIUM

- **Analysis and Justification:**  
  - *Explanation:* The vulnerability involves an **improper access control** issue in the JWT plugin of Kong Gateway, allowing unauthenticated users to access authenticated routes without a valid JWT. This directly aligns with **CWE-306** [Missing Authentication for Critical Function], as the system fails to properly authenticate users before granting access to sensitive functionalities. The CVE reference summary highlights that the Kong API Gateway doesn't normalize the incoming request URI, leading to an authentication bypass via path traversal, which further supports the relevance of authentication issues.
  - *Explanation:* The vulnerability also involves a path traversal issue. According to the CVE reference, the root cause of the vulnerability is that "Kong API Gateway prior to 2.3.2.0 does not normalize the incoming request URI before matching against the Router. This allowed an attacker to bypass authentication by using an unauthenticated route with a path traversal." This is a textbook case of **CWE-57** [Path Equivalence: 'fakedir/../realdir/filename'], since the path traversal allows the attacker to bypass the protection mechanisms in place.

  - *Relationship Analysis:* **CWE-306** is a base-level weakness indicating a lack of authentication. It's related to **CWE-287** [Improper Authentication], but **CWE-306** is more specific since it highlights the *absence* of authentication, rather than an incorrect implementation. **CWE-57** could lead to **CWE-425** [Direct Request ('Forced Browsing')] since the path traversal allows attackers to access restricted resources directly.

- **Confidence Score:**  
  - Confidence: 0.85 (High confidence for CWE-306 due to direct match with vulnerability description and CVE details).
  - Confidence: 0.65 (Medium confidence for CWE-57 due to dependency on external factors like path normalization and the presence of unauthenticated routes)

---

# CWE Examples from Database


## Known Examples for CWE-57: Path Equivalence: 'fakedir/../realdir/filename'
### Observed Examples
- **CVE-2001-1152** [https://www.cve.org/CVERecord?id=CVE-2001-1152](https://www.cve.org/CVERecord?id=CVE-2001-1152): Proxy allows remote attackers to bypass denylist restrictions and connect to unauthorized web servers by modifying the requested URL, including (1) a // (double slash), (2) a /SUBDIR/.. where the desired file is in the parentdir, (3) a /./, or (4) URL-encoded characters.
- **CVE-2000-0191** [https://www.cve.org/CVERecord?id=CVE-2000-0191](https://www.cve.org/CVERecord?id=CVE-2000-0191): application check access for restricted URL before canonicalization
- **CVE-2005-1366** [https://www.cve.org/CVERecord?id=CVE-2005-1366](https://www.cve.org/CVERecord?id=CVE-2005-1366): CGI source disclosure using "dirname/../cgi-bin"
### Top 25 Examples
- **CVE-2021-27306**: An improper access control vulnerability in the JWT plugin in Kong Gateway prior to 2.3.2.0 allows unauthenticated users access to authenticated routes without a valid token JWT.
- **CVE-2021-40856**: Auerswald COMfortel 1400 IP and 2600 IP before 2.8G devices allow Authentication Bypass via the /about/../ substring.


## Known Examples for CWE-287: Improper Authentication
### Observed Examples
- **CVE-2022-35248** [https://www.cve.org/CVERecord?id=CVE-2022-35248](https://www.cve.org/CVERecord?id=CVE-2022-35248): Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436** [https://www.cve.org/CVERecord?id=CVE-2022-36436](https://www.cve.org/CVERecord?id=CVE-2022-36436): Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034** [https://www.cve.org/CVERecord?id=CVE-2022-30034](https://www.cve.org/CVERecord?id=CVE-2022-30034): Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).
- **CVE-2022-29951** [https://www.cve.org/CVERecord?id=CVE-2022-29951](https://www.cve.org/CVERecord?id=CVE-2022-29951): TCP-based protocol in Programmable Logic Controller (PLC) has no authentication.
- **CVE-2022-29952** [https://www.cve.org/CVERecord?id=CVE-2022-29952](https://www.cve.org/CVERecord?id=CVE-2022-29952): Condition Monitor uses a protocol that does not require authentication.


# Relevant CWE Specifications

## CWE-57: Path Equivalence: 'fakedir/../realdir/filename'
**Abstraction:** Variant
**Status:** Incomplete

### Description
The product contains protection mechanisms to restrict access to 'realdir/filename', but it constructs pathnames using external input in the form of 'fakedir/../realdir/filename' that are not handled by those mechanisms. This allows attackers to perform unauthorized actions against the targeted file.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-41

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Strategy:** Input Validation
- **Description:** Inputs should be decoded and canonicalized to the application's current internal representation before being validated (CWE-180). Make sure that the application does not decode the same input twice (CWE-174). Such errors could be used to bypass allowlist validation schemes by introducing dangerous inputs after they have been checked.



### Additional Notes
**[Theoretical]** This is a manipulation that uses an injection for one consequence (containment violation using relative path) to achieve a different consequence (equivalence by alternate name).



### Observed Examples
- **CVE-2001-1152:** Proxy allows remote attackers to bypass denylist restrictions and connect to unauthorized web servers by modifying the requested URL, including (1) a // (double slash), (2) a /SUBDIR/.. where the desired file is in the parentdir, (3) a /./, or (4) URL-encoded characters.
- **CVE-2000-0191:** application check access for restricted URL before canonicalization
- **CVE-2005-1366:** CGI source disclosure using "dirname/../cgi-bin"



## CWE-287: Improper Authentication
**Abstraction:** Class
**Status:** Draft

### Description
When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.

### Extended Description
Not provided

### Alternative Terms
authentification: An alternate term is "authentification", which appears to be most commonly used by people from non-English-speaking countries.
AuthN: "AuthN" is typically used as an abbreviation of "authentication" within the web application security community. It is also distinct from "AuthZ," which is an abbreviation of "authorization." The use of "Auth" as an abbreviation is discouraged, since it could be used for either authentication or authorization.
AuthC: "AuthC" is used as an abbreviation of "authentication," but it appears to used less frequently than "AuthN."

### Relationships
ChildOf -> CWE-284
ChildOf -> CWE-284
ParentOf -> CWE-1390
ParentOf -> CWE-290
ParentOf -> CWE-294
ParentOf -> CWE-295
ParentOf -> CWE-306
ParentOf -> CWE-307
ParentOf -> CWE-521
ParentOf -> CWE-522
CanFollow -> CWE-613
ParentOf -> CWE-640
ParentOf -> CWE-645
ParentOf -> CWE-798

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry might be misused when lower-level CWE entries are likely to be applicable. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children or descendants, beginning with CWE-1390: Weak Authentication or CWE-306: Missing Authentication for Critical Function.
**Reasons:**
- Frequent Misuse
**Suggested Alternatives:**
- CWE-1390: Weak Authentication
- CWE-306: Missing Authentication for Critical Function


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** Use an authentication framework or library such as the OWASP ESAPI Authentication feature.



### Additional Notes
**[Relationship]** This can be resultant from SQL injection vulnerabilities and other issues.

**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-35248:** Chat application skips validation when Central Authentication Service (CAS) is enabled, effectively removing the second factor from two-factor authentication
- **CVE-2022-36436:** Python-based authentication proxy does not enforce password authentication during the initial handshake, allowing the client to bypass authentication by specifying a 'None' authentication type.
- **CVE-2022-30034:** Chain: Web UI for a Python RPC framework does not use regex anchors to validate user login emails (CWE-777), potentially allowing bypass of OAuth (CWE-1390).



## CWE-306: Missing Authentication for Critical Function
**Abstraction:** Base
**Status:** Draft

### Description
The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-287
ChildOf -> CWE-287
ParentOf -> CWE-288
ParentOf -> CWE-322

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** 

Divide the software into anonymous, normal, privileged, and administrative areas. Identify which of these areas require a proven user identity, and use a centralized authentication capability.


Identify all potential communication channels, or other means of interaction with the software, to ensure that all channels are appropriately protected, including those channels that are assumed to be accessible only by authorized parties. Developers sometimes perform authentication at the primary channel, but open up a secondary channel that is assumed to be private. For example, a login mechanism may be listening on one network port, but after successful authentication, it may open up a second port where it waits for the connection, but avoids authentication because it assumes that only the authenticated party will connect to the port.


In general, if the software or protocol allows a single session or user state to persist across multiple connections or channels, authentication and appropriate credential management need to be used throughout.


**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server.

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Description:** 

Where possible, avoid implementing custom, "grow-your-own" authentication routines and consider using authentication capabilities as provided by the surrounding framework, operating system, or environment. These capabilities may avoid common weaknesses that are unique to authentication; support automatic auditing and tracking; and make it easier to provide a clear separation between authentication tasks and authorization tasks.


In environments such as the World Wide Web, the line between authentication and authorization is sometimes blurred. If custom authentication routines are required instead of those provided by the server, then these routines must be applied to every single page, since these pages could be requested directly.





### Observed Examples
- **CVE-2022-31260:** Chain: a digital asset management program has an undisclosed backdoor in the legacy version of a PHP script (CWE-912) that could allow an unauthenticated user to export metadata (CWE-306)
- **CVE-2022-29951:** TCP-based protocol in Programmable Logic Controller (PLC) has no authentication.
- **CVE-2022-29952:** Condition Monitor firmware uses a protocol that does not require authentication.



## CWE-425: Direct Request ('Forced Browsing')
**Abstraction:** Base
**Status:** Incomplete

### Description
The web application does not adequately enforce appropriate authorization on all restricted URLs, scripts, or files.

### Extended Description
Web applications susceptible to direct request attacks often make the false assumption that such resources can only be reached through a given navigation path and so only apply authorization at certain points in the path.

### Alternative Terms
forced browsing: The "forced browsing" term could be misinterpreted to include weaknesses such as CSRF or XSS, so its use is discouraged.

### Relationships
ChildOf -> CWE-862
ChildOf -> CWE-862
ChildOf -> CWE-288
ChildOf -> CWE-424
CanPrecede -> CWE-471
CanPrecede -> CWE-98

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design, Operation
- **Description:** Apply appropriate access control authorizations for each access to all restricted URLs, scripts or files.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** Consider using MVC based frameworks such as Struts.



### Additional Notes
**[Relationship]** Overlaps Modification of Assumed-Immutable Data (MAID), authorization errors, container errors; often primary to other weaknesses such as XSS and SQL injection.

**[Theoretical]** "Forced browsing" is a step-based manipulation involving the omission of one or more steps, whose order is assumed to be immutable. The application does not verify that the first step was performed successfully before the second step. The consequence is typically "authentication bypass" or "path disclosure," although it can be primary to all kinds of weaknesses, especially in languages such as PHP, which allow external modification of assumed-immutable variables.



### Observed Examples
- **CVE-2022-29238:** Access-control setting in web-based document collaboration tool is not properly implemented by the code, which prevents listing hidden directories but does not prevent direct requests to files in those directories.
- **CVE-2022-23607:** Python-based HTTP library did not scope cookies to a particular domain such that "supercookies" could be sent to any domain on redirect.
- **CVE-2004-2144:** Bypass authentication via direct request.

