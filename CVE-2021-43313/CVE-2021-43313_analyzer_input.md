# Vulnerability Information: CVE-2021-43313

## Vulnerability Description
A **heap-based buffer overflow** was discovered in upx, during the variable bucket points to an inaccessible address. The issue is being triggered in the function PackLinuxElf32invert_pt_dynamic at p_lx_elf.cpp1688.

### Vulnerability Description Key Phrases
- **rootcause:** **heap-based buffer overflow**
- **product:** upx

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 11)

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** A heap-based buffer overflow occurs in the `PackLinuxElf32::invert_pt_dynamic` function due to an insufficient boundary check when accessing the `buckets` array. The loop variable `j` iterates up to `n_bucket`, but the size allocated for `buckets` might be smaller than `n_bucket`. This can cause an out-of-bounds read when accessing `buckets[j]`.
- **Weaknesses/vulnerabilities present:** Heap-based buffer overflow.
- **Impact of exploitation:** A crafted input file can trigger a crash, potentially leading to denial of service. The ASAN report shows a read of size 4 at an address outside the allocated region, and the debugger session shows a segmentation fault due to an out-of-bounds memory access.
- **Attack vectors:** By providing a specially crafted input file to the UPX packer.
- **Required attacker capabilities/position:** The attacker needs the ability to provide a crafted input file to be processed by the vulnerable UPX version. The vulnerability is triggered during the decompression process.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6998 | dense, sparse, graph | dense: 0.527, sparse: 0.188, graph: 0.919 |
| 2 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6723 | dense, sparse, graph | dense: 0.589, sparse: 0.191, graph: 0.752 |
| 3 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.6032 | dense, sparse, graph | dense: 0.581, sparse: 0.166, graph: 0.607 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5490 | dense, sparse, graph | dense: 0.569, sparse: 0.188, graph: 0.567 |
| 5 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.5171 | dense, sparse, graph | dense: 0.526, sparse: 0.164, graph: 0.447 |
| 6 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3935 | dense, sparse | dense: 0.589, sparse: 0.230 |
| 7 | CWE-170 | Improper Null Termination | Base | Allowed | 0.3750 | sparse, graph | sparse: 0.162, graph: 0.789 |
| 8 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.3600 | dense, sparse | dense: 0.546, sparse: 0.152 |
| 9 | CWE-197 | Numeric Truncation Error | Base | Allowed | 0.3535 | dense, sparse | dense: 0.517, sparse: 0.165 |
| 10 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3523 | dense, sparse | dense: 0.562, sparse: 0.176 |

