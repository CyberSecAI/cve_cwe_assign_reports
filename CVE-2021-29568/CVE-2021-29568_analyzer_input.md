# Vulnerability Information: CVE-2021-29568

## Vulnerability Description
TensorFlow is an end-to-end open source platform for machine learning. An attacker can trigger undefined behavior by binding to null pointer in `tf.raw_ops.ParameterizedTruncatedNormal`. This is because the implementation(https//github.com/tensorflow/tensorflow/blob/3f6fe4dfef6f57e768260b48166c27d148f3015f/tensorflow/core/kernels/parameterized_truncated_normal_op.cc#L630) does not validate input arguments before accessing the first element of `shape`. If `shape` argument is empty, then `shape_tensor.flat()` is an empty array. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.

### Vulnerability Description Key Phrases
- **rootcause:** **does not validate input arguments before accessing the first element of shape**
- **weakness:** **null pointer dereference**
- **impact:** undefined behavior
- **attacker:** attacker
- **product:** TensorFlow
- **version:** before 2.5.0
- **component:** tf.raw_ops.ParameterizedTruncatedNormal

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2021-29568:

**Root Cause of Vulnerability:**
The vulnerability lies in the `ParameterizedTruncatedNormal` operation within TensorFlow. The code accesses the first element of the `shape` tensor without validating if the tensor is empty. Specifically, the line `int32 num_batches = shape_tensor.flat<int32>()(0);` attempts to access index 0 of the flattened `shape_tensor` without checking if `shape_tensor` is empty.

**Weaknesses/Vulnerabilities Present:**
- **Null Pointer Dereference:** When an empty shape tensor is provided as input, `shape_tensor.flat<int32>()` results in an empty array, leading to access of index 0 on empty data which causes a crash, which is undefined behavior.
- **Lack of Input Validation:** The code lacks proper input validation to ensure that the `shape` tensor is not empty before accessing its elements.

**Impact of Exploitation:**
- **Crash/Denial of Service:** Exploiting this vulnerability leads to a crash due to undefined behavior, resulting in a denial-of-service condition.

**Attack Vectors:**
- **Crafted Input:** The attack vector involves providing a specifically crafted input with an empty `shape` tensor to the `tf.raw_ops.ParameterizedTruncatedNormal` operation.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to control the input provided to the `tf.raw_ops.ParameterizedTruncatedNormal` operation.

**Additional Notes:**
- The fix for this vulnerability is present in commit `5e52ef5a461570cfb68f3bdbbebfe972cb4e0fd8`, which adds checks to validate that the shape tensor is not empty.
- The vulnerability is rated as low severity.
- Affected versions are TensorFlow versions prior to 2.5.0. Patched versions include 2.1.4, 2.2.3, 2.3.3, and 2.4.2.
- The vulnerability was reported by Ying Wang and Yakun Zhang of Baidu X-Team.
- The vulnerability is identified as CVE-2021-29568 with no associated CWE.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 1.1469 | dense, sparse, graph | dense: 0.501, sparse: 1.000, graph: 0.907 |
| 2 | CWE-476 | NULL Pointer Dereference | Base | Allowed | 1.0597 | dense, sparse, graph | dense: 0.473, sparse: 1.000, graph: 0.702 |
| 3 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 1.0410 | dense, sparse, graph | dense: 0.454, sparse: 1.000, graph: 0.677 |
| 4 | CWE-824 | Access of Uninitialized Pointer | Base | Allowed | 1.0408 | dense, sparse, graph | dense: 0.523, sparse: 1.000, graph: 0.579 |
| 5 | CWE-617 | Reachable Assertion | Base | Allowed | 1.0343 | dense, sparse, graph | dense: 0.442, sparse: 1.000, graph: 0.674 |
| 6 | CWE-1287 | Improper Validation of Specified Type of Input | Base | Allowed | 0.9729 | dense, sparse, graph | dense: 0.498, sparse: 0.907, graph: 0.573 |
| 7 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.9306 | dense, sparse, graph | dense: 0.444, sparse: 0.896, graph: 0.548 |
| 8 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.8430 | sparse, graph | sparse: 0.867, graph: 0.971 |
| 9 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.7878 | dense, sparse | dense: 0.431, sparse: 1.000 |
| 10 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.7590 | dense, sparse | dense: 0.436, sparse: 0.946 |

