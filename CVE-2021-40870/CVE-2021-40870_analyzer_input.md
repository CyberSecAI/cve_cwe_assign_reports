# Vulnerability Information: CVE-2021-40870

## Vulnerability Description
An issue was discovered in Aviatrix Controller 6.x before 6.5-1804.1922. Unrestricted upload of a file with a dangerous type is possible, which allows an unauthenticated user to execute arbitrary code via directory traversal.

### Vulnerability Description Key Phrases
- **rootcause:** **unrestricted file upload**
- **impact:** execute arbitrary code
- **vector:** directory traversal
- **attacker:** unauthenticated user
- **product:** Aviatrix Controller
- **version:** 6.x before 6.5-1804.1922

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described:

**Root Cause:**
The root cause is an insufficient access control check in the Aviatrix Cloud Controller's API. Specifically, several API calls, including one used to set metric gateway selections, do not enforce authentication, allowing unauthenticated users to interact with them.

**Weaknesses/Vulnerabilities:**
- **Unauthenticated API access:** The primary vulnerability is the lack of authentication checks on certain API endpoints. This allows unauthenticated users to make requests to the system.
- **Unrestricted file upload:** The lack of validation or restriction on file paths and content allows an attacker to upload arbitrary files, including executable scripts, to the filesystem using a specific API endpoint. This bypasses the intended access controls on the server.

**Impact of Exploitation:**
- **Arbitrary code execution:** By uploading a malicious PHP script (.php) to the server, an attacker can achieve arbitrary code execution. The web server processes uploaded files, allowing the attacker's code to run on the system.
- **Full system compromise:** Successful code execution can provide complete control of the Aviatrix Cloud Controller and any underlying systems or data it accesses.

**Attack Vectors:**
- **Network-based:** The vulnerability is exploitable via network access to the affected Aviatrix Cloud Controller instance.
- **API endpoint:** The specific API endpoint vulnerable to this attack is `/v1/backend1` with parameters `CID`, `action=set_metric_gw_selections`, `account_name` and `data`.

**Required Attacker Capabilities/Position:**
- **Network connectivity:** The attacker needs network access to the Aviatrix Cloud Controller.
- **No prior authentication:** The attacker does not require any authentication credentials to upload files and execute code.

**Additional details from the provided content:**
- **Proof of Concept:** The provided `curl` command demonstrates how an unauthenticated user can upload a PHP script and trigger its execution.
- **Affected Versions:** The vulnerability affects Aviatrix Cloud Controller versions prior to:
  * UserConnect-6.2-1804.2043
  * UserConnect-6.3-1804.2490
  * UserConnect-6.4-1804.2838
  * UserConnect-6.5-1804.1922
- **Severity:** The vulnerability is classified as critical, with a CVSS base score of 10.0.
- **Discovery and Reporting:** The vulnerability was discovered on 2021-05-12 and reported to Aviatrix on 2021-08-24.

The information provided is more detailed than a typical CVE description and outlines the exact API call and parameters used for exploitation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | 0.8033 | dense, sparse, graph | dense: 0.633, sparse: 0.225, graph: 1.000 |
| 2 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.7396 | dense, sparse, graph | dense: 0.608, sparse: 0.183, graph: 0.925 |
| 3 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.7054 | dense, sparse, graph | dense: 0.578, sparse: 0.152, graph: 0.920 |
| 4 | CWE-25 | Path Traversal: '/../filedir' | Variant | Allowed | 0.5955 | dense, sparse, graph | dense: 0.589, sparse: 0.267, graph: 0.554 |
| 5 | CWE-73 | External Control of File Name or Path | Base | Allowed | 0.5682 | dense, sparse, graph | dense: 0.556, sparse: 0.155, graph: 0.563 |
| 6 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.4198 | sparse, graph | sparse: 0.183, graph: 0.882 |
| 7 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.3699 | dense, sparse | dense: 0.553, sparse: 0.163 |
| 8 | CWE-24 | Path Traversal: '../filedir' | Variant | Allowed | 0.3489 | dense, sparse | dense: 0.575, sparse: 0.158 |
| 9 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.2516 | sparse, graph | sparse: 0.156, graph: 0.488 |
| 10 | CWE-436 | Interpretation Conflict | Class | Allowed-with-Review | 0.2459 | sparse, graph | sparse: 0.257, graph: 0.760 |

