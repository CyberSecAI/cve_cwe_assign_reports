# Vulnerability Information: CVE-2022-1621

## Vulnerability Description
**Heap buffer overflow** in vim_strncpy find_word in GitHub repository vim/vim prior to 8.2.4919. This vulnerability is capable of crashing software, Bypass Protection Mechanism, Modify Memory, and possible remote execution.

### Vulnerability Description Key Phrases
- **weakness:** **Heap buffer overflow**
- **impact:** crashing software
- **product:** vim
- **version:** prior to 8.2.4919
- **component:** vim_strncpy find_word

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability related to CVE-2022-1621:

**Root Cause of Vulnerability:**
The vulnerability stems from a heap-based buffer overflow within the `vim_strncpy` function, specifically when used in the `find_word` function. The issue arises when handling spell checking, allowing potentially invalid bytes to be added to the word tree.

**Weaknesses/Vulnerabilities Present:**
- Heap-based buffer overflow.
- Improper input validation when handling word strings during spell checking.

**Impact of Exploitation:**
- Denial of Service (application crash) due to memory corruption.
- Possible arbitrary code execution.
- Bypass Protection Mechanism
- Modify Memory

**Attack Vectors:**
- The vulnerability is triggered through the `:spellgood` command.
- A specially crafted word containing invalid bytes is needed to cause the overflow.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to use the `:spellgood` command in Vim, likely requiring the ability to edit a file.
- They need to be able to insert a crafted string with invalid bytes into a document where spell checking is enabled.

**Additional details:**
- The fix involves adding a check within the `store_word` and `spell_add_word` functions to ensure a valid UTF-8 string is being used with the `utf_valid_string` function.
- An error message "E1280: Illegal character in word" will be displayed when trying to add an invalid character.
-  The vulnerability was addressed by updating Vim to version 8.2.4927 in Fedora and 2:8.1.0875-5+deb10u4 in Debian.

The content from github.com provides the specific code changes related to the fix. It also provides a test case which is an assert fails call `call assert_fails("spellgood! 0\xac", 'E1280:')`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6690 | dense, sparse, graph | dense: 0.539, sparse: 0.158, graph: 0.864 |
| 2 | CWE-124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | 0.6465 | dense, sparse, graph | dense: 0.556, sparse: 0.179, graph: 0.743 |
| 3 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.5077 | dense, sparse, graph | dense: 0.515, sparse: 0.128, graph: 0.561 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.3837 | dense, sparse | dense: 0.585, sparse: 0.215 |
| 5 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3656 | dense, sparse | dense: 0.566, sparse: 0.198 |
| 6 | CWE-193 | Off-by-one Error | Base | Allowed | 0.3474 | dense, sparse | dense: 0.521, sparse: 0.152 |
| 7 | CWE-131 | Incorrect Calculation of Buffer Size | Base | Allowed | 0.3433 | dense, sparse | dense: 0.529, sparse: 0.138 |
| 8 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3360 | dense, sparse | dense: 0.513, sparse: 0.139 |
| 9 | CWE-1222 | Insufficient Granularity of Address Regions Protected by Register Locks | Variant | Allowed | 0.3156 | dense, sparse | dense: 0.497, sparse: 0.163 |
| 10 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3098 | dense, sparse | dense: 0.518, sparse: 0.133 |

