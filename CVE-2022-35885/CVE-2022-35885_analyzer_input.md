# Vulnerability Information: CVE-2022-35885

## Vulnerability Description
Four **format string injection** vulnerabilities exist in the web interface /action/wirelessConnect functionality of Abode Systems, Inc. iota All-In-One Security Kit 6.9Z and 6.9X. A specially-crafted HTTP request can lead to **memory corruption**, information disclosure and denial of service. An attacker can make an authenticated HTTP request to trigger these vulnerabilities.This vulnerability arises from **format string injection** via the `wpapsk_hex` HTTP parameter, as used within the `/action/wirelessConnect` handler.

### Vulnerability Description Key Phrases
- **rootcause:** **format string injection**
- **weakness:** **memory corruption**
- **impact:** information disclosure and denial of service
- **vector:** specially-crafted HTTP request
- **attacker:** attacker
- **product:** Abode Systems iota All-In-One Security Kit
- **version:** 6.9Z and 6.9X
- **component:** /action/wirelessConnect functionality

## CVE Reference Links Content Summary
The provided content is a Talos vulnerability report that contains detailed information about CVE-2022-35885 and related vulnerabilities.

**Root Cause:**
The root cause of the vulnerability is the misuse of the `log` function, which acts as a wrapper for `vsnprintf`, in the `/action/wirelessConnect` HTTP handler of the Abode Systems, Inc. iota All-In-One Security Kit. This function is used to generate log messages, but it takes user-supplied input as its format parameter without proper sanitization. Specifically, the `ssid_hex`, `wpapsk_hex`, `default_key_id`, and `key` HTTP parameters are used to construct OS commands and then passed to the `log` function before the command's execution.

**Weaknesses/Vulnerabilities:**
- Format String Injection: The primary vulnerability is a format string injection. By injecting format specifiers (e.g., `%x`, `%s`) into the vulnerable HTTP parameters, attackers can control the format string passed to `vsnprintf`.
- Improper Input Sanitization: The web interface does not adequately sanitize user-supplied data before using it as a format string argument for logging.

**Impact of Exploitation:**
- Memory Corruption: By controlling the format string, an attacker can potentially corrupt memory on the device.
- Information Disclosure: An attacker can potentially leak stack memory.
- Denial of Service (DoS): The format string injection could lead to a crash of the device, resulting in a denial of service.
- Arbitrary memory write: An attacker can also write arbitrary memory.

**Attack Vectors:**
- The vulnerability can be triggered by making an authenticated HTTP request to the `/action/wirelessConnect` endpoint.
- The vulnerable parameters are `ssid_hex`, `wpapsk_hex`, `default_key_id`, and `key` within the HTTP request body.

**Required Attacker Capabilities/Position:**
- An attacker needs to be able to send HTTP requests to the device.
- The web interface is disabled by default. To make these vulnerabilities accessible over the network, the attacker must enable the web interface and change the admin password using vulnerabilities described in TALOS-2022-1552 and TALOS-2022-1553.
- While exploitation of the format string vulnerability occurs server-side, output can be observed on the device's physical UART console. This access is available only to a physically present attacker who has partially disassembled the device and connected to the UART console.

**Additional Details:**

- The vulnerability affects `abode systems, inc. iota All-In-One Security Kit 6.9X` and `6.9Z`.
- The vulnerable code is in the `web_wireless_connect` function, located at offset `0x19AC94` within the `hpgw` binary of the firmware.
- The `log` function uses `vsnprintf`, which is vulnerable to format string attacks if the format string argument is attacker-controlled.
- The severity of the vulnerability is rated as `8.2` on the CVSSv3 scale (`CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:H`).
- The identified CWE is `CWE-134 - Use of Externally-Controlled Format String`.
- There are four distinct format string injection vulnerabilities in the same function, each triggered by different parameters.

The content provides more detail than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-134 | Use of Externally-Controlled Format String | Base | Allowed | 1.1887 | dense, sparse, graph | dense: 0.723, sparse: 1.000, graph: 0.712 |
| 2 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.8393 | dense, sparse, graph | dense: 0.619, sparse: 0.548, graph: 0.605 |
| 3 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.6923 | sparse, graph | sparse: 0.585, graph: 1.000 |
| 4 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6138 | sparse, graph | sparse: 0.522, graph: 0.882 |
| 5 | CWE-798 | Use of Hard-coded Credentials | Base | Allowed | 0.5755 | dense, sparse | dense: 0.577, sparse: 0.501 |
| 6 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.5331 | dense, sparse | dense: 0.599, sparse: 0.485 |
| 7 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.4468 | dense, sparse | dense: 0.585, sparse: 0.306 |
| 8 | CWE-1287 | Improper Validation of Specified Type of Input | Base | Allowed | 0.2916 | sparse | sparse: 0.510 |
| 9 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.2869 | sparse | sparse: 0.502 |
| 10 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.2868 | sparse | sparse: 0.501 |

