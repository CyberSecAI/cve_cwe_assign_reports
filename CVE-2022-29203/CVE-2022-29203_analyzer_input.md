# Vulnerability Information: CVE-2022-29203

## Vulnerability Description
TensorFlow is an open source platform for machine learning. Prior to versions 2.9.0, 2.8.1, 2.7.2, and 2.6.4, the implementation of `tf.raw_ops.SpaceToBatchND` (in all backends such as XLA and handwritten kernels) is vulnerable to an **integer overflow** The result of this **integer overflow** is used to allocate the output tensor, hence we get a denial of service via a `CHECK`-failure (assertion failure), as in TFSA-2021-198. Versions 2.9.0, 2.8.1, 2.7.2, and 2.6.4 contain a patch for this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **integer overflow**
- **impact:** Denial of Service
- **vector:** assertion failure
- **product:** TensorFlow
- **version:** prior to 2.9.0, 2.8.1, 2.7.2, and 2.6.4
- **component:** tf.raw_ops.SpaceToBatchND

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2022-29203:

**Root Cause:**

- The vulnerability stems from an integer overflow in the implementation of `tf.raw_ops.SpaceToBatchND`. This overflow occurs when calculating the output tensor's size.

**Weaknesses:**

- Integer Overflow: The code multiplies dimensions of the input tensor with the block shape without proper checks to prevent overflows. If the result is a negative number, a `CHECK`-failure (assertion failure) occurs, leading to a denial of service.

**Impact of Exploitation:**

- Denial of Service (DoS): Exploiting this vulnerability can cause a denial of service due to the assertion failure (CHECK-failure), which crashes the application. The process is terminated unexpectedly.

**Attack Vectors:**

- Malicious Input: An attacker can craft specific input tensors and `block_shape` parameters to `tf.raw_ops.SpaceToBatchND` that will cause an integer overflow when calculating the output tensor's dimensions, leading to the crash.

**Required Attacker Capabilities/Position:**

- The attacker needs to be able to control the inputs to the `tf.raw_ops.SpaceToBatchND` operation, specifically the `block_shape` parameter. This could be achieved by providing manipulated data to a TensorFlow model that uses this operation.

**Technical Details:**

- The vulnerability is located in the `SpaceToBatchND` operation which is used to rearrange data within a tensor. The output shape is calculated based on input shape, block shape, and paddings.
- Integer overflows happen in the calculation of `block_num_elems` and `output_dim`.
- The fix involves adding checks that ensure block dimensions are positive and that intermediate and output dimensions are positive after multiplication, preventing the overflow and subsequent crash.

**Patches:**

- The vulnerability is fixed in TensorFlow versions 2.6.4, 2.7.2, 2.8.1, and 2.9.0. The fix is also present in commit `acd56b8bcb72b163c834ae4f18469047b001fadf`.
- The patch adds checks to ensure the product of the block dimensions is positive and the output dimension is non-negative. This prevents the integer overflow that leads to the crash.
- Shape inference was also updated with `MultiplyWithoutOverflow` function to avoid integer overflow.

This information is more detailed than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.7898 | dense, sparse, graph | dense: 0.481, sparse: 0.503, graph: 0.732 |
| 2 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.7765 | dense, sparse, graph | dense: 0.522, sparse: 0.528, graph: 0.596 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.7446 | dense, sparse, graph | dense: 0.487, sparse: 0.507, graph: 0.589 |
| 4 | CWE-1287 | Improper Validation of Specified Type of Input | Base | Allowed | 0.7302 | dense, sparse, graph | dense: 0.533, sparse: 0.437, graph: 0.596 |
| 5 | CWE-824 | Access of Uninitialized Pointer | Base | Allowed | 0.7284 | dense, sparse, graph | dense: 0.479, sparse: 0.485, graph: 0.592 |
| 6 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.6787 | dense, sparse, graph | dense: 0.480, sparse: 0.398, graph: 0.589 |
| 7 | CWE-843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | 0.6584 | dense, sparse, graph | dense: 0.443, sparse: 0.399, graph: 0.583 |
| 8 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.5831 | sparse, graph | sparse: 0.412, graph: 0.971 |
| 9 | CWE-617 | Reachable Assertion | Base | Allowed | 0.4940 | dense, sparse | dense: 0.461, sparse: 0.460 |
| 10 | CWE-193 | Off-by-one Error | Base | Allowed | 0.4847 | dense, sparse | dense: 0.441, sparse: 0.462 |

