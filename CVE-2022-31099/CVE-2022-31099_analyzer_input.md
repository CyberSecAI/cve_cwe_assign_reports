# Vulnerability Information: CVE-2022-31099

## Vulnerability Description
rulex is a new, portable, regular expression language. When parsing untrusted rulex expressions, the stack may overflow, possibly enabling a Denial of Service attack. This happens when parsing an expression with several hundred levels of nesting, causing the process to abort immediately. This is a security concern for you, if your service parses untrusted rulex expressions (expressions provided by an untrusted user), and your service becomes unavailable when the process running rulex aborts due to a **stack overflow**. The crash is fixed in version **0.4.3**. Affected users are advised to update to this version. There are no known workarounds for this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **stack overflow**
- **impact:** Denial of Service
- **vector:** parsing untrusted rulex expressions
- **product:** rulex

## CVE Reference Links Content Summary
The provided content is related to CVE-2022-31099.

**Root cause of vulnerability:**
The vulnerability is due to uncontrolled recursion in the rulex parsing logic. Specifically, deeply nested expressions can cause a stack overflow, leading to a denial of service.

**Weaknesses/vulnerabilities present:**
- Uncontrolled recursion during parsing of rulex expressions.
- Lack of a recursion limit or a mechanism to prevent excessively deep nesting during parsing.

**Impact of exploitation:**
- Denial of service (DoS) due to stack overflow, causing the process to abort immediately.
- The service becomes unavailable if the process parsing rulex expressions crashes.

**Attack vectors:**
- Providing a crafted rulex expression with several hundred levels of nesting as input to the parsing logic.

**Required attacker capabilities/position:**
- Ability to provide untrusted rulex expressions as input to the service.
-  Ability to cause the process running rulex to abort due to stack overflow.

**Additional details from the provided content:**
- The issue was addressed by adding a recursion limit in version 0.4.3.
- The fix involved adding a `recursion` field to the Input struct, incrementing/decrementing it at the start and end of parsing functions.
- The `recursion_start` method will return an error `ParseErrorKind::RecursionLimit` if the limit is reached.
- The commit `60aa2dc` adds this recursion limit.
- The vulnerability is classified as low severity.
- The affected versions are <= 0.4.2.
- The vulnerability is related to CWE-674 (Uncontrolled Recursion).

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.7026 | dense, sparse, graph | dense: 0.426, sparse: 0.484, graph: 0.594 |
| 2 | CWE-1333 | Inefficient Regular Expression Complexity | Base | Allowed | 0.5431 | dense, sparse | dense: 0.469, sparse: 0.539 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4669 | dense, sparse | dense: 0.415, sparse: 0.453 |
| 4 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.4614 | dense, sparse | dense: 0.422, sparse: 0.438 |
| 5 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4425 | dense, sparse | dense: 0.420, sparse: 0.471 |
| 6 | CWE-120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | 0.4284 | dense, sparse | dense: 0.411, sparse: 0.425 |
| 7 | CWE-617 | Reachable Assertion | Base | Allowed | 0.4100 | sparse | sparse: 0.717 |
| 8 | CWE-674 | Uncontrolled Recursion | Class | Allowed-with-Review | 0.4043 | dense, sparse | dense: 0.489, sparse: 0.776 |
| 9 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.2608 | sparse | sparse: 0.456 |
| 10 | CWE-789 | Memory Allocation with Excessive Size Value | Variant | Allowed | 0.2580 | sparse | sparse: 0.489 |

