# Vulnerability Information: CVE-2021-40867

## Vulnerability Description
Certain NETGEAR smart switches are affected by an **authentication hijacking race-condition** vulnerability by an unauthenticated attacker who uses the same source IP address as an admin in the process of logging in (e.g., behind the same NAT device, or already in possession of a foothold on an admins machine). This occurs because the multi-step HTTP authentication process is effectively tied only to the source IP address. This affects GC108P before 1.0.8.2, GC108PP before 1.0.8.2, GS108Tv3 before 7.0.7.2, GS110TPP before 7.0.7.2, GS110TPv3 before 7.0.7.2, GS110TUP before 1.0.5.3, GS308T before 1.0.3.2, GS310TP before 1.0.3.2, GS710TUP before 1.0.5.3, GS716TP before 1.0.4.2, GS716TPP before 1.0.4.2, GS724TPP before 2.0.6.3, GS724TPv2 before 2.0.6.3, GS728TPPv2 before 6.0.8.2, GS728TPv2 before 6.0.8.2, GS750E before 1.0.1.10, GS752TPP before 6.0.8.2, GS752TPv2 before 6.0.8.2, MS510TXM before 1.0.4.2, and MS510TXUP before 1.0.4.2.

### Vulnerability Description Key Phrases
- **rootcause:** **authentication hijacking race-condition**
- **impact:** unauthenticated admin login
- **vector:** same source IP address
- **attacker:** unauthenticated attacker
- **product:** NETGEAR smart switches
- **version:** multiple versions

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information related to CVE-2021-40867:

**Root Cause of Vulnerability:**

The vulnerability lies in the web UI authentication logic of certain NETGEAR smart switches. Specifically, the `get.cgi` handler, which is responsible for providing session bootstrapping information, relies solely on the client IP and a guessable browser type number for verification. This lack of proper session management and reliance on easily spoofable data allows an attacker to hijack the authentication process.

**Weaknesses/Vulnerabilities Present:**

*   **Insecure Session Handling:** The vulnerability stems from a lack of a secure session identifier. Instead of using a cryptographically secure token, the system relies on the client's IP address and user-agent type which is insufficient for securing the session.
*   **Race Condition:** The vulnerability is exploitable due to a race condition between the legitimate admin's browser and the attacker's requests to the `/cgi/get.cgi` endpoint. The attacker can flood the endpoint to gain session information before the legitimate user.
*   **Lack of Input Validation:** The lack of proper input validation when polling for the session status allows an attacker to send repeated requests without having to authenticate or prove they are the intended user.

**Impact of Exploitation:**

*   **Full Device Compromise:** A successful exploitation allows the attacker to hijack the session bootstrapping information. This grants the attacker full administrative access to the device's web UI and thus complete control of the switch.
*   **Data Manipulation:** With admin access, the attacker can manipulate switch configurations, potentially disrupting network operations or redirecting traffic.

**Attack Vectors:**

*   **Same IP Requirement:** The primary attack vector requires the attacker to have the same IP address as the admin who is logging in. This can be achieved by:
    *   Compromising a machine on the same network as the admin with limited privileges.
    *   Sharing the same source NAT IP
    *   Spoofing the IP address, potentially requiring low-level network manipulation.
*   **Race Condition:** The attacker needs to win a race condition with a 1-second window during the admin's login process.

**Required Attacker Capabilities/Position:**

*   **Network Proximity:** The attacker needs to be on the same network as the victim and ideally have the same IP address as the admin.
*   **Technical Knowledge:** The attacker needs technical knowledge to craft HTTP requests to flood `/cgi/get.cgi` and potentially spoof IP addresses.
*   **Timing:** Exploitation requires an attacker to be active while a legitimate administrator is logging into the web UI.

**Additional Notes:**

*   The vulnerability was identified as "Draconian Fear" by Gynvael Coldwind and reported to NETGEAR.
*   NETGEAR assigned this vulnerability the identifier PSV-2021-0144.
*   The advisory mentions a "90-day policy", indicating that the vulnerability was disclosed publicly 90 days after it was initially reported.
*   The provided proof-of-concept exploit (PoC) demonstrates how an attacker can successfully exploit this vulnerability.
*   The advisory also lists multiple other vulnerabilities that were addressed by these patches (PSV-2021-0140, PSV-2021-0145), but the details for "Draconian Fear" are the most detailed.
*  The suggested fix is to use a cryptographically secure random value for the result file name, which should then be passed as a token and used for subsequent get.cgi requests

This information is more detailed than a typical CVE description, providing insights into the technical aspects of the vulnerability and how it can be exploited.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-291 | Reliance on IP Address for Authentication | Variant | Allowed | 0.9917 | dense, sparse, graph | dense: 0.633, sparse: 1.000, graph: 0.519 |
| 2 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.8660 | dense, sparse, graph | dense: 0.595, sparse: 0.606, graph: 0.620 |
| 3 | CWE-93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | 0.7702 | sparse, graph | sparse: 0.811, graph: 0.857 |
| 4 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.6445 | dense, sparse | dense: 0.587, sparse: 0.614 |
| 5 | CWE-290 | Authentication Bypass by Spoofing | Base | Allowed | 0.6286 | dense, sparse | dense: 0.578, sparse: 0.594 |
| 6 | CWE-230 | Improper Handling of Missing Values | Variant | Allowed | 0.4934 | sparse | sparse: 0.934 |
| 7 | CWE-77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | 0.4055 | dense, sparse | dense: 0.644, sparse: 0.643 |
| 8 | CWE-522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | 0.3647 | dense, sparse | dense: 0.572, sparse: 0.585 |
| 9 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.3400 | sparse | sparse: 0.594 |
| 10 | CWE-22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | 0.3365 | sparse | sparse: 0.588 |

