# Vulnerability Information: CVE-2021-22565

## Vulnerability Description
An attacker could prematurely expire a verification code, making it unusable by the patient, making the patient unable to upload their TEKs to generate exposure notifications. We recommend upgrading the Exposure Notification server to V1.1.2 or greater.

### Vulnerability Description Key Phrases
- **impact:** prematurely expire verification code
- **attacker:** attacker
- **product:** Exposure Notification server

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2021-22565

**Root Cause:** Insufficient access control when expiring verification codes.

**Weaknesses:**
*   **Insufficient Granularity of Access Control:** The system allowed users or API keys with the permission to expire verification codes to potentially expire codes belonging to other realms. This was due to the system not properly validating if the user/API key had the authorization to expire the specific code.

**Impact of Exploitation:**
*   **Unauthorized Code Expiration:** An attacker with the ability to expire verification codes could expire codes from other realms if they could guess the UUID of the target code. This could disrupt the intended functionality of the system by rendering valid codes unusable.

**Attack Vectors:**
*   **Guessing UUIDs:** The attacker would need to guess the 64-bit UUID of a verification code belonging to a realm they don't have access to but have the general permission to expire codes.

**Required Attacker Capabilities/Position:**
*   **Permissions to Expire Codes:** The attacker must have user or API key access with the permission to expire verification codes.
*   **Ability to guess UUIDs:**  The attacker needs the capability to guess a valid 64 bit UUID.

**Additional Details:**

*   The vulnerability is specific to versions of the `exposure-notifications-verification-server` prior to 1.1.2.
*   The issue was addressed in version 1.1.2 and later.
*   Verification codes have a short lifespan, reducing the window of opportunity for exploitation.
*   There are no indications this vulnerability has been exploited in the wild.
* The vulnerability has been classified as Moderate severity.
* The associated CWE is CWE-1220 which is "Insufficient Granularity of Access Control".

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1220 | Insufficient Granularity of Access Control | Base | Allowed | 0.3640 | sparse, graph | sparse: 0.116, graph: 0.832 |
| 2 | CWE-1204 | Generation of Weak Initialization Vector (IV) | Base | Allowed | 0.2994 | sparse, graph | sparse: 0.050, graph: 0.757 |
| 3 | CWE-540 | Inclusion of Sensitive Information in Source Code | Base | Allowed | 0.2990 | sparse, graph | sparse: 0.050, graph: 0.757 |
| 4 | CWE-918 | Server-Side Request Forgery (SSRF) | Base | Allowed | 0.2982 | sparse, graph | sparse: 0.048, graph: 0.757 |
| 5 | CWE-327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | 0.1281 | sparse, graph | sparse: 0.048, graph: 0.534 |
| 6 | CWE-287 | Improper Authentication | Class | Discouraged | 0.0988 | dense, sparse | dense: 0.389, sparse: 0.046 |
| 7 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.0268 | sparse | sparse: 0.047 |
| 8 | CWE-306 | Missing Authentication for Critical Function | Base | Allowed | 0.0264 | sparse | sparse: 0.046 |
| 9 | CWE-1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | 0.0264 | sparse | sparse: 0.046 |
| 10 | CWE-409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | Allowed | 0.0262 | sparse | sparse: 0.046 |

