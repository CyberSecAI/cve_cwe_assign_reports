# Vulnerability Information: CVE-2022-23591

## Vulnerability Description
Tensorflow is an Open Source Machine Learning Framework. The `GraphDef` format in TensorFlow does not allow self recursive functions. The runtime assumes that this invariant is satisfied. However, a `GraphDef` containing a fragment such as the following can be consumed when loading a `SavedModel`. This would result in a **stack overflow** during execution as resolving each `NodeDef` means resolving the function itself and its nodes. The fix will be included in TensorFlow 2.8.0. We will also cherrypick this commit on TensorFlow 2.7.1, TensorFlow 2.6.3, and TensorFlow 2.5.3, as these are also affected and still in supported range.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **vector:** GraphDef containing a self recursive function
- **product:** Tensorflow
- **version:** 2.8.0 and prior versions

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2022-23591:

**Root Cause:**
The vulnerability stems from the lack of validation for self-recursive functions within the `GraphDef` format in TensorFlow. The runtime incorrectly assumes that `GraphDef` will not contain self-recursive functions, leading to a stack overflow when a malicious `GraphDef` with such a structure is loaded.

**Weaknesses/Vulnerabilities:**
- Absence of checks for self-recursive function definitions within `GraphDef`.
- The runtime's assumption that `GraphDef` will not contain self-recursive functions.
- Failure to properly handle the recursive function calls during the resolution of nodes in the graph.

**Impact of Exploitation:**
- A stack overflow during the execution of the model, leading to a denial-of-service condition.
- The application using TensorFlow can crash or become unresponsive.

**Attack Vectors:**
- Crafting a malicious `GraphDef` containing a self-recursive function definition.
- Loading the crafted `GraphDef` using `SavedModel` loading mechanisms in TensorFlow.

**Required Attacker Capabilities/Position:**
- An attacker needs to be able to provide a malicious `GraphDef` to the TensorFlow runtime. This could be through supplying a specifically crafted SavedModel, which when loaded triggers the vulnerability.
- No specific position/privileges are mentioned, so ability to supply input model is the only requirement.

**Additional Details:**
- The vulnerability is present in TensorFlow versions prior to 2.8.0. Patches have been backported to 2.5.3, 2.6.3, and 2.7.1
- The vulnerability is addressed by adding a check in `tensorflow/cc/saved_model/loader.cc` that prevents self-recursive functions.
- The provided code snippet highlights a function `ValidateFunctionNotRecursive` which is added to prevent this issue from happening.
- The fix is available in the GitHub commit [448a16182065bd08a202d9057dd8ca541e67996c](https://github.com/tensorflow/tensorflow/commit/448a16182065bd08a202d9057dd8ca541e67996c).

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-663 | Use of a Non-reentrant Function in a Concurrent Context | Base | Allowed | 0.7196 | dense, sparse, graph | dense: 0.437, sparse: 0.519, graph: 0.571 |
| 2 | CWE-824 | Access of Uninitialized Pointer | Base | Allowed | 0.7159 | dense, sparse, graph | dense: 0.372, sparse: 0.576, graph: 0.560 |
| 3 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.7140 | dense, sparse, graph | dense: 0.387, sparse: 0.560, graph: 0.559 |
| 4 | CWE-1287 | Improper Validation of Specified Type of Input | Base | Allowed | 0.6169 | dense, sparse, graph | dense: 0.382, sparse: 0.385, graph: 0.574 |
| 5 | CWE-787 | Out-of-bounds Write | Base | Allowed | 0.5269 | sparse, graph | sparse: 0.428, graph: 0.789 |
| 6 | CWE-835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | 0.5179 | sparse, graph | sparse: 0.551, graph: 0.567 |
| 7 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.4838 | dense, sparse | dense: 0.346, sparse: 0.543 |
| 8 | CWE-617 | Reachable Assertion | Base | Allowed | 0.4763 | dense, sparse | dense: 0.354, sparse: 0.523 |
| 9 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.4527 | dense, sparse | dense: 0.337, sparse: 0.497 |
| 10 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.4324 | dense, sparse | dense: 0.333, sparse: 0.465 |

