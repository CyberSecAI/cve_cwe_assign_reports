# Vulnerability Information: CVE-2021-44648

## Vulnerability Description
GNOME gdk-pixbuf 2.42.6 is vulnerable to a **heap-buffer overflow** vulnerability when decoding the lzw compressed stream of image data in GIF files with lzw minimum code size equals to 12.

### Vulnerability Description Key Phrases
- **weakness:** **heap-buffer overflow**
- **product:** GNOME gdk-pixbuf
- **version:** 2.42.6

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described as CVE-2021-44648:

**Root Cause:**

*   The vulnerability is a heap-based buffer overflow in the `lzw_decoder_new` function of the GdkPixbuf library.
*   It occurs when decoding LZW-compressed image data within GIF files.
*   The library incorrectly calculates the maximum number of codes allowed in the LZW code table when the LZW minimum code size is 12.

**Weaknesses/Vulnerabilities:**

*   **Incorrect Code Table Size Calculation:** The `lzw_decoder_new` function initializes the LZW decoder with a code size that is one greater than the specified minimum code size from the GIF file.
*   **Out-of-Bounds Write:** When the minimum code size is 12, the `lzw_decoder_new` function allocates space for 4096 entries in `code_table` but proceeds to write up to 4098 indexes.
*   **`code_table_size` Overwrite:** Writing past the allocated buffer overwrites the `LZWDecoder->code_table_size` variable.

**Impact of Exploitation:**

*   **Heap-based buffer overflow:** This can lead to a crash, denial of service, or potentially arbitrary code execution depending on how memory is laid out at the time of the overflow.

**Attack Vectors:**

*   **Malicious GIF File:** The vulnerability is triggered by processing a specially crafted GIF image with an LZW minimum code size set to 12.

**Required Attacker Capabilities/Position:**

*   **Ability to provide a malformed GIF file:** An attacker needs to be able to deliver a malicious GIF file to the vulnerable software, either by directly opening it, or via a library that relies on the vulnerable code to decode images..
*   **No special privileges required:** No elevated privileges are needed to exploit this.

**Additional Technical Details:**

*   The `LZW_CODE_MAX` is defined as 12, resulting in a maximum code count of 4096.
*   The `lzw_decoder_new` function increments the given code size by one, so a minimum code size of 12 becomes 13. This results in `eoi_code` (end of information) being equal to 4097. The loop in the `lzw_decoder_new` function iterates up to `eoi_code`, which results in the code table being written past its boundary.
*   Dynamic analysis using GDB confirms that the `code_table_size` is overwritten by the out-of-bounds write.
*   AddressSanitizer (ASAN) reports a heap-buffer-overflow during `write_indexes` function.

In summary, the vulnerability is caused by a logic error in calculating the size of the LZW code table, leading to a heap-based buffer overflow that can be triggered with a malformed GIF image. This could result in denial of service or potentially arbitrary code execution.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | 0.6974 | dense, sparse, graph | dense: 0.490, sparse: 0.165, graph: 1.000 |
| 2 | CWE-193 | Off-by-one Error | Base | Allowed | 0.6621 | dense, sparse, graph | dense: 0.480, sparse: 0.169, graph: 0.910 |
| 3 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.6542 | dense, sparse, graph | dense: 0.532, sparse: 0.205, graph: 0.757 |
| 4 | CWE-126 | Buffer Over-read | Variant | Allowed | 0.5452 | dense, sparse, graph | dense: 0.540, sparse: 0.158, graph: 0.644 |
| 5 | CWE-681 | Incorrect Conversion between Numeric Types | Base | Allowed | 0.4058 | sparse, graph | sparse: 0.166, graph: 0.870 |
| 6 | CWE-122 | Heap-based Buffer Overflow | Variant | Allowed | 0.3668 | dense, sparse | dense: 0.577, sparse: 0.190 |
| 7 | CWE-195 | Signed to Unsigned Conversion Error | Variant | Allowed | 0.3349 | sparse, graph | sparse: 0.145, graph: 0.783 |
| 8 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.3319 | dense, sparse | dense: 0.503, sparse: 0.140 |
| 9 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.3224 | dense, sparse | dense: 0.527, sparse: 0.149 |
| 10 | CWE-191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | 0.3204 | dense, sparse | dense: 0.466, sparse: 0.152 |

