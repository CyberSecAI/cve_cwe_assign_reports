# Vulnerability Information: CVE-2022-35879

## Vulnerability Description
Four **format string injection** vulnerabilities exist in the UPnP logging functionality of Abode Systems, Inc. iota All-In-One Security Kit 6.9Z and 6.9X. A specially-crafted UPnP negotiation can lead to memory corruption, information disclosure, and denial of service. An attacker can host a malicious UPnP service to trigger these vulnerabilities.This vulnerability arises from **format string injection** via `controlURL` XML tag, as used within the `DoUpdateUPnPbyService` action handler.

### Vulnerability Description Key Phrases
- **rootcause:** **format string injection**
- **impact:** memory corruption and information disclosure and denial of service
- **vector:** specially-crafted UPnP negotiation
- **attacker:** attacker
- **product:** Abode Systems iota All-In-One Security Kit
- **version:** 6.9Z and 6.9X
- **component:** UPnP logging functionality

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Vulnerability Details for CVE-2022-35879**

*   **Root Cause:** The vulnerability stems from a format string injection in the UPnP logging functionality of the Abode iota All-In-One Security Kit. The `log` function, which is used for diagnostic logging, passes attacker-controlled strings as the `format` parameter to `vsnprintf` without proper sanitization.

*   **Weakness:** The primary weakness is the use of externally controlled data (from UPnP responses) directly within format strings without proper validation. Specifically, the `controlURL` field from the UPnP response is used as part of the format string in the `log_msg` and passed to the vulnerable `log` function.

*  **Impact of Exploitation:**
    *   **Memory Corruption:** By injecting format string specifiers (e.g., `%x`, `%n`) an attacker can potentially read from or write to arbitrary memory locations, causing the device to crash or possibly leading to code execution, though this specific report does not confirm arbitrary code execution.
    *   **Information Disclosure:** Using format specifiers such as `%x`, an attacker can leak stack memory, exposing sensitive information.
    *   **Denial of Service:** Memory corruption can lead to a denial-of-service condition by crashing the device.

*   **Attack Vectors:**
    *   **Network-based:** An attacker would need to be on the same network as the Abode iota device to intercept its UPnP M-SEARCH requests and respond with a crafted response containing a malicious `controlURL`. The attacker must be able to host a malicious HTTP server that will respond to further UPnP HTTP queries.
*   **Required Attacker Capabilities/Position:**
    *   The attacker must be on the same network segment as the vulnerable device.
    *   The attacker needs to be able to capture and reply to UPnP M-SEARCH broadcasts.
    *   The attacker needs to host a malicious HTTP server.
    *   Physical access to the device's UART console is needed to observe the exploit output.

**Specific to CVE-2022-35879:**

*   This CVE specifically addresses the vulnerability within the `DoUpdateUPnPbyService` action where the `controlURL` value is used in a log message.
*  The vulnerable code is located at offset `0x182038` in the `hpgw` binary included in firmware version 6.9Z.

**Additional Notes:**

*   The provided report indicates that while exploitation can lead to memory corruption and information disclosure, the log output is only visible via the device's UART console, meaning an attacker requires physical access for observability of the exploit.
*   The report also discusses other similar format string vulnerabilities (CVE-2022-35878, CVE-2022-35880, and CVE-2022-35881) in the same UPnP logging functionality, which are triggered by different fields from UPnP responses.
*   The vulnerability has been patched by the vendor.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-134 | Use of Externally-Controlled Format String | Base | Allowed | 1.0774 | dense, sparse, graph | dense: 0.700, sparse: 0.827, graph: 0.710 |
| 2 | CWE-78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | 0.6854 | dense, sparse, graph | dense: 0.600, sparse: 0.296, graph: 0.603 |
| 3 | CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | 0.5238 | sparse, graph | sparse: 0.291, graph: 1.000 |
| 4 | CWE-190 | Integer Overflow or Wraparound | Base | Allowed | 0.4887 | sparse, graph | sparse: 0.303, graph: 0.882 |
| 5 | CWE-121 | Stack-based Buffer Overflow | Variant | Allowed | 0.4145 | dense, sparse | dense: 0.591, sparse: 0.268 |
| 6 | CWE-94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | 0.4082 | dense, sparse | dense: 0.544, sparse: 0.271 |
| 7 | CWE-20 | Improper Input Validation | Class | Discouraged | 0.1982 | dense, sparse | dense: 0.552, sparse: 0.291 |
| 8 | CWE-502 | Deserialization of Untrusted Data | Base | Allowed | 0.1637 | sparse | sparse: 0.286 |
| 9 | CWE-1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | 0.1632 | sparse | sparse: 0.285 |
| 10 | CWE-125 | Out-of-bounds Read | Base | Allowed | 0.1629 | sparse | sparse: 0.285 |

