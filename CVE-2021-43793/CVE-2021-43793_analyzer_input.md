# Vulnerability Information: CVE-2021-43793

## Vulnerability Description
Discourse is an open source discussion platform. In affected versions a vulnerability in the Polls feature allowed users to vote multiple times in a single-option poll. The problem is patched in the latest tests-passed, beta and stable versions of Discourse

### Vulnerability Description Key Phrases
- **impact:** vote multiple times
- **attacker:** users
- **product:** Discourse
- **version:** affected versions
- **component:** Polls feature

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2021-43793:

**Root Cause of Vulnerability:**
The vulnerability stems from a flaw in how Discourse's poll feature handles voting limits, specifically for single-option polls. The system failed to properly enforce the restriction that a user could only cast one vote on such polls.

**Weaknesses/Vulnerabilities Present:**
- **Insufficient input validation:** The core issue was a lack of proper validation of the number of votes a user could cast in a single-option poll. Despite the intention to limit users to one vote, the system was not enforcing this constraint.
- **Logic Error:** The code logic allowed users to bypass the intended one-vote-per-user restriction.

**Impact of Exploitation:**
- **Bypassing vote limits:** An attacker could exploit this vulnerability to cast multiple votes in a single-option poll.
- **Manipulation of poll results:** By casting multiple votes, a user could skew poll results, potentially leading to inaccurate or manipulated outcomes.

**Attack Vectors:**
- **Direct interaction with poll feature:** An attacker would interact with the poll feature directly through the user interface.
- **Repeated submission of votes:** The attacker would need to repeatedly submit votes for a single-option poll.

**Required Attacker Capabilities/Position:**
- **Authenticated user:** The attacker must be a registered user of the Discourse forum.
- **Access to poll:** The attacker needs access to a poll to cast votes.
- **No special privileges:** No elevated privileges or special access was required to perform the attack.

**Additional Notes:**

- The provided content includes a commit ([1d0faed](https://github.com/discourse/discourse/commit/1d0faedfbc3a8b77b971dc70d25e30791dbb6e0b)) that addresses the vulnerability. This commit introduces a SQL query that deletes older votes from a user once they have exceeded the allowed number of votes. It also adds validation for the min/max number of votes in the poll.
- The vulnerability was reported by JerryShah3 and ethicalbughunter.
- The fix was backported to the stable version of Discourse.
- The vulnerability was rated as "low severity."

In summary, CVE-2021-43793 is a vulnerability that allowed users to bypass voting limits in single-option polls on Discourse, leading to potential manipulation of poll results. The fix involved implementing proper validation and a mechanism for removing excess votes.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-837 | Improper Enforcement of a Single, Unique Action | Base | Allowed | 0.5093 | dense, sparse, graph | dense: 0.485, sparse: 0.128, graph: 0.540 |
| 2 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.4832 | dense, sparse, graph | dense: 0.478, sparse: 0.065, graph: 0.578 |
| 3 | CWE-538 | Insertion of Sensitive Information into Externally-Accessible File or Directory | Base | Allowed | 0.4781 | dense, sparse, graph | dense: 0.437, sparse: 0.079, graph: 0.599 |
| 4 | CWE-201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | 0.4754 | dense, sparse, graph | dense: 0.477, sparse: 0.078, graph: 0.538 |
| 5 | CWE-359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | 0.2527 | dense, sparse | dense: 0.432, sparse: 0.064 |
| 6 | CWE-770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | 0.2384 | dense, sparse | dense: 0.409, sparse: 0.059 |
| 7 | CWE-1333 | Inefficient Regular Expression Complexity | Base | Allowed | 0.2371 | dense, sparse | dense: 0.403, sparse: 0.062 |
| 8 | CWE-88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | 0.2362 | dense, sparse | dense: 0.404, sparse: 0.059 |
| 9 | CWE-525 | Use of Web Browser Cache Containing Sensitive Information | Variant | Allowed | 0.1873 | sparse, graph | sparse: 0.087, graph: 0.429 |
| 10 | CWE-863 | Incorrect Authorization | Class | Allowed-with-Review | 0.1595 | dense, sparse | dense: 0.462, sparse: 0.071 |

