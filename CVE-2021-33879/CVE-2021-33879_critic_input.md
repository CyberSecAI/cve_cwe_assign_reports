# Critic Input for CVE-2021-33879



# Original Analyzer Input
## Vulnerability Description
Tencent GameLoop before 4.1.21.90 downloaded updates over an insecure HTTP connection. A malicious attacker in an MITM position could spoof the contents of an XML document describing an update package, replacing a download URL with one pointing to an arbitrary Windows executable. Because the only integrity check would be a comparison of the downloaded files MD5 checksum to the one contained within the XML document, the downloaded executable would then be executed on the victims machine.

### Vulnerability Description Key Phrases
- **impact:** execute arbitrary Windows executable
- **vector:** spoof contents of XML document with malicious download URL
- **attacker:** malicious attacker in MITM position
- **product:** Tencent GameLoop
- **version:** before 4.1.21.90

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2021-33879:

**Root Cause of Vulnerability:**

*   The GameLoop application downloads updates over an insecure HTTP connection. This lack of encryption allows for man-in-the-middle (MITM) attacks.
*   The update mechanism lacks proper authentication.
*   The only integrity check performed is an MD5 hash comparison, which is insufficient because the attacker can control both the download URL and the MD5 hash.

**Weaknesses/Vulnerabilities Present:**

*   **CWE-494: Download of Code Without Integrity Check:** The software downloads executable code without verifying its integrity using a strong cryptographic method, relying only on an easily manipulable MD5 hash.
*   **Insecure Communication:** HTTP is used instead of HTTPS for downloading updates, leaving the communication vulnerable to interception and manipulation.
*   **Lack of Authentication:** The update process does not authenticate the server providing the update, allowing an attacker to impersonate it.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** An attacker in a MITM position can replace the legitimate update package with a malicious executable. The victim's machine will then execute the attacker's code with the privileges of the GameLoop application, potentially leading to full system compromise.
*   **Malware Installation:**  The attacker can install ransomware, trojans, or any other malware of their choice.
*   **Data Exfiltration:** The attacker could steal sensitive data.

**Attack Vectors:**

*   **Man-in-the-Middle (MITM) Attack:** The attacker needs to be positioned between the victim and the update server. This could be achieved on a shared network (e.g., public Wi-Fi) or by compromising a router.
*   **Interception of Update Request:** The attacker intercepts the request for the `ComponentUpdate.xml` file.
*   **Spoofing Update Information:** The attacker modifies the intercepted `ComponentUpdate.xml` response by:
    *   Replacing the download URL with a URL to the attacker's malicious executable.
    *   Providing the MD5 hash of their malicious executable.
    *  Modifying the file size to match the attacker's payload size.

**Required Attacker Capabilities/Position:**

*   **Network Positioning:** The attacker must be able to intercept network traffic between the victim and the GameLoop update server (MITM).
*   **Web Server:** The attacker needs to host their malicious executable on a web server.
*   **Proxy:** The attacker can set up a proxy to intercept and modify the update XML responses.
*   **MD5 Hash Calculation:** The attacker needs to calculate the MD5 hash of their malicious executable.

**Additional Details:**
*   The provided `ComponentUpdate.xml` example within the Github repository illustrates how the attacker would craft the malicious update information.
*   The vulnerability affects all GameLoop versions prior to 4.1.21.90.
*   The proof of concept shows the calculator app being launched, but any executable can be deployed, meaning the impact is severe.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage | Combined Score | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|---------------|------------|-------------------|
| 1 | CWE-494 | Download of Code Without Integrity Check | Base | Allowed | 0.6601 | dense, sparse, graph | dense: 0.606, sparse: 0.233, graph: 0.625 |
| 2 | CWE-427 | Uncontrolled Search Path Element | Base | Allowed | 0.5229 | dense, sparse, graph | dense: 0.510, sparse: 0.105, graph: 0.581 |
| 3 | CWE-295 | Improper Certificate Validation | Base | Allowed | 0.5182 | dense, sparse, graph | dense: 0.470, sparse: 0.115, graph: 0.606 |
| 4 | CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | 0.3399 | sparse, graph | sparse: 0.101, graph: 0.789 |
| 5 | CWE-23 | Relative Path Traversal | Base | Allowed | 0.3318 | sparse, graph | sparse: 0.107, graph: 0.757 |
| 6 | CWE-347 | Improper Verification of Cryptographic Signature | Base | Allowed | 0.2852 | sparse, graph | sparse: 0.121, graph: 0.604 |
| 7 | CWE-451 | User Interface (UI) Misrepresentation of Critical Information | Class | Allowed-with-Review | 0.1719 | dense, sparse | dense: 0.468, sparse: 0.102 |
| 8 | CWE-732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | 0.1707 | dense, sparse | dense: 0.460, sparse: 0.106 |
| 9 | CWE-59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | 0.0609 | sparse | sparse: 0.106 |
| 10 | CWE-611 | Improper Restriction of XML External Entity Reference | Base | Allowed | 0.0592 | sparse | sparse: 0.103 |



# Analysis to Review
# Summary
| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |
|---|---|---|---|---|---|
| CWE-494 | Download of Code Without Integrity Check | 0.95 | Base | Allowed | Primary CWE. The software downloads executable code without verifying its integrity. |
| CWE-319 | Cleartext Transmission of Sensitive Information | 0.75 | Base | Allowed | Secondary CWE. Updates are downloaded over HTTP, which is an insecure channel. |
| CWE-345 | Insufficient Verification of Data Authenticity | 0.60 | Class | Discouraged | Secondary CWE. The product does not sufficiently verify the origin or authenticity of data, in a way that causes it to accept invalid data. |

## Evidence and Confidence

*   **Confidence Score:** 0.85
*   **Evidence Strength:** HIGH

- **Analysis and Justification:**  
  - *Explanation:* "The primary **weakness** is that the GameLoop application downloads updates over an insecure HTTP connection and lacks proper authentication. The most direct mapping for this is CWE-494 (Download of Code Without Integrity Check) because the application downloads executable code without sufficiently verifying its integrity, relying only on an MD5 hash. This allows an attacker to replace the legitimate update with a malicious executable. The "CVE Reference Links Content Summary" explicitly mentions CWE-494 as a vulnerability. CWE-494 is a Base level CWE and its usage is ALLOWED."
  
  - *Relationship Analysis:* "CWE-494 does not have direct relationships to other CWEs in the provided information. However, it is related to the broader category of improper input validation and authentication issues. The "CVE Reference Links Content Summary" mentions that the MD5 hash is easily manipulable, highlighting the **lack of integrity check** in the update process. CWE-494 CanPrecede CWE-79 (Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'))"

- **Confidence Score:**  
  - *Example:* Confidence: 0.95 (High confidence due to explicit mention in CVE reference and strong alignment with vulnerability details)

---
- **Analysis and Justification:**  
  - *Explanation:* "A secondary **weakness** is the use of HTTP, which is an insecure channel, for downloading updates. This maps to CWE-319 (Cleartext Transmission of Sensitive Information) because the update is transmitted in cleartext, making it vulnerable to interception. Although the description doesn't explicitly state that sensitive information is transmitted, the executable update itself is security-critical data. CWE-319 is a Base level CWE and its usage is ALLOWED."
  
  - *Relationship Analysis:* "CWE-319 is related to the broader issue of insecure communication. It has a ChildOf relationship with CWE-311 (Missing Encryption of Sensitive Data). The "CVE Reference Links Content Summary" confirms the insecure communication channel as a contributing factor to the vulnerability."

- **Confidence Score:**  
  - *Example:* Confidence: 0.75 (Medium confidence; while relevant, the primary issue is the lack of integrity check rather than cleartext transmission of sensitive information.)

---
- **Analysis and Justification:**  
  - *Explanation:* "The vulnerability also touches upon the lack of proper authentication and origin verification. This aligns with CWE-345 (Insufficient Verification of Data Authenticity), as the application fails to adequately verify the source and integrity of the downloaded update. The "CVE Reference Links Content Summary" mentions the lack of authentication as a key factor. However, CWE-345 is a Class level CWE, so it is used with review."
  
  - *Relationship Analysis:* "CWE-345 is a parent of CWE-347 (Improper Verification of Cryptographic Signature). The **lack of origin verification** contributes to the exploitation of this vulnerability. CWE-345 is related to CWE-494 because the missing integrity check is a form of insufficient data authenticity verification."

- **Confidence Score:**  
  - *Example:* Confidence: 0.60 (Low confidence; CWE-345 is a more general class and other CWEs more directly capture the specific weakness.)

# CWE Examples from Database


## Known Examples for CWE-311: Missing Encryption of Sensitive Data
### Observed Examples
- **CVE-2009-2272** [https://www.cve.org/CVERecord?id=CVE-2009-2272](https://www.cve.org/CVERecord?id=CVE-2009-2272): password and username stored in cleartext in a cookie
- **CVE-2009-1466** [https://www.cve.org/CVERecord?id=CVE-2009-1466](https://www.cve.org/CVERecord?id=CVE-2009-1466): password stored in cleartext in a file with insecure permissions
- **CVE-2009-0152** [https://www.cve.org/CVERecord?id=CVE-2009-0152](https://www.cve.org/CVERecord?id=CVE-2009-0152): chat program disables SSL in some circumstances even when the user says to use SSL.
- **CVE-2009-1603** [https://www.cve.org/CVERecord?id=CVE-2009-1603](https://www.cve.org/CVERecord?id=CVE-2009-1603): Chain: product uses an incorrect public exponent when generating an RSA key, which effectively disables the encryption
- **CVE-2009-0964** [https://www.cve.org/CVERecord?id=CVE-2009-0964](https://www.cve.org/CVERecord?id=CVE-2009-0964): storage of unencrypted passwords in a database
- **CVE-2008-6157** [https://www.cve.org/CVERecord?id=CVE-2008-6157](https://www.cve.org/CVERecord?id=CVE-2008-6157): storage of unencrypted passwords in a database
- **CVE-2008-6828** [https://www.cve.org/CVERecord?id=CVE-2008-6828](https://www.cve.org/CVERecord?id=CVE-2008-6828): product stores a password in cleartext in memory
- **CVE-2008-1567** [https://www.cve.org/CVERecord?id=CVE-2008-1567](https://www.cve.org/CVERecord?id=CVE-2008-1567): storage of a secret key in cleartext in a temporary file
- **CVE-2008-0174** [https://www.cve.org/CVERecord?id=CVE-2008-0174](https://www.cve.org/CVERecord?id=CVE-2008-0174): SCADA product uses HTTP Basic Authentication, which is not encrypted
- **CVE-2007-5778** [https://www.cve.org/CVERecord?id=CVE-2007-5778](https://www.cve.org/CVERecord?id=CVE-2007-5778): login credentials stored unencrypted in a registry key


# Relevant CWE Specifications

## CWE-311: Missing Encryption of Sensitive Data
**Abstraction:** Class
**Status:** Draft

### Description
The product does not encrypt sensitive or critical information before storage or transmission.

### Extended Description
The lack of proper data encryption passes up the guarantees of confidentiality, integrity, and accountability that properly implemented encryption conveys.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-693
ParentOf -> CWE-312
ParentOf -> CWE-319

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** CWE-311 is high-level with more precise children available. It is a level-1 Class (i.e., a child of a Pillar).
**Comments:** Consider children CWE-312: Cleartext Storage of Sensitive Information or CWE-319: Cleartext Transmission of Sensitive Information.
**Reasons:**
- Abstraction


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Requirements
- **Description:** Clearly specify which data or resources are valuable enough that they should be protected by encryption. Require that any transmission or storage of this data/resource should use well-vetted encryption algorithms.

**Mitigation 2:**
- **Phase:** Architecture and Design
- **Description:** 

Ensure that encryption is properly integrated into the system design, including but not necessarily limited to:


  - Encryption that is needed to store or transmit private data of the users of the system

  - Encryption that is needed to protect the system itself from unauthorized disclosure or tampering

Identify the separate needs and contexts for encryption:

  - One-way (i.e., only the user or recipient needs to have the key). This can be achieved using public key cryptography, or other techniques in which the encrypting party (i.e., the product) does not need to have access to a private key.

  - Two-way (i.e., the encryption can be automatically performed on behalf of a user, but the key must be available so that the plaintext can be automatically recoverable by that user). This requires storage of the private key in a format that is recoverable only by the user (or perhaps by the operating system) in a way that cannot be recovered by others.

Using threat modeling or other techniques, assume that data can be compromised through a separate vulnerability or weakness, and determine where encryption will be most effective. Ensure that data that should be private is not being inadvertently exposed using weaknesses such as insecure permissions (CWE-732). [REF-7]

**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

When there is a need to store or transmit sensitive data, use strong, up-to-date cryptographic algorithms to encrypt that data. Select a well-vetted algorithm that is currently considered to be strong by experts in the field, and use well-tested implementations. As with all cryptographic mechanisms, the source code should be available for analysis.


For example, US government systems require FIPS 140-2 certification.


Do not develop custom or private cryptographic algorithms. They will likely be exposed to attacks that are well-understood by cryptographers. Reverse engineering techniques are mature. If the algorithm can be compromised if attackers find out how it works, then it is especially weak.


Periodically ensure that the cryptography has not become obsolete. Some older algorithms, once thought to require a billion years of computing time, can now be broken in days or hours. This includes MD4, MD5, SHA1, DES, and other algorithms that were once regarded as strong. [REF-267]




### Additional Notes
**[Relationship]** There is an overlapping relationship between insecure storage of sensitive information (CWE-922) and missing encryption of sensitive information (CWE-311). Encryption is often used to prevent an attacker from reading the sensitive data. However, encryption does not prevent the attacker from erasing or overwriting the data.



### Observed Examples
- **CVE-2009-2272:** password and username stored in cleartext in a cookie
- **CVE-2009-1466:** password stored in cleartext in a file with insecure permissions
- **CVE-2009-0152:** chat program disables SSL in some circumstances even when the user says to use SSL.



## CWE-345: Insufficient Verification of Data Authenticity
**Abstraction:** Class
**Status:** Draft

### Description
The product does not sufficiently verify the origin or authenticity of data, in a way that causes it to accept invalid data.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-693
ParentOf -> CWE-1293
ParentOf -> CWE-346
ParentOf -> CWE-347
ParentOf -> CWE-348
ParentOf -> CWE-349
ParentOf -> CWE-351
ParentOf -> CWE-352
ParentOf -> CWE-353
ParentOf -> CWE-354
ParentOf -> CWE-360
ParentOf -> CWE-494
ParentOf -> CWE-616
ParentOf -> CWE-646
ParentOf -> CWE-649
ParentOf -> CWE-924

### Mapping Guidance
**Usage:** Discouraged
**Rationale:** This CWE entry is a level-1 Class (i.e., a child of a Pillar). It might have lower-level children that would be more appropriate
**Comments:** Examine children of this entry to see if there is a better fit
**Reasons:**
- Abstraction



### Additional Notes
**[Relationship]** "origin validation" could fall under this.

**[Maintenance]** The specific ways in which the origin is not properly identified should be laid out as separate weaknesses. In some sense, this is more like a category.



### Observed Examples
- **CVE-2022-30260:** Distributed Control System (DCS) does not sign firmware images and only relies on insecure checksums for integrity checks
- **CVE-2022-30267:** Distributed Control System (DCS) does not sign firmware images and only relies on insecure checksums for integrity checks
- **CVE-2022-30272:** Remote Terminal Unit (RTU) does not use signatures for firmware images and relies on insecure checksums



## CWE-319: Cleartext Transmission of Sensitive Information
**Abstraction:** Base
**Status:** Draft

### Description
The product transmits sensitive or security-critical data in cleartext in a communication channel that can be sniffed by unauthorized actors.

### Extended Description


Many communication channels can be "sniffed" (monitored) by adversaries during data transmission. For example, in networking, packets can traverse many intermediary nodes from the source to the destination, whether across the internet, an internal network, the cloud, etc. Some actors might have privileged access to a network interface or any link along the channel, such as a router, but they might not be authorized to collect the underlying data. As a result, network traffic could be sniffed by adversaries, spilling security-critical data.


Applicable communication channels are not limited to software products. Applicable channels include hardware-specific technologies such as internal hardware networks and external debug channels, supporting remote JTAG debugging. When mitigations are not applied to combat adversaries within the product's threat model, this weakness significantly lowers the difficulty of exploitation by such adversaries.


When full communications are recorded or logged, such as with a packet dump, an adversary could attempt to obtain the dump long after the transmission has occurred and try to "sniff" the cleartext from the recorded communications in the dump itself. Even if the information is encoded in a way that is not human-readable, certain techniques could determine which encoding is being used, then decode the information. 


### Alternative Terms
None

### Relationships
ChildOf -> CWE-311
ChildOf -> CWE-311
ParentOf -> CWE-5
ParentOf -> CWE-614

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Description:** Before transmitting, encrypt the data using reliable, confidentiality-protecting cryptographic protocols.

**Mitigation 2:**
- **Phase:** Implementation
- **Description:** When using web applications with SSL, use SSL for the entire session from login to logout, not just for the initial login page.

**Mitigation 3:**
- **Phase:** Implementation
- **Description:** When designing hardware platforms, ensure that approved encryption algorithms (such as those recommended by NIST) protect paths from security critical data to trusted user applications.



### Additional Notes
**[Maintenance]** The Taxonomy_Mappings to ISA/IEC 62443 were added in CWE 4.10, but they are still under review and might change in future CWE versions. These draft mappings were performed by members of the "Mapping CWE to 62443" subgroup of the CWE-CAPEC ICS/OT Special Interest Group (SIG), and their work is incomplete as of CWE 4.10. The mappings are included to facilitate discussion and review by the broader ICS/OT community, and they are likely to change in future CWE versions.



### Observed Examples
- **CVE-2022-29519:** Programmable Logic Controller (PLC) sends sensitive information in plaintext, including passwords and session tokens.
- **CVE-2022-30312:** Building Controller uses a protocol that transmits authentication credentials in plaintext.
- **CVE-2022-31204:** Programmable Logic Controller (PLC) sends password in plaintext.



## CWE-494: Download of Code Without Integrity Check
**Abstraction:** Base
**Status:** Draft

### Description
The product downloads source code or an executable from a remote location and executes the code without sufficiently verifying the origin and integrity of the code.

### Extended Description
An attacker can execute malicious code by compromising the host server, performing DNS spoofing, or modifying the code in transit.

### Alternative Terms
None

### Relationships
ChildOf -> CWE-345
ChildOf -> CWE-669
ChildOf -> CWE-669
CanFollow -> CWE-79

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Implementation
- **Description:** Perform proper forward and reverse DNS lookups to detect DNS spoofing.

**Mitigation 2:**
- **Phase:** Architecture and Design, Operation
- **Description:** 

Encrypt the code with a reliable encryption scheme before transmitting.


This will only be a partial solution, since it will not detect DNS spoofing and it will not prevent your code from being modified on the hosting site.


**Mitigation 3:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


Speficially, it may be helpful to use tools or frameworks to perform integrity checking on the transmitted code.


  - When providing the code that is to be downloaded, such as for automatic updates of the software, then use cryptographic signatures for the code and modify the download clients to verify the signatures. Ensure that the implementation does not contain CWE-295, CWE-320, CWE-347, and related weaknesses.

  - Use code signing technologies such as Authenticode. See references [REF-454] [REF-455] [REF-456].





### Additional Notes
**[Research Gap]** This is critical for mobile code, but it is likely to become more and more common as developers continue to adopt automated, network-based product distributions and upgrades. Software-as-a-Service (SaaS) might introduce additional subtleties. Common exploitation scenarios may include ad server compromises and bad upgrades.



### Observed Examples
- **CVE-2019-9534:** Satellite phone does not validate its firmware image.
- **CVE-2021-22909:** Chain: router's firmware update procedure uses curl with "-k" (insecure) option that disables certificate validation (CWE-295), allowing adversary-in-the-middle (AITM) compromise with a malicious firmware image (CWE-494).
- **CVE-2008-3438:** OS does not verify authenticity of its own updates.



## CWE-347: Improper Verification of Cryptographic Signature
**Abstraction:** Base
**Status:** Draft

### Description
The product does not verify, or incorrectly verifies, the cryptographic signature for data.

### Extended Description
Not provided

### Alternative Terms
None

### Relationships
ChildOf -> CWE-345
ChildOf -> CWE-345

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use




### Observed Examples
- **CVE-2002-1796:** Does not properly verify signatures for "trusted" entities.
- **CVE-2005-2181:** Insufficient verification allows spoofing.
- **CVE-2005-2182:** Insufficient verification allows spoofing.



## CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
**Abstraction:** Base
**Status:** Stable

### Description
The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.

### Extended Description


Cross-site scripting (XSS) vulnerabilities occur when:


  1. Untrusted data enters a web application, typically from a web request.

  1. The web application dynamically generates a web page that contains this untrusted data.

  1. During page generation, the application does not prevent the data from containing content that is executable by a web browser, such as JavaScript, HTML tags, HTML attributes, mouse events, Flash, ActiveX, etc.

  1. A victim visits the generated web page through a web browser, which contains malicious script that was injected using the untrusted data.

  1. Since the script comes from a web page that was sent by the web server, the victim's web browser executes the malicious script in the context of the web server's domain.

  1. This effectively violates the intention of the web browser's same-origin policy, which states that scripts in one domain should not be able to access resources or run code in a different domain.

There are three main kinds of XSS:

  -  **Type 1: Reflected XSS (or Non-Persistent)**  - The server reads data directly from the HTTP request and reflects it back in the HTTP response. Reflected XSS exploits occur when an attacker causes a victim to supply dangerous content to a vulnerable web application, which is then reflected back to the victim and executed by the web browser. The most common mechanism for delivering malicious content is to include it as a parameter in a URL that is posted publicly or e-mailed directly to the victim. URLs constructed in this manner constitute the core of many phishing schemes, whereby an attacker convinces a victim to visit a URL that refers to a vulnerable site. After the site reflects the attacker's content back to the victim, the content is executed by the victim's browser.

  -  **Type 2: Stored XSS (or Persistent)**  - The application stores dangerous data in a database, message forum, visitor log, or other trusted data store. At a later time, the dangerous data is subsequently read back into the application and included in dynamic content. From an attacker's perspective, the optimal place to inject malicious content is in an area that is displayed to either many users or particularly interesting users. Interesting users typically have elevated privileges in the application or interact with sensitive data that is valuable to the attacker. If one of these users executes malicious content, the attacker may be able to perform privileged operations on behalf of the user or gain access to sensitive data belonging to the user. For example, the attacker might inject XSS into a log message, which might not be handled properly when an administrator views the logs. 

  -  **Type 0: DOM-Based XSS**  - In DOM-based XSS, the client performs the injection of XSS into the page; in the other types, the server performs the injection. DOM-based XSS generally involves server-controlled, trusted script that is sent to the client, such as Javascript that performs sanity checks on a form before the user submits it. If the server-supplied script processes user-supplied data and then injects it back into the web page (such as with dynamic HTML), then DOM-based XSS is possible. 

Once the malicious script is injected, the attacker can perform a variety of malicious activities. The attacker could transfer private information, such as cookies that may include session information, from the victim's machine to the attacker. The attacker could send malicious requests to a web site on behalf of the victim, which could be especially dangerous to the site if the victim has administrator privileges to manage that site. Phishing attacks could be used to emulate trusted web sites and trick the victim into entering a password, allowing the attacker to compromise the victim's account on that web site. Finally, the script could exploit a vulnerability in the web browser itself possibly taking over the victim's machine, sometimes referred to as "drive-by hacking."

In many cases, the attack can be launched without the victim even being aware of it. Even with careful users, attackers frequently use a variety of methods to encode the malicious portion of the attack, such as URL encoding or Unicode, so the request looks less suspicious.


### Alternative Terms
XSS: A common abbreviation for Cross-Site Scripting.
HTML Injection: Used as a synonym of stored (Type 2) XSS.
CSS: In the early years after initial discovery of XSS, "CSS" was a commonly-used acronym. However, this would cause confusion with "Cascading Style Sheets," so usage of this acronym has declined significantly.

### Relationships
ChildOf -> CWE-74
ChildOf -> CWE-74
CanPrecede -> CWE-494
PeerOf -> CWE-352
CanFollow -> CWE-113
CanFollow -> CWE-184
ParentOf -> CWE-80
ParentOf -> CWE-81
ParentOf -> CWE-83
ParentOf -> CWE-84
ParentOf -> CWE-85
ParentOf -> CWE-86
ParentOf -> CWE-87

### Mapping Guidance
**Usage:** Allowed
**Rationale:** This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.
**Comments:** Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.
**Reasons:**
- Acceptable-Use


### Potential Mitigations
**Mitigation 1:**
- **Phase:** Architecture and Design
- **Strategy:** Libraries or Frameworks
- **Description:** 

Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.


Examples of libraries and frameworks that make it easier to generate properly encoded output include Microsoft's Anti-XSS library, the OWASP ESAPI Encoding module, and Apache Wicket.


**Mitigation 2:**
- **Phase:** Implementation, Architecture and Design
- **Description:** 

Understand the context in which your data will be used and the encoding that will be expected. This is especially important when transmitting data between different components, or when generating outputs that can contain multiple encodings at the same time, such as web pages or multi-part mail messages. Study all expected communication protocols and data representations to determine the required encoding strategies.


For any data that will be output to another web page, especially any data that was received from external inputs, use the appropriate encoding on all non-alphanumeric characters.


Parts of the same output document may require different encodings, which will vary depending on whether the output is in the:


  - HTML body

  - Element attributes (such as src="XYZ")

  - URIs

  - JavaScript sections

  - Cascading Style Sheets and style property

etc. Note that HTML Entity Encoding is only appropriate for the HTML body.

Consult the XSS Prevention Cheat Sheet [REF-724] for more details on the types of encoding and escaping that are needed.


**Mitigation 3:**
- **Phase:** Architecture and Design, Implementation
- **Effectiveness:** Limited
- **Strategy:** Attack Surface Reduction
- **Description:** Understand all the potential areas where untrusted inputs can enter your software: parameters or arguments, cookies, anything read from the network, environment variables, reverse DNS lookups, query results, request headers, URL components, e-mail, files, filenames, databases, and any external systems that provide data to the application. Remember that such inputs may be obtained indirectly through API calls.



### Additional Notes
**[Relationship]** 

There can be a close relationship between XSS and CSRF (CWE-352). An attacker might use CSRF in order to trick the victim into submitting requests to the server in which the requests contain an XSS payload. A well-known example of this was the Samy worm on MySpace [REF-956]. The worm used XSS to insert malicious HTML sequences into a user's profile and add the attacker as a MySpace friend. MySpace friends of that victim would then execute the payload to modify their own profiles, causing the worm to propagate exponentially. Since the victims did not intentionally insert the malicious script themselves, CSRF was a root cause.


**[Applicable Platform]** 

XSS flaws are very common in web applications, since they require a great deal of developer discipline to avoid them.




### Observed Examples
- **CVE-2021-25926:** Python Library Manager did not sufficiently neutralize a user-supplied search term, allowing reflected XSS.
- **CVE-2021-25963:** Python-based e-commerce platform did not escape returned content on error pages, allowing for reflected Cross-Site Scripting attacks.
- **CVE-2021-1879:** Universal XSS in mobile operating system, as exploited in the wild per CISA KEV.

